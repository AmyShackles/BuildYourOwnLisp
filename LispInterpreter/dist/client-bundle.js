/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./client.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./client.ts":
/*!*******************!*\
  !*** ./client.ts ***!
  \*******************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

exports.__esModule = true;
var attach = __webpack_require__(/*! xterm/lib/addons/attach/attach */ "./node_modules/xterm/lib/addons/attach/attach.js");
var fit = __webpack_require__(/*! xterm/lib/addons/fit/fit */ "./node_modules/xterm/lib/addons/fit/fit.js");
var fullscreen = __webpack_require__(/*! xterm/lib/addons/fullscreen/fullscreen */ "./node_modules/xterm/lib/addons/fullscreen/fullscreen.js");
var search = __webpack_require__(/*! xterm/lib/addons/search/search */ "./node_modules/xterm/lib/addons/search/search.js");
var webLinks = __webpack_require__(/*! xterm/lib/addons/webLinks/webLinks */ "./node_modules/xterm/lib/addons/webLinks/webLinks.js");
var winptyCompat = __webpack_require__(/*! xterm/lib/addons/winptyCompat/winptyCompat */ "./node_modules/xterm/lib/addons/winptyCompat/winptyCompat.js");
var Terminal_js_1 = __webpack_require__(/*! xterm/lib/public/Terminal.js */ "./node_modules/xterm/lib/public/Terminal.js");
Terminal_js_1.Terminal.applyAddon(attach);
Terminal_js_1.Terminal.applyAddon(fit);
Terminal_js_1.Terminal.applyAddon(fullscreen);
Terminal_js_1.Terminal.applyAddon(search);
Terminal_js_1.Terminal.applyAddon(webLinks);
Terminal_js_1.Terminal.applyAddon(winptyCompat);
var term;
var protocol;
var socketURL;
var socket;
var pid;
var terminalContainer = document.getElementById("terminal-container");
var actionElements = {
    findNext: document.querySelector("#find-next"),
    findPrevious: document.querySelector("#find-previous")
};
var paddingElement = document.getElementById("padding");
function setPadding() {
    term.element.style.padding =
        parseInt(paddingElement.value, 10).toString() + "px";
    term.fit();
}
createTerminal();
var disposeRecreateButtonHandler = function () {
    if (term) {
        term.dispose();
        term = null;
        window.term = null;
        socket = null;
        document.getElementById("dispose").innerHTML = "Recreate Terminal";
    }
    else {
        createTerminal();
        document.getElementById("dispose").innerHTML = "Dispose terminal";
    }
};
document.getElementById("dispose").addEventListener("click", disposeRecreateButtonHandler);
function createTerminal() {
    while (terminalContainer.children.length) {
        terminalContainer.removeChild(terminalContainer.children[0]);
    }
    term = new Terminal_js_1.Terminal({});
    window.term = term;
    term.on("resize", function (size) {
        if (!pid) {
            return;
        }
        var cols = size.cols;
        var rows = size.rows;
        var url = "/terminals/" + pid + "/size?cols=" + cols + "&rows=" + rows;
        fetch(url, { method: "POST" });
    });
    protocol = location.protocol === "https:" ? "wss://" : "ws://";
    socketURL = protocol + location.hostname +
        (location.port ? ":" + location.port : "") + "/terminals/";
    term.open(terminalContainer);
    term.winptyCompatInit();
    term.webLinksInit();
    term.fit();
    term.focus();
    addDomListener(paddingElement, "change", setPadding);
    addDomListener(actionElements.findNext, "keypress", function (e) {
        if (e.key === "Enter") {
            e.preventDefault();
            var searchOptions = {
                regex: document.getElementById("regex").checked,
                wholeWord: document.getElementById("whole-word").checked,
                caseSensitive: document.getElementById("case-sensitive")
                    .checked
            };
            term.findNext(actionElements.findNext.value, searchOptions);
        }
    });
    addDomListener(actionElements.findPrevious, "keypress", function (e) {
        if (e.key === "Enter") {
            e.preventDefault();
            var searchOptions = {
                regex: document.getElementById("regex").checked,
                wholeWord: document.getElementById("whole-word").checked,
                caseSensitive: document.getElementById("case-sensitive")
                    .checked
            };
            term.findPrevious(actionElements.findPrevious.value, searchOptions);
        }
    });
    setTimeout(function () {
        initOptions(term);
        paddingElement.value = "0";
        updateTerminalSize();
        fetch("/terminals?cols=" + term.cols + "&rows=" + term.rows, {
            method: "POST"
        }).then(function (res) {
            res.text().then(function (processId) {
                pid = processId;
                socketURL += processId;
                socket = new WebSocket(socketURL);
                socket.onopen = runRealTerminal;
                socket.onclose = runFakeTerminal;
                socket.onerror = runFakeTerminal;
            });
        });
    }, 0);
}
function runRealTerminal() {
    term.attach(socket);
    term._initialized = true;
}
function runFakeTerminal() {
    if (term._initialized) {
        return;
    }
    term._initialized = true;
    term.prompt = function () { term.write("\r\n$ "); };
    term.writeln("Welcome to xterm.js");
    term.writeln("This is a local terminal emulation, without a real terminal in the back-end.");
    term.writeln("Type some keys and commands to play around.");
    term.writeln("");
    term.prompt();
    term._core.register(term.addDisposableListener("key", function (key, ev) {
        var printable = !ev.altKey && !ev.altGraphKey && !ev.ctrlKey && !ev.metaKey;
        if (ev.keyCode === 13) {
            term.prompt();
        }
        else if (ev.keyCode === 8) {
            // Do not delete prompt
            if (term.x > 2) {
                term.write("\b \b");
            }
        }
        else if (printable) {
            term.write(key);
        }
    }));
    term._core.register(term.addDisposableListener("paste", function (data, ev) { term.write(data); }));
}
function initOptions(term) {
    var blacklistedOptions = [
        // Internal only options
        "cancelEvents", "convertEol", "debug", "handler", "screenKeys", "termName",
        "useFlowControl", "theme"
    ];
    var stringOptions = {
        bellSound: null,
        bellStype: ["none", "sound"],
        cursorStyle: ["block", "underline", "bar"],
        experimentalCharAtlas: ["none", "static", "dynamic"],
        fontFamily: null,
        fontWeight: [
            "normal", "bold", "100", "200", "300", "400", "500", "600", "700", "800",
            "900"
        ],
        fontWeightBold: [
            "normal", "bold", "100", "200", "300", "400", "500", "600", "700", "800",
            "900"
        ],
        rendererType: ["dom", "canvas"],
        experimentalBufferLineIml: ["JsArray", "TypedArray"]
    };
    var options = Object.keys(term._core.options);
    var booleanOptions = [];
    var numberOptions = [];
    options.filter(function (o) { return blacklistedOptions.indexOf(o) === -1; }).forEach(function (o) {
        switch (typeof term.getOption(o)) {
            case "boolean":
                booleanOptions.push(o);
                break;
            case "number":
                numberOptions.push(o);
                break;
            default:
                if (Object.keys(stringOptions).indexOf(o) === -1) {
                    console.warn("Unrecognized option: '" + o + "'");
                }
        }
    });
    var html = "";
    html += '<div class="option-group">';
    booleanOptions.forEach(function (o) {
        html += "<div class=\"option\"><label><input id=\"opt-" + o + "\" type=\"checkbox\" " + (term.getOption(o) ? "checked" : "") + "/> " + o + "</label></div>";
    });
    html += '</div><div class="optin-group">';
    numberOptions.forEach(function (o) {
        html += "<div class=\"option\"><label>" + o + " <input id=\"opt-" + o + "\" type=\"number\" value=\"" + term.getOption(o) + "\"/></label></div>";
    });
    html += '</div><div class="option-group">';
    Object.keys(stringOptions).forEach(function (o) {
        if (stringOptions[o]) {
            html += "<div class=\"option\"><label>" + o + " <select id=\"opt-" + o + "\">" + stringOptions[o]
                .map(function (v) { return "<option " + (term.getOption(o) === v ? "selected" : "") + ">" + v + "</option>"; })
                .join("") + "</select></label></div>";
        }
        else {
            html += "<div class=\"option\"><label>" + o + " <input id=\"opt-" + o + "\" type=\"text\" value=\"" + term.getOption(o) + "\"/></label></div>";
        }
    });
    html += "</div>";
    var container = document.getElementById("options-container");
    container.innerHTML = html;
    // Attach listeners
    booleanOptions.forEach(function (o) {
        var input = document.getElementById("opt-" + o);
        addDomListener(input, "change", function () {
            console.log("change", o, input.checked);
            term.setOption(o, input.checked);
        });
    });
    numberOptions.forEach(function (o) {
        var input = document.getElementById("opt-" + o);
        addDomListener(input, "change", function () {
            console.log("change", o, input.value);
            if (o === "cols" || o === "rows") {
                updateTerminalSize();
            }
            else {
                term.setOption(o, parseInt(input.value, 10));
            }
        });
    });
    Object.keys(stringOptions).forEach(function (o) {
        var input = document.getElementById("opt-" + o);
        addDomListener(input, "change", function () {
            console.log("change", o, input.value);
            term.setOption(o, input.value);
        });
    });
}
function addDomListener(element, type, handler) {
    element.addEventListener(type, handler);
    term._core.register({ dispose: function () { return element.removeEventListener(type, handler); } });
}
function updateTerminalSize() {
    var cols = parseInt(document.getElementById("opt-cols").value, 10);
    var rows = parseInt(document.getElementById("opt-rows").value, 10);
    var width = (cols * term._core.renderer.dimensions.actualCellWidth +
        term._core.viewport.scrollBarWidth)
        .toString() +
        "px";
    var height = (rows * term._core.renderer.dimensions.actualCellHeight).toString() +
        "px";
    terminalContainer.style.width = width;
    terminalContainer.style.height = height;
    term.fit();
}


/***/ }),

/***/ "./node_modules/xterm/lib/AccessibilityManager.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/AccessibilityManager.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Strings = __webpack_require__(/*! ./Strings */ "./node_modules/xterm/lib/Strings.js");
var Platform_1 = __webpack_require__(/*! ./core/Platform */ "./node_modules/xterm/lib/core/Platform.js");
var RenderDebouncer_1 = __webpack_require__(/*! ./ui/RenderDebouncer */ "./node_modules/xterm/lib/ui/RenderDebouncer.js");
var Lifecycle_1 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var Lifecycle_2 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var MAX_ROWS_TO_READ = 20;
var AccessibilityManager = (function (_super) {
    __extends(AccessibilityManager, _super);
    function AccessibilityManager(_terminal) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._liveRegionLineCount = 0;
        _this._charsToConsume = [];
        _this._accessibilityTreeRoot = document.createElement('div');
        _this._accessibilityTreeRoot.classList.add('xterm-accessibility');
        _this._rowContainer = document.createElement('div');
        _this._rowContainer.classList.add('xterm-accessibility-tree');
        _this._rowElements = [];
        for (var i = 0; i < _this._terminal.rows; i++) {
            _this._rowElements[i] = _this._createAccessibilityTreeNode();
            _this._rowContainer.appendChild(_this._rowElements[i]);
        }
        _this._topBoundaryFocusListener = function (e) { return _this._onBoundaryFocus(e, 0); };
        _this._bottomBoundaryFocusListener = function (e) { return _this._onBoundaryFocus(e, 1); };
        _this._rowElements[0].addEventListener('focus', _this._topBoundaryFocusListener);
        _this._rowElements[_this._rowElements.length - 1].addEventListener('focus', _this._bottomBoundaryFocusListener);
        _this._refreshRowsDimensions();
        _this._accessibilityTreeRoot.appendChild(_this._rowContainer);
        _this._renderRowsDebouncer = new RenderDebouncer_1.RenderDebouncer(_this._terminal, _this._renderRows.bind(_this));
        _this._refreshRows();
        _this._liveRegion = document.createElement('div');
        _this._liveRegion.classList.add('live-region');
        _this._liveRegion.setAttribute('aria-live', 'assertive');
        _this._accessibilityTreeRoot.appendChild(_this._liveRegion);
        _this._terminal.element.insertAdjacentElement('afterbegin', _this._accessibilityTreeRoot);
        _this.register(_this._renderRowsDebouncer);
        _this.register(_this._terminal.addDisposableListener('resize', function (data) { return _this._onResize(data.rows); }));
        _this.register(_this._terminal.addDisposableListener('refresh', function (data) { return _this._refreshRows(data.start, data.end); }));
        _this.register(_this._terminal.addDisposableListener('scroll', function (data) { return _this._refreshRows(); }));
        _this.register(_this._terminal.addDisposableListener('a11y.char', function (char) { return _this._onChar(char); }));
        _this.register(_this._terminal.addDisposableListener('linefeed', function () { return _this._onChar('\n'); }));
        _this.register(_this._terminal.addDisposableListener('a11y.tab', function (spaceCount) { return _this._onTab(spaceCount); }));
        _this.register(_this._terminal.addDisposableListener('key', function (keyChar) { return _this._onKey(keyChar); }));
        _this.register(_this._terminal.addDisposableListener('blur', function () { return _this._clearLiveRegion(); }));
        _this.register(_this._terminal.addDisposableListener('dprchange', function () { return _this._refreshRowsDimensions(); }));
        _this.register(_this._terminal.renderer.addDisposableListener('resize', function () { return _this._refreshRowsDimensions(); }));
        _this.register(Lifecycle_1.addDisposableDomListener(window, 'resize', function () { return _this._refreshRowsDimensions(); }));
        return _this;
    }
    AccessibilityManager.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._terminal.element.removeChild(this._accessibilityTreeRoot);
        this._rowElements.length = 0;
    };
    AccessibilityManager.prototype._onBoundaryFocus = function (e, position) {
        var boundaryElement = e.target;
        var beforeBoundaryElement = this._rowElements[position === 0 ? 1 : this._rowElements.length - 2];
        var posInSet = boundaryElement.getAttribute('aria-posinset');
        var lastRowPos = position === 0 ? '1' : "" + this._terminal.buffer.lines.length;
        if (posInSet === lastRowPos) {
            return;
        }
        if (e.relatedTarget !== beforeBoundaryElement) {
            return;
        }
        var topBoundaryElement;
        var bottomBoundaryElement;
        if (position === 0) {
            topBoundaryElement = boundaryElement;
            bottomBoundaryElement = this._rowElements.pop();
            this._rowContainer.removeChild(bottomBoundaryElement);
        }
        else {
            topBoundaryElement = this._rowElements.shift();
            bottomBoundaryElement = boundaryElement;
            this._rowContainer.removeChild(topBoundaryElement);
        }
        topBoundaryElement.removeEventListener('focus', this._topBoundaryFocusListener);
        bottomBoundaryElement.removeEventListener('focus', this._bottomBoundaryFocusListener);
        if (position === 0) {
            var newElement = this._createAccessibilityTreeNode();
            this._rowElements.unshift(newElement);
            this._rowContainer.insertAdjacentElement('afterbegin', newElement);
        }
        else {
            var newElement = this._createAccessibilityTreeNode();
            this._rowElements.push(newElement);
            this._rowContainer.appendChild(newElement);
        }
        this._rowElements[0].addEventListener('focus', this._topBoundaryFocusListener);
        this._rowElements[this._rowElements.length - 1].addEventListener('focus', this._bottomBoundaryFocusListener);
        this._terminal.scrollLines(position === 0 ? -1 : 1);
        this._rowElements[position === 0 ? 1 : this._rowElements.length - 2].focus();
        e.preventDefault();
        e.stopImmediatePropagation();
    };
    AccessibilityManager.prototype._onResize = function (rows) {
        this._rowElements[this._rowElements.length - 1].removeEventListener('focus', this._bottomBoundaryFocusListener);
        for (var i = this._rowContainer.children.length; i < this._terminal.rows; i++) {
            this._rowElements[i] = this._createAccessibilityTreeNode();
            this._rowContainer.appendChild(this._rowElements[i]);
        }
        while (this._rowElements.length > rows) {
            this._rowContainer.removeChild(this._rowElements.pop());
        }
        this._rowElements[this._rowElements.length - 1].addEventListener('focus', this._bottomBoundaryFocusListener);
        this._refreshRowsDimensions();
    };
    AccessibilityManager.prototype._createAccessibilityTreeNode = function () {
        var element = document.createElement('div');
        element.setAttribute('role', 'listitem');
        element.tabIndex = -1;
        this._refreshRowDimensions(element);
        return element;
    };
    AccessibilityManager.prototype._onTab = function (spaceCount) {
        for (var i = 0; i < spaceCount; i++) {
            this._onChar(' ');
        }
    };
    AccessibilityManager.prototype._onChar = function (char) {
        var _this = this;
        if (this._liveRegionLineCount < MAX_ROWS_TO_READ + 1) {
            if (this._charsToConsume.length > 0) {
                var shiftedChar = this._charsToConsume.shift();
                if (shiftedChar !== char) {
                    this._announceCharacter(char);
                }
            }
            else {
                this._announceCharacter(char);
            }
            if (char === '\n') {
                this._liveRegionLineCount++;
                if (this._liveRegionLineCount === MAX_ROWS_TO_READ + 1) {
                    this._liveRegion.textContent += Strings.tooMuchOutput;
                }
            }
            if (Platform_1.isMac) {
                if (this._liveRegion.textContent && this._liveRegion.textContent.length > 0 && !this._liveRegion.parentNode) {
                    setTimeout(function () {
                        _this._accessibilityTreeRoot.appendChild(_this._liveRegion);
                    }, 0);
                }
            }
        }
    };
    AccessibilityManager.prototype._clearLiveRegion = function () {
        this._liveRegion.textContent = '';
        this._liveRegionLineCount = 0;
        if (Platform_1.isMac) {
            if (this._liveRegion.parentNode) {
                this._accessibilityTreeRoot.removeChild(this._liveRegion);
            }
        }
    };
    AccessibilityManager.prototype._onKey = function (keyChar) {
        this._clearLiveRegion();
        this._charsToConsume.push(keyChar);
    };
    AccessibilityManager.prototype._refreshRows = function (start, end) {
        this._renderRowsDebouncer.refresh(start, end);
    };
    AccessibilityManager.prototype._renderRows = function (start, end) {
        var buffer = this._terminal.buffer;
        var setSize = buffer.lines.length.toString();
        for (var i = start; i <= end; i++) {
            var lineData = buffer.translateBufferLineToString(buffer.ydisp + i, true);
            var posInSet = (buffer.ydisp + i + 1).toString();
            var element = this._rowElements[i];
            element.textContent = lineData.length === 0 ? Strings.blankLine : lineData;
            element.setAttribute('aria-posinset', posInSet);
            element.setAttribute('aria-setsize', setSize);
        }
    };
    AccessibilityManager.prototype._refreshRowsDimensions = function () {
        if (!this._terminal.renderer.dimensions.actualCellHeight) {
            return;
        }
        if (this._rowElements.length !== this._terminal.rows) {
            this._onResize(this._terminal.rows);
        }
        for (var i = 0; i < this._terminal.rows; i++) {
            this._refreshRowDimensions(this._rowElements[i]);
        }
    };
    AccessibilityManager.prototype._refreshRowDimensions = function (element) {
        element.style.height = this._terminal.renderer.dimensions.actualCellHeight + "px";
    };
    AccessibilityManager.prototype._announceCharacter = function (char) {
        if (char === ' ') {
            this._liveRegion.innerHTML += '&nbsp;';
        }
        else {
            this._liveRegion.textContent += char;
        }
    };
    return AccessibilityManager;
}(Lifecycle_2.Disposable));
exports.AccessibilityManager = AccessibilityManager;
//# sourceMappingURL=AccessibilityManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Buffer.js":
/*!******************************************!*\
  !*** ./node_modules/xterm/lib/Buffer.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var CircularList_1 = __webpack_require__(/*! ./common/CircularList */ "./node_modules/xterm/lib/common/CircularList.js");
var EventEmitter_1 = __webpack_require__(/*! ./common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var BufferLine_1 = __webpack_require__(/*! ./BufferLine */ "./node_modules/xterm/lib/BufferLine.js");
var Types_1 = __webpack_require__(/*! ./renderer/atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
exports.DEFAULT_ATTR = (0 << 18) | (Types_1.DEFAULT_COLOR << 9) | (256 << 0);
exports.CHAR_DATA_ATTR_INDEX = 0;
exports.CHAR_DATA_CHAR_INDEX = 1;
exports.CHAR_DATA_WIDTH_INDEX = 2;
exports.CHAR_DATA_CODE_INDEX = 3;
exports.MAX_BUFFER_SIZE = 4294967295;
exports.NULL_CELL_CHAR = ' ';
exports.NULL_CELL_WIDTH = 1;
exports.NULL_CELL_CODE = 32;
var Buffer = (function () {
    function Buffer(_terminal, _hasScrollback) {
        this._terminal = _terminal;
        this._hasScrollback = _hasScrollback;
        this.markers = [];
        this.clear();
    }
    Buffer.prototype.setBufferLineFactory = function (type) {
        if (type === 'JsArray') {
            if (this._bufferLineConstructor !== BufferLine_1.BufferLineJSArray) {
                this._bufferLineConstructor = BufferLine_1.BufferLineJSArray;
                this._recreateLines();
            }
        }
        else {
            if (this._bufferLineConstructor !== BufferLine_1.BufferLine) {
                this._bufferLineConstructor = BufferLine_1.BufferLine;
                this._recreateLines();
            }
        }
    };
    Buffer.prototype._recreateLines = function () {
        if (!this.lines)
            return;
        for (var i = 0; i < this.lines.length; ++i) {
            var oldLine = this.lines.get(i);
            var newLine = new this._bufferLineConstructor(oldLine.length);
            for (var j = 0; j < oldLine.length; ++j) {
                newLine.set(j, oldLine.get(j));
            }
            this.lines.set(i, newLine);
        }
    };
    Buffer.prototype.getBlankLine = function (attr, isWrapped) {
        var fillCharData = [attr, exports.NULL_CELL_CHAR, exports.NULL_CELL_WIDTH, exports.NULL_CELL_CODE];
        return new this._bufferLineConstructor(this._terminal.cols, fillCharData, isWrapped);
    };
    Object.defineProperty(Buffer.prototype, "hasScrollback", {
        get: function () {
            return this._hasScrollback && this.lines.maxLength > this._terminal.rows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Buffer.prototype, "isCursorInViewport", {
        get: function () {
            var absoluteY = this.ybase + this.y;
            var relativeY = absoluteY - this.ydisp;
            return (relativeY >= 0 && relativeY < this._terminal.rows);
        },
        enumerable: true,
        configurable: true
    });
    Buffer.prototype._getCorrectBufferLength = function (rows) {
        if (!this._hasScrollback) {
            return rows;
        }
        var correctBufferLength = rows + this._terminal.options.scrollback;
        return correctBufferLength > exports.MAX_BUFFER_SIZE ? exports.MAX_BUFFER_SIZE : correctBufferLength;
    };
    Buffer.prototype.fillViewportRows = function (fillAttr) {
        if (this.lines.length === 0) {
            if (fillAttr === undefined) {
                fillAttr = exports.DEFAULT_ATTR;
            }
            var i = this._terminal.rows;
            while (i--) {
                this.lines.push(this.getBlankLine(fillAttr));
            }
        }
    };
    Buffer.prototype.clear = function () {
        this.setBufferLineFactory(this._terminal.options.experimentalBufferLineImpl);
        this.ydisp = 0;
        this.ybase = 0;
        this.y = 0;
        this.x = 0;
        this.lines = new CircularList_1.CircularList(this._getCorrectBufferLength(this._terminal.rows));
        this.scrollTop = 0;
        this.scrollBottom = this._terminal.rows - 1;
        this.setupTabStops();
    };
    Buffer.prototype.resize = function (newCols, newRows) {
        var newMaxLength = this._getCorrectBufferLength(newRows);
        if (newMaxLength > this.lines.maxLength) {
            this.lines.maxLength = newMaxLength;
        }
        if (this.lines.length > 0) {
            if (this._terminal.cols < newCols) {
                var ch = [exports.DEFAULT_ATTR, exports.NULL_CELL_CHAR, exports.NULL_CELL_WIDTH, exports.NULL_CELL_CODE];
                for (var i = 0; i < this.lines.length; i++) {
                    this.lines.get(i).resize(newCols, ch);
                }
            }
            var addToY = 0;
            if (this._terminal.rows < newRows) {
                for (var y = this._terminal.rows; y < newRows; y++) {
                    if (this.lines.length < newRows + this.ybase) {
                        if (this.ybase > 0 && this.lines.length <= this.ybase + this.y + addToY + 1) {
                            this.ybase--;
                            addToY++;
                            if (this.ydisp > 0) {
                                this.ydisp--;
                            }
                        }
                        else {
                            var fillCharData = [exports.DEFAULT_ATTR, exports.NULL_CELL_CHAR, exports.NULL_CELL_WIDTH, exports.NULL_CELL_CODE];
                            this.lines.push(new this._bufferLineConstructor(newCols, fillCharData));
                        }
                    }
                }
            }
            else {
                for (var y = this._terminal.rows; y > newRows; y--) {
                    if (this.lines.length > newRows + this.ybase) {
                        if (this.lines.length > this.ybase + this.y + 1) {
                            this.lines.pop();
                        }
                        else {
                            this.ybase++;
                            this.ydisp++;
                        }
                    }
                }
            }
            if (newMaxLength < this.lines.maxLength) {
                var amountToTrim = this.lines.length - newMaxLength;
                if (amountToTrim > 0) {
                    this.lines.trimStart(amountToTrim);
                    this.ybase = Math.max(this.ybase - amountToTrim, 0);
                    this.ydisp = Math.max(this.ydisp - amountToTrim, 0);
                }
                this.lines.maxLength = newMaxLength;
            }
            this.x = Math.min(this.x, newCols - 1);
            this.y = Math.min(this.y, newRows - 1);
            if (addToY) {
                this.y += addToY;
            }
            this.savedY = Math.min(this.savedY, newRows - 1);
            this.savedX = Math.min(this.savedX, newCols - 1);
            this.scrollTop = 0;
        }
        this.scrollBottom = newRows - 1;
    };
    Buffer.prototype.stringIndexToBufferIndex = function (lineIndex, stringIndex) {
        while (stringIndex) {
            var line = this.lines.get(lineIndex);
            if (!line) {
                [-1, -1];
            }
            for (var i = 0; i < line.length; ++i) {
                stringIndex -= line.get(i)[exports.CHAR_DATA_CHAR_INDEX].length;
                if (stringIndex < 0) {
                    return [lineIndex, i];
                }
            }
            lineIndex++;
        }
        return [lineIndex, 0];
    };
    Buffer.prototype.translateBufferLineToString = function (lineIndex, trimRight, startCol, endCol) {
        if (startCol === void 0) { startCol = 0; }
        if (endCol === void 0) { endCol = null; }
        var lineString = '';
        var line = this.lines.get(lineIndex);
        if (!line) {
            return '';
        }
        var startIndex = startCol;
        if (endCol === null) {
            endCol = line.length;
        }
        var endIndex = endCol;
        for (var i = 0; i < line.length; i++) {
            var char = line.get(i);
            lineString += char[exports.CHAR_DATA_CHAR_INDEX];
            if (char[exports.CHAR_DATA_WIDTH_INDEX] === 0) {
                if (startCol >= i) {
                    startIndex--;
                }
                if (endCol > i) {
                    endIndex--;
                }
            }
            else {
                if (char[exports.CHAR_DATA_CHAR_INDEX].length > 1) {
                    if (startCol > i) {
                        startIndex += char[exports.CHAR_DATA_CHAR_INDEX].length - 1;
                    }
                    if (endCol > i) {
                        endIndex += char[exports.CHAR_DATA_CHAR_INDEX].length - 1;
                    }
                }
            }
        }
        if (trimRight) {
            var rightWhitespaceIndex = lineString.search(/\s+$/);
            if (rightWhitespaceIndex !== -1) {
                endIndex = Math.min(endIndex, rightWhitespaceIndex);
            }
            if (endIndex <= startIndex) {
                return '';
            }
        }
        return lineString.substring(startIndex, endIndex);
    };
    Buffer.prototype.getWrappedRangeForLine = function (y) {
        var first = y;
        var last = y;
        while (first > 0 && this.lines.get(first).isWrapped) {
            first--;
        }
        while (last + 1 < this.lines.length && this.lines.get(last + 1).isWrapped) {
            last++;
        }
        return { first: first, last: last };
    };
    Buffer.prototype.setupTabStops = function (i) {
        if (i !== null && i !== undefined) {
            if (!this.tabs[i]) {
                i = this.prevStop(i);
            }
        }
        else {
            this.tabs = {};
            i = 0;
        }
        for (; i < this._terminal.cols; i += this._terminal.options.tabStopWidth) {
            this.tabs[i] = true;
        }
    };
    Buffer.prototype.prevStop = function (x) {
        if (x === null || x === undefined) {
            x = this.x;
        }
        while (!this.tabs[--x] && x > 0)
            ;
        return x >= this._terminal.cols ? this._terminal.cols - 1 : x < 0 ? 0 : x;
    };
    Buffer.prototype.nextStop = function (x) {
        if (x === null || x === undefined) {
            x = this.x;
        }
        while (!this.tabs[++x] && x < this._terminal.cols)
            ;
        return x >= this._terminal.cols ? this._terminal.cols - 1 : x < 0 ? 0 : x;
    };
    Buffer.prototype.addMarker = function (y) {
        var _this = this;
        var marker = new Marker(y);
        this.markers.push(marker);
        marker.register(this.lines.addDisposableListener('trim', function (amount) {
            marker.line -= amount;
            if (marker.line < 0) {
                marker.dispose();
            }
        }));
        marker.register(marker.addDisposableListener('dispose', function () { return _this._removeMarker(marker); }));
        return marker;
    };
    Buffer.prototype._removeMarker = function (marker) {
        this.markers.splice(this.markers.indexOf(marker), 1);
    };
    Buffer.prototype.iterator = function (trimRight, startIndex, endIndex, startOverscan, endOverscan) {
        return new BufferStringIterator(this, trimRight, startIndex, endIndex, startOverscan, endOverscan);
    };
    return Buffer;
}());
exports.Buffer = Buffer;
var Marker = (function (_super) {
    __extends(Marker, _super);
    function Marker(line) {
        var _this = _super.call(this) || this;
        _this.line = line;
        _this._id = Marker._nextId++;
        _this.isDisposed = false;
        return _this;
    }
    Object.defineProperty(Marker.prototype, "id", {
        get: function () { return this._id; },
        enumerable: true,
        configurable: true
    });
    Marker.prototype.dispose = function () {
        if (this.isDisposed) {
            return;
        }
        this.isDisposed = true;
        this.emit('dispose');
        _super.prototype.dispose.call(this);
    };
    Marker._nextId = 1;
    return Marker;
}(EventEmitter_1.EventEmitter));
exports.Marker = Marker;
var BufferStringIterator = (function () {
    function BufferStringIterator(_buffer, _trimRight, _startIndex, _endIndex, _startOverscan, _endOverscan) {
        if (_startIndex === void 0) { _startIndex = 0; }
        if (_endIndex === void 0) { _endIndex = _buffer.lines.length; }
        if (_startOverscan === void 0) { _startOverscan = 0; }
        if (_endOverscan === void 0) { _endOverscan = 0; }
        this._buffer = _buffer;
        this._trimRight = _trimRight;
        this._startIndex = _startIndex;
        this._endIndex = _endIndex;
        this._startOverscan = _startOverscan;
        this._endOverscan = _endOverscan;
        if (this._startIndex < 0) {
            this._startIndex = 0;
        }
        if (this._endIndex > this._buffer.lines.length) {
            this._endIndex = this._buffer.lines.length;
        }
        this._current = this._startIndex;
    }
    BufferStringIterator.prototype.hasNext = function () {
        return this._current < this._endIndex;
    };
    BufferStringIterator.prototype.next = function () {
        var range = this._buffer.getWrappedRangeForLine(this._current);
        if (range.first < this._startIndex - this._startOverscan) {
            range.first = this._startIndex - this._startOverscan;
        }
        if (range.last > this._endIndex + this._endOverscan) {
            range.last = this._endIndex + this._endOverscan;
        }
        range.first = Math.max(range.first, 0);
        range.last = Math.min(range.last, this._buffer.lines.length);
        var result = '';
        for (var i = range.first; i <= range.last; ++i) {
            result += this._buffer.translateBufferLineToString(i, (this._trimRight) ? i === range.last : false);
        }
        this._current = range.last + 1;
        return { range: range, content: result };
    };
    return BufferStringIterator;
}());
exports.BufferStringIterator = BufferStringIterator;
//# sourceMappingURL=Buffer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/BufferLine.js":
/*!**********************************************!*\
  !*** ./node_modules/xterm/lib/BufferLine.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var BufferLineJSArray = (function () {
    function BufferLineJSArray(cols, fillCharData, isWrapped) {
        this.isWrapped = false;
        this._data = [];
        if (!fillCharData) {
            fillCharData = [0, Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE];
        }
        for (var i = 0; i < cols; i++) {
            this._push(fillCharData);
        }
        if (isWrapped) {
            this.isWrapped = true;
        }
        this.length = this._data.length;
    }
    BufferLineJSArray.prototype._pop = function () {
        var data = this._data.pop();
        this.length = this._data.length;
        return data;
    };
    BufferLineJSArray.prototype._push = function (data) {
        this._data.push(data);
        this.length = this._data.length;
    };
    BufferLineJSArray.prototype._splice = function (start, deleteCount) {
        var items = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            items[_i - 2] = arguments[_i];
        }
        var _a;
        var removed = (_a = this._data).splice.apply(_a, [start, deleteCount].concat(items));
        this.length = this._data.length;
        return removed;
    };
    BufferLineJSArray.prototype.get = function (index) {
        return this._data[index];
    };
    BufferLineJSArray.prototype.set = function (index, data) {
        this._data[index] = data;
    };
    BufferLineJSArray.prototype.insertCells = function (pos, n, ch) {
        while (n--) {
            this._splice(pos, 0, ch);
            this._pop();
        }
    };
    BufferLineJSArray.prototype.deleteCells = function (pos, n, fillCharData) {
        while (n--) {
            this._splice(pos, 1);
            this._push(fillCharData);
        }
    };
    BufferLineJSArray.prototype.replaceCells = function (start, end, fillCharData) {
        while (start < end && start < this.length) {
            this.set(start++, fillCharData);
        }
    };
    BufferLineJSArray.prototype.resize = function (cols, fillCharData, shrink) {
        if (shrink === void 0) { shrink = false; }
        while (this._data.length < cols) {
            this._data.push(fillCharData);
        }
        if (shrink) {
            while (this._data.length > cols) {
                this._data.pop();
            }
        }
        this.length = this._data.length;
    };
    BufferLineJSArray.prototype.fill = function (fillCharData) {
        for (var i = 0; i < this.length; ++i) {
            this.set(i, fillCharData);
        }
    };
    BufferLineJSArray.prototype.copyFrom = function (line) {
        this._data = line._data.slice(0);
        this.length = line.length;
        this.isWrapped = line.isWrapped;
    };
    BufferLineJSArray.prototype.clone = function () {
        var newLine = new BufferLineJSArray(0);
        newLine.copyFrom(this);
        return newLine;
    };
    return BufferLineJSArray;
}());
exports.BufferLineJSArray = BufferLineJSArray;
var CELL_SIZE = 3;
var BufferLine = (function () {
    function BufferLine(cols, fillCharData, isWrapped) {
        if (isWrapped === void 0) { isWrapped = false; }
        this.isWrapped = isWrapped;
        this._data = null;
        this._combined = {};
        if (!fillCharData) {
            fillCharData = [0, Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE];
        }
        if (cols) {
            this._data = new Uint32Array(cols * CELL_SIZE);
            for (var i = 0; i < cols; ++i) {
                this.set(i, fillCharData);
            }
        }
        this.length = cols;
    }
    BufferLine.prototype.get = function (index) {
        var stringData = this._data[index * CELL_SIZE + 1];
        return [
            this._data[index * CELL_SIZE + 0],
            (stringData & 0x80000000)
                ? this._combined[index]
                : (stringData) ? String.fromCharCode(stringData) : '',
            this._data[index * CELL_SIZE + 2],
            (stringData & 0x80000000)
                ? this._combined[index].charCodeAt(this._combined[index].length - 1)
                : stringData
        ];
    };
    BufferLine.prototype.set = function (index, value) {
        this._data[index * CELL_SIZE + 0] = value[0];
        if (value[1].length > 1) {
            this._combined[index] = value[1];
            this._data[index * CELL_SIZE + 1] = index | 0x80000000;
        }
        else {
            this._data[index * CELL_SIZE + 1] = value[1].charCodeAt(0);
        }
        this._data[index * CELL_SIZE + 2] = value[2];
    };
    BufferLine.prototype.insertCells = function (pos, n, fillCharData) {
        pos %= this.length;
        if (n < this.length - pos) {
            for (var i = this.length - pos - n - 1; i >= 0; --i) {
                this.set(pos + n + i, this.get(pos + i));
            }
            for (var i = 0; i < n; ++i) {
                this.set(pos + i, fillCharData);
            }
        }
        else {
            for (var i = pos; i < this.length; ++i) {
                this.set(i, fillCharData);
            }
        }
    };
    BufferLine.prototype.deleteCells = function (pos, n, fillCharData) {
        pos %= this.length;
        if (n < this.length - pos) {
            for (var i = 0; i < this.length - pos - n; ++i) {
                this.set(pos + i, this.get(pos + n + i));
            }
            for (var i = this.length - n; i < this.length; ++i) {
                this.set(i, fillCharData);
            }
        }
        else {
            for (var i = pos; i < this.length; ++i) {
                this.set(i, fillCharData);
            }
        }
    };
    BufferLine.prototype.replaceCells = function (start, end, fillCharData) {
        while (start < end && start < this.length) {
            this.set(start++, fillCharData);
        }
    };
    BufferLine.prototype.resize = function (cols, fillCharData, shrink) {
        if (shrink === void 0) { shrink = false; }
        if (cols === this.length || (!shrink && cols < this.length)) {
            return;
        }
        if (cols > this.length) {
            var data = new Uint32Array(cols * CELL_SIZE);
            if (this.length) {
                if (cols * CELL_SIZE < this._data.length) {
                    data.set(this._data.subarray(0, cols * CELL_SIZE));
                }
                else {
                    data.set(this._data);
                }
            }
            this._data = data;
            for (var i = this.length; i < cols; ++i) {
                this.set(i, fillCharData);
            }
        }
        else if (shrink) {
            if (cols) {
                var data = new Uint32Array(cols * CELL_SIZE);
                data.set(this._data.subarray(0, cols * CELL_SIZE));
                this._data = data;
            }
            else {
                this._data = null;
            }
        }
        this.length = cols;
    };
    BufferLine.prototype.fill = function (fillCharData) {
        this._combined = {};
        for (var i = 0; i < this.length; ++i) {
            this.set(i, fillCharData);
        }
    };
    BufferLine.prototype.copyFrom = function (line) {
        if (this.length !== line.length) {
            this._data = new Uint32Array(line._data);
        }
        else {
            this._data.set(line._data);
        }
        this.length = line.length;
        this._combined = {};
        for (var el in line._combined) {
            this._combined[el] = line._combined[el];
        }
        this.isWrapped = line.isWrapped;
    };
    BufferLine.prototype.clone = function () {
        var newLine = new BufferLine(0);
        newLine._data = new Uint32Array(this._data);
        newLine.length = this.length;
        for (var el in this._combined) {
            newLine._combined[el] = this._combined[el];
        }
        newLine.isWrapped = this.isWrapped;
        return newLine;
    };
    return BufferLine;
}());
exports.BufferLine = BufferLine;
//# sourceMappingURL=BufferLine.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/BufferSet.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/BufferSet.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var EventEmitter_1 = __webpack_require__(/*! ./common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var BufferSet = (function (_super) {
    __extends(BufferSet, _super);
    function BufferSet(_terminal) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._normal = new Buffer_1.Buffer(_this._terminal, true);
        _this._normal.fillViewportRows();
        _this._alt = new Buffer_1.Buffer(_this._terminal, false);
        _this._activeBuffer = _this._normal;
        _this.setupTabStops();
        return _this;
    }
    Object.defineProperty(BufferSet.prototype, "alt", {
        get: function () {
            return this._alt;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferSet.prototype, "active", {
        get: function () {
            return this._activeBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferSet.prototype, "normal", {
        get: function () {
            return this._normal;
        },
        enumerable: true,
        configurable: true
    });
    BufferSet.prototype.activateNormalBuffer = function () {
        if (this._activeBuffer === this._normal) {
            return;
        }
        this._normal.x = this._alt.x;
        this._normal.y = this._alt.y;
        this._alt.clear();
        this._activeBuffer = this._normal;
        this.emit('activate', {
            activeBuffer: this._normal,
            inactiveBuffer: this._alt
        });
    };
    BufferSet.prototype.activateAltBuffer = function (fillAttr) {
        if (this._activeBuffer === this._alt) {
            return;
        }
        this._alt.fillViewportRows(fillAttr);
        this._alt.x = this._normal.x;
        this._alt.y = this._normal.y;
        this._activeBuffer = this._alt;
        this.emit('activate', {
            activeBuffer: this._alt,
            inactiveBuffer: this._normal
        });
    };
    BufferSet.prototype.resize = function (newCols, newRows) {
        this._normal.resize(newCols, newRows);
        this._alt.resize(newCols, newRows);
    };
    BufferSet.prototype.setupTabStops = function (i) {
        this._normal.setupTabStops(i);
        this._alt.setupTabStops(i);
    };
    return BufferSet;
}(EventEmitter_1.EventEmitter));
exports.BufferSet = BufferSet;
//# sourceMappingURL=BufferSet.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/CharWidth.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/CharWidth.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var TypedArrayUtils_1 = __webpack_require__(/*! ./common/TypedArrayUtils */ "./node_modules/xterm/lib/common/TypedArrayUtils.js");
exports.wcwidth = (function (opts) {
    var COMBINING_BMP = [
        [0x0300, 0x036F], [0x0483, 0x0486], [0x0488, 0x0489],
        [0x0591, 0x05BD], [0x05BF, 0x05BF], [0x05C1, 0x05C2],
        [0x05C4, 0x05C5], [0x05C7, 0x05C7], [0x0600, 0x0603],
        [0x0610, 0x0615], [0x064B, 0x065E], [0x0670, 0x0670],
        [0x06D6, 0x06E4], [0x06E7, 0x06E8], [0x06EA, 0x06ED],
        [0x070F, 0x070F], [0x0711, 0x0711], [0x0730, 0x074A],
        [0x07A6, 0x07B0], [0x07EB, 0x07F3], [0x0901, 0x0902],
        [0x093C, 0x093C], [0x0941, 0x0948], [0x094D, 0x094D],
        [0x0951, 0x0954], [0x0962, 0x0963], [0x0981, 0x0981],
        [0x09BC, 0x09BC], [0x09C1, 0x09C4], [0x09CD, 0x09CD],
        [0x09E2, 0x09E3], [0x0A01, 0x0A02], [0x0A3C, 0x0A3C],
        [0x0A41, 0x0A42], [0x0A47, 0x0A48], [0x0A4B, 0x0A4D],
        [0x0A70, 0x0A71], [0x0A81, 0x0A82], [0x0ABC, 0x0ABC],
        [0x0AC1, 0x0AC5], [0x0AC7, 0x0AC8], [0x0ACD, 0x0ACD],
        [0x0AE2, 0x0AE3], [0x0B01, 0x0B01], [0x0B3C, 0x0B3C],
        [0x0B3F, 0x0B3F], [0x0B41, 0x0B43], [0x0B4D, 0x0B4D],
        [0x0B56, 0x0B56], [0x0B82, 0x0B82], [0x0BC0, 0x0BC0],
        [0x0BCD, 0x0BCD], [0x0C3E, 0x0C40], [0x0C46, 0x0C48],
        [0x0C4A, 0x0C4D], [0x0C55, 0x0C56], [0x0CBC, 0x0CBC],
        [0x0CBF, 0x0CBF], [0x0CC6, 0x0CC6], [0x0CCC, 0x0CCD],
        [0x0CE2, 0x0CE3], [0x0D41, 0x0D43], [0x0D4D, 0x0D4D],
        [0x0DCA, 0x0DCA], [0x0DD2, 0x0DD4], [0x0DD6, 0x0DD6],
        [0x0E31, 0x0E31], [0x0E34, 0x0E3A], [0x0E47, 0x0E4E],
        [0x0EB1, 0x0EB1], [0x0EB4, 0x0EB9], [0x0EBB, 0x0EBC],
        [0x0EC8, 0x0ECD], [0x0F18, 0x0F19], [0x0F35, 0x0F35],
        [0x0F37, 0x0F37], [0x0F39, 0x0F39], [0x0F71, 0x0F7E],
        [0x0F80, 0x0F84], [0x0F86, 0x0F87], [0x0F90, 0x0F97],
        [0x0F99, 0x0FBC], [0x0FC6, 0x0FC6], [0x102D, 0x1030],
        [0x1032, 0x1032], [0x1036, 0x1037], [0x1039, 0x1039],
        [0x1058, 0x1059], [0x1160, 0x11FF], [0x135F, 0x135F],
        [0x1712, 0x1714], [0x1732, 0x1734], [0x1752, 0x1753],
        [0x1772, 0x1773], [0x17B4, 0x17B5], [0x17B7, 0x17BD],
        [0x17C6, 0x17C6], [0x17C9, 0x17D3], [0x17DD, 0x17DD],
        [0x180B, 0x180D], [0x18A9, 0x18A9], [0x1920, 0x1922],
        [0x1927, 0x1928], [0x1932, 0x1932], [0x1939, 0x193B],
        [0x1A17, 0x1A18], [0x1B00, 0x1B03], [0x1B34, 0x1B34],
        [0x1B36, 0x1B3A], [0x1B3C, 0x1B3C], [0x1B42, 0x1B42],
        [0x1B6B, 0x1B73], [0x1DC0, 0x1DCA], [0x1DFE, 0x1DFF],
        [0x200B, 0x200F], [0x202A, 0x202E], [0x2060, 0x2063],
        [0x206A, 0x206F], [0x20D0, 0x20EF], [0x302A, 0x302F],
        [0x3099, 0x309A], [0xA806, 0xA806], [0xA80B, 0xA80B],
        [0xA825, 0xA826], [0xFB1E, 0xFB1E], [0xFE00, 0xFE0F],
        [0xFE20, 0xFE23], [0xFEFF, 0xFEFF], [0xFFF9, 0xFFFB]
    ];
    var COMBINING_HIGH = [
        [0x10A01, 0x10A03], [0x10A05, 0x10A06], [0x10A0C, 0x10A0F],
        [0x10A38, 0x10A3A], [0x10A3F, 0x10A3F], [0x1D167, 0x1D169],
        [0x1D173, 0x1D182], [0x1D185, 0x1D18B], [0x1D1AA, 0x1D1AD],
        [0x1D242, 0x1D244], [0xE0001, 0xE0001], [0xE0020, 0xE007F],
        [0xE0100, 0xE01EF]
    ];
    function bisearch(ucs, data) {
        var min = 0;
        var max = data.length - 1;
        var mid;
        if (ucs < data[0][0] || ucs > data[max][1]) {
            return false;
        }
        while (max >= min) {
            mid = (min + max) >> 1;
            if (ucs > data[mid][1]) {
                min = mid + 1;
            }
            else if (ucs < data[mid][0]) {
                max = mid - 1;
            }
            else {
                return true;
            }
        }
        return false;
    }
    function wcwidthHigh(ucs) {
        if (bisearch(ucs, COMBINING_HIGH)) {
            return 0;
        }
        if ((ucs >= 0x20000 && ucs <= 0x2fffd) || (ucs >= 0x30000 && ucs <= 0x3fffd)) {
            return 2;
        }
        return 1;
    }
    var control = opts.control | 0;
    var table = new Uint8Array(65536);
    TypedArrayUtils_1.fill(table, 1);
    table[0] = opts.nul;
    TypedArrayUtils_1.fill(table, opts.control, 1, 32);
    TypedArrayUtils_1.fill(table, opts.control, 0x7f, 0xa0);
    TypedArrayUtils_1.fill(table, 2, 0x1100, 0x1160);
    table[0x2329] = 2;
    table[0x232a] = 2;
    TypedArrayUtils_1.fill(table, 2, 0x2e80, 0xa4d0);
    table[0x303f] = 1;
    TypedArrayUtils_1.fill(table, 2, 0xac00, 0xd7a4);
    TypedArrayUtils_1.fill(table, 2, 0xf900, 0xfb00);
    TypedArrayUtils_1.fill(table, 2, 0xfe10, 0xfe1a);
    TypedArrayUtils_1.fill(table, 2, 0xfe30, 0xfe70);
    TypedArrayUtils_1.fill(table, 2, 0xff00, 0xff61);
    TypedArrayUtils_1.fill(table, 2, 0xffe0, 0xffe7);
    for (var r = 0; r < COMBINING_BMP.length; ++r) {
        TypedArrayUtils_1.fill(table, 0, COMBINING_BMP[r][0], COMBINING_BMP[r][1] + 1);
    }
    return function (num) {
        if (num < 32) {
            return control | 0;
        }
        if (num < 127) {
            return 1;
        }
        if (num < 65536) {
            return table[num];
        }
        return wcwidthHigh(num);
    };
})({ nul: 0, control: 0 });
function getStringCellWidth(s) {
    var result = 0;
    var length = s.length;
    for (var i = 0; i < length; ++i) {
        var code = s.charCodeAt(i);
        if (0xD800 <= code && code <= 0xDBFF) {
            if (++i >= length) {
                return result + exports.wcwidth(code);
            }
            var second = s.charCodeAt(i);
            if (0xDC00 <= second && second <= 0xDFFF) {
                code = (code - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
            }
            else {
                result += exports.wcwidth(second);
            }
        }
        result += exports.wcwidth(code);
    }
    return result;
}
exports.getStringCellWidth = getStringCellWidth;
//# sourceMappingURL=CharWidth.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/CompositionHelper.js":
/*!*****************************************************!*\
  !*** ./node_modules/xterm/lib/CompositionHelper.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var CompositionHelper = (function () {
    function CompositionHelper(_textarea, _compositionView, _terminal) {
        this._textarea = _textarea;
        this._compositionView = _compositionView;
        this._terminal = _terminal;
        this._isComposing = false;
        this._isSendingComposition = false;
        this._compositionPosition = { start: null, end: null };
    }
    CompositionHelper.prototype.compositionstart = function () {
        this._isComposing = true;
        this._compositionPosition.start = this._textarea.value.length;
        this._compositionView.textContent = '';
        this._compositionView.classList.add('active');
    };
    CompositionHelper.prototype.compositionupdate = function (ev) {
        var _this = this;
        this._compositionView.textContent = ev.data;
        this.updateCompositionElements();
        setTimeout(function () {
            _this._compositionPosition.end = _this._textarea.value.length;
        }, 0);
    };
    CompositionHelper.prototype.compositionend = function () {
        this._finalizeComposition(true);
    };
    CompositionHelper.prototype.keydown = function (ev) {
        if (this._isComposing || this._isSendingComposition) {
            if (ev.keyCode === 229) {
                return false;
            }
            else if (ev.keyCode === 16 || ev.keyCode === 17 || ev.keyCode === 18) {
                return false;
            }
            this._finalizeComposition(false);
        }
        if (ev.keyCode === 229) {
            this._handleAnyTextareaChanges();
            return false;
        }
        return true;
    };
    CompositionHelper.prototype._finalizeComposition = function (waitForPropogation) {
        var _this = this;
        this._compositionView.classList.remove('active');
        this._isComposing = false;
        this._clearTextareaPosition();
        if (!waitForPropogation) {
            this._isSendingComposition = false;
            var input = this._textarea.value.substring(this._compositionPosition.start, this._compositionPosition.end);
            this._terminal.handler(input);
        }
        else {
            var currentCompositionPosition_1 = {
                start: this._compositionPosition.start,
                end: this._compositionPosition.end
            };
            this._isSendingComposition = true;
            setTimeout(function () {
                if (_this._isSendingComposition) {
                    _this._isSendingComposition = false;
                    var input = void 0;
                    if (_this._isComposing) {
                        input = _this._textarea.value.substring(currentCompositionPosition_1.start, currentCompositionPosition_1.end);
                    }
                    else {
                        input = _this._textarea.value.substring(currentCompositionPosition_1.start);
                    }
                    _this._terminal.handler(input);
                }
            }, 0);
        }
    };
    CompositionHelper.prototype._handleAnyTextareaChanges = function () {
        var _this = this;
        var oldValue = this._textarea.value;
        setTimeout(function () {
            if (!_this._isComposing) {
                var newValue = _this._textarea.value;
                var diff = newValue.replace(oldValue, '');
                if (diff.length > 0) {
                    _this._terminal.handler(diff);
                }
            }
        }, 0);
    };
    CompositionHelper.prototype.updateCompositionElements = function (dontRecurse) {
        var _this = this;
        if (!this._isComposing) {
            return;
        }
        if (this._terminal.buffer.isCursorInViewport) {
            var cellHeight = Math.ceil(this._terminal.charMeasure.height * this._terminal.options.lineHeight);
            var cursorTop = this._terminal.buffer.y * cellHeight;
            var cursorLeft = this._terminal.buffer.x * this._terminal.charMeasure.width;
            this._compositionView.style.left = cursorLeft + 'px';
            this._compositionView.style.top = cursorTop + 'px';
            this._compositionView.style.height = cellHeight + 'px';
            this._compositionView.style.lineHeight = cellHeight + 'px';
            var compositionViewBounds = this._compositionView.getBoundingClientRect();
            this._textarea.style.left = cursorLeft + 'px';
            this._textarea.style.top = cursorTop + 'px';
            this._textarea.style.width = compositionViewBounds.width + 'px';
            this._textarea.style.height = compositionViewBounds.height + 'px';
            this._textarea.style.lineHeight = compositionViewBounds.height + 'px';
        }
        if (!dontRecurse) {
            setTimeout(function () { return _this.updateCompositionElements(true); }, 0);
        }
    };
    CompositionHelper.prototype._clearTextareaPosition = function () {
        this._textarea.style.left = '';
        this._textarea.style.top = '';
    };
    return CompositionHelper;
}());
exports.CompositionHelper = CompositionHelper;
//# sourceMappingURL=CompositionHelper.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/EscapeSequenceParser.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/EscapeSequenceParser.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
function r(low, high) {
    var c = high - low;
    var arr = new Array(c);
    while (c--) {
        arr[c] = --high;
    }
    return arr;
}
var TransitionTable = (function () {
    function TransitionTable(length) {
        this.table = (typeof Uint8Array === 'undefined')
            ? new Array(length)
            : new Uint8Array(length);
    }
    TransitionTable.prototype.add = function (code, state, action, next) {
        this.table[state << 8 | code] = ((action | 0) << 4) | ((next === undefined) ? state : next);
    };
    TransitionTable.prototype.addMany = function (codes, state, action, next) {
        for (var i = 0; i < codes.length; i++) {
            this.add(codes[i], state, action, next);
        }
    };
    return TransitionTable;
}());
exports.TransitionTable = TransitionTable;
var PRINTABLES = r(0x20, 0x7f);
var EXECUTABLES = r(0x00, 0x18);
EXECUTABLES.push(0x19);
EXECUTABLES.push.apply(EXECUTABLES, r(0x1c, 0x20));
var DEFAULT_TRANSITION = 1 << 4 | 0;
exports.VT500_TRANSITION_TABLE = (function () {
    var table = new TransitionTable(4095);
    var states = r(0, 13 + 1);
    var state;
    for (state in states) {
        for (var code = 0; code < 160; ++code) {
            table.add(code, state, 1, 0);
        }
    }
    table.addMany(PRINTABLES, 0, 2, 0);
    for (state in states) {
        table.addMany([0x18, 0x1a, 0x99, 0x9a], state, 3, 0);
        table.addMany(r(0x80, 0x90), state, 3, 0);
        table.addMany(r(0x90, 0x98), state, 3, 0);
        table.add(0x9c, state, 0, 0);
        table.add(0x1b, state, 11, 1);
        table.add(0x9d, state, 4, 8);
        table.addMany([0x98, 0x9e, 0x9f], state, 0, 7);
        table.add(0x9b, state, 11, 3);
        table.add(0x90, state, 11, 9);
    }
    table.addMany(EXECUTABLES, 0, 3, 0);
    table.addMany(EXECUTABLES, 1, 3, 1);
    table.add(0x7f, 1, 0, 1);
    table.addMany(EXECUTABLES, 8, 0, 8);
    table.addMany(EXECUTABLES, 3, 3, 3);
    table.add(0x7f, 3, 0, 3);
    table.addMany(EXECUTABLES, 4, 3, 4);
    table.add(0x7f, 4, 0, 4);
    table.addMany(EXECUTABLES, 6, 3, 6);
    table.addMany(EXECUTABLES, 5, 3, 5);
    table.add(0x7f, 5, 0, 5);
    table.addMany(EXECUTABLES, 2, 3, 2);
    table.add(0x7f, 2, 0, 2);
    table.add(0x5d, 1, 4, 8);
    table.addMany(PRINTABLES, 8, 5, 8);
    table.add(0x7f, 8, 5, 8);
    table.addMany([0x9c, 0x1b, 0x18, 0x1a, 0x07], 8, 6, 0);
    table.addMany(r(0x1c, 0x20), 8, 0, 8);
    table.addMany([0x58, 0x5e, 0x5f], 1, 0, 7);
    table.addMany(PRINTABLES, 7, 0, 7);
    table.addMany(EXECUTABLES, 7, 0, 7);
    table.add(0x9c, 7, 0, 0);
    table.add(0x5b, 1, 11, 3);
    table.addMany(r(0x40, 0x7f), 3, 7, 0);
    table.addMany(r(0x30, 0x3a), 3, 8, 4);
    table.add(0x3b, 3, 8, 4);
    table.addMany([0x3c, 0x3d, 0x3e, 0x3f], 3, 9, 4);
    table.addMany(r(0x30, 0x3a), 4, 8, 4);
    table.add(0x3b, 4, 8, 4);
    table.addMany(r(0x40, 0x7f), 4, 7, 0);
    table.addMany([0x3a, 0x3c, 0x3d, 0x3e, 0x3f], 4, 0, 6);
    table.addMany(r(0x20, 0x40), 6, 0, 6);
    table.add(0x7f, 6, 0, 6);
    table.addMany(r(0x40, 0x7f), 6, 0, 0);
    table.add(0x3a, 3, 0, 6);
    table.addMany(r(0x20, 0x30), 3, 9, 5);
    table.addMany(r(0x20, 0x30), 5, 9, 5);
    table.addMany(r(0x30, 0x40), 5, 0, 6);
    table.addMany(r(0x40, 0x7f), 5, 7, 0);
    table.addMany(r(0x20, 0x30), 4, 9, 5);
    table.addMany(r(0x20, 0x30), 1, 9, 2);
    table.addMany(r(0x20, 0x30), 2, 9, 2);
    table.addMany(r(0x30, 0x7f), 2, 10, 0);
    table.addMany(r(0x30, 0x50), 1, 10, 0);
    table.addMany(r(0x51, 0x58), 1, 10, 0);
    table.addMany([0x59, 0x5a, 0x5c], 1, 10, 0);
    table.addMany(r(0x60, 0x7f), 1, 10, 0);
    table.add(0x50, 1, 11, 9);
    table.addMany(EXECUTABLES, 9, 0, 9);
    table.add(0x7f, 9, 0, 9);
    table.addMany(r(0x1c, 0x20), 9, 0, 9);
    table.addMany(r(0x20, 0x30), 9, 9, 12);
    table.add(0x3a, 9, 0, 11);
    table.addMany(r(0x30, 0x3a), 9, 8, 10);
    table.add(0x3b, 9, 8, 10);
    table.addMany([0x3c, 0x3d, 0x3e, 0x3f], 9, 9, 10);
    table.addMany(EXECUTABLES, 11, 0, 11);
    table.addMany(r(0x20, 0x80), 11, 0, 11);
    table.addMany(r(0x1c, 0x20), 11, 0, 11);
    table.addMany(EXECUTABLES, 10, 0, 10);
    table.add(0x7f, 10, 0, 10);
    table.addMany(r(0x1c, 0x20), 10, 0, 10);
    table.addMany(r(0x30, 0x3a), 10, 8, 10);
    table.add(0x3b, 10, 8, 10);
    table.addMany([0x3a, 0x3c, 0x3d, 0x3e, 0x3f], 10, 0, 11);
    table.addMany(r(0x20, 0x30), 10, 9, 12);
    table.addMany(EXECUTABLES, 12, 0, 12);
    table.add(0x7f, 12, 0, 12);
    table.addMany(r(0x1c, 0x20), 12, 0, 12);
    table.addMany(r(0x20, 0x30), 12, 9, 12);
    table.addMany(r(0x30, 0x40), 12, 0, 11);
    table.addMany(r(0x40, 0x7f), 12, 12, 13);
    table.addMany(r(0x40, 0x7f), 10, 12, 13);
    table.addMany(r(0x40, 0x7f), 9, 12, 13);
    table.addMany(EXECUTABLES, 13, 13, 13);
    table.addMany(PRINTABLES, 13, 13, 13);
    table.add(0x7f, 13, 0, 13);
    table.addMany([0x1b, 0x9c], 13, 14, 0);
    return table;
})();
var DcsDummy = (function () {
    function DcsDummy() {
    }
    DcsDummy.prototype.hook = function (collect, params, flag) { };
    DcsDummy.prototype.put = function (data, start, end) { };
    DcsDummy.prototype.unhook = function () { };
    return DcsDummy;
}());
var EscapeSequenceParser = (function (_super) {
    __extends(EscapeSequenceParser, _super);
    function EscapeSequenceParser(TRANSITIONS) {
        if (TRANSITIONS === void 0) { TRANSITIONS = exports.VT500_TRANSITION_TABLE; }
        var _this = _super.call(this) || this;
        _this.TRANSITIONS = TRANSITIONS;
        _this.initialState = 0;
        _this.currentState = _this.initialState;
        _this._osc = '';
        _this._params = [0];
        _this._collect = '';
        _this._printHandlerFb = function (data, start, end) { };
        _this._executeHandlerFb = function (code) { };
        _this._csiHandlerFb = function (collect, params, flag) { };
        _this._escHandlerFb = function (collect, flag) { };
        _this._oscHandlerFb = function (identifier, data) { };
        _this._dcsHandlerFb = new DcsDummy();
        _this._errorHandlerFb = function (state) { return state; };
        _this._printHandler = _this._printHandlerFb;
        _this._executeHandlers = Object.create(null);
        _this._csiHandlers = Object.create(null);
        _this._escHandlers = Object.create(null);
        _this._oscHandlers = Object.create(null);
        _this._dcsHandlers = Object.create(null);
        _this._activeDcsHandler = null;
        _this._errorHandler = _this._errorHandlerFb;
        _this.setEscHandler('\\', function () { });
        return _this;
    }
    EscapeSequenceParser.prototype.dispose = function () {
        this._printHandlerFb = null;
        this._executeHandlerFb = null;
        this._csiHandlerFb = null;
        this._escHandlerFb = null;
        this._oscHandlerFb = null;
        this._dcsHandlerFb = null;
        this._errorHandlerFb = null;
        this._printHandler = null;
        this._executeHandlers = null;
        this._csiHandlers = null;
        this._escHandlers = null;
        this._oscHandlers = null;
        this._dcsHandlers = null;
        this._activeDcsHandler = null;
        this._errorHandler = null;
    };
    EscapeSequenceParser.prototype.setPrintHandler = function (callback) {
        this._printHandler = callback;
    };
    EscapeSequenceParser.prototype.clearPrintHandler = function () {
        this._printHandler = this._printHandlerFb;
    };
    EscapeSequenceParser.prototype.setExecuteHandler = function (flag, callback) {
        this._executeHandlers[flag.charCodeAt(0)] = callback;
    };
    EscapeSequenceParser.prototype.clearExecuteHandler = function (flag) {
        if (this._executeHandlers[flag.charCodeAt(0)])
            delete this._executeHandlers[flag.charCodeAt(0)];
    };
    EscapeSequenceParser.prototype.setExecuteHandlerFallback = function (callback) {
        this._executeHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.setCsiHandler = function (flag, callback) {
        this._csiHandlers[flag.charCodeAt(0)] = callback;
    };
    EscapeSequenceParser.prototype.clearCsiHandler = function (flag) {
        if (this._csiHandlers[flag.charCodeAt(0)])
            delete this._csiHandlers[flag.charCodeAt(0)];
    };
    EscapeSequenceParser.prototype.setCsiHandlerFallback = function (callback) {
        this._csiHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.setEscHandler = function (collectAndFlag, callback) {
        this._escHandlers[collectAndFlag] = callback;
    };
    EscapeSequenceParser.prototype.clearEscHandler = function (collectAndFlag) {
        if (this._escHandlers[collectAndFlag])
            delete this._escHandlers[collectAndFlag];
    };
    EscapeSequenceParser.prototype.setEscHandlerFallback = function (callback) {
        this._escHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.setOscHandler = function (ident, callback) {
        this._oscHandlers[ident] = callback;
    };
    EscapeSequenceParser.prototype.clearOscHandler = function (ident) {
        if (this._oscHandlers[ident])
            delete this._oscHandlers[ident];
    };
    EscapeSequenceParser.prototype.setOscHandlerFallback = function (callback) {
        this._oscHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.setDcsHandler = function (collectAndFlag, handler) {
        this._dcsHandlers[collectAndFlag] = handler;
    };
    EscapeSequenceParser.prototype.clearDcsHandler = function (collectAndFlag) {
        if (this._dcsHandlers[collectAndFlag])
            delete this._dcsHandlers[collectAndFlag];
    };
    EscapeSequenceParser.prototype.setDcsHandlerFallback = function (handler) {
        this._dcsHandlerFb = handler;
    };
    EscapeSequenceParser.prototype.setErrorHandler = function (callback) {
        this._errorHandler = callback;
    };
    EscapeSequenceParser.prototype.clearErrorHandler = function () {
        this._errorHandler = this._errorHandlerFb;
    };
    EscapeSequenceParser.prototype.reset = function () {
        this.currentState = this.initialState;
        this._osc = '';
        this._params = [0];
        this._collect = '';
        this._activeDcsHandler = null;
    };
    EscapeSequenceParser.prototype.parse = function (data) {
        var code = 0;
        var transition = 0;
        var error = false;
        var currentState = this.currentState;
        var print = -1;
        var dcs = -1;
        var osc = this._osc;
        var collect = this._collect;
        var params = this._params;
        var table = this.TRANSITIONS.table;
        var dcsHandler = this._activeDcsHandler;
        var callback = null;
        var l = data.length;
        for (var i = 0; i < l; ++i) {
            code = data.charCodeAt(i);
            if (currentState === 0 && code > 0x1f && code < 0x80) {
                print = (~print) ? print : i;
                do
                    i++;
                while (i < l && data.charCodeAt(i) > 0x1f && data.charCodeAt(i) < 0x80);
                i--;
                continue;
            }
            if (currentState === 4 && (code > 0x2f && code < 0x39)) {
                params[params.length - 1] = params[params.length - 1] * 10 + code - 48;
                continue;
            }
            transition = (code < 0xa0) ? (table[currentState << 8 | code]) : DEFAULT_TRANSITION;
            switch (transition >> 4) {
                case 2:
                    print = (~print) ? print : i;
                    break;
                case 3:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    callback = this._executeHandlers[code];
                    if (callback)
                        callback();
                    else
                        this._executeHandlerFb(code);
                    break;
                case 0:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    else if (~dcs) {
                        dcsHandler.put(data, dcs, i);
                        dcs = -1;
                    }
                    break;
                case 1:
                    if (code > 0x9f) {
                        switch (currentState) {
                            case 0:
                                print = (~print) ? print : i;
                                break;
                            case 8:
                                osc += String.fromCharCode(code);
                                transition |= 8;
                                break;
                            case 6:
                                transition |= 6;
                                break;
                            case 11:
                                transition |= 11;
                                break;
                            case 13:
                                dcs = (~dcs) ? dcs : i;
                                transition |= 13;
                                break;
                            default:
                                error = true;
                        }
                    }
                    else {
                        error = true;
                    }
                    if (error) {
                        var inject = this._errorHandler({
                            position: i,
                            code: code,
                            currentState: currentState,
                            print: print,
                            dcs: dcs,
                            osc: osc,
                            collect: collect,
                            params: params,
                            abort: false
                        });
                        if (inject.abort)
                            return;
                        error = false;
                    }
                    break;
                case 7:
                    callback = this._csiHandlers[code];
                    if (callback)
                        callback(params, collect);
                    else
                        this._csiHandlerFb(collect, params, code);
                    break;
                case 8:
                    if (code === 0x3b)
                        params.push(0);
                    else
                        params[params.length - 1] = params[params.length - 1] * 10 + code - 48;
                    break;
                case 9:
                    collect += String.fromCharCode(code);
                    break;
                case 10:
                    callback = this._escHandlers[collect + String.fromCharCode(code)];
                    if (callback)
                        callback(collect, code);
                    else
                        this._escHandlerFb(collect, code);
                    break;
                case 11:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    osc = '';
                    params = [0];
                    collect = '';
                    dcs = -1;
                    break;
                case 12:
                    dcsHandler = this._dcsHandlers[collect + String.fromCharCode(code)];
                    if (!dcsHandler)
                        dcsHandler = this._dcsHandlerFb;
                    dcsHandler.hook(collect, params, code);
                    break;
                case 13:
                    dcs = (~dcs) ? dcs : i;
                    break;
                case 14:
                    if (dcsHandler) {
                        if (~dcs)
                            dcsHandler.put(data, dcs, i);
                        dcsHandler.unhook();
                        dcsHandler = null;
                    }
                    if (code === 0x1b)
                        transition |= 1;
                    osc = '';
                    params = [0];
                    collect = '';
                    dcs = -1;
                    break;
                case 4:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    osc = '';
                    break;
                case 5:
                    osc += data.charAt(i);
                    break;
                case 6:
                    if (osc && code !== 0x18 && code !== 0x1a) {
                        var idx = osc.indexOf(';');
                        if (idx === -1) {
                            this._oscHandlerFb(-1, osc);
                        }
                        else {
                            var identifier = parseInt(osc.substring(0, idx));
                            var content = osc.substring(idx + 1);
                            callback = this._oscHandlers[identifier];
                            if (callback)
                                callback(content);
                            else
                                this._oscHandlerFb(identifier, content);
                        }
                    }
                    if (code === 0x1b)
                        transition |= 1;
                    osc = '';
                    params = [0];
                    collect = '';
                    dcs = -1;
                    break;
            }
            currentState = transition & 15;
        }
        if (currentState === 0 && ~print) {
            this._printHandler(data, print, data.length);
        }
        else if (currentState === 13 && ~dcs && dcsHandler) {
            dcsHandler.put(data, dcs, data.length);
        }
        this._osc = osc;
        this._collect = collect;
        this._params = params;
        this._activeDcsHandler = dcsHandler;
        this.currentState = currentState;
    };
    return EscapeSequenceParser;
}(Lifecycle_1.Disposable));
exports.EscapeSequenceParser = EscapeSequenceParser;
//# sourceMappingURL=EscapeSequenceParser.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/InputHandler.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/InputHandler.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var EscapeSequences_1 = __webpack_require__(/*! ./common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var Charsets_1 = __webpack_require__(/*! ./core/data/Charsets */ "./node_modules/xterm/lib/core/data/Charsets.js");
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var CharWidth_1 = __webpack_require__(/*! ./CharWidth */ "./node_modules/xterm/lib/CharWidth.js");
var EscapeSequenceParser_1 = __webpack_require__(/*! ./EscapeSequenceParser */ "./node_modules/xterm/lib/EscapeSequenceParser.js");
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var GLEVEL = { '(': 0, ')': 1, '*': 2, '+': 3, '-': 1, '.': 2 };
var RequestTerminfo = (function () {
    function RequestTerminfo(_terminal) {
        this._terminal = _terminal;
    }
    RequestTerminfo.prototype.hook = function (collect, params, flag) {
        this._data = '';
    };
    RequestTerminfo.prototype.put = function (data, start, end) {
        this._data += data.substring(start, end);
    };
    RequestTerminfo.prototype.unhook = function () {
        this._terminal.handler(EscapeSequences_1.C0.ESC + "P0+r" + this._data + EscapeSequences_1.C0.ESC + "\\");
    };
    return RequestTerminfo;
}());
var DECRQSS = (function () {
    function DECRQSS(_terminal) {
        this._terminal = _terminal;
    }
    DECRQSS.prototype.hook = function (collect, params, flag) {
        this._data = '';
    };
    DECRQSS.prototype.put = function (data, start, end) {
        this._data += data.substring(start, end);
    };
    DECRQSS.prototype.unhook = function () {
        switch (this._data) {
            case '"q':
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r0\"q" + EscapeSequences_1.C0.ESC + "\\");
            case '"p':
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r61\"p" + EscapeSequences_1.C0.ESC + "\\");
            case 'r':
                var pt = '' + (this._terminal.buffer.scrollTop + 1) +
                    ';' + (this._terminal.buffer.scrollBottom + 1) + 'r';
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r" + pt + EscapeSequences_1.C0.ESC + "\\");
            case 'm':
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r0m" + EscapeSequences_1.C0.ESC + "\\");
            case ' q':
                var STYLES = { 'block': 2, 'underline': 4, 'bar': 6 };
                var style = STYLES[this._terminal.getOption('cursorStyle')];
                style -= this._terminal.getOption('cursorBlink');
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r" + style + " q" + EscapeSequences_1.C0.ESC + "\\");
            default:
                this._terminal.error('Unknown DCS $q %s', this._data);
                this._terminal.handler(EscapeSequences_1.C0.ESC + "P0$r" + this._data + EscapeSequences_1.C0.ESC + "\\");
        }
    };
    return DECRQSS;
}());
var InputHandler = (function (_super) {
    __extends(InputHandler, _super);
    function InputHandler(_terminal, _parser) {
        if (_parser === void 0) { _parser = new EscapeSequenceParser_1.EscapeSequenceParser(); }
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._parser = _parser;
        _this.register(_this._parser);
        _this._surrogateFirst = '';
        _this._parser.setCsiHandlerFallback(function (collect, params, flag) {
            _this._terminal.error('Unknown CSI code: ', { collect: collect, params: params, flag: String.fromCharCode(flag) });
        });
        _this._parser.setEscHandlerFallback(function (collect, flag) {
            _this._terminal.error('Unknown ESC code: ', { collect: collect, flag: String.fromCharCode(flag) });
        });
        _this._parser.setExecuteHandlerFallback(function (code) {
            _this._terminal.error('Unknown EXECUTE code: ', { code: code });
        });
        _this._parser.setOscHandlerFallback(function (identifier, data) {
            _this._terminal.error('Unknown OSC code: ', { identifier: identifier, data: data });
        });
        _this._parser.setPrintHandler(function (data, start, end) { return _this.print(data, start, end); });
        _this._parser.setCsiHandler('@', function (params, collect) { return _this.insertChars(params); });
        _this._parser.setCsiHandler('A', function (params, collect) { return _this.cursorUp(params); });
        _this._parser.setCsiHandler('B', function (params, collect) { return _this.cursorDown(params); });
        _this._parser.setCsiHandler('C', function (params, collect) { return _this.cursorForward(params); });
        _this._parser.setCsiHandler('D', function (params, collect) { return _this.cursorBackward(params); });
        _this._parser.setCsiHandler('E', function (params, collect) { return _this.cursorNextLine(params); });
        _this._parser.setCsiHandler('F', function (params, collect) { return _this.cursorPrecedingLine(params); });
        _this._parser.setCsiHandler('G', function (params, collect) { return _this.cursorCharAbsolute(params); });
        _this._parser.setCsiHandler('H', function (params, collect) { return _this.cursorPosition(params); });
        _this._parser.setCsiHandler('I', function (params, collect) { return _this.cursorForwardTab(params); });
        _this._parser.setCsiHandler('J', function (params, collect) { return _this.eraseInDisplay(params); });
        _this._parser.setCsiHandler('K', function (params, collect) { return _this.eraseInLine(params); });
        _this._parser.setCsiHandler('L', function (params, collect) { return _this.insertLines(params); });
        _this._parser.setCsiHandler('M', function (params, collect) { return _this.deleteLines(params); });
        _this._parser.setCsiHandler('P', function (params, collect) { return _this.deleteChars(params); });
        _this._parser.setCsiHandler('S', function (params, collect) { return _this.scrollUp(params); });
        _this._parser.setCsiHandler('T', function (params, collect) { return _this.scrollDown(params, collect); });
        _this._parser.setCsiHandler('X', function (params, collect) { return _this.eraseChars(params); });
        _this._parser.setCsiHandler('Z', function (params, collect) { return _this.cursorBackwardTab(params); });
        _this._parser.setCsiHandler('`', function (params, collect) { return _this.charPosAbsolute(params); });
        _this._parser.setCsiHandler('a', function (params, collect) { return _this.hPositionRelative(params); });
        _this._parser.setCsiHandler('b', function (params, collect) { return _this.repeatPrecedingCharacter(params); });
        _this._parser.setCsiHandler('c', function (params, collect) { return _this.sendDeviceAttributes(params, collect); });
        _this._parser.setCsiHandler('d', function (params, collect) { return _this.linePosAbsolute(params); });
        _this._parser.setCsiHandler('e', function (params, collect) { return _this.vPositionRelative(params); });
        _this._parser.setCsiHandler('f', function (params, collect) { return _this.hVPosition(params); });
        _this._parser.setCsiHandler('g', function (params, collect) { return _this.tabClear(params); });
        _this._parser.setCsiHandler('h', function (params, collect) { return _this.setMode(params, collect); });
        _this._parser.setCsiHandler('l', function (params, collect) { return _this.resetMode(params, collect); });
        _this._parser.setCsiHandler('m', function (params, collect) { return _this.charAttributes(params); });
        _this._parser.setCsiHandler('n', function (params, collect) { return _this.deviceStatus(params, collect); });
        _this._parser.setCsiHandler('p', function (params, collect) { return _this.softReset(params, collect); });
        _this._parser.setCsiHandler('q', function (params, collect) { return _this.setCursorStyle(params, collect); });
        _this._parser.setCsiHandler('r', function (params, collect) { return _this.setScrollRegion(params, collect); });
        _this._parser.setCsiHandler('s', function (params, collect) { return _this.saveCursor(params); });
        _this._parser.setCsiHandler('u', function (params, collect) { return _this.restoreCursor(params); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.BEL, function () { return _this.bell(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.LF, function () { return _this.lineFeed(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.VT, function () { return _this.lineFeed(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.FF, function () { return _this.lineFeed(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.CR, function () { return _this.carriageReturn(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.BS, function () { return _this.backspace(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.HT, function () { return _this.tab(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.SO, function () { return _this.shiftOut(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.SI, function () { return _this.shiftIn(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C1.IND, function () { return _this.index(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C1.NEL, function () { return _this.nextLine(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C1.HTS, function () { return _this.tabSet(); });
        _this._parser.setOscHandler(0, function (data) { return _this.setTitle(data); });
        _this._parser.setOscHandler(2, function (data) { return _this.setTitle(data); });
        _this._parser.setEscHandler('7', function () { return _this.saveCursor([]); });
        _this._parser.setEscHandler('8', function () { return _this.restoreCursor([]); });
        _this._parser.setEscHandler('D', function () { return _this.index(); });
        _this._parser.setEscHandler('E', function () { return _this.nextLine(); });
        _this._parser.setEscHandler('H', function () { return _this.tabSet(); });
        _this._parser.setEscHandler('M', function () { return _this.reverseIndex(); });
        _this._parser.setEscHandler('=', function () { return _this.keypadApplicationMode(); });
        _this._parser.setEscHandler('>', function () { return _this.keypadNumericMode(); });
        _this._parser.setEscHandler('c', function () { return _this.reset(); });
        _this._parser.setEscHandler('n', function () { return _this.setgLevel(2); });
        _this._parser.setEscHandler('o', function () { return _this.setgLevel(3); });
        _this._parser.setEscHandler('|', function () { return _this.setgLevel(3); });
        _this._parser.setEscHandler('}', function () { return _this.setgLevel(2); });
        _this._parser.setEscHandler('~', function () { return _this.setgLevel(1); });
        _this._parser.setEscHandler('%@', function () { return _this.selectDefaultCharset(); });
        _this._parser.setEscHandler('%G', function () { return _this.selectDefaultCharset(); });
        var _loop_1 = function (flag) {
            this_1._parser.setEscHandler('(' + flag, function () { return _this.selectCharset('(' + flag); });
            this_1._parser.setEscHandler(')' + flag, function () { return _this.selectCharset(')' + flag); });
            this_1._parser.setEscHandler('*' + flag, function () { return _this.selectCharset('*' + flag); });
            this_1._parser.setEscHandler('+' + flag, function () { return _this.selectCharset('+' + flag); });
            this_1._parser.setEscHandler('-' + flag, function () { return _this.selectCharset('-' + flag); });
            this_1._parser.setEscHandler('.' + flag, function () { return _this.selectCharset('.' + flag); });
            this_1._parser.setEscHandler('/' + flag, function () { return _this.selectCharset('/' + flag); });
        };
        var this_1 = this;
        for (var flag in Charsets_1.CHARSETS) {
            _loop_1(flag);
        }
        _this._parser.setErrorHandler(function (state) {
            _this._terminal.error('Parsing error: ', state);
            return state;
        });
        _this._parser.setDcsHandler('$q', new DECRQSS(_this._terminal));
        _this._parser.setDcsHandler('+q', new RequestTerminfo(_this._terminal));
        return _this;
    }
    InputHandler.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._terminal = null;
    };
    InputHandler.prototype.parse = function (data) {
        if (!this._terminal) {
            return;
        }
        var buffer = this._terminal.buffer;
        var cursorStartX = buffer.x;
        var cursorStartY = buffer.y;
        if (this._terminal.debug) {
            this._terminal.log('data: ' + data);
        }
        if (this._surrogateFirst) {
            data = this._surrogateFirst + data;
            this._surrogateFirst = '';
        }
        this._parser.parse(data);
        buffer = this._terminal.buffer;
        if (buffer.x !== cursorStartX || buffer.y !== cursorStartY) {
            this._terminal.emit('cursormove');
        }
    };
    InputHandler.prototype.print = function (data, start, end) {
        var char;
        var code;
        var chWidth;
        var buffer = this._terminal.buffer;
        var charset = this._terminal.charset;
        var screenReaderMode = this._terminal.options.screenReaderMode;
        var cols = this._terminal.cols;
        var wraparoundMode = this._terminal.wraparoundMode;
        var insertMode = this._terminal.insertMode;
        var curAttr = this._terminal.curAttr;
        var bufferRow = buffer.lines.get(buffer.y + buffer.ybase);
        this._terminal.updateRange(buffer.y);
        for (var stringPosition = start; stringPosition < end; ++stringPosition) {
            char = data.charAt(stringPosition);
            code = data.charCodeAt(stringPosition);
            if (0xD800 <= code && code <= 0xDBFF) {
                if (++stringPosition >= end) {
                    this._surrogateFirst = char;
                    continue;
                }
                var second = data.charCodeAt(stringPosition);
                if (0xDC00 <= second && second <= 0xDFFF) {
                    code = (code - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
                    char += data.charAt(stringPosition);
                }
                else {
                    stringPosition--;
                }
            }
            chWidth = CharWidth_1.wcwidth(code);
            if (charset) {
                char = charset[char] || char;
                code = char.charCodeAt(0);
            }
            if (screenReaderMode) {
                this._terminal.emit('a11y.char', char);
            }
            if (!chWidth && buffer.x) {
                var chMinusOne = bufferRow.get(buffer.x - 1);
                if (chMinusOne) {
                    if (!chMinusOne[Buffer_1.CHAR_DATA_WIDTH_INDEX]) {
                        var chMinusTwo = bufferRow.get(buffer.x - 2);
                        if (chMinusTwo) {
                            chMinusTwo[Buffer_1.CHAR_DATA_CHAR_INDEX] += char;
                            chMinusTwo[Buffer_1.CHAR_DATA_CODE_INDEX] = code;
                            bufferRow.set(buffer.x - 2, chMinusTwo);
                        }
                    }
                    else {
                        chMinusOne[Buffer_1.CHAR_DATA_CHAR_INDEX] += char;
                        chMinusOne[Buffer_1.CHAR_DATA_CODE_INDEX] = code;
                        bufferRow.set(buffer.x - 1, chMinusOne);
                    }
                }
                continue;
            }
            if (buffer.x + chWidth - 1 >= cols) {
                if (wraparoundMode) {
                    buffer.x = 0;
                    buffer.y++;
                    if (buffer.y > buffer.scrollBottom) {
                        buffer.y--;
                        this._terminal.scroll(true);
                    }
                    else {
                        buffer.lines.get(buffer.y).isWrapped = true;
                    }
                    bufferRow = buffer.lines.get(buffer.y + buffer.ybase);
                }
                else {
                    if (chWidth === 2) {
                        continue;
                    }
                }
            }
            if (insertMode) {
                bufferRow.insertCells(buffer.x, chWidth, [curAttr, Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
                var lastCell = bufferRow.get(cols - 1);
                if (lastCell[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 2) {
                    bufferRow.set(cols - 1, [curAttr, Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
                }
            }
            bufferRow.set(buffer.x++, [curAttr, char, chWidth, code]);
            if (chWidth > 0) {
                while (--chWidth) {
                    bufferRow.set(buffer.x++, [curAttr, '', 0, undefined]);
                }
            }
        }
        this._terminal.updateRange(buffer.y);
    };
    InputHandler.prototype.bell = function () {
        this._terminal.bell();
    };
    InputHandler.prototype.lineFeed = function () {
        var buffer = this._terminal.buffer;
        if (this._terminal.options.convertEol) {
            buffer.x = 0;
        }
        buffer.y++;
        if (buffer.y > buffer.scrollBottom) {
            buffer.y--;
            this._terminal.scroll();
        }
        if (buffer.x >= this._terminal.cols) {
            buffer.x--;
        }
        this._terminal.emit('linefeed');
    };
    InputHandler.prototype.carriageReturn = function () {
        this._terminal.buffer.x = 0;
    };
    InputHandler.prototype.backspace = function () {
        if (this._terminal.buffer.x > 0) {
            this._terminal.buffer.x--;
        }
    };
    InputHandler.prototype.tab = function () {
        var originalX = this._terminal.buffer.x;
        this._terminal.buffer.x = this._terminal.buffer.nextStop();
        if (this._terminal.options.screenReaderMode) {
            this._terminal.emit('a11y.tab', this._terminal.buffer.x - originalX);
        }
    };
    InputHandler.prototype.shiftOut = function () {
        this._terminal.setgLevel(1);
    };
    InputHandler.prototype.shiftIn = function () {
        this._terminal.setgLevel(0);
    };
    InputHandler.prototype.insertChars = function (params) {
        this._terminal.buffer.lines.get(this._terminal.buffer.y + this._terminal.buffer.ybase).insertCells(this._terminal.buffer.x, params[0] || 1, [this._terminal.eraseAttr(), Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
        this._terminal.updateRange(this._terminal.buffer.y);
    };
    InputHandler.prototype.cursorUp = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y -= param;
        if (this._terminal.buffer.y < 0) {
            this._terminal.buffer.y = 0;
        }
    };
    InputHandler.prototype.cursorDown = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y += param;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x--;
        }
    };
    InputHandler.prototype.cursorForward = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x += param;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.cursorBackward = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x--;
        }
        this._terminal.buffer.x -= param;
        if (this._terminal.buffer.x < 0) {
            this._terminal.buffer.x = 0;
        }
    };
    InputHandler.prototype.cursorNextLine = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y += param;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        this._terminal.buffer.x = 0;
    };
    InputHandler.prototype.cursorPrecedingLine = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y -= param;
        if (this._terminal.buffer.y < 0) {
            this._terminal.buffer.y = 0;
        }
        this._terminal.buffer.x = 0;
    };
    InputHandler.prototype.cursorCharAbsolute = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x = param - 1;
    };
    InputHandler.prototype.cursorPosition = function (params) {
        var col;
        var row = params[0] - 1;
        if (params.length >= 2) {
            col = params[1] - 1;
        }
        else {
            col = 0;
        }
        if (row < 0) {
            row = 0;
        }
        else if (row >= this._terminal.rows) {
            row = this._terminal.rows - 1;
        }
        if (col < 0) {
            col = 0;
        }
        else if (col >= this._terminal.cols) {
            col = this._terminal.cols - 1;
        }
        this._terminal.buffer.x = col;
        this._terminal.buffer.y = row;
    };
    InputHandler.prototype.cursorForwardTab = function (params) {
        var param = params[0] || 1;
        while (param--) {
            this._terminal.buffer.x = this._terminal.buffer.nextStop();
        }
    };
    InputHandler.prototype._eraseInBufferLine = function (y, start, end, clearWrap) {
        if (clearWrap === void 0) { clearWrap = false; }
        var line = this._terminal.buffer.lines.get(this._terminal.buffer.ybase + y);
        line.replaceCells(start, end, [this._terminal.eraseAttr(), Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
        if (clearWrap) {
            line.isWrapped = false;
        }
    };
    InputHandler.prototype._resetBufferLine = function (y) {
        this._eraseInBufferLine(y, 0, this._terminal.cols, true);
    };
    InputHandler.prototype.eraseInDisplay = function (params) {
        var j;
        switch (params[0]) {
            case 0:
                j = this._terminal.buffer.y;
                this._terminal.updateRange(j);
                this._eraseInBufferLine(j++, this._terminal.buffer.x, this._terminal.cols, this._terminal.buffer.x === 0);
                for (; j < this._terminal.rows; j++) {
                    this._resetBufferLine(j);
                }
                this._terminal.updateRange(j);
                break;
            case 1:
                j = this._terminal.buffer.y;
                this._terminal.updateRange(j);
                this._eraseInBufferLine(j, 0, this._terminal.buffer.x + 1, true);
                if (this._terminal.buffer.x + 1 >= this._terminal.cols) {
                    this._terminal.buffer.lines.get(j + 1).isWrapped = false;
                }
                while (j--) {
                    this._resetBufferLine(j);
                }
                this._terminal.updateRange(0);
                break;
            case 2:
                j = this._terminal.rows;
                this._terminal.updateRange(j - 1);
                while (j--) {
                    this._resetBufferLine(j);
                }
                this._terminal.updateRange(0);
                break;
            case 3:
                var scrollBackSize = this._terminal.buffer.lines.length - this._terminal.rows;
                if (scrollBackSize > 0) {
                    this._terminal.buffer.lines.trimStart(scrollBackSize);
                    this._terminal.buffer.ybase = Math.max(this._terminal.buffer.ybase - scrollBackSize, 0);
                    this._terminal.buffer.ydisp = Math.max(this._terminal.buffer.ydisp - scrollBackSize, 0);
                    this._terminal.emit('scroll', 0);
                }
                break;
        }
    };
    InputHandler.prototype.eraseInLine = function (params) {
        switch (params[0]) {
            case 0:
                this._eraseInBufferLine(this._terminal.buffer.y, this._terminal.buffer.x, this._terminal.cols);
                break;
            case 1:
                this._eraseInBufferLine(this._terminal.buffer.y, 0, this._terminal.buffer.x + 1);
                break;
            case 2:
                this._eraseInBufferLine(this._terminal.buffer.y, 0, this._terminal.cols);
                break;
        }
        this._terminal.updateRange(this._terminal.buffer.y);
    };
    InputHandler.prototype.insertLines = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        var buffer = this._terminal.buffer;
        var row = buffer.y + buffer.ybase;
        var scrollBottomRowsOffset = this._terminal.rows - 1 - buffer.scrollBottom;
        var scrollBottomAbsolute = this._terminal.rows - 1 + buffer.ybase - scrollBottomRowsOffset + 1;
        while (param--) {
            buffer.lines.splice(scrollBottomAbsolute - 1, 1);
            buffer.lines.splice(row, 0, buffer.getBlankLine(this._terminal.eraseAttr()));
        }
        this._terminal.updateRange(buffer.y);
        this._terminal.updateRange(buffer.scrollBottom);
    };
    InputHandler.prototype.deleteLines = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        var buffer = this._terminal.buffer;
        var row = buffer.y + buffer.ybase;
        var j;
        j = this._terminal.rows - 1 - buffer.scrollBottom;
        j = this._terminal.rows - 1 + buffer.ybase - j;
        while (param--) {
            buffer.lines.splice(row, 1);
            buffer.lines.splice(j, 0, buffer.getBlankLine(this._terminal.eraseAttr()));
        }
        this._terminal.updateRange(buffer.y);
        this._terminal.updateRange(buffer.scrollBottom);
    };
    InputHandler.prototype.deleteChars = function (params) {
        this._terminal.buffer.lines.get(this._terminal.buffer.y + this._terminal.buffer.ybase).deleteCells(this._terminal.buffer.x, params[0] || 1, [this._terminal.eraseAttr(), Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
        this._terminal.updateRange(this._terminal.buffer.y);
    };
    InputHandler.prototype.scrollUp = function (params) {
        var param = params[0] || 1;
        var buffer = this._terminal.buffer;
        while (param--) {
            buffer.lines.splice(buffer.ybase + buffer.scrollTop, 1);
            buffer.lines.splice(buffer.ybase + buffer.scrollBottom, 0, buffer.getBlankLine(Buffer_1.DEFAULT_ATTR));
        }
        this._terminal.updateRange(buffer.scrollTop);
        this._terminal.updateRange(buffer.scrollBottom);
    };
    InputHandler.prototype.scrollDown = function (params, collect) {
        if (params.length < 2 && !collect) {
            var param = params[0] || 1;
            var buffer = this._terminal.buffer;
            while (param--) {
                buffer.lines.splice(buffer.ybase + buffer.scrollBottom, 1);
                buffer.lines.splice(buffer.ybase + buffer.scrollBottom, 0, buffer.getBlankLine(Buffer_1.DEFAULT_ATTR));
            }
            this._terminal.updateRange(buffer.scrollTop);
            this._terminal.updateRange(buffer.scrollBottom);
        }
    };
    InputHandler.prototype.eraseChars = function (params) {
        this._terminal.buffer.lines.get(this._terminal.buffer.y + this._terminal.buffer.ybase).replaceCells(this._terminal.buffer.x, this._terminal.buffer.x + (params[0] || 1), [this._terminal.eraseAttr(), Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
    };
    InputHandler.prototype.cursorBackwardTab = function (params) {
        var param = params[0] || 1;
        var buffer = this._terminal.buffer;
        while (param--) {
            buffer.x = buffer.prevStop();
        }
    };
    InputHandler.prototype.charPosAbsolute = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x = param - 1;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.hPositionRelative = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x += param;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.repeatPrecedingCharacter = function (params) {
        var buffer = this._terminal.buffer;
        var line = buffer.lines.get(buffer.ybase + buffer.y);
        line.replaceCells(buffer.x, buffer.x + (params[0] || 1), line.get(buffer.x - 1) || [Buffer_1.DEFAULT_ATTR, Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE]);
    };
    InputHandler.prototype.sendDeviceAttributes = function (params, collect) {
        if (params[0] > 0) {
            return;
        }
        if (!collect) {
            if (this._terminal.is('xterm') || this._terminal.is('rxvt-unicode') || this._terminal.is('screen')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[?1;2c');
            }
            else if (this._terminal.is('linux')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[?6c');
            }
        }
        else if (collect === '>') {
            if (this._terminal.is('xterm')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[>0;276;0c');
            }
            else if (this._terminal.is('rxvt-unicode')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[>85;95;0c');
            }
            else if (this._terminal.is('linux')) {
                this._terminal.handler(params[0] + 'c');
            }
            else if (this._terminal.is('screen')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[>83;40003;0c');
            }
        }
    };
    InputHandler.prototype.linePosAbsolute = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y = param - 1;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
    };
    InputHandler.prototype.vPositionRelative = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y += param;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x--;
        }
    };
    InputHandler.prototype.hVPosition = function (params) {
        if (params[0] < 1)
            params[0] = 1;
        if (params[1] < 1)
            params[1] = 1;
        this._terminal.buffer.y = params[0] - 1;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        this._terminal.buffer.x = params[1] - 1;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.tabClear = function (params) {
        var param = params[0];
        if (param <= 0) {
            delete this._terminal.buffer.tabs[this._terminal.buffer.x];
        }
        else if (param === 3) {
            this._terminal.buffer.tabs = {};
        }
    };
    InputHandler.prototype.setMode = function (params, collect) {
        if (params.length > 1) {
            for (var i = 0; i < params.length; i++) {
                this.setMode([params[i]]);
            }
            return;
        }
        if (!collect) {
            switch (params[0]) {
                case 4:
                    this._terminal.insertMode = true;
                    break;
                case 20:
                    break;
            }
        }
        else if (collect === '?') {
            switch (params[0]) {
                case 1:
                    this._terminal.applicationCursor = true;
                    break;
                case 2:
                    this._terminal.setgCharset(0, Charsets_1.DEFAULT_CHARSET);
                    this._terminal.setgCharset(1, Charsets_1.DEFAULT_CHARSET);
                    this._terminal.setgCharset(2, Charsets_1.DEFAULT_CHARSET);
                    this._terminal.setgCharset(3, Charsets_1.DEFAULT_CHARSET);
                    break;
                case 3:
                    this._terminal.savedCols = this._terminal.cols;
                    this._terminal.resize(132, this._terminal.rows);
                    break;
                case 6:
                    this._terminal.originMode = true;
                    break;
                case 7:
                    this._terminal.wraparoundMode = true;
                    break;
                case 12:
                    break;
                case 66:
                    this._terminal.log('Serial port requested application keypad.');
                    this._terminal.applicationKeypad = true;
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    break;
                case 9:
                case 1000:
                case 1002:
                case 1003:
                    this._terminal.x10Mouse = params[0] === 9;
                    this._terminal.vt200Mouse = params[0] === 1000;
                    this._terminal.normalMouse = params[0] > 1000;
                    this._terminal.mouseEvents = true;
                    this._terminal.element.classList.add('enable-mouse-events');
                    this._terminal.selectionManager.disable();
                    this._terminal.log('Binding to mouse events.');
                    break;
                case 1004:
                    this._terminal.sendFocus = true;
                    break;
                case 1005:
                    this._terminal.utfMouse = true;
                    break;
                case 1006:
                    this._terminal.sgrMouse = true;
                    break;
                case 1015:
                    this._terminal.urxvtMouse = true;
                    break;
                case 25:
                    this._terminal.cursorHidden = false;
                    break;
                case 1048:
                    this.saveCursor(params);
                    break;
                case 1049:
                    this.saveCursor(params);
                case 47:
                case 1047:
                    this._terminal.buffers.activateAltBuffer(this._terminal.eraseAttr());
                    this._terminal.refresh(0, this._terminal.rows - 1);
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    this._terminal.showCursor();
                    break;
                case 2004:
                    this._terminal.bracketedPasteMode = true;
                    break;
            }
        }
    };
    InputHandler.prototype.resetMode = function (params, collect) {
        if (params.length > 1) {
            for (var i = 0; i < params.length; i++) {
                this.resetMode([params[i]]);
            }
            return;
        }
        if (!collect) {
            switch (params[0]) {
                case 4:
                    this._terminal.insertMode = false;
                    break;
                case 20:
                    break;
            }
        }
        else if (collect === '?') {
            switch (params[0]) {
                case 1:
                    this._terminal.applicationCursor = false;
                    break;
                case 3:
                    if (this._terminal.cols === 132 && this._terminal.savedCols) {
                        this._terminal.resize(this._terminal.savedCols, this._terminal.rows);
                    }
                    delete this._terminal.savedCols;
                    break;
                case 6:
                    this._terminal.originMode = false;
                    break;
                case 7:
                    this._terminal.wraparoundMode = false;
                    break;
                case 12:
                    break;
                case 66:
                    this._terminal.log('Switching back to normal keypad.');
                    this._terminal.applicationKeypad = false;
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    break;
                case 9:
                case 1000:
                case 1002:
                case 1003:
                    this._terminal.x10Mouse = false;
                    this._terminal.vt200Mouse = false;
                    this._terminal.normalMouse = false;
                    this._terminal.mouseEvents = false;
                    this._terminal.element.classList.remove('enable-mouse-events');
                    this._terminal.selectionManager.enable();
                    break;
                case 1004:
                    this._terminal.sendFocus = false;
                    break;
                case 1005:
                    this._terminal.utfMouse = false;
                    break;
                case 1006:
                    this._terminal.sgrMouse = false;
                    break;
                case 1015:
                    this._terminal.urxvtMouse = false;
                    break;
                case 25:
                    this._terminal.cursorHidden = true;
                    break;
                case 1048:
                    this.restoreCursor(params);
                    break;
                case 1049:
                case 47:
                case 1047:
                    this._terminal.buffers.activateNormalBuffer();
                    if (params[0] === 1049) {
                        this.restoreCursor(params);
                    }
                    this._terminal.refresh(0, this._terminal.rows - 1);
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    this._terminal.showCursor();
                    break;
                case 2004:
                    this._terminal.bracketedPasteMode = false;
                    break;
            }
        }
    };
    InputHandler.prototype.charAttributes = function (params) {
        if (params.length === 1 && params[0] === 0) {
            this._terminal.curAttr = Buffer_1.DEFAULT_ATTR;
            return;
        }
        var l = params.length;
        var flags = this._terminal.curAttr >> 18;
        var fg = (this._terminal.curAttr >> 9) & 0x1ff;
        var bg = this._terminal.curAttr & 0x1ff;
        var p;
        for (var i = 0; i < l; i++) {
            p = params[i];
            if (p >= 30 && p <= 37) {
                fg = p - 30;
            }
            else if (p >= 40 && p <= 47) {
                bg = p - 40;
            }
            else if (p >= 90 && p <= 97) {
                p += 8;
                fg = p - 90;
            }
            else if (p >= 100 && p <= 107) {
                p += 8;
                bg = p - 100;
            }
            else if (p === 0) {
                flags = Buffer_1.DEFAULT_ATTR >> 18;
                fg = (Buffer_1.DEFAULT_ATTR >> 9) & 0x1ff;
                bg = Buffer_1.DEFAULT_ATTR & 0x1ff;
            }
            else if (p === 1) {
                flags |= 1;
            }
            else if (p === 3) {
                flags |= 64;
            }
            else if (p === 4) {
                flags |= 2;
            }
            else if (p === 5) {
                flags |= 4;
            }
            else if (p === 7) {
                flags |= 8;
            }
            else if (p === 8) {
                flags |= 16;
            }
            else if (p === 2) {
                flags |= 32;
            }
            else if (p === 22) {
                flags &= ~1;
                flags &= ~32;
            }
            else if (p === 23) {
                flags &= ~64;
            }
            else if (p === 24) {
                flags &= ~2;
            }
            else if (p === 25) {
                flags &= ~4;
            }
            else if (p === 27) {
                flags &= ~8;
            }
            else if (p === 28) {
                flags &= ~16;
            }
            else if (p === 39) {
                fg = (Buffer_1.DEFAULT_ATTR >> 9) & 0x1ff;
            }
            else if (p === 49) {
                bg = Buffer_1.DEFAULT_ATTR & 0x1ff;
            }
            else if (p === 38) {
                if (params[i + 1] === 2) {
                    i += 2;
                    fg = this._terminal.matchColor(params[i] & 0xff, params[i + 1] & 0xff, params[i + 2] & 0xff);
                    if (fg === -1)
                        fg = 0x1ff;
                    i += 2;
                }
                else if (params[i + 1] === 5) {
                    i += 2;
                    p = params[i] & 0xff;
                    fg = p;
                }
            }
            else if (p === 48) {
                if (params[i + 1] === 2) {
                    i += 2;
                    bg = this._terminal.matchColor(params[i] & 0xff, params[i + 1] & 0xff, params[i + 2] & 0xff);
                    if (bg === -1)
                        bg = 0x1ff;
                    i += 2;
                }
                else if (params[i + 1] === 5) {
                    i += 2;
                    p = params[i] & 0xff;
                    bg = p;
                }
            }
            else if (p === 100) {
                fg = (Buffer_1.DEFAULT_ATTR >> 9) & 0x1ff;
                bg = Buffer_1.DEFAULT_ATTR & 0x1ff;
            }
            else {
                this._terminal.error('Unknown SGR attribute: %d.', p);
            }
        }
        this._terminal.curAttr = (flags << 18) | (fg << 9) | bg;
    };
    InputHandler.prototype.deviceStatus = function (params, collect) {
        if (!collect) {
            switch (params[0]) {
                case 5:
                    this._terminal.emit('data', EscapeSequences_1.C0.ESC + "[0n");
                    break;
                case 6:
                    var y = this._terminal.buffer.y + 1;
                    var x = this._terminal.buffer.x + 1;
                    this._terminal.emit('data', EscapeSequences_1.C0.ESC + "[" + y + ";" + x + "R");
                    break;
            }
        }
        else if (collect === '?') {
            switch (params[0]) {
                case 6:
                    var y = this._terminal.buffer.y + 1;
                    var x = this._terminal.buffer.x + 1;
                    this._terminal.emit('data', EscapeSequences_1.C0.ESC + "[?" + y + ";" + x + "R");
                    break;
                case 15:
                    break;
                case 25:
                    break;
                case 26:
                    break;
                case 53:
                    break;
            }
        }
    };
    InputHandler.prototype.softReset = function (params, collect) {
        if (collect === '!') {
            this._terminal.cursorHidden = false;
            this._terminal.insertMode = false;
            this._terminal.originMode = false;
            this._terminal.wraparoundMode = true;
            this._terminal.applicationKeypad = false;
            if (this._terminal.viewport) {
                this._terminal.viewport.syncScrollArea();
            }
            this._terminal.applicationCursor = false;
            this._terminal.buffer.scrollTop = 0;
            this._terminal.buffer.scrollBottom = this._terminal.rows - 1;
            this._terminal.curAttr = Buffer_1.DEFAULT_ATTR;
            this._terminal.buffer.x = this._terminal.buffer.y = 0;
            this._terminal.charset = null;
            this._terminal.glevel = 0;
            this._terminal.charsets = [null];
        }
    };
    InputHandler.prototype.setCursorStyle = function (params, collect) {
        if (collect === ' ') {
            var param = params[0] < 1 ? 1 : params[0];
            switch (param) {
                case 1:
                case 2:
                    this._terminal.setOption('cursorStyle', 'block');
                    break;
                case 3:
                case 4:
                    this._terminal.setOption('cursorStyle', 'underline');
                    break;
                case 5:
                case 6:
                    this._terminal.setOption('cursorStyle', 'bar');
                    break;
            }
            var isBlinking = param % 2 === 1;
            this._terminal.setOption('cursorBlink', isBlinking);
        }
    };
    InputHandler.prototype.setScrollRegion = function (params, collect) {
        if (collect)
            return;
        this._terminal.buffer.scrollTop = (params[0] || 1) - 1;
        this._terminal.buffer.scrollBottom = (params[1] && params[1] <= this._terminal.rows ? params[1] : this._terminal.rows) - 1;
        this._terminal.buffer.x = 0;
        this._terminal.buffer.y = 0;
    };
    InputHandler.prototype.saveCursor = function (params) {
        this._terminal.buffer.savedX = this._terminal.buffer.x;
        this._terminal.buffer.savedY = this._terminal.buffer.y;
        this._terminal.buffer.savedCurAttr = this._terminal.curAttr;
    };
    InputHandler.prototype.restoreCursor = function (params) {
        this._terminal.buffer.x = this._terminal.buffer.savedX || 0;
        this._terminal.buffer.y = this._terminal.buffer.savedY || 0;
        this._terminal.curAttr = this._terminal.buffer.savedCurAttr || Buffer_1.DEFAULT_ATTR;
    };
    InputHandler.prototype.setTitle = function (data) {
        this._terminal.handleTitle(data);
    };
    InputHandler.prototype.nextLine = function () {
        this._terminal.buffer.x = 0;
        this.index();
    };
    InputHandler.prototype.keypadApplicationMode = function () {
        this._terminal.log('Serial port requested application keypad.');
        this._terminal.applicationKeypad = true;
        if (this._terminal.viewport) {
            this._terminal.viewport.syncScrollArea();
        }
    };
    InputHandler.prototype.keypadNumericMode = function () {
        this._terminal.log('Switching back to normal keypad.');
        this._terminal.applicationKeypad = false;
        if (this._terminal.viewport) {
            this._terminal.viewport.syncScrollArea();
        }
    };
    InputHandler.prototype.selectDefaultCharset = function () {
        this._terminal.setgLevel(0);
        this._terminal.setgCharset(0, Charsets_1.DEFAULT_CHARSET);
    };
    InputHandler.prototype.selectCharset = function (collectAndFlag) {
        if (collectAndFlag.length !== 2)
            return this.selectDefaultCharset();
        if (collectAndFlag[0] === '/')
            return;
        this._terminal.setgCharset(GLEVEL[collectAndFlag[0]], Charsets_1.CHARSETS[collectAndFlag[1]] || Charsets_1.DEFAULT_CHARSET);
    };
    InputHandler.prototype.index = function () {
        this._terminal.index();
    };
    InputHandler.prototype.tabSet = function () {
        this._terminal.tabSet();
    };
    InputHandler.prototype.reverseIndex = function () {
        this._terminal.reverseIndex();
    };
    InputHandler.prototype.reset = function () {
        this._parser.reset();
        this._terminal.reset();
    };
    InputHandler.prototype.setgLevel = function (level) {
        this._terminal.setgLevel(level);
    };
    return InputHandler;
}(Lifecycle_1.Disposable));
exports.InputHandler = InputHandler;
//# sourceMappingURL=InputHandler.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Linkifier.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/Linkifier.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var MouseZoneManager_1 = __webpack_require__(/*! ./ui/MouseZoneManager */ "./node_modules/xterm/lib/ui/MouseZoneManager.js");
var EventEmitter_1 = __webpack_require__(/*! ./common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var CharWidth_1 = __webpack_require__(/*! ./CharWidth */ "./node_modules/xterm/lib/CharWidth.js");
var Linkifier = (function (_super) {
    __extends(Linkifier, _super);
    function Linkifier(_terminal) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._linkMatchers = [];
        _this._nextLinkMatcherId = 0;
        _this._rowsToLinkify = {
            start: null,
            end: null
        };
        return _this;
    }
    Linkifier.prototype.attachToDom = function (mouseZoneManager) {
        this._mouseZoneManager = mouseZoneManager;
    };
    Linkifier.prototype.linkifyRows = function (start, end) {
        var _this = this;
        if (!this._mouseZoneManager) {
            return;
        }
        if (this._rowsToLinkify.start === null) {
            this._rowsToLinkify.start = start;
            this._rowsToLinkify.end = end;
        }
        else {
            this._rowsToLinkify.start = Math.min(this._rowsToLinkify.start, start);
            this._rowsToLinkify.end = Math.max(this._rowsToLinkify.end, end);
        }
        this._mouseZoneManager.clearAll(start, end);
        if (this._rowsTimeoutId) {
            clearTimeout(this._rowsTimeoutId);
        }
        this._rowsTimeoutId = setTimeout(function () { return _this._linkifyRows(); }, Linkifier.TIME_BEFORE_LINKIFY);
    };
    Linkifier.prototype._linkifyRows = function () {
        this._rowsTimeoutId = null;
        var buffer = this._terminal.buffer;
        var absoluteRowIndexStart = buffer.ydisp + this._rowsToLinkify.start;
        if (absoluteRowIndexStart >= buffer.lines.length) {
            return;
        }
        var absoluteRowIndexEnd = buffer.ydisp + Math.min(this._rowsToLinkify.end, this._terminal.rows) + 1;
        var overscanLineLimit = Math.ceil(Linkifier.OVERSCAN_CHAR_LIMIT / this._terminal.cols);
        var iterator = this._terminal.buffer.iterator(false, absoluteRowIndexStart, absoluteRowIndexEnd, overscanLineLimit, overscanLineLimit);
        while (iterator.hasNext()) {
            var lineData = iterator.next();
            for (var i = 0; i < this._linkMatchers.length; i++) {
                this._doLinkifyRow(lineData.range.first, lineData.content, this._linkMatchers[i]);
            }
        }
        this._rowsToLinkify.start = null;
        this._rowsToLinkify.end = null;
    };
    Linkifier.prototype.registerLinkMatcher = function (regex, handler, options) {
        if (options === void 0) { options = {}; }
        if (!handler) {
            throw new Error('handler must be defined');
        }
        var matcher = {
            id: this._nextLinkMatcherId++,
            regex: regex,
            handler: handler,
            matchIndex: options.matchIndex,
            validationCallback: options.validationCallback,
            hoverTooltipCallback: options.tooltipCallback,
            hoverLeaveCallback: options.leaveCallback,
            willLinkActivate: options.willLinkActivate,
            priority: options.priority || 0
        };
        this._addLinkMatcherToList(matcher);
        return matcher.id;
    };
    Linkifier.prototype._addLinkMatcherToList = function (matcher) {
        if (this._linkMatchers.length === 0) {
            this._linkMatchers.push(matcher);
            return;
        }
        for (var i = this._linkMatchers.length - 1; i >= 0; i--) {
            if (matcher.priority <= this._linkMatchers[i].priority) {
                this._linkMatchers.splice(i + 1, 0, matcher);
                return;
            }
        }
        this._linkMatchers.splice(0, 0, matcher);
    };
    Linkifier.prototype.deregisterLinkMatcher = function (matcherId) {
        for (var i = 0; i < this._linkMatchers.length; i++) {
            if (this._linkMatchers[i].id === matcherId) {
                this._linkMatchers.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    Linkifier.prototype._doLinkifyRow = function (rowIndex, text, matcher) {
        var _this = this;
        var rex = new RegExp(matcher.regex.source, matcher.regex.flags + 'g');
        var match;
        var stringIndex = -1;
        var _loop_1 = function () {
            var uri = match[typeof matcher.matchIndex !== 'number' ? 0 : matcher.matchIndex];
            if (!uri) {
                if (this_1._terminal.debug) {
                    console.log({ match: match, matcher: matcher });
                    throw new Error('match found without corresponding matchIndex');
                }
                return "break";
            }
            stringIndex = text.indexOf(uri, stringIndex + 1);
            rex.lastIndex = stringIndex + uri.length;
            var bufferIndex = this_1._terminal.buffer.stringIndexToBufferIndex(rowIndex, stringIndex);
            var line = this_1._terminal.buffer.lines.get(bufferIndex[0]);
            var char = line.get(bufferIndex[1]);
            var fg;
            if (char) {
                var attr = char[Buffer_1.CHAR_DATA_ATTR_INDEX];
                fg = (attr >> 9) & 0x1ff;
            }
            if (matcher.validationCallback) {
                matcher.validationCallback(uri, function (isValid) {
                    if (_this._rowsTimeoutId) {
                        return;
                    }
                    if (isValid) {
                        _this._addLink(bufferIndex[1], bufferIndex[0] - _this._terminal.buffer.ydisp, uri, matcher, fg);
                    }
                });
            }
            else {
                this_1._addLink(bufferIndex[1], bufferIndex[0] - this_1._terminal.buffer.ydisp, uri, matcher, fg);
            }
        };
        var this_1 = this;
        while ((match = rex.exec(text)) !== null) {
            var state_1 = _loop_1();
            if (state_1 === "break")
                break;
        }
    };
    Linkifier.prototype._addLink = function (x, y, uri, matcher, fg) {
        var _this = this;
        var width = CharWidth_1.getStringCellWidth(uri);
        var x1 = x % this._terminal.cols;
        var y1 = y + Math.floor(x / this._terminal.cols);
        var x2 = (x1 + width) % this._terminal.cols;
        var y2 = y1 + Math.floor((x1 + width) / this._terminal.cols);
        if (x2 === 0) {
            x2 = this._terminal.cols;
            y2--;
        }
        this._mouseZoneManager.add(new MouseZoneManager_1.MouseZone(x1 + 1, y1 + 1, x2 + 1, y2 + 1, function (e) {
            if (matcher.handler) {
                return matcher.handler(e, uri);
            }
            window.open(uri, '_blank');
        }, function (e) {
            _this.emit("linkhover", _this._createLinkHoverEvent(x1, y1, x2, y2, fg));
            _this._terminal.element.classList.add('xterm-cursor-pointer');
        }, function (e) {
            _this.emit("linktooltip", _this._createLinkHoverEvent(x1, y1, x2, y2, fg));
            if (matcher.hoverTooltipCallback) {
                matcher.hoverTooltipCallback(e, uri);
            }
        }, function () {
            _this.emit("linkleave", _this._createLinkHoverEvent(x1, y1, x2, y2, fg));
            _this._terminal.element.classList.remove('xterm-cursor-pointer');
            if (matcher.hoverLeaveCallback) {
                matcher.hoverLeaveCallback();
            }
        }, function (e) {
            if (matcher.willLinkActivate) {
                return matcher.willLinkActivate(e, uri);
            }
            return true;
        }));
    };
    Linkifier.prototype._createLinkHoverEvent = function (x1, y1, x2, y2, fg) {
        return { x1: x1, y1: y1, x2: x2, y2: y2, cols: this._terminal.cols, fg: fg };
    };
    Linkifier.TIME_BEFORE_LINKIFY = 200;
    Linkifier.OVERSCAN_CHAR_LIMIT = 2000;
    return Linkifier;
}(EventEmitter_1.EventEmitter));
exports.Linkifier = Linkifier;
//# sourceMappingURL=Linkifier.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/SelectionManager.js":
/*!****************************************************!*\
  !*** ./node_modules/xterm/lib/SelectionManager.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var MouseHelper_1 = __webpack_require__(/*! ./utils/MouseHelper */ "./node_modules/xterm/lib/utils/MouseHelper.js");
var Browser = __webpack_require__(/*! ./core/Platform */ "./node_modules/xterm/lib/core/Platform.js");
var EventEmitter_1 = __webpack_require__(/*! ./common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var SelectionModel_1 = __webpack_require__(/*! ./SelectionModel */ "./node_modules/xterm/lib/SelectionModel.js");
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var AltClickHandler_1 = __webpack_require__(/*! ./handlers/AltClickHandler */ "./node_modules/xterm/lib/handlers/AltClickHandler.js");
var DRAG_SCROLL_MAX_THRESHOLD = 50;
var DRAG_SCROLL_MAX_SPEED = 15;
var DRAG_SCROLL_INTERVAL = 50;
var ALT_CLICK_MOVE_CURSOR_TIME = 500;
var WORD_SEPARATORS = ' ()[]{}\'"';
var NON_BREAKING_SPACE_CHAR = String.fromCharCode(160);
var ALL_NON_BREAKING_SPACE_REGEX = new RegExp(NON_BREAKING_SPACE_CHAR, 'g');
var SelectionManager = (function (_super) {
    __extends(SelectionManager, _super);
    function SelectionManager(_terminal, _charMeasure) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._charMeasure = _charMeasure;
        _this._enabled = true;
        _this._initListeners();
        _this.enable();
        _this._model = new SelectionModel_1.SelectionModel(_terminal);
        _this._activeSelectionMode = 0;
        return _this;
    }
    SelectionManager.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._removeMouseDownListeners();
    };
    Object.defineProperty(SelectionManager.prototype, "_buffer", {
        get: function () {
            return this._terminal.buffers.active;
        },
        enumerable: true,
        configurable: true
    });
    SelectionManager.prototype._initListeners = function () {
        var _this = this;
        this._mouseMoveListener = function (event) { return _this._onMouseMove(event); };
        this._mouseUpListener = function (event) { return _this._onMouseUp(event); };
        this._trimListener = function (amount) { return _this._onTrim(amount); };
        this.initBuffersListeners();
    };
    SelectionManager.prototype.initBuffersListeners = function () {
        var _this = this;
        this._terminal.buffer.lines.on('trim', this._trimListener);
        this._terminal.buffers.on('activate', function (e) { return _this._onBufferActivate(e); });
    };
    SelectionManager.prototype.disable = function () {
        this.clearSelection();
        this._enabled = false;
    };
    SelectionManager.prototype.enable = function () {
        this._enabled = true;
    };
    Object.defineProperty(SelectionManager.prototype, "selectionStart", {
        get: function () { return this._model.finalSelectionStart; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "selectionEnd", {
        get: function () { return this._model.finalSelectionEnd; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "hasSelection", {
        get: function () {
            var start = this._model.finalSelectionStart;
            var end = this._model.finalSelectionEnd;
            if (!start || !end) {
                return false;
            }
            return start[0] !== end[0] || start[1] !== end[1];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "selectionText", {
        get: function () {
            var start = this._model.finalSelectionStart;
            var end = this._model.finalSelectionEnd;
            if (!start || !end) {
                return '';
            }
            var result = [];
            if (this._activeSelectionMode === 3) {
                if (start[0] === end[0]) {
                    return '';
                }
                for (var i = start[1]; i <= end[1]; i++) {
                    var lineText = this._buffer.translateBufferLineToString(i, true, start[0], end[0]);
                    result.push(lineText);
                }
            }
            else {
                var startRowEndCol = start[1] === end[1] ? end[0] : null;
                result.push(this._buffer.translateBufferLineToString(start[1], true, start[0], startRowEndCol));
                for (var i = start[1] + 1; i <= end[1] - 1; i++) {
                    var bufferLine = this._buffer.lines.get(i);
                    var lineText = this._buffer.translateBufferLineToString(i, true);
                    if (bufferLine.isWrapped) {
                        result[result.length - 1] += lineText;
                    }
                    else {
                        result.push(lineText);
                    }
                }
                if (start[1] !== end[1]) {
                    var bufferLine = this._buffer.lines.get(end[1]);
                    var lineText = this._buffer.translateBufferLineToString(end[1], true, 0, end[0]);
                    if (bufferLine.isWrapped) {
                        result[result.length - 1] += lineText;
                    }
                    else {
                        result.push(lineText);
                    }
                }
            }
            var formattedResult = result.map(function (line) {
                return line.replace(ALL_NON_BREAKING_SPACE_REGEX, ' ');
            }).join(Browser.isMSWindows ? '\r\n' : '\n');
            return formattedResult;
        },
        enumerable: true,
        configurable: true
    });
    SelectionManager.prototype.clearSelection = function () {
        this._model.clearSelection();
        this._removeMouseDownListeners();
        this.refresh();
    };
    SelectionManager.prototype.refresh = function (isNewSelection) {
        var _this = this;
        if (!this._refreshAnimationFrame) {
            this._refreshAnimationFrame = window.requestAnimationFrame(function () { return _this._refresh(); });
        }
        if (Browser.isLinux && isNewSelection) {
            var selectionText = this.selectionText;
            if (selectionText.length) {
                this.emit('newselection', this.selectionText);
            }
        }
    };
    SelectionManager.prototype._refresh = function () {
        this._refreshAnimationFrame = null;
        this.emit('refresh', {
            start: this._model.finalSelectionStart,
            end: this._model.finalSelectionEnd,
            columnSelectMode: this._activeSelectionMode === 3
        });
    };
    SelectionManager.prototype.isClickInSelection = function (event) {
        var coords = this._getMouseBufferCoords(event);
        var start = this._model.finalSelectionStart;
        var end = this._model.finalSelectionEnd;
        if (!start || !end) {
            return false;
        }
        return this._areCoordsInSelection(coords, start, end);
    };
    SelectionManager.prototype._areCoordsInSelection = function (coords, start, end) {
        return (coords[1] > start[1] && coords[1] < end[1]) ||
            (start[1] === end[1] && coords[1] === start[1] && coords[0] >= start[0] && coords[0] < end[0]) ||
            (start[1] < end[1] && coords[1] === end[1] && coords[0] < end[0]) ||
            (start[1] < end[1] && coords[1] === start[1] && coords[0] >= start[0]);
    };
    SelectionManager.prototype.selectWordAtCursor = function (event) {
        var coords = this._getMouseBufferCoords(event);
        if (coords) {
            this._selectWordAt(coords, false);
            this._model.selectionEnd = null;
            this.refresh(true);
        }
    };
    SelectionManager.prototype.selectAll = function () {
        this._model.isSelectAllActive = true;
        this.refresh();
        this._terminal.emit('selection');
    };
    SelectionManager.prototype.selectLines = function (start, end) {
        this._model.clearSelection();
        start = Math.max(start, 0);
        end = Math.min(end, this._terminal.buffer.lines.length - 1);
        this._model.selectionStart = [0, start];
        this._model.selectionEnd = [this._terminal.cols, end];
        this.refresh();
        this._terminal.emit('selection');
    };
    SelectionManager.prototype._onTrim = function (amount) {
        var needsRefresh = this._model.onTrim(amount);
        if (needsRefresh) {
            this.refresh();
        }
    };
    SelectionManager.prototype._getMouseBufferCoords = function (event) {
        var coords = this._terminal.mouseHelper.getCoords(event, this._terminal.screenElement, this._charMeasure, this._terminal.cols, this._terminal.rows, true);
        if (!coords) {
            return null;
        }
        coords[0]--;
        coords[1]--;
        coords[1] += this._terminal.buffer.ydisp;
        return coords;
    };
    SelectionManager.prototype._getMouseEventScrollAmount = function (event) {
        var offset = MouseHelper_1.MouseHelper.getCoordsRelativeToElement(event, this._terminal.screenElement)[1];
        var terminalHeight = this._terminal.rows * Math.ceil(this._charMeasure.height * this._terminal.options.lineHeight);
        if (offset >= 0 && offset <= terminalHeight) {
            return 0;
        }
        if (offset > terminalHeight) {
            offset -= terminalHeight;
        }
        offset = Math.min(Math.max(offset, -DRAG_SCROLL_MAX_THRESHOLD), DRAG_SCROLL_MAX_THRESHOLD);
        offset /= DRAG_SCROLL_MAX_THRESHOLD;
        return (offset / Math.abs(offset)) + Math.round(offset * (DRAG_SCROLL_MAX_SPEED - 1));
    };
    SelectionManager.prototype.shouldForceSelection = function (event) {
        if (Browser.isMac) {
            return event.altKey && this._terminal.options.macOptionClickForcesSelection;
        }
        return event.shiftKey;
    };
    SelectionManager.prototype.onMouseDown = function (event) {
        this._mouseDownTimeStamp = event.timeStamp;
        if (event.button === 2 && this.hasSelection) {
            return;
        }
        if (event.button !== 0) {
            return;
        }
        if (!this._enabled) {
            if (!this.shouldForceSelection(event)) {
                return;
            }
            event.stopPropagation();
        }
        event.preventDefault();
        this._dragScrollAmount = 0;
        if (this._enabled && event.shiftKey) {
            this._onIncrementalClick(event);
        }
        else {
            if (event.detail === 1) {
                this._onSingleClick(event);
            }
            else if (event.detail === 2) {
                this._onDoubleClick(event);
            }
            else if (event.detail === 3) {
                this._onTripleClick(event);
            }
        }
        this._addMouseDownListeners();
        this.refresh(true);
    };
    SelectionManager.prototype._addMouseDownListeners = function () {
        var _this = this;
        this._terminal.element.ownerDocument.addEventListener('mousemove', this._mouseMoveListener);
        this._terminal.element.ownerDocument.addEventListener('mouseup', this._mouseUpListener);
        this._dragScrollIntervalTimer = setInterval(function () { return _this._dragScroll(); }, DRAG_SCROLL_INTERVAL);
    };
    SelectionManager.prototype._removeMouseDownListeners = function () {
        if (this._terminal.element.ownerDocument) {
            this._terminal.element.ownerDocument.removeEventListener('mousemove', this._mouseMoveListener);
            this._terminal.element.ownerDocument.removeEventListener('mouseup', this._mouseUpListener);
        }
        clearInterval(this._dragScrollIntervalTimer);
        this._dragScrollIntervalTimer = null;
    };
    SelectionManager.prototype._onIncrementalClick = function (event) {
        if (this._model.selectionStart) {
            this._model.selectionEnd = this._getMouseBufferCoords(event);
        }
    };
    SelectionManager.prototype._onSingleClick = function (event) {
        this._model.selectionStartLength = 0;
        this._model.isSelectAllActive = false;
        this._activeSelectionMode = this.shouldColumnSelect(event) ? 3 : 0;
        this._model.selectionStart = this._getMouseBufferCoords(event);
        if (!this._model.selectionStart) {
            return;
        }
        this._model.selectionEnd = null;
        var line = this._buffer.lines.get(this._model.selectionStart[1]);
        if (!line) {
            return;
        }
        if (line.length >= this._model.selectionStart[0]) {
            return;
        }
        var char = line.get(this._model.selectionStart[0]);
        if (char[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 0) {
            this._model.selectionStart[0]++;
        }
    };
    SelectionManager.prototype._onDoubleClick = function (event) {
        var coords = this._getMouseBufferCoords(event);
        if (coords) {
            this._activeSelectionMode = 1;
            this._selectWordAt(coords, true);
        }
    };
    SelectionManager.prototype._onTripleClick = function (event) {
        var coords = this._getMouseBufferCoords(event);
        if (coords) {
            this._activeSelectionMode = 2;
            this._selectLineAt(coords[1]);
        }
    };
    SelectionManager.prototype.shouldColumnSelect = function (event) {
        return event.altKey && !(Browser.isMac && this._terminal.options.macOptionClickForcesSelection);
    };
    SelectionManager.prototype._onMouseMove = function (event) {
        event.stopImmediatePropagation();
        var previousSelectionEnd = this._model.selectionEnd ? [this._model.selectionEnd[0], this._model.selectionEnd[1]] : null;
        this._model.selectionEnd = this._getMouseBufferCoords(event);
        if (!this._model.selectionEnd) {
            this.refresh(true);
            return;
        }
        if (this._activeSelectionMode === 2) {
            if (this._model.selectionEnd[1] < this._model.selectionStart[1]) {
                this._model.selectionEnd[0] = 0;
            }
            else {
                this._model.selectionEnd[0] = this._terminal.cols;
            }
        }
        else if (this._activeSelectionMode === 1) {
            this._selectToWordAt(this._model.selectionEnd);
        }
        this._dragScrollAmount = this._getMouseEventScrollAmount(event);
        if (this._activeSelectionMode !== 3) {
            if (this._dragScrollAmount > 0) {
                this._model.selectionEnd[0] = this._terminal.cols;
            }
            else if (this._dragScrollAmount < 0) {
                this._model.selectionEnd[0] = 0;
            }
        }
        if (this._model.selectionEnd[1] < this._buffer.lines.length) {
            var char = this._buffer.lines.get(this._model.selectionEnd[1]).get(this._model.selectionEnd[0]);
            if (char && char[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 0) {
                this._model.selectionEnd[0]++;
            }
        }
        if (!previousSelectionEnd ||
            previousSelectionEnd[0] !== this._model.selectionEnd[0] ||
            previousSelectionEnd[1] !== this._model.selectionEnd[1]) {
            this.refresh(true);
        }
    };
    SelectionManager.prototype._dragScroll = function () {
        if (this._dragScrollAmount) {
            this._terminal.scrollLines(this._dragScrollAmount, false);
            if (this._dragScrollAmount > 0) {
                if (this._activeSelectionMode !== 3) {
                    this._model.selectionEnd[0] = this._terminal.cols;
                }
                this._model.selectionEnd[1] = Math.min(this._terminal.buffer.ydisp + this._terminal.rows, this._terminal.buffer.lines.length - 1);
            }
            else {
                if (this._activeSelectionMode !== 3) {
                    this._model.selectionEnd[0] = 0;
                }
                this._model.selectionEnd[1] = this._terminal.buffer.ydisp;
            }
            this.refresh();
        }
    };
    SelectionManager.prototype._onMouseUp = function (event) {
        var timeElapsed = event.timeStamp - this._mouseDownTimeStamp;
        this._removeMouseDownListeners();
        if (this.selectionText.length <= 1 && timeElapsed < ALT_CLICK_MOVE_CURSOR_TIME) {
            (new AltClickHandler_1.AltClickHandler(event, this._terminal)).move();
        }
        else if (this.hasSelection) {
            this._terminal.emit('selection');
        }
    };
    SelectionManager.prototype._onBufferActivate = function (e) {
        this.clearSelection();
        e.inactiveBuffer.lines.off('trim', this._trimListener);
        e.activeBuffer.lines.on('trim', this._trimListener);
    };
    SelectionManager.prototype._convertViewportColToCharacterIndex = function (bufferLine, coords) {
        var charIndex = coords[0];
        for (var i = 0; coords[0] >= i; i++) {
            var char = bufferLine.get(i);
            if (char[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 0) {
                charIndex--;
            }
            else if (char[Buffer_1.CHAR_DATA_CHAR_INDEX].length > 1 && coords[0] !== i) {
                charIndex += char[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
            }
        }
        return charIndex;
    };
    SelectionManager.prototype.setSelection = function (col, row, length) {
        this._model.clearSelection();
        this._removeMouseDownListeners();
        this._model.selectionStart = [col, row];
        this._model.selectionStartLength = length;
        this.refresh();
    };
    SelectionManager.prototype._getWordAt = function (coords, allowWhitespaceOnlySelection, followWrappedLinesAbove, followWrappedLinesBelow) {
        if (followWrappedLinesAbove === void 0) { followWrappedLinesAbove = true; }
        if (followWrappedLinesBelow === void 0) { followWrappedLinesBelow = true; }
        if (coords[0] >= this._terminal.cols) {
            return null;
        }
        var bufferLine = this._buffer.lines.get(coords[1]);
        if (!bufferLine) {
            return null;
        }
        var line = this._buffer.translateBufferLineToString(coords[1], false);
        var startIndex = this._convertViewportColToCharacterIndex(bufferLine, coords);
        var endIndex = startIndex;
        var charOffset = coords[0] - startIndex;
        var leftWideCharCount = 0;
        var rightWideCharCount = 0;
        var leftLongCharOffset = 0;
        var rightLongCharOffset = 0;
        if (line.charAt(startIndex) === ' ') {
            while (startIndex > 0 && line.charAt(startIndex - 1) === ' ') {
                startIndex--;
            }
            while (endIndex < line.length && line.charAt(endIndex + 1) === ' ') {
                endIndex++;
            }
        }
        else {
            var startCol = coords[0];
            var endCol = coords[0];
            if (bufferLine.get(startCol)[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 0) {
                leftWideCharCount++;
                startCol--;
            }
            if (bufferLine.get(endCol)[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 2) {
                rightWideCharCount++;
                endCol++;
            }
            if (bufferLine.get(endCol)[Buffer_1.CHAR_DATA_CHAR_INDEX].length > 1) {
                rightLongCharOffset += bufferLine.get(endCol)[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
                endIndex += bufferLine.get(endCol)[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
            }
            while (startCol > 0 && startIndex > 0 && !this._isCharWordSeparator(bufferLine.get(startCol - 1))) {
                var char = bufferLine.get(startCol - 1);
                if (char[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 0) {
                    leftWideCharCount++;
                    startCol--;
                }
                else if (char[Buffer_1.CHAR_DATA_CHAR_INDEX].length > 1) {
                    leftLongCharOffset += char[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
                    startIndex -= char[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
                }
                startIndex--;
                startCol--;
            }
            while (endCol < bufferLine.length && endIndex + 1 < line.length && !this._isCharWordSeparator(bufferLine.get(endCol + 1))) {
                var char = bufferLine.get(endCol + 1);
                if (char[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 2) {
                    rightWideCharCount++;
                    endCol++;
                }
                else if (char[Buffer_1.CHAR_DATA_CHAR_INDEX].length > 1) {
                    rightLongCharOffset += char[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
                    endIndex += char[Buffer_1.CHAR_DATA_CHAR_INDEX].length - 1;
                }
                endIndex++;
                endCol++;
            }
        }
        endIndex++;
        var start = startIndex
            + charOffset
            - leftWideCharCount
            + leftLongCharOffset;
        var length = Math.min(this._terminal.cols, endIndex
            - startIndex
            + leftWideCharCount
            + rightWideCharCount
            - leftLongCharOffset
            - rightLongCharOffset);
        if (!allowWhitespaceOnlySelection && line.slice(startIndex, endIndex).trim() === '') {
            return null;
        }
        if (followWrappedLinesAbove) {
            if (start === 0 && bufferLine.get(0)[Buffer_1.CHAR_DATA_CODE_INDEX] !== 32) {
                var previousBufferLine = this._buffer.lines.get(coords[1] - 1);
                if (previousBufferLine && bufferLine.isWrapped && previousBufferLine.get(this._terminal.cols - 1)[Buffer_1.CHAR_DATA_CODE_INDEX] !== 32) {
                    var previousLineWordPosition = this._getWordAt([this._terminal.cols - 1, coords[1] - 1], false, true, false);
                    if (previousLineWordPosition) {
                        var offset = this._terminal.cols - previousLineWordPosition.start;
                        start -= offset;
                        length += offset;
                    }
                }
            }
        }
        if (followWrappedLinesBelow) {
            if (start + length === this._terminal.cols && bufferLine.get(this._terminal.cols - 1)[Buffer_1.CHAR_DATA_CODE_INDEX] !== 32) {
                var nextBufferLine = this._buffer.lines.get(coords[1] + 1);
                if (nextBufferLine && nextBufferLine.isWrapped && nextBufferLine.get(0)[Buffer_1.CHAR_DATA_CODE_INDEX] !== 32) {
                    var nextLineWordPosition = this._getWordAt([0, coords[1] + 1], false, false, true);
                    if (nextLineWordPosition) {
                        length += nextLineWordPosition.length;
                    }
                }
            }
        }
        return { start: start, length: length };
    };
    SelectionManager.prototype._selectWordAt = function (coords, allowWhitespaceOnlySelection) {
        var wordPosition = this._getWordAt(coords, allowWhitespaceOnlySelection);
        if (wordPosition) {
            while (wordPosition.start < 0) {
                wordPosition.start += this._terminal.cols;
                coords[1]--;
            }
            this._model.selectionStart = [wordPosition.start, coords[1]];
            this._model.selectionStartLength = wordPosition.length;
        }
    };
    SelectionManager.prototype._selectToWordAt = function (coords) {
        var wordPosition = this._getWordAt(coords, true);
        if (wordPosition) {
            var endRow = coords[1];
            while (wordPosition.start < 0) {
                wordPosition.start += this._terminal.cols;
                endRow--;
            }
            if (!this._model.areSelectionValuesReversed()) {
                while (wordPosition.start + wordPosition.length > this._terminal.cols) {
                    wordPosition.length -= this._terminal.cols;
                    endRow++;
                }
            }
            this._model.selectionEnd = [this._model.areSelectionValuesReversed() ? wordPosition.start : wordPosition.start + wordPosition.length, endRow];
        }
    };
    SelectionManager.prototype._isCharWordSeparator = function (charData) {
        if (charData[Buffer_1.CHAR_DATA_WIDTH_INDEX] === 0) {
            return false;
        }
        return WORD_SEPARATORS.indexOf(charData[Buffer_1.CHAR_DATA_CHAR_INDEX]) >= 0;
    };
    SelectionManager.prototype._selectLineAt = function (line) {
        var wrappedRange = this._buffer.getWrappedRangeForLine(line);
        this._model.selectionStart = [0, wrappedRange.first];
        this._model.selectionEnd = [this._terminal.cols, wrappedRange.last];
        this._model.selectionStartLength = 0;
    };
    return SelectionManager;
}(EventEmitter_1.EventEmitter));
exports.SelectionManager = SelectionManager;
//# sourceMappingURL=SelectionManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/SelectionModel.js":
/*!**************************************************!*\
  !*** ./node_modules/xterm/lib/SelectionModel.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var SelectionModel = (function () {
    function SelectionModel(_terminal) {
        this._terminal = _terminal;
        this.clearSelection();
    }
    SelectionModel.prototype.clearSelection = function () {
        this.selectionStart = null;
        this.selectionEnd = null;
        this.isSelectAllActive = false;
        this.selectionStartLength = 0;
    };
    Object.defineProperty(SelectionModel.prototype, "finalSelectionStart", {
        get: function () {
            if (this.isSelectAllActive) {
                return [0, 0];
            }
            if (!this.selectionEnd || !this.selectionStart) {
                return this.selectionStart;
            }
            return this.areSelectionValuesReversed() ? this.selectionEnd : this.selectionStart;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionModel.prototype, "finalSelectionEnd", {
        get: function () {
            if (this.isSelectAllActive) {
                return [this._terminal.cols, this._terminal.buffer.ybase + this._terminal.rows - 1];
            }
            if (!this.selectionStart) {
                return null;
            }
            if (!this.selectionEnd || this.areSelectionValuesReversed()) {
                var startPlusLength = this.selectionStart[0] + this.selectionStartLength;
                if (startPlusLength > this._terminal.cols) {
                    return [startPlusLength % this._terminal.cols, this.selectionStart[1] + Math.floor(startPlusLength / this._terminal.cols)];
                }
                return [startPlusLength, this.selectionStart[1]];
            }
            if (this.selectionStartLength) {
                if (this.selectionEnd[1] === this.selectionStart[1]) {
                    return [Math.max(this.selectionStart[0] + this.selectionStartLength, this.selectionEnd[0]), this.selectionEnd[1]];
                }
            }
            return this.selectionEnd;
        },
        enumerable: true,
        configurable: true
    });
    SelectionModel.prototype.areSelectionValuesReversed = function () {
        var start = this.selectionStart;
        var end = this.selectionEnd;
        if (!start || !end) {
            return false;
        }
        return start[1] > end[1] || (start[1] === end[1] && start[0] > end[0]);
    };
    SelectionModel.prototype.onTrim = function (amount) {
        if (this.selectionStart) {
            this.selectionStart[1] -= amount;
        }
        if (this.selectionEnd) {
            this.selectionEnd[1] -= amount;
        }
        if (this.selectionEnd && this.selectionEnd[1] < 0) {
            this.clearSelection();
            return true;
        }
        if (this.selectionStart && this.selectionStart[1] < 0) {
            this.selectionStart[1] = 0;
        }
        return false;
    };
    return SelectionModel;
}());
exports.SelectionModel = SelectionModel;
//# sourceMappingURL=SelectionModel.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/SoundManager.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/SoundManager.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_BELL_SOUND = 'data:audio/wav;base64,UklGRigBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQBAADpAFgCwAMlBZoG/wdmCcoKRAypDQ8PbRDBEQQTOxRtFYcWlBePGIUZXhoiG88bcBz7HHIdzh0WHlMeZx51HmkeUx4WHs8dah0AHXwc3hs9G4saxRnyGBIYGBcQFv8U4RPAEoYRQBACD70NWwwHC6gJOwjWBloF7gOBAhABkf8b/qv8R/ve+Xf4Ife79W/0JfPZ8Z/wde9N7ijtE+wU6xvqM+lb6H7nw+YX5mrlxuQz5Mzje+Ma49fioeKD4nXiYeJy4pHitOL04j/jn+MN5IPkFOWs5U3mDefM55/ogOl36m7rdOyE7abuyu8D8Unyj/Pg9D/2qfcb+Yn6/vuK/Qj/lAAlAg==';
var SoundManager = (function () {
    function SoundManager(_terminal) {
        this._terminal = _terminal;
    }
    Object.defineProperty(SoundManager, "audioContext", {
        get: function () {
            if (!SoundManager._audioContext) {
                var audioContextCtor = window.AudioContext || window.webkitAudioContext;
                if (!audioContextCtor) {
                    console.warn('Web Audio API is not supported by this browser. Consider upgrading to the latest version');
                    return null;
                }
                SoundManager._audioContext = new audioContextCtor();
            }
            return SoundManager._audioContext;
        },
        enumerable: true,
        configurable: true
    });
    SoundManager.prototype.playBellSound = function () {
        var ctx = SoundManager.audioContext;
        if (!ctx) {
            return;
        }
        var bellAudioSource = ctx.createBufferSource();
        ctx.decodeAudioData(this._base64ToArrayBuffer(this._removeMimeType(this._terminal.options.bellSound)), function (buffer) {
            bellAudioSource.buffer = buffer;
            bellAudioSource.connect(ctx.destination);
            bellAudioSource.start(0);
        });
    };
    SoundManager.prototype._base64ToArrayBuffer = function (base64) {
        var binaryString = window.atob(base64);
        var len = binaryString.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    };
    SoundManager.prototype._removeMimeType = function (dataURI) {
        var splitUri = dataURI.split(',');
        return splitUri[1];
    };
    return SoundManager;
}());
exports.SoundManager = SoundManager;
//# sourceMappingURL=SoundManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Strings.js":
/*!*******************************************!*\
  !*** ./node_modules/xterm/lib/Strings.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.blankLine = 'Blank line';
exports.promptLabel = 'Terminal input';
exports.tooMuchOutput = 'Too much output to announce, navigate to rows manually to read';
//# sourceMappingURL=Strings.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Terminal.js":
/*!********************************************!*\
  !*** ./node_modules/xterm/lib/Terminal.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BufferSet_1 = __webpack_require__(/*! ./BufferSet */ "./node_modules/xterm/lib/BufferSet.js");
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var CompositionHelper_1 = __webpack_require__(/*! ./CompositionHelper */ "./node_modules/xterm/lib/CompositionHelper.js");
var EventEmitter_1 = __webpack_require__(/*! ./common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var Viewport_1 = __webpack_require__(/*! ./Viewport */ "./node_modules/xterm/lib/Viewport.js");
var Clipboard_1 = __webpack_require__(/*! ./ui/Clipboard */ "./node_modules/xterm/lib/ui/Clipboard.js");
var EscapeSequences_1 = __webpack_require__(/*! ./common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var InputHandler_1 = __webpack_require__(/*! ./InputHandler */ "./node_modules/xterm/lib/InputHandler.js");
var Renderer_1 = __webpack_require__(/*! ./renderer/Renderer */ "./node_modules/xterm/lib/renderer/Renderer.js");
var Linkifier_1 = __webpack_require__(/*! ./Linkifier */ "./node_modules/xterm/lib/Linkifier.js");
var SelectionManager_1 = __webpack_require__(/*! ./SelectionManager */ "./node_modules/xterm/lib/SelectionManager.js");
var CharMeasure_1 = __webpack_require__(/*! ./ui/CharMeasure */ "./node_modules/xterm/lib/ui/CharMeasure.js");
var Browser = __webpack_require__(/*! ./core/Platform */ "./node_modules/xterm/lib/core/Platform.js");
var Lifecycle_1 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var Strings = __webpack_require__(/*! ./Strings */ "./node_modules/xterm/lib/Strings.js");
var MouseHelper_1 = __webpack_require__(/*! ./utils/MouseHelper */ "./node_modules/xterm/lib/utils/MouseHelper.js");
var Clone_1 = __webpack_require__(/*! ./utils/Clone */ "./node_modules/xterm/lib/utils/Clone.js");
var SoundManager_1 = __webpack_require__(/*! ./SoundManager */ "./node_modules/xterm/lib/SoundManager.js");
var ColorManager_1 = __webpack_require__(/*! ./renderer/ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var MouseZoneManager_1 = __webpack_require__(/*! ./ui/MouseZoneManager */ "./node_modules/xterm/lib/ui/MouseZoneManager.js");
var AccessibilityManager_1 = __webpack_require__(/*! ./AccessibilityManager */ "./node_modules/xterm/lib/AccessibilityManager.js");
var ScreenDprMonitor_1 = __webpack_require__(/*! ./ui/ScreenDprMonitor */ "./node_modules/xterm/lib/ui/ScreenDprMonitor.js");
var CharAtlasCache_1 = __webpack_require__(/*! ./renderer/atlas/CharAtlasCache */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js");
var DomRenderer_1 = __webpack_require__(/*! ./renderer/dom/DomRenderer */ "./node_modules/xterm/lib/renderer/dom/DomRenderer.js");
var Keyboard_1 = __webpack_require__(/*! ./core/input/Keyboard */ "./node_modules/xterm/lib/core/input/Keyboard.js");
var document = (typeof window !== 'undefined') ? window.document : null;
var WRITE_BUFFER_PAUSE_THRESHOLD = 5;
var WRITE_BATCH_SIZE = 300;
var CONSTRUCTOR_ONLY_OPTIONS = ['cols', 'rows'];
var DEFAULT_OPTIONS = {
    cols: 80,
    rows: 24,
    convertEol: false,
    termName: 'xterm',
    cursorBlink: false,
    cursorStyle: 'block',
    bellSound: SoundManager_1.DEFAULT_BELL_SOUND,
    bellStyle: 'none',
    drawBoldTextInBrightColors: true,
    enableBold: true,
    experimentalCharAtlas: 'static',
    fontFamily: 'courier-new, courier, monospace',
    fontSize: 15,
    fontWeight: 'normal',
    fontWeightBold: 'bold',
    lineHeight: 1.0,
    letterSpacing: 0,
    scrollback: 1000,
    screenKeys: false,
    screenReaderMode: false,
    debug: false,
    macOptionIsMeta: false,
    macOptionClickForcesSelection: false,
    cancelEvents: false,
    disableStdin: false,
    useFlowControl: false,
    allowTransparency: false,
    tabStopWidth: 8,
    theme: null,
    rightClickSelectsWord: Browser.isMac,
    rendererType: 'canvas',
    experimentalBufferLineImpl: 'TypedArray'
};
var Terminal = (function (_super) {
    __extends(Terminal, _super);
    function Terminal(options) {
        if (options === void 0) { options = {}; }
        var _this = _super.call(this) || this;
        _this.browser = Browser;
        _this._blankLine = null;
        _this.options = Clone_1.clone(options);
        _this._setup();
        return _this;
    }
    Terminal.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._customKeyEventHandler = null;
        CharAtlasCache_1.removeTerminalFromCache(this);
        this.handler = function () { };
        this.write = function () { };
        if (this.element && this.element.parentNode) {
            this.element.parentNode.removeChild(this.element);
        }
    };
    Terminal.prototype.destroy = function () {
        this.dispose();
    };
    Terminal.prototype._setup = function () {
        var _this = this;
        Object.keys(DEFAULT_OPTIONS).forEach(function (key) {
            if (_this.options[key] === null || _this.options[key] === undefined) {
                _this.options[key] = DEFAULT_OPTIONS[key];
            }
        });
        this._parent = document ? document.body : null;
        this.cols = this.options.cols;
        this.rows = this.options.rows;
        if (this.options.handler) {
            this.on('data', this.options.handler);
        }
        this.cursorState = 0;
        this.cursorHidden = false;
        this._customKeyEventHandler = null;
        this.applicationKeypad = false;
        this.applicationCursor = false;
        this.originMode = false;
        this.insertMode = false;
        this.wraparoundMode = true;
        this.bracketedPasteMode = false;
        this.charset = null;
        this.gcharset = null;
        this.glevel = 0;
        this.charsets = [null];
        this.curAttr = Buffer_1.DEFAULT_ATTR;
        this.params = [];
        this.currentParam = 0;
        this.writeBuffer = [];
        this._writeInProgress = false;
        this._xoffSentToCatchUp = false;
        this._userScrolling = false;
        this._inputHandler = new InputHandler_1.InputHandler(this);
        this.register(this._inputHandler);
        this.renderer = this.renderer || null;
        this.selectionManager = this.selectionManager || null;
        this.linkifier = this.linkifier || new Linkifier_1.Linkifier(this);
        this._mouseZoneManager = this._mouseZoneManager || null;
        this.soundManager = this.soundManager || new SoundManager_1.SoundManager(this);
        this.buffers = new BufferSet_1.BufferSet(this);
        if (this.selectionManager) {
            this.selectionManager.clearSelection();
            this.selectionManager.initBuffersListeners();
        }
    };
    Object.defineProperty(Terminal.prototype, "buffer", {
        get: function () {
            return this.buffers.active;
        },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.eraseAttr = function () {
        return (Buffer_1.DEFAULT_ATTR & ~0x1ff) | (this.curAttr & 0x1ff);
    };
    Terminal.prototype.focus = function () {
        if (this.textarea) {
            this.textarea.focus();
        }
    };
    Object.defineProperty(Terminal.prototype, "isFocused", {
        get: function () {
            return document.activeElement === this.textarea && document.hasFocus();
        },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.getOption = function (key) {
        if (!(key in DEFAULT_OPTIONS)) {
            throw new Error('No option with key "' + key + '"');
        }
        return this.options[key];
    };
    Terminal.prototype.setOption = function (key, value) {
        if (!(key in DEFAULT_OPTIONS)) {
            throw new Error('No option with key "' + key + '"');
        }
        if (CONSTRUCTOR_ONLY_OPTIONS.indexOf(key) !== -1) {
            console.error("Option \"" + key + "\" can only be set in the constructor");
        }
        if (this.options[key] === value) {
            return;
        }
        switch (key) {
            case 'bellStyle':
                if (!value) {
                    value = 'none';
                }
                break;
            case 'cursorStyle':
                if (!value) {
                    value = 'block';
                }
                break;
            case 'fontWeight':
                if (!value) {
                    value = 'normal';
                }
                break;
            case 'fontWeightBold':
                if (!value) {
                    value = 'bold';
                }
                break;
            case 'lineHeight':
                if (value < 1) {
                    console.warn(key + " cannot be less than 1, value: " + value);
                    return;
                }
            case 'rendererType':
                if (!value) {
                    value = 'canvas';
                }
                break;
            case 'tabStopWidth':
                if (value < 1) {
                    console.warn(key + " cannot be less than 1, value: " + value);
                    return;
                }
                break;
            case 'theme':
                if (this.renderer) {
                    this._setTheme(value);
                    return;
                }
                break;
            case 'scrollback':
                value = Math.min(value, Buffer_1.MAX_BUFFER_SIZE);
                if (value < 0) {
                    console.warn(key + " cannot be less than 0, value: " + value);
                    return;
                }
                if (this.options[key] !== value) {
                    var newBufferLength = this.rows + value;
                    if (this.buffer.lines.length > newBufferLength) {
                        var amountToTrim = this.buffer.lines.length - newBufferLength;
                        var needsRefresh = (this.buffer.ydisp - amountToTrim < 0);
                        this.buffer.lines.trimStart(amountToTrim);
                        this.buffer.ybase = Math.max(this.buffer.ybase - amountToTrim, 0);
                        this.buffer.ydisp = Math.max(this.buffer.ydisp - amountToTrim, 0);
                        if (needsRefresh) {
                            this.refresh(0, this.rows - 1);
                        }
                    }
                }
                break;
        }
        this.options[key] = value;
        switch (key) {
            case 'fontFamily':
            case 'fontSize':
                if (this.renderer) {
                    this.renderer.clear();
                    this.charMeasure.measure(this.options);
                }
                break;
            case 'drawBoldTextInBrightColors':
            case 'experimentalCharAtlas':
            case 'enableBold':
            case 'letterSpacing':
            case 'lineHeight':
            case 'fontWeight':
            case 'fontWeightBold':
                if (this.renderer) {
                    this.renderer.clear();
                    this.renderer.onResize(this.cols, this.rows);
                    this.refresh(0, this.rows - 1);
                }
            case 'rendererType':
                if (this.renderer) {
                    this.unregister(this.renderer);
                    this.renderer.dispose();
                    this.renderer = null;
                }
                this._setupRenderer();
                this.renderer.onCharSizeChanged();
                if (this._theme) {
                    this.renderer.setTheme(this._theme);
                }
                this.mouseHelper.setRenderer(this.renderer);
                break;
            case 'scrollback':
                this.buffers.resize(this.cols, this.rows);
                if (this.viewport) {
                    this.viewport.syncScrollArea();
                }
                break;
            case 'screenReaderMode':
                if (value) {
                    if (!this._accessibilityManager) {
                        this._accessibilityManager = new AccessibilityManager_1.AccessibilityManager(this);
                    }
                }
                else {
                    if (this._accessibilityManager) {
                        this._accessibilityManager.dispose();
                        this._accessibilityManager = null;
                    }
                }
                break;
            case 'tabStopWidth':
                this.buffers.setupTabStops();
                break;
            case 'experimentalBufferLineImpl':
                this.buffers.normal.setBufferLineFactory(value);
                this.buffers.alt.setBufferLineFactory(value);
                this._blankLine = null;
                break;
        }
        if (this.renderer) {
            this.renderer.onOptionsChanged();
        }
    };
    Terminal.prototype._onTextAreaFocus = function (ev) {
        if (this.sendFocus) {
            this.handler(EscapeSequences_1.C0.ESC + '[I');
        }
        this.updateCursorStyle(ev);
        this.element.classList.add('focus');
        this.showCursor();
        this.emit('focus');
    };
    Terminal.prototype.blur = function () {
        return this.textarea.blur();
    };
    Terminal.prototype._onTextAreaBlur = function () {
        this.textarea.value = '';
        this.refresh(this.buffer.y, this.buffer.y);
        if (this.sendFocus) {
            this.handler(EscapeSequences_1.C0.ESC + '[O');
        }
        this.element.classList.remove('focus');
        this.emit('blur');
    };
    Terminal.prototype._initGlobal = function () {
        var _this = this;
        this._bindKeys();
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'copy', function (event) {
            if (!_this.hasSelection()) {
                return;
            }
            Clipboard_1.copyHandler(event, _this, _this.selectionManager);
        }));
        var pasteHandlerWrapper = function (event) { return Clipboard_1.pasteHandler(event, _this); };
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'paste', pasteHandlerWrapper));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'paste', pasteHandlerWrapper));
        if (Browser.isFirefox) {
            this.register(Lifecycle_1.addDisposableDomListener(this.element, 'mousedown', function (event) {
                if (event.button === 2) {
                    Clipboard_1.rightClickHandler(event, _this.textarea, _this.selectionManager, _this.options.rightClickSelectsWord);
                }
            }));
        }
        else {
            this.register(Lifecycle_1.addDisposableDomListener(this.element, 'contextmenu', function (event) {
                Clipboard_1.rightClickHandler(event, _this.textarea, _this.selectionManager, _this.options.rightClickSelectsWord);
            }));
        }
        if (Browser.isLinux) {
            this.register(Lifecycle_1.addDisposableDomListener(this.element, 'auxclick', function (event) {
                if (event.button === 1) {
                    Clipboard_1.moveTextAreaUnderMouseCursor(event, _this.textarea);
                }
            }));
        }
    };
    Terminal.prototype._bindKeys = function () {
        var _this = this;
        var self = this;
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'keydown', function (ev) {
            if (document.activeElement !== this) {
                return;
            }
            self._keyDown(ev);
        }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'keypress', function (ev) {
            if (document.activeElement !== this) {
                return;
            }
            self._keyPress(ev);
        }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'keyup', function (ev) {
            if (!wasModifierKeyOnlyEvent(ev)) {
                _this.focus();
            }
            self._keyUp(ev);
        }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'keydown', function (ev) { return _this._keyDown(ev); }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'keypress', function (ev) { return _this._keyPress(ev); }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'compositionstart', function () { return _this._compositionHelper.compositionstart(); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'compositionupdate', function (e) { return _this._compositionHelper.compositionupdate(e); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'compositionend', function () { return _this._compositionHelper.compositionend(); }));
        this.register(this.addDisposableListener('refresh', function () { return _this._compositionHelper.updateCompositionElements(); }));
        this.register(this.addDisposableListener('refresh', function (data) { return _this._queueLinkification(data.start, data.end); }));
    };
    Terminal.prototype.open = function (parent) {
        var _this = this;
        this._parent = parent || this._parent;
        if (!this._parent) {
            throw new Error('Terminal requires a parent element.');
        }
        this._context = this._parent.ownerDocument.defaultView;
        this._document = this._parent.ownerDocument;
        this._screenDprMonitor = new ScreenDprMonitor_1.ScreenDprMonitor();
        this._screenDprMonitor.setListener(function () { return _this.emit('dprchange', window.devicePixelRatio); });
        this.register(this._screenDprMonitor);
        this.element = this._document.createElement('div');
        this.element.dir = 'ltr';
        this.element.classList.add('terminal');
        this.element.classList.add('xterm');
        this.element.setAttribute('tabindex', '0');
        this._parent.appendChild(this.element);
        var fragment = document.createDocumentFragment();
        this._viewportElement = document.createElement('div');
        this._viewportElement.classList.add('xterm-viewport');
        fragment.appendChild(this._viewportElement);
        this._viewportScrollArea = document.createElement('div');
        this._viewportScrollArea.classList.add('xterm-scroll-area');
        this._viewportElement.appendChild(this._viewportScrollArea);
        this.screenElement = document.createElement('div');
        this.screenElement.classList.add('xterm-screen');
        this._helperContainer = document.createElement('div');
        this._helperContainer.classList.add('xterm-helpers');
        this.screenElement.appendChild(this._helperContainer);
        fragment.appendChild(this.screenElement);
        this._mouseZoneManager = new MouseZoneManager_1.MouseZoneManager(this);
        this.register(this._mouseZoneManager);
        this.register(this.addDisposableListener('scroll', function () { return _this._mouseZoneManager.clearAll(); }));
        this.linkifier.attachToDom(this._mouseZoneManager);
        this.textarea = document.createElement('textarea');
        this.textarea.classList.add('xterm-helper-textarea');
        this.textarea.setAttribute('aria-label', Strings.promptLabel);
        this.textarea.setAttribute('aria-multiline', 'false');
        this.textarea.setAttribute('autocorrect', 'off');
        this.textarea.setAttribute('autocapitalize', 'off');
        this.textarea.setAttribute('spellcheck', 'false');
        this.textarea.tabIndex = 0;
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'focus', function (ev) { return _this._onTextAreaFocus(ev); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'blur', function () { return _this._onTextAreaBlur(); }));
        this._helperContainer.appendChild(this.textarea);
        this._compositionView = document.createElement('div');
        this._compositionView.classList.add('composition-view');
        this._compositionHelper = new CompositionHelper_1.CompositionHelper(this.textarea, this._compositionView, this);
        this._helperContainer.appendChild(this._compositionView);
        this.charMeasure = new CharMeasure_1.CharMeasure(document, this._helperContainer);
        this.element.appendChild(fragment);
        this._setupRenderer();
        this._theme = this.options.theme;
        this.options.theme = null;
        this.viewport = new Viewport_1.Viewport(this, this._viewportElement, this._viewportScrollArea, this.charMeasure);
        this.viewport.onThemeChanged(this.renderer.colorManager.colors);
        this.register(this.viewport);
        this.register(this.addDisposableListener('cursormove', function () { return _this.renderer.onCursorMove(); }));
        this.register(this.addDisposableListener('resize', function () { return _this.renderer.onResize(_this.cols, _this.rows); }));
        this.register(this.addDisposableListener('blur', function () { return _this.renderer.onBlur(); }));
        this.register(this.addDisposableListener('focus', function () { return _this.renderer.onFocus(); }));
        this.register(this.addDisposableListener('dprchange', function () { return _this.renderer.onWindowResize(window.devicePixelRatio); }));
        this.register(Lifecycle_1.addDisposableDomListener(window, 'resize', function () { return _this.renderer.onWindowResize(window.devicePixelRatio); }));
        this.register(this.charMeasure.addDisposableListener('charsizechanged', function () { return _this.renderer.onCharSizeChanged(); }));
        this.register(this.renderer.addDisposableListener('resize', function (dimensions) { return _this.viewport.syncScrollArea(); }));
        this.selectionManager = new SelectionManager_1.SelectionManager(this, this.charMeasure);
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'mousedown', function (e) { return _this.selectionManager.onMouseDown(e); }));
        this.register(this.selectionManager.addDisposableListener('refresh', function (data) { return _this.renderer.onSelectionChanged(data.start, data.end, data.columnSelectMode); }));
        this.register(this.selectionManager.addDisposableListener('newselection', function (text) {
            _this.textarea.value = text;
            _this.textarea.focus();
            _this.textarea.select();
        }));
        this.register(this.addDisposableListener('scroll', function () {
            _this.viewport.syncScrollArea();
            _this.selectionManager.refresh();
        }));
        this.register(Lifecycle_1.addDisposableDomListener(this._viewportElement, 'scroll', function () { return _this.selectionManager.refresh(); }));
        this.mouseHelper = new MouseHelper_1.MouseHelper(this.renderer);
        if (this.options.screenReaderMode) {
            this._accessibilityManager = new AccessibilityManager_1.AccessibilityManager(this);
        }
        this.charMeasure.measure(this.options);
        this.refresh(0, this.rows - 1);
        this._initGlobal();
        this.bindMouse();
    };
    Terminal.prototype._setupRenderer = function () {
        switch (this.options.rendererType) {
            case 'canvas':
                this.renderer = new Renderer_1.Renderer(this, this.options.theme);
                break;
            case 'dom':
                this.renderer = new DomRenderer_1.DomRenderer(this, this.options.theme);
                break;
            default: throw new Error("Unrecognized rendererType \"" + this.options.rendererType + "\"");
        }
        this.register(this.renderer);
    };
    Terminal.prototype._setTheme = function (theme) {
        this._theme = theme;
        var colors = this.renderer.setTheme(theme);
        if (this.viewport) {
            this.viewport.onThemeChanged(colors);
        }
    };
    Terminal.prototype.bindMouse = function () {
        var _this = this;
        var el = this.element;
        var self = this;
        var pressed = 32;
        function sendButton(ev) {
            var button;
            var pos;
            button = getButton(ev);
            pos = self.mouseHelper.getRawByteCoords(ev, self.screenElement, self.charMeasure, self.cols, self.rows);
            if (!pos)
                return;
            sendEvent(button, pos);
            switch (ev.overrideType || ev.type) {
                case 'mousedown':
                    pressed = button;
                    break;
                case 'mouseup':
                    pressed = 32;
                    break;
                case 'wheel':
                    break;
            }
        }
        function sendMove(ev) {
            var button = pressed;
            var pos = self.mouseHelper.getRawByteCoords(ev, self.screenElement, self.charMeasure, self.cols, self.rows);
            if (!pos)
                return;
            button += 32;
            sendEvent(button, pos);
        }
        function encode(data, ch) {
            if (!self.utfMouse) {
                if (ch === 255) {
                    data.push(0);
                    return;
                }
                if (ch > 127)
                    ch = 127;
                data.push(ch);
            }
            else {
                if (ch === 2047) {
                    data.push(0);
                    return;
                }
                if (ch < 127) {
                    data.push(ch);
                }
                else {
                    if (ch > 2047)
                        ch = 2047;
                    data.push(0xC0 | (ch >> 6));
                    data.push(0x80 | (ch & 0x3F));
                }
            }
        }
        function sendEvent(button, pos) {
            if (self._vt300Mouse) {
                button &= 3;
                pos.x -= 32;
                pos.y -= 32;
                var data_1 = EscapeSequences_1.C0.ESC + '[24';
                if (button === 0)
                    data_1 += '1';
                else if (button === 1)
                    data_1 += '3';
                else if (button === 2)
                    data_1 += '5';
                else if (button === 3)
                    return;
                else
                    data_1 += '0';
                data_1 += '~[' + pos.x + ',' + pos.y + ']\r';
                self.handler(data_1);
                return;
            }
            if (self._decLocator) {
                button &= 3;
                pos.x -= 32;
                pos.y -= 32;
                if (button === 0)
                    button = 2;
                else if (button === 1)
                    button = 4;
                else if (button === 2)
                    button = 6;
                else if (button === 3)
                    button = 3;
                self.handler(EscapeSequences_1.C0.ESC + '['
                    + button
                    + ';'
                    + (button === 3 ? 4 : 0)
                    + ';'
                    + pos.y
                    + ';'
                    + pos.x
                    + ';'
                    + pos.page || 0
                    + '&w');
                return;
            }
            if (self.urxvtMouse) {
                pos.x -= 32;
                pos.y -= 32;
                pos.x++;
                pos.y++;
                self.handler(EscapeSequences_1.C0.ESC + '[' + button + ';' + pos.x + ';' + pos.y + 'M');
                return;
            }
            if (self.sgrMouse) {
                pos.x -= 32;
                pos.y -= 32;
                self.handler(EscapeSequences_1.C0.ESC + '[<'
                    + (((button & 3) === 3 ? button & ~3 : button) - 32)
                    + ';'
                    + pos.x
                    + ';'
                    + pos.y
                    + ((button & 3) === 3 ? 'm' : 'M'));
                return;
            }
            var data = [];
            encode(data, button);
            encode(data, pos.x);
            encode(data, pos.y);
            self.handler(EscapeSequences_1.C0.ESC + '[M' + String.fromCharCode.apply(String, data));
        }
        function getButton(ev) {
            var button;
            var shift;
            var meta;
            var ctrl;
            var mod;
            switch (ev.overrideType || ev.type) {
                case 'mousedown':
                    button = ev.button !== null && ev.button !== undefined
                        ? +ev.button
                        : ev.which !== null && ev.which !== undefined
                            ? ev.which - 1
                            : null;
                    if (Browser.isMSIE) {
                        button = button === 1 ? 0 : button === 4 ? 1 : button;
                    }
                    break;
                case 'mouseup':
                    button = 3;
                    break;
                case 'DOMMouseScroll':
                    button = ev.detail < 0
                        ? 64
                        : 65;
                    break;
                case 'wheel':
                    button = ev.deltaY < 0
                        ? 64
                        : 65;
                    break;
            }
            shift = ev.shiftKey ? 4 : 0;
            meta = ev.metaKey ? 8 : 0;
            ctrl = ev.ctrlKey ? 16 : 0;
            mod = shift | meta | ctrl;
            if (self.vt200Mouse) {
                mod &= ctrl;
            }
            else if (!self.normalMouse) {
                mod = 0;
            }
            button = (32 + (mod << 2)) + button;
            return button;
        }
        this.register(Lifecycle_1.addDisposableDomListener(el, 'mousedown', function (ev) {
            ev.preventDefault();
            _this.focus();
            if (!_this.mouseEvents || _this.selectionManager.shouldForceSelection(ev)) {
                return;
            }
            sendButton(ev);
            if (_this.vt200Mouse) {
                ev.overrideType = 'mouseup';
                sendButton(ev);
                return _this.cancel(ev);
            }
            var moveHandler;
            if (_this.normalMouse) {
                moveHandler = function (event) {
                    if (!_this.normalMouse) {
                        return;
                    }
                    sendMove(event);
                };
                _this._document.addEventListener('mousemove', moveHandler);
            }
            var handler = function (ev) {
                if (_this.normalMouse && !_this.x10Mouse) {
                    sendButton(ev);
                }
                if (moveHandler) {
                    _this._document.removeEventListener('mousemove', moveHandler);
                    moveHandler = null;
                }
                _this._document.removeEventListener('mouseup', handler);
                return _this.cancel(ev);
            };
            _this._document.addEventListener('mouseup', handler);
            return _this.cancel(ev);
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'wheel', function (ev) {
            if (!_this.mouseEvents) {
                if (!_this.buffer.hasScrollback) {
                    var amount = _this.viewport.getLinesScrolled(ev);
                    if (amount === 0) {
                        return;
                    }
                    var sequence = EscapeSequences_1.C0.ESC + (_this.applicationCursor ? 'O' : '[') + (ev.deltaY < 0 ? 'A' : 'B');
                    var data = '';
                    for (var i = 0; i < Math.abs(amount); i++) {
                        data += sequence;
                    }
                    _this.handler(data);
                }
                return;
            }
            if (_this.x10Mouse || _this._vt300Mouse || _this._decLocator)
                return;
            sendButton(ev);
            ev.preventDefault();
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'wheel', function (ev) {
            if (_this.mouseEvents)
                return;
            _this.viewport.onWheel(ev);
            return _this.cancel(ev);
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'touchstart', function (ev) {
            if (_this.mouseEvents)
                return;
            _this.viewport.onTouchStart(ev);
            return _this.cancel(ev);
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'touchmove', function (ev) {
            if (_this.mouseEvents)
                return;
            _this.viewport.onTouchMove(ev);
            return _this.cancel(ev);
        }));
    };
    Terminal.prototype.refresh = function (start, end) {
        if (this.renderer) {
            this.renderer.refreshRows(start, end);
        }
    };
    Terminal.prototype._queueLinkification = function (start, end) {
        if (this.linkifier) {
            this.linkifier.linkifyRows(start, end);
        }
    };
    Terminal.prototype.updateCursorStyle = function (ev) {
        if (this.selectionManager && this.selectionManager.shouldColumnSelect(ev)) {
            this.element.classList.add('column-select');
        }
        else {
            this.element.classList.remove('column-select');
        }
    };
    Terminal.prototype.showCursor = function () {
        if (!this.cursorState) {
            this.cursorState = 1;
            this.refresh(this.buffer.y, this.buffer.y);
        }
    };
    Terminal.prototype.scroll = function (isWrapped) {
        if (isWrapped === void 0) { isWrapped = false; }
        var newLine;
        var useRecycling = this.options.experimentalBufferLineImpl !== 'JsArray';
        if (useRecycling) {
            newLine = this._blankLine;
            if (!newLine || newLine.length !== this.cols || newLine.get(0)[Buffer_1.CHAR_DATA_ATTR_INDEX] !== this.eraseAttr()) {
                newLine = this.buffer.getBlankLine(this.eraseAttr(), isWrapped);
                this._blankLine = newLine;
            }
            newLine.isWrapped = isWrapped;
        }
        else {
            newLine = this.buffer.getBlankLine(this.eraseAttr(), isWrapped);
        }
        var topRow = this.buffer.ybase + this.buffer.scrollTop;
        var bottomRow = this.buffer.ybase + this.buffer.scrollBottom;
        if (this.buffer.scrollTop === 0) {
            var willBufferBeTrimmed = this.buffer.lines.isFull;
            if (bottomRow === this.buffer.lines.length - 1) {
                if (useRecycling) {
                    if (willBufferBeTrimmed) {
                        this.buffer.lines.recycle().copyFrom(newLine);
                    }
                    else {
                        this.buffer.lines.push(newLine.clone());
                    }
                }
                else {
                    this.buffer.lines.push(newLine);
                }
            }
            else {
                this.buffer.lines.splice(bottomRow + 1, 0, (useRecycling) ? newLine.clone() : newLine);
            }
            if (!willBufferBeTrimmed) {
                this.buffer.ybase++;
                if (!this._userScrolling) {
                    this.buffer.ydisp++;
                }
            }
            else {
                if (this._userScrolling) {
                    this.buffer.ydisp = Math.max(this.buffer.ydisp - 1, 0);
                }
            }
        }
        else {
            var scrollRegionHeight = bottomRow - topRow + 1;
            this.buffer.lines.shiftElements(topRow + 1, scrollRegionHeight - 1, -1);
            this.buffer.lines.set(bottomRow, (useRecycling) ? newLine.clone() : newLine);
        }
        if (!this._userScrolling) {
            this.buffer.ydisp = this.buffer.ybase;
        }
        this.updateRange(this.buffer.scrollTop);
        this.updateRange(this.buffer.scrollBottom);
        this.emit('scroll', this.buffer.ydisp);
    };
    Terminal.prototype.scrollLines = function (disp, suppressScrollEvent) {
        if (disp < 0) {
            if (this.buffer.ydisp === 0) {
                return;
            }
            this._userScrolling = true;
        }
        else if (disp + this.buffer.ydisp >= this.buffer.ybase) {
            this._userScrolling = false;
        }
        var oldYdisp = this.buffer.ydisp;
        this.buffer.ydisp = Math.max(Math.min(this.buffer.ydisp + disp, this.buffer.ybase), 0);
        if (oldYdisp === this.buffer.ydisp) {
            return;
        }
        if (!suppressScrollEvent) {
            this.emit('scroll', this.buffer.ydisp);
        }
        this.refresh(0, this.rows - 1);
    };
    Terminal.prototype.scrollPages = function (pageCount) {
        this.scrollLines(pageCount * (this.rows - 1));
    };
    Terminal.prototype.scrollToTop = function () {
        this.scrollLines(-this.buffer.ydisp);
    };
    Terminal.prototype.scrollToBottom = function () {
        this.scrollLines(this.buffer.ybase - this.buffer.ydisp);
    };
    Terminal.prototype.scrollToLine = function (line) {
        var scrollAmount = line - this.buffer.ydisp;
        if (scrollAmount !== 0) {
            this.scrollLines(scrollAmount);
        }
    };
    Terminal.prototype.write = function (data) {
        var _this = this;
        if (this._isDisposed) {
            return;
        }
        if (!data) {
            return;
        }
        this.writeBuffer.push(data);
        if (this.options.useFlowControl && !this._xoffSentToCatchUp && this.writeBuffer.length >= WRITE_BUFFER_PAUSE_THRESHOLD) {
            this.handler(EscapeSequences_1.C0.DC3);
            this._xoffSentToCatchUp = true;
        }
        if (!this._writeInProgress && this.writeBuffer.length > 0) {
            this._writeInProgress = true;
            setTimeout(function () {
                _this._innerWrite();
            });
        }
    };
    Terminal.prototype._innerWrite = function () {
        var _this = this;
        if (this._isDisposed) {
            this.writeBuffer = [];
        }
        var writeBatch = this.writeBuffer.splice(0, WRITE_BATCH_SIZE);
        while (writeBatch.length > 0) {
            var data = writeBatch.shift();
            if (this._xoffSentToCatchUp && writeBatch.length === 0 && this.writeBuffer.length === 0) {
                this.handler(EscapeSequences_1.C0.DC1);
                this._xoffSentToCatchUp = false;
            }
            this._refreshStart = this.buffer.y;
            this._refreshEnd = this.buffer.y;
            this._inputHandler.parse(data);
            this.updateRange(this.buffer.y);
            this.refresh(this._refreshStart, this._refreshEnd);
        }
        if (this.writeBuffer.length > 0) {
            setTimeout(function () { return _this._innerWrite(); }, 0);
        }
        else {
            this._writeInProgress = false;
        }
    };
    Terminal.prototype.writeln = function (data) {
        this.write(data + '\r\n');
    };
    Terminal.prototype.attachCustomKeyEventHandler = function (customKeyEventHandler) {
        this._customKeyEventHandler = customKeyEventHandler;
    };
    Terminal.prototype.registerLinkMatcher = function (regex, handler, options) {
        var matcherId = this.linkifier.registerLinkMatcher(regex, handler, options);
        this.refresh(0, this.rows - 1);
        return matcherId;
    };
    Terminal.prototype.deregisterLinkMatcher = function (matcherId) {
        if (this.linkifier.deregisterLinkMatcher(matcherId)) {
            this.refresh(0, this.rows - 1);
        }
    };
    Terminal.prototype.registerCharacterJoiner = function (handler) {
        var joinerId = this.renderer.registerCharacterJoiner(handler);
        this.refresh(0, this.rows - 1);
        return joinerId;
    };
    Terminal.prototype.deregisterCharacterJoiner = function (joinerId) {
        if (this.renderer.deregisterCharacterJoiner(joinerId)) {
            this.refresh(0, this.rows - 1);
        }
    };
    Object.defineProperty(Terminal.prototype, "markers", {
        get: function () {
            return this.buffer.markers;
        },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.addMarker = function (cursorYOffset) {
        if (this.buffer !== this.buffers.normal) {
            return;
        }
        return this.buffer.addMarker(this.buffer.ybase + this.buffer.y + cursorYOffset);
    };
    Terminal.prototype.hasSelection = function () {
        return this.selectionManager ? this.selectionManager.hasSelection : false;
    };
    Terminal.prototype.getSelection = function () {
        return this.selectionManager ? this.selectionManager.selectionText : '';
    };
    Terminal.prototype.clearSelection = function () {
        if (this.selectionManager) {
            this.selectionManager.clearSelection();
        }
    };
    Terminal.prototype.selectAll = function () {
        if (this.selectionManager) {
            this.selectionManager.selectAll();
        }
    };
    Terminal.prototype.selectLines = function (start, end) {
        if (this.selectionManager) {
            this.selectionManager.selectLines(start, end);
        }
    };
    Terminal.prototype._keyDown = function (event) {
        if (this._customKeyEventHandler && this._customKeyEventHandler(event) === false) {
            return false;
        }
        if (!this._compositionHelper.keydown(event)) {
            if (this.buffer.ybase !== this.buffer.ydisp) {
                this.scrollToBottom();
            }
            return false;
        }
        var result = Keyboard_1.evaluateKeyboardEvent(event, this.applicationCursor, this.browser.isMac, this.options.macOptionIsMeta);
        this.updateCursorStyle(event);
        if (result.type === 3 || result.type === 2) {
            var scrollCount = this.rows - 1;
            this.scrollLines(result.type === 2 ? -scrollCount : scrollCount);
            return this.cancel(event, true);
        }
        if (result.type === 1) {
            this.selectAll();
        }
        if (this._isThirdLevelShift(this.browser, event)) {
            return true;
        }
        if (result.cancel) {
            this.cancel(event, true);
        }
        if (!result.key) {
            return true;
        }
        this.emit('keydown', event);
        this.emit('key', result.key, event);
        this.showCursor();
        this.handler(result.key);
        return this.cancel(event, true);
    };
    Terminal.prototype._isThirdLevelShift = function (browser, ev) {
        var thirdLevelKey = (browser.isMac && !this.options.macOptionIsMeta && ev.altKey && !ev.ctrlKey && !ev.metaKey) ||
            (browser.isMSWindows && ev.altKey && ev.ctrlKey && !ev.metaKey);
        if (ev.type === 'keypress') {
            return thirdLevelKey;
        }
        return thirdLevelKey && (!ev.keyCode || ev.keyCode > 47);
    };
    Terminal.prototype.setgLevel = function (g) {
        this.glevel = g;
        this.charset = this.charsets[g];
    };
    Terminal.prototype.setgCharset = function (g, charset) {
        this.charsets[g] = charset;
        if (this.glevel === g) {
            this.charset = charset;
        }
    };
    Terminal.prototype._keyUp = function (ev) {
        this.updateCursorStyle(ev);
    };
    Terminal.prototype._keyPress = function (ev) {
        var key;
        if (this._customKeyEventHandler && this._customKeyEventHandler(ev) === false) {
            return false;
        }
        this.cancel(ev);
        if (ev.charCode) {
            key = ev.charCode;
        }
        else if (ev.which === null || ev.which === undefined) {
            key = ev.keyCode;
        }
        else if (ev.which !== 0 && ev.charCode !== 0) {
            key = ev.which;
        }
        else {
            return false;
        }
        if (!key || ((ev.altKey || ev.ctrlKey || ev.metaKey) && !this._isThirdLevelShift(this.browser, ev))) {
            return false;
        }
        key = String.fromCharCode(key);
        this.emit('keypress', key, ev);
        this.emit('key', key, ev);
        this.showCursor();
        this.handler(key);
        return true;
    };
    Terminal.prototype.bell = function () {
        var _this = this;
        this.emit('bell');
        if (this._soundBell()) {
            this.soundManager.playBellSound();
        }
        if (this._visualBell()) {
            this.element.classList.add('visual-bell-active');
            clearTimeout(this._visualBellTimer);
            this._visualBellTimer = window.setTimeout(function () {
                _this.element.classList.remove('visual-bell-active');
            }, 200);
        }
    };
    Terminal.prototype.log = function (text, data) {
        if (!this.options.debug)
            return;
        if (!this._context.console || !this._context.console.log)
            return;
        this._context.console.log(text, data);
    };
    Terminal.prototype.error = function (text, data) {
        if (!this.options.debug)
            return;
        if (!this._context.console || !this._context.console.error)
            return;
        this._context.console.error(text, data);
    };
    Terminal.prototype.resize = function (x, y) {
        if (isNaN(x) || isNaN(y)) {
            return;
        }
        if (x === this.cols && y === this.rows) {
            if (this.charMeasure && (!this.charMeasure.width || !this.charMeasure.height)) {
                this.charMeasure.measure(this.options);
            }
            return;
        }
        if (x < 1)
            x = 1;
        if (y < 1)
            y = 1;
        this.buffers.resize(x, y);
        this.cols = x;
        this.rows = y;
        this.buffers.setupTabStops(this.cols);
        if (this.charMeasure) {
            this.charMeasure.measure(this.options);
        }
        this.refresh(0, this.rows - 1);
        this.emit('resize', { cols: x, rows: y });
    };
    Terminal.prototype.updateRange = function (y) {
        if (y < this._refreshStart)
            this._refreshStart = y;
        if (y > this._refreshEnd)
            this._refreshEnd = y;
    };
    Terminal.prototype.maxRange = function () {
        this._refreshStart = 0;
        this._refreshEnd = this.rows - 1;
    };
    Terminal.prototype.clear = function () {
        if (this.buffer.ybase === 0 && this.buffer.y === 0) {
            return;
        }
        this.buffer.lines.set(0, this.buffer.lines.get(this.buffer.ybase + this.buffer.y));
        this.buffer.lines.length = 1;
        this.buffer.ydisp = 0;
        this.buffer.ybase = 0;
        this.buffer.y = 0;
        for (var i = 1; i < this.rows; i++) {
            this.buffer.lines.push(this.buffer.getBlankLine(Buffer_1.DEFAULT_ATTR));
        }
        this.refresh(0, this.rows - 1);
        this.emit('scroll', this.buffer.ydisp);
    };
    Terminal.prototype.ch = function (cur) {
        if (cur) {
            return [this.eraseAttr(), Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE];
        }
        return [Buffer_1.DEFAULT_ATTR, Buffer_1.NULL_CELL_CHAR, Buffer_1.NULL_CELL_WIDTH, Buffer_1.NULL_CELL_CODE];
    };
    Terminal.prototype.is = function (term) {
        return (this.options.termName + '').indexOf(term) === 0;
    };
    Terminal.prototype.handler = function (data) {
        if (this.options.disableStdin) {
            return;
        }
        if (this.selectionManager && this.selectionManager.hasSelection) {
            this.selectionManager.clearSelection();
        }
        if (this.buffer.ybase !== this.buffer.ydisp) {
            this.scrollToBottom();
        }
        this.emit('data', data);
    };
    Terminal.prototype.handleTitle = function (title) {
        this.emit('title', title);
    };
    Terminal.prototype.index = function () {
        this.buffer.y++;
        if (this.buffer.y > this.buffer.scrollBottom) {
            this.buffer.y--;
            this.scroll();
        }
        if (this.buffer.x >= this.cols) {
            this.buffer.x--;
        }
    };
    Terminal.prototype.reverseIndex = function () {
        if (this.buffer.y === this.buffer.scrollTop) {
            var scrollRegionHeight = this.buffer.scrollBottom - this.buffer.scrollTop;
            this.buffer.lines.shiftElements(this.buffer.y + this.buffer.ybase, scrollRegionHeight, 1);
            this.buffer.lines.set(this.buffer.y + this.buffer.ybase, this.buffer.getBlankLine(this.eraseAttr()));
            this.updateRange(this.buffer.scrollTop);
            this.updateRange(this.buffer.scrollBottom);
        }
        else {
            this.buffer.y--;
        }
    };
    Terminal.prototype.reset = function () {
        this.options.rows = this.rows;
        this.options.cols = this.cols;
        var customKeyEventHandler = this._customKeyEventHandler;
        var inputHandler = this._inputHandler;
        var cursorState = this.cursorState;
        this._setup();
        this._customKeyEventHandler = customKeyEventHandler;
        this._inputHandler = inputHandler;
        this.cursorState = cursorState;
        this.refresh(0, this.rows - 1);
        if (this.viewport) {
            this.viewport.syncScrollArea();
        }
    };
    Terminal.prototype.tabSet = function () {
        this.buffer.tabs[this.buffer.x] = true;
    };
    Terminal.prototype.cancel = function (ev, force) {
        if (!this.options.cancelEvents && !force) {
            return;
        }
        ev.preventDefault();
        ev.stopPropagation();
        return false;
    };
    Terminal.prototype.matchColor = function (r1, g1, b1) {
        var hash = (r1 << 16) | (g1 << 8) | b1;
        if (matchColorCache[hash] !== null && matchColorCache[hash] !== undefined) {
            return matchColorCache[hash];
        }
        var ldiff = Infinity;
        var li = -1;
        var i = 0;
        var c;
        var r2;
        var g2;
        var b2;
        var diff;
        for (; i < ColorManager_1.DEFAULT_ANSI_COLORS.length; i++) {
            c = ColorManager_1.DEFAULT_ANSI_COLORS[i].rgba;
            r2 = c >>> 24;
            g2 = c >>> 16 & 0xFF;
            b2 = c >>> 8 & 0xFF;
            diff = matchColorDistance(r1, g1, b1, r2, g2, b2);
            if (diff === 0) {
                li = i;
                break;
            }
            if (diff < ldiff) {
                ldiff = diff;
                li = i;
            }
        }
        return matchColorCache[hash] = li;
    };
    Terminal.prototype._visualBell = function () {
        return false;
    };
    Terminal.prototype._soundBell = function () {
        return this.options.bellStyle === 'sound';
    };
    return Terminal;
}(EventEmitter_1.EventEmitter));
exports.Terminal = Terminal;
function wasModifierKeyOnlyEvent(ev) {
    return ev.keyCode === 16 ||
        ev.keyCode === 17 ||
        ev.keyCode === 18;
}
var matchColorCache = {};
function matchColorDistance(r1, g1, b1, r2, g2, b2) {
    return Math.pow(30 * (r1 - r2), 2)
        + Math.pow(59 * (g1 - g2), 2)
        + Math.pow(11 * (b1 - b2), 2);
}
//# sourceMappingURL=Terminal.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Viewport.js":
/*!********************************************!*\
  !*** ./node_modules/xterm/lib/Viewport.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var Lifecycle_2 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var FALLBACK_SCROLL_BAR_WIDTH = 15;
var Viewport = (function (_super) {
    __extends(Viewport, _super);
    function Viewport(_terminal, _viewportElement, _scrollArea, _charMeasure) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._viewportElement = _viewportElement;
        _this._scrollArea = _scrollArea;
        _this._charMeasure = _charMeasure;
        _this.scrollBarWidth = 0;
        _this._currentRowHeight = 0;
        _this._lastRecordedBufferLength = 0;
        _this._lastRecordedViewportHeight = 0;
        _this._lastRecordedBufferHeight = 0;
        _this._lastScrollTop = 0;
        _this._wheelPartialScroll = 0;
        _this._refreshAnimationFrame = null;
        _this._ignoreNextScrollEvent = false;
        _this.scrollBarWidth = (_this._viewportElement.offsetWidth - _this._scrollArea.offsetWidth) || FALLBACK_SCROLL_BAR_WIDTH;
        _this.register(Lifecycle_2.addDisposableDomListener(_this._viewportElement, 'scroll', _this._onScroll.bind(_this)));
        setTimeout(function () { return _this.syncScrollArea(); }, 0);
        return _this;
    }
    Viewport.prototype.onThemeChanged = function (colors) {
        this._viewportElement.style.backgroundColor = colors.background.css;
    };
    Viewport.prototype._refresh = function () {
        var _this = this;
        if (this._refreshAnimationFrame === null) {
            this._refreshAnimationFrame = requestAnimationFrame(function () { return _this._innerRefresh(); });
        }
    };
    Viewport.prototype._innerRefresh = function () {
        if (this._charMeasure.height > 0) {
            this._currentRowHeight = this._terminal.renderer.dimensions.scaledCellHeight / window.devicePixelRatio;
            this._lastRecordedViewportHeight = this._viewportElement.offsetHeight;
            var newBufferHeight = Math.round(this._currentRowHeight * this._lastRecordedBufferLength) + (this._lastRecordedViewportHeight - this._terminal.renderer.dimensions.canvasHeight);
            if (this._lastRecordedBufferHeight !== newBufferHeight) {
                this._lastRecordedBufferHeight = newBufferHeight;
                this._scrollArea.style.height = this._lastRecordedBufferHeight + 'px';
            }
        }
        var scrollTop = this._terminal.buffer.ydisp * this._currentRowHeight;
        if (this._viewportElement.scrollTop !== scrollTop) {
            this._ignoreNextScrollEvent = true;
            this._viewportElement.scrollTop = scrollTop;
        }
        this._refreshAnimationFrame = null;
    };
    Viewport.prototype.syncScrollArea = function () {
        if (this._lastRecordedBufferLength !== this._terminal.buffer.lines.length) {
            this._lastRecordedBufferLength = this._terminal.buffer.lines.length;
            this._refresh();
            return;
        }
        if (this._lastRecordedViewportHeight !== this._terminal.renderer.dimensions.canvasHeight) {
            this._refresh();
            return;
        }
        var newScrollTop = this._terminal.buffer.ydisp * this._currentRowHeight;
        if (this._lastScrollTop !== newScrollTop) {
            this._refresh();
            return;
        }
        if (this._lastScrollTop !== this._viewportElement.scrollTop) {
            this._refresh();
            return;
        }
        if (this._terminal.renderer.dimensions.scaledCellHeight / window.devicePixelRatio !== this._currentRowHeight) {
            this._refresh();
            return;
        }
    };
    Viewport.prototype._onScroll = function (ev) {
        this._lastScrollTop = this._viewportElement.scrollTop;
        if (!this._viewportElement.offsetParent) {
            return;
        }
        if (this._ignoreNextScrollEvent) {
            this._ignoreNextScrollEvent = false;
            return;
        }
        var newRow = Math.round(this._lastScrollTop / this._currentRowHeight);
        var diff = newRow - this._terminal.buffer.ydisp;
        this._terminal.scrollLines(diff, true);
    };
    Viewport.prototype.onWheel = function (ev) {
        var amount = this._getPixelsScrolled(ev);
        if (amount === 0) {
            return;
        }
        this._viewportElement.scrollTop += amount;
        ev.preventDefault();
    };
    Viewport.prototype._getPixelsScrolled = function (ev) {
        if (ev.deltaY === 0) {
            return 0;
        }
        var amount = ev.deltaY;
        if (ev.deltaMode === WheelEvent.DOM_DELTA_LINE) {
            amount *= this._currentRowHeight;
        }
        else if (ev.deltaMode === WheelEvent.DOM_DELTA_PAGE) {
            amount *= this._currentRowHeight * this._terminal.rows;
        }
        return amount;
    };
    Viewport.prototype.getLinesScrolled = function (ev) {
        if (ev.deltaY === 0) {
            return 0;
        }
        var amount = ev.deltaY;
        if (ev.deltaMode === WheelEvent.DOM_DELTA_PIXEL) {
            amount /= this._currentRowHeight + 0.0;
            this._wheelPartialScroll += amount;
            amount = Math.floor(Math.abs(this._wheelPartialScroll)) * (this._wheelPartialScroll > 0 ? 1 : -1);
            this._wheelPartialScroll %= 1;
        }
        else if (ev.deltaMode === WheelEvent.DOM_DELTA_PAGE) {
            amount *= this._terminal.rows;
        }
        return amount;
    };
    Viewport.prototype.onTouchStart = function (ev) {
        this._lastTouchY = ev.touches[0].pageY;
    };
    Viewport.prototype.onTouchMove = function (ev) {
        var deltaY = this._lastTouchY - ev.touches[0].pageY;
        this._lastTouchY = ev.touches[0].pageY;
        if (deltaY === 0) {
            return;
        }
        this._viewportElement.scrollTop += deltaY;
        ev.preventDefault();
    };
    return Viewport;
}(Lifecycle_1.Disposable));
exports.Viewport = Viewport;
//# sourceMappingURL=Viewport.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/attach/attach.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/addons/attach/attach.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function attach(term, socket, bidirectional, buffered) {
    var addonTerminal = term;
    bidirectional = (typeof bidirectional === 'undefined') ? true : bidirectional;
    addonTerminal.__socket = socket;
    addonTerminal.__flushBuffer = function () {
        addonTerminal.write(addonTerminal.__attachSocketBuffer);
        addonTerminal.__attachSocketBuffer = null;
    };
    addonTerminal.__pushToBuffer = function (data) {
        if (addonTerminal.__attachSocketBuffer) {
            addonTerminal.__attachSocketBuffer += data;
        }
        else {
            addonTerminal.__attachSocketBuffer = data;
            setTimeout(addonTerminal.__flushBuffer, 10);
        }
    };
    var myTextDecoder;
    addonTerminal.__getMessage = function (ev) {
        var str;
        if (typeof ev.data === 'object') {
            if (!myTextDecoder) {
                myTextDecoder = new TextDecoder();
            }
            if (ev.data instanceof ArrayBuffer) {
                str = myTextDecoder.decode(ev.data);
                displayData(str);
            }
            else {
                var fileReader_1 = new FileReader();
                fileReader_1.addEventListener('load', function () {
                    str = myTextDecoder.decode(fileReader_1.result);
                    displayData(str);
                });
                fileReader_1.readAsArrayBuffer(ev.data);
            }
        }
        else if (typeof ev.data === 'string') {
            displayData(ev.data);
        }
        else {
            throw Error("Cannot handle \"" + typeof ev.data + "\" websocket message.");
        }
    };
    function displayData(str, data) {
        if (buffered) {
            addonTerminal.__pushToBuffer(str || data);
        }
        else {
            addonTerminal.write(str || data);
        }
    }
    addonTerminal.__sendData = function (data) {
        if (socket.readyState !== 1) {
            return;
        }
        socket.send(data);
    };
    addonTerminal._core.register(addSocketListener(socket, 'message', addonTerminal.__getMessage));
    if (bidirectional) {
        addonTerminal._core.register(addonTerminal.addDisposableListener('data', addonTerminal.__sendData));
    }
    addonTerminal._core.register(addSocketListener(socket, 'close', function () { return detach(addonTerminal, socket); }));
    addonTerminal._core.register(addSocketListener(socket, 'error', function () { return detach(addonTerminal, socket); }));
}
exports.attach = attach;
function addSocketListener(socket, type, handler) {
    socket.addEventListener(type, handler);
    return {
        dispose: function () {
            if (!handler) {
                return;
            }
            socket.removeEventListener(type, handler);
            handler = null;
        }
    };
}
function detach(term, socket) {
    var addonTerminal = term;
    addonTerminal.off('data', addonTerminal.__sendData);
    socket = (typeof socket === 'undefined') ? addonTerminal.__socket : socket;
    if (socket) {
        socket.removeEventListener('message', addonTerminal.__getMessage);
    }
    delete addonTerminal.__socket;
}
exports.detach = detach;
function apply(terminalConstructor) {
    terminalConstructor.prototype.attach = function (socket, bidirectional, buffered) {
        attach(this, socket, bidirectional, buffered);
    };
    terminalConstructor.prototype.detach = function (socket) {
        detach(this, socket);
    };
}
exports.apply = apply;
//# sourceMappingURL=attach.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/fit/fit.js":
/*!**************************************************!*\
  !*** ./node_modules/xterm/lib/addons/fit/fit.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function proposeGeometry(term) {
    if (!term.element.parentElement) {
        return null;
    }
    var parentElementStyle = window.getComputedStyle(term.element.parentElement);
    var parentElementHeight = parseInt(parentElementStyle.getPropertyValue('height'));
    var parentElementWidth = Math.max(0, parseInt(parentElementStyle.getPropertyValue('width')));
    var elementStyle = window.getComputedStyle(term.element);
    var elementPadding = {
        top: parseInt(elementStyle.getPropertyValue('padding-top')),
        bottom: parseInt(elementStyle.getPropertyValue('padding-bottom')),
        right: parseInt(elementStyle.getPropertyValue('padding-right')),
        left: parseInt(elementStyle.getPropertyValue('padding-left'))
    };
    var elementPaddingVer = elementPadding.top + elementPadding.bottom;
    var elementPaddingHor = elementPadding.right + elementPadding.left;
    var availableHeight = parentElementHeight - elementPaddingVer;
    var availableWidth = parentElementWidth - elementPaddingHor - term._core.viewport.scrollBarWidth;
    var geometry = {
        cols: Math.floor(availableWidth / term._core.renderer.dimensions.actualCellWidth),
        rows: Math.floor(availableHeight / term._core.renderer.dimensions.actualCellHeight)
    };
    return geometry;
}
exports.proposeGeometry = proposeGeometry;
function fit(term) {
    var geometry = proposeGeometry(term);
    if (geometry) {
        if (term.rows !== geometry.rows || term.cols !== geometry.cols) {
            term._core.renderer.clear();
            term.resize(geometry.cols, geometry.rows);
        }
    }
}
exports.fit = fit;
function apply(terminalConstructor) {
    terminalConstructor.prototype.proposeGeometry = function () {
        return proposeGeometry(this);
    };
    terminalConstructor.prototype.fit = function () {
        fit(this);
    };
}
exports.apply = apply;
//# sourceMappingURL=fit.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/fullscreen/fullscreen.js":
/*!****************************************************************!*\
  !*** ./node_modules/xterm/lib/addons/fullscreen/fullscreen.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function toggleFullScreen(term, fullscreen) {
    var fn;
    if (typeof fullscreen === 'undefined') {
        fn = (term.element.classList.contains('fullscreen')) ?
            term.element.classList.remove : term.element.classList.add;
    }
    else if (!fullscreen) {
        fn = term.element.classList.remove;
    }
    else {
        fn = term.element.classList.add;
    }
    fn('fullscreen');
}
exports.toggleFullScreen = toggleFullScreen;
function apply(terminalConstructor) {
    terminalConstructor.prototype.toggleFullScreen = function (fullscreen) {
        toggleFullScreen(this, fullscreen);
    };
}
exports.apply = apply;
//# sourceMappingURL=fullscreen.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/search/SearchHelper.js":
/*!**************************************************************!*\
  !*** ./node_modules/xterm/lib/addons/search/SearchHelper.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var nonWordCharacters = ' ~!@#$%^&*()+`-=[]{}|\;:"\',./<>?';
var SearchHelper = (function () {
    function SearchHelper(_terminal) {
        this._terminal = _terminal;
    }
    SearchHelper.prototype.findNext = function (term, searchOptions) {
        if (!term || term.length === 0) {
            return false;
        }
        var result;
        var startRow = this._terminal._core.buffer.ydisp;
        if (this._terminal._core.selectionManager.selectionEnd) {
            if (this._terminal.getSelection().length !== 0) {
                startRow = this._terminal._core.selectionManager.selectionEnd[1];
            }
        }
        for (var y = startRow + 1; y < this._terminal._core.buffer.ybase + this._terminal.rows; y++) {
            result = this._findInLine(term, y, searchOptions);
            if (result) {
                break;
            }
        }
        if (!result) {
            for (var y = 0; y < startRow; y++) {
                result = this._findInLine(term, y, searchOptions);
                if (result) {
                    break;
                }
            }
        }
        return this._selectResult(result);
    };
    SearchHelper.prototype.findPrevious = function (term, searchOptions) {
        if (!term || term.length === 0) {
            return false;
        }
        var result;
        var startRow = this._terminal._core.buffer.ydisp;
        if (this._terminal._core.selectionManager.selectionStart) {
            if (this._terminal.getSelection().length !== 0) {
                startRow = this._terminal._core.selectionManager.selectionStart[1];
            }
        }
        for (var y = startRow - 1; y >= 0; y--) {
            result = this._findInLine(term, y, searchOptions);
            if (result) {
                break;
            }
        }
        if (!result) {
            for (var y = this._terminal._core.buffer.ybase + this._terminal.rows - 1; y > startRow; y--) {
                result = this._findInLine(term, y, searchOptions);
                if (result) {
                    break;
                }
            }
        }
        return this._selectResult(result);
    };
    SearchHelper.prototype._isWholeWord = function (searchIndex, line, term) {
        return (((searchIndex === 0) || (nonWordCharacters.indexOf(line[searchIndex - 1]) !== -1)) &&
            (((searchIndex + term.length) === line.length) || (nonWordCharacters.indexOf(line[searchIndex + term.length]) !== -1)));
    };
    SearchHelper.prototype._findInLine = function (term, y, searchOptions) {
        if (searchOptions === void 0) { searchOptions = {}; }
        if (this._terminal._core.buffer.lines.get(y).isWrapped) {
            return;
        }
        var stringLine = this.translateBufferLineToStringWithWrap(y, true);
        var searchStringLine = searchOptions.caseSensitive ? stringLine : stringLine.toLowerCase();
        var searchTerm = searchOptions.caseSensitive ? term : term.toLowerCase();
        var searchIndex = -1;
        if (searchOptions.regex) {
            var searchRegex = RegExp(searchTerm, 'g');
            var foundTerm = searchRegex.exec(searchStringLine);
            if (foundTerm && foundTerm[0].length > 0) {
                searchIndex = searchRegex.lastIndex - foundTerm[0].length;
                term = foundTerm[0];
            }
        }
        else {
            searchIndex = searchStringLine.indexOf(searchTerm);
        }
        if (searchIndex >= 0) {
            if (searchIndex >= this._terminal.cols) {
                y += Math.floor(searchIndex / this._terminal.cols);
                searchIndex = searchIndex % this._terminal.cols;
            }
            if (searchOptions.wholeWord && !this._isWholeWord(searchIndex, searchStringLine, term)) {
                return;
            }
            var line = this._terminal._core.buffer.lines.get(y);
            for (var i = 0; i < searchIndex; i++) {
                var charData = line.get(i);
                var char = charData[1];
                if (char.length > 1) {
                    searchIndex -= char.length - 1;
                }
                var charWidth = charData[2];
                if (charWidth === 0) {
                    searchIndex++;
                }
            }
            return {
                term: term,
                col: searchIndex,
                row: y
            };
        }
    };
    SearchHelper.prototype.translateBufferLineToStringWithWrap = function (lineIndex, trimRight) {
        var lineString = '';
        var lineWrapsToNext;
        do {
            var nextLine = this._terminal._core.buffer.lines.get(lineIndex + 1);
            lineWrapsToNext = nextLine ? nextLine.isWrapped : false;
            lineString += this._terminal._core.buffer.translateBufferLineToString(lineIndex, !lineWrapsToNext && trimRight).substring(0, this._terminal.cols);
            lineIndex++;
        } while (lineWrapsToNext);
        return lineString;
    };
    SearchHelper.prototype._selectResult = function (result) {
        if (!result) {
            this._terminal.clearSelection();
            return false;
        }
        this._terminal._core.selectionManager.setSelection(result.col, result.row, result.term.length);
        this._terminal.scrollLines(result.row - this._terminal._core.buffer.ydisp);
        return true;
    };
    return SearchHelper;
}());
exports.SearchHelper = SearchHelper;
//# sourceMappingURL=SearchHelper.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/search/search.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/addons/search/search.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var SearchHelper_1 = __webpack_require__(/*! ./SearchHelper */ "./node_modules/xterm/lib/addons/search/SearchHelper.js");
function findNext(terminal, term, searchOptions) {
    if (searchOptions === void 0) { searchOptions = {}; }
    var addonTerminal = terminal;
    if (!addonTerminal.__searchHelper) {
        addonTerminal.__searchHelper = new SearchHelper_1.SearchHelper(addonTerminal);
    }
    return addonTerminal.__searchHelper.findNext(term, searchOptions);
}
exports.findNext = findNext;
function findPrevious(terminal, term, searchOptions) {
    var addonTerminal = terminal;
    if (!addonTerminal.__searchHelper) {
        addonTerminal.__searchHelper = new SearchHelper_1.SearchHelper(addonTerminal);
    }
    return addonTerminal.__searchHelper.findPrevious(term, searchOptions);
}
exports.findPrevious = findPrevious;
function apply(terminalConstructor) {
    terminalConstructor.prototype.findNext = function (term, searchOptions) {
        return findNext(this, term, searchOptions);
    };
    terminalConstructor.prototype.findPrevious = function (term, searchOptions) {
        return findPrevious(this, term, searchOptions);
    };
}
exports.apply = apply;
//# sourceMappingURL=search.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/webLinks/webLinks.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/addons/webLinks/webLinks.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var protocolClause = '(https?:\\/\\/)';
var domainCharacterSet = '[\\da-z\\.-]+';
var negatedDomainCharacterSet = '[^\\da-z\\.-]+';
var domainBodyClause = '(' + domainCharacterSet + ')';
var tldClause = '([a-z\\.]{2,6})';
var ipClause = '((\\d{1,3}\\.){3}\\d{1,3})';
var localHostClause = '(localhost)';
var portClause = '(:\\d{1,5})';
var hostClause = '((' + domainBodyClause + '\\.' + tldClause + ')|' + ipClause + '|' + localHostClause + ')' + portClause + '?';
var pathClause = '(\\/[\\/\\w\\.\\-%~:]*)*([^:\\s])';
var queryStringHashFragmentCharacterSet = '[0-9\\w\\[\\]\\(\\)\\/\\?\\!#@$%&\'*+,:;~\\=\\.\\-]*';
var queryStringClause = '(\\?' + queryStringHashFragmentCharacterSet + ')?';
var hashFragmentClause = '(#' + queryStringHashFragmentCharacterSet + ')?';
var negatedPathCharacterSet = '[^\\/\\w\\.\\-%]+';
var bodyClause = hostClause + pathClause + queryStringClause + hashFragmentClause;
var start = '(?:^|' + negatedDomainCharacterSet + ')(';
var end = ')($|' + negatedPathCharacterSet + ')';
var strictUrlRegex = new RegExp(start + protocolClause + bodyClause + end);
function handleLink(event, uri) {
    window.open(uri, '_blank');
}
function webLinksInit(term, handler, options) {
    if (handler === void 0) { handler = handleLink; }
    if (options === void 0) { options = {}; }
    options.matchIndex = 1;
    term.registerLinkMatcher(strictUrlRegex, handler, options);
}
exports.webLinksInit = webLinksInit;
function apply(terminalConstructor) {
    terminalConstructor.prototype.webLinksInit = function (handler, options) {
        webLinksInit(this, handler, options);
    };
}
exports.apply = apply;
//# sourceMappingURL=webLinks.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/addons/winptyCompat/winptyCompat.js":
/*!********************************************************************!*\
  !*** ./node_modules/xterm/lib/addons/winptyCompat/winptyCompat.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var CHAR_DATA_CODE_INDEX = 3;
var NULL_CELL_CODE = 32;
function winptyCompatInit(terminal) {
    var addonTerminal = terminal;
    var isWindows = ['Windows', 'Win16', 'Win32', 'WinCE'].indexOf(navigator.platform) >= 0;
    if (!isWindows) {
        return;
    }
    addonTerminal.on('linefeed', function () {
        var line = addonTerminal._core.buffer.lines.get(addonTerminal._core.buffer.ybase + addonTerminal._core.buffer.y - 1);
        var lastChar = line.get(addonTerminal.cols - 1);
        if (lastChar[CHAR_DATA_CODE_INDEX] !== NULL_CELL_CODE) {
            var nextLine = addonTerminal._core.buffer.lines.get(addonTerminal._core.buffer.ybase + addonTerminal._core.buffer.y);
            nextLine.isWrapped = true;
        }
    });
}
exports.winptyCompatInit = winptyCompatInit;
function apply(terminalConstructor) {
    terminalConstructor.prototype.winptyCompatInit = function () {
        winptyCompatInit(this);
    };
}
exports.apply = apply;
//# sourceMappingURL=winptyCompat.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/CircularList.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/common/CircularList.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter_1 = __webpack_require__(/*! ./EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var CircularList = (function (_super) {
    __extends(CircularList, _super);
    function CircularList(_maxLength) {
        var _this = _super.call(this) || this;
        _this._maxLength = _maxLength;
        _this._array = new Array(_this._maxLength);
        _this._startIndex = 0;
        _this._length = 0;
        return _this;
    }
    Object.defineProperty(CircularList.prototype, "maxLength", {
        get: function () {
            return this._maxLength;
        },
        set: function (newMaxLength) {
            if (this._maxLength === newMaxLength) {
                return;
            }
            var newArray = new Array(newMaxLength);
            for (var i = 0; i < Math.min(newMaxLength, this.length); i++) {
                newArray[i] = this._array[this._getCyclicIndex(i)];
            }
            this._array = newArray;
            this._maxLength = newMaxLength;
            this._startIndex = 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CircularList.prototype, "length", {
        get: function () {
            return this._length;
        },
        set: function (newLength) {
            if (newLength > this._length) {
                for (var i = this._length; i < newLength; i++) {
                    this._array[i] = undefined;
                }
            }
            this._length = newLength;
        },
        enumerable: true,
        configurable: true
    });
    CircularList.prototype.get = function (index) {
        return this._array[this._getCyclicIndex(index)];
    };
    CircularList.prototype.set = function (index, value) {
        this._array[this._getCyclicIndex(index)] = value;
    };
    CircularList.prototype.push = function (value) {
        this._array[this._getCyclicIndex(this._length)] = value;
        if (this._length === this._maxLength) {
            this._startIndex = ++this._startIndex % this._maxLength;
            this.emit('trim', 1);
        }
        else {
            this._length++;
        }
    };
    CircularList.prototype.recycle = function () {
        if (this._length !== this._maxLength) {
            throw new Error('Can only recycle when the buffer is full');
        }
        this._startIndex = ++this._startIndex % this._maxLength;
        this.emit('trim', 1);
        return this._array[this._getCyclicIndex(this._length - 1)];
    };
    Object.defineProperty(CircularList.prototype, "isFull", {
        get: function () {
            return this._length === this._maxLength;
        },
        enumerable: true,
        configurable: true
    });
    CircularList.prototype.pop = function () {
        return this._array[this._getCyclicIndex(this._length-- - 1)];
    };
    CircularList.prototype.splice = function (start, deleteCount) {
        var items = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            items[_i - 2] = arguments[_i];
        }
        if (deleteCount) {
            for (var i = start; i < this._length - deleteCount; i++) {
                this._array[this._getCyclicIndex(i)] = this._array[this._getCyclicIndex(i + deleteCount)];
            }
            this._length -= deleteCount;
        }
        if (items && items.length) {
            for (var i = this._length - 1; i >= start; i--) {
                this._array[this._getCyclicIndex(i + items.length)] = this._array[this._getCyclicIndex(i)];
            }
            for (var i = 0; i < items.length; i++) {
                this._array[this._getCyclicIndex(start + i)] = items[i];
            }
            if (this._length + items.length > this._maxLength) {
                var countToTrim = (this._length + items.length) - this._maxLength;
                this._startIndex += countToTrim;
                this._length = this._maxLength;
                this.emit('trim', countToTrim);
            }
            else {
                this._length += items.length;
            }
        }
    };
    CircularList.prototype.trimStart = function (count) {
        if (count > this._length) {
            count = this._length;
        }
        this._startIndex += count;
        this._length -= count;
        this.emit('trim', count);
    };
    CircularList.prototype.shiftElements = function (start, count, offset) {
        if (count <= 0) {
            return;
        }
        if (start < 0 || start >= this._length) {
            throw new Error('start argument out of range');
        }
        if (start + offset < 0) {
            throw new Error('Cannot shift elements in list beyond index 0');
        }
        if (offset > 0) {
            for (var i = count - 1; i >= 0; i--) {
                this.set(start + i + offset, this.get(start + i));
            }
            var expandListBy = (start + count + offset) - this._length;
            if (expandListBy > 0) {
                this._length += expandListBy;
                while (this._length > this._maxLength) {
                    this._length--;
                    this._startIndex++;
                    this.emit('trim', 1);
                }
            }
        }
        else {
            for (var i = 0; i < count; i++) {
                this.set(start + i + offset, this.get(start + i));
            }
        }
    };
    CircularList.prototype._getCyclicIndex = function (index) {
        return (this._startIndex + index) % this._maxLength;
    };
    return CircularList;
}(EventEmitter_1.EventEmitter));
exports.CircularList = CircularList;
//# sourceMappingURL=CircularList.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/EventEmitter.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/common/EventEmitter.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var EventEmitter = (function (_super) {
    __extends(EventEmitter, _super);
    function EventEmitter() {
        var _this = _super.call(this) || this;
        _this._events = _this._events || {};
        return _this;
    }
    EventEmitter.prototype.on = function (type, listener) {
        this._events[type] = this._events[type] || [];
        this._events[type].push(listener);
    };
    EventEmitter.prototype.addDisposableListener = function (type, handler) {
        var _this = this;
        this.on(type, handler);
        var disposed = false;
        return {
            dispose: function () {
                if (disposed) {
                    return;
                }
                _this.off(type, handler);
                disposed = true;
            }
        };
    };
    EventEmitter.prototype.off = function (type, listener) {
        if (!this._events[type]) {
            return;
        }
        var obj = this._events[type];
        var i = obj.length;
        while (i--) {
            if (obj[i] === listener) {
                obj.splice(i, 1);
                return;
            }
        }
    };
    EventEmitter.prototype.removeAllListeners = function (type) {
        if (this._events[type]) {
            delete this._events[type];
        }
    };
    EventEmitter.prototype.emit = function (type) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (!this._events[type]) {
            return;
        }
        var obj = this._events[type];
        for (var i = 0; i < obj.length; i++) {
            obj[i].apply(this, args);
        }
    };
    EventEmitter.prototype.listeners = function (type) {
        return this._events[type] || [];
    };
    EventEmitter.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._events = {};
    };
    return EventEmitter;
}(Lifecycle_1.Disposable));
exports.EventEmitter = EventEmitter;
//# sourceMappingURL=EventEmitter.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/Lifecycle.js":
/*!****************************************************!*\
  !*** ./node_modules/xterm/lib/common/Lifecycle.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Disposable = (function () {
    function Disposable() {
        this._disposables = [];
        this._isDisposed = false;
    }
    Disposable.prototype.dispose = function () {
        this._isDisposed = true;
        this._disposables.forEach(function (d) { return d.dispose(); });
        this._disposables.length = 0;
    };
    Disposable.prototype.register = function (d) {
        this._disposables.push(d);
    };
    Disposable.prototype.unregister = function (d) {
        var index = this._disposables.indexOf(d);
        if (index !== -1) {
            this._disposables.splice(index, 1);
        }
    };
    return Disposable;
}());
exports.Disposable = Disposable;
//# sourceMappingURL=Lifecycle.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/TypedArrayUtils.js":
/*!**********************************************************!*\
  !*** ./node_modules/xterm/lib/common/TypedArrayUtils.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function fill(array, value, start, end) {
    if (array.fill) {
        return array.fill(value, start, end);
    }
    return fillFallback(array, value, start, end);
}
exports.fill = fill;
function fillFallback(array, value, start, end) {
    if (start === void 0) { start = 0; }
    if (end === void 0) { end = array.length; }
    if (start >= array.length) {
        return array;
    }
    start = (array.length + start) % array.length;
    if (end >= array.length) {
        end = array.length;
    }
    else {
        end = (array.length + end) % array.length;
    }
    for (var i = start; i < end; ++i) {
        array[i] = value;
    }
    return array;
}
exports.fillFallback = fillFallback;
//# sourceMappingURL=TypedArrayUtils.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/data/EscapeSequences.js":
/*!***************************************************************!*\
  !*** ./node_modules/xterm/lib/common/data/EscapeSequences.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var C0;
(function (C0) {
    C0.NUL = '\x00';
    C0.SOH = '\x01';
    C0.STX = '\x02';
    C0.ETX = '\x03';
    C0.EOT = '\x04';
    C0.ENQ = '\x05';
    C0.ACK = '\x06';
    C0.BEL = '\x07';
    C0.BS = '\x08';
    C0.HT = '\x09';
    C0.LF = '\x0a';
    C0.VT = '\x0b';
    C0.FF = '\x0c';
    C0.CR = '\x0d';
    C0.SO = '\x0e';
    C0.SI = '\x0f';
    C0.DLE = '\x10';
    C0.DC1 = '\x11';
    C0.DC2 = '\x12';
    C0.DC3 = '\x13';
    C0.DC4 = '\x14';
    C0.NAK = '\x15';
    C0.SYN = '\x16';
    C0.ETB = '\x17';
    C0.CAN = '\x18';
    C0.EM = '\x19';
    C0.SUB = '\x1a';
    C0.ESC = '\x1b';
    C0.FS = '\x1c';
    C0.GS = '\x1d';
    C0.RS = '\x1e';
    C0.US = '\x1f';
    C0.SP = '\x20';
    C0.DEL = '\x7f';
})(C0 = exports.C0 || (exports.C0 = {}));
var C1;
(function (C1) {
    C1.PAD = '\x80';
    C1.HOP = '\x81';
    C1.BPH = '\x82';
    C1.NBH = '\x83';
    C1.IND = '\x84';
    C1.NEL = '\x85';
    C1.SSA = '\x86';
    C1.ESA = '\x87';
    C1.HTS = '\x88';
    C1.HTJ = '\x89';
    C1.VTS = '\x8a';
    C1.PLD = '\x8b';
    C1.PLU = '\x8c';
    C1.RI = '\x8d';
    C1.SS2 = '\x8e';
    C1.SS3 = '\x8f';
    C1.DCS = '\x90';
    C1.PU1 = '\x91';
    C1.PU2 = '\x92';
    C1.STS = '\x93';
    C1.CCH = '\x94';
    C1.MW = '\x95';
    C1.SPA = '\x96';
    C1.EPA = '\x97';
    C1.SOS = '\x98';
    C1.SGCI = '\x99';
    C1.SCI = '\x9a';
    C1.CSI = '\x9b';
    C1.ST = '\x9c';
    C1.OSC = '\x9d';
    C1.PM = '\x9e';
    C1.APC = '\x9f';
})(C1 = exports.C1 || (exports.C1 = {}));
//# sourceMappingURL=EscapeSequences.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/Platform.js":
/*!*************************************************!*\
  !*** ./node_modules/xterm/lib/core/Platform.js ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var isNode = (typeof navigator === 'undefined') ? true : false;
var userAgent = (isNode) ? 'node' : navigator.userAgent;
var platform = (isNode) ? 'node' : navigator.platform;
exports.isFirefox = !!~userAgent.indexOf('Firefox');
exports.isSafari = /^((?!chrome|android).)*safari/i.test(userAgent);
exports.isMSIE = !!~userAgent.indexOf('MSIE') || !!~userAgent.indexOf('Trident');
exports.isMac = contains(['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'], platform);
exports.isIpad = platform === 'iPad';
exports.isIphone = platform === 'iPhone';
exports.isMSWindows = contains(['Windows', 'Win16', 'Win32', 'WinCE'], platform);
exports.isLinux = platform.indexOf('Linux') >= 0;
function contains(arr, el) {
    return arr.indexOf(el) >= 0;
}
//# sourceMappingURL=Platform.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/data/Charsets.js":
/*!******************************************************!*\
  !*** ./node_modules/xterm/lib/core/data/Charsets.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.CHARSETS = {};
exports.DEFAULT_CHARSET = exports.CHARSETS['B'];
exports.CHARSETS['0'] = {
    '`': '\u25c6',
    'a': '\u2592',
    'b': '\u0009',
    'c': '\u000c',
    'd': '\u000d',
    'e': '\u000a',
    'f': '\u00b0',
    'g': '\u00b1',
    'h': '\u2424',
    'i': '\u000b',
    'j': '\u2518',
    'k': '\u2510',
    'l': '\u250c',
    'm': '\u2514',
    'n': '\u253c',
    'o': '\u23ba',
    'p': '\u23bb',
    'q': '\u2500',
    'r': '\u23bc',
    's': '\u23bd',
    't': '\u251c',
    'u': '\u2524',
    'v': '\u2534',
    'w': '\u252c',
    'x': '\u2502',
    'y': '\u2264',
    'z': '\u2265',
    '{': '\u03c0',
    '|': '\u2260',
    '}': '\u00a3',
    '~': '\u00b7'
};
exports.CHARSETS['A'] = {
    '#': ''
};
exports.CHARSETS['B'] = null;
exports.CHARSETS['4'] = {
    '#': '',
    '@': '',
    '[': 'ij',
    '\\': '',
    ']': '|',
    '{': '',
    '|': 'f',
    '}': '',
    '~': ''
};
exports.CHARSETS['C'] =
    exports.CHARSETS['5'] = {
        '[': '',
        '\\': '',
        ']': '',
        '^': '',
        '`': '',
        '{': '',
        '|': '',
        '}': '',
        '~': ''
    };
exports.CHARSETS['R'] = {
    '#': '',
    '@': '',
    '[': '',
    '\\': '',
    ']': '',
    '{': '',
    '|': '',
    '}': '',
    '~': ''
};
exports.CHARSETS['Q'] = {
    '@': '',
    '[': '',
    '\\': '',
    ']': '',
    '^': '',
    '`': '',
    '{': '',
    '|': '',
    '}': '',
    '~': ''
};
exports.CHARSETS['K'] = {
    '@': '',
    '[': '',
    '\\': '',
    ']': '',
    '{': '',
    '|': '',
    '}': '',
    '~': ''
};
exports.CHARSETS['Y'] = {
    '#': '',
    '@': '',
    '[': '',
    '\\': '',
    ']': '',
    '`': '',
    '{': '',
    '|': '',
    '}': '',
    '~': ''
};
exports.CHARSETS['E'] =
    exports.CHARSETS['6'] = {
        '@': '',
        '[': '',
        '\\': '',
        ']': '',
        '^': '',
        '`': '',
        '{': '',
        '|': '',
        '}': '',
        '~': ''
    };
exports.CHARSETS['Z'] = {
    '#': '',
    '@': '',
    '[': '',
    '\\': '',
    ']': '',
    '{': '',
    '|': '',
    '}': ''
};
exports.CHARSETS['H'] =
    exports.CHARSETS['7'] = {
        '@': '',
        '[': '',
        '\\': '',
        ']': '',
        '^': '',
        '`': '',
        '{': '',
        '|': '',
        '}': '',
        '~': ''
    };
exports.CHARSETS['='] = {
    '#': '',
    '@': '',
    '[': '',
    '\\': '',
    ']': '',
    '^': '',
    '_': '',
    '`': '',
    '{': '',
    '|': '',
    '}': '',
    '~': ''
};
//# sourceMappingURL=Charsets.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/input/Keyboard.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/core/input/Keyboard.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EscapeSequences_1 = __webpack_require__(/*! ../../common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var KEYCODE_KEY_MAPPINGS = {
    48: ['0', ')'],
    49: ['1', '!'],
    50: ['2', '@'],
    51: ['3', '#'],
    52: ['4', '$'],
    53: ['5', '%'],
    54: ['6', '^'],
    55: ['7', '&'],
    56: ['8', '*'],
    57: ['9', '('],
    186: [';', ':'],
    187: ['=', '+'],
    188: [',', '<'],
    189: ['-', '_'],
    190: ['.', '>'],
    191: ['/', '?'],
    192: ['`', '~'],
    219: ['[', '{'],
    220: ['\\', '|'],
    221: [']', '}'],
    222: ['\'', '"']
};
function evaluateKeyboardEvent(ev, applicationCursorMode, isMac, macOptionIsMeta) {
    var result = {
        type: 0,
        cancel: false,
        key: undefined
    };
    var modifiers = (ev.shiftKey ? 1 : 0) | (ev.altKey ? 2 : 0) | (ev.ctrlKey ? 4 : 0) | (ev.metaKey ? 8 : 0);
    switch (ev.keyCode) {
        case 0:
            if (ev.key === 'UIKeyInputUpArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OA';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[A';
                }
            }
            else if (ev.key === 'UIKeyInputLeftArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OD';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[D';
                }
            }
            else if (ev.key === 'UIKeyInputRightArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OC';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[C';
                }
            }
            else if (ev.key === 'UIKeyInputDownArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OB';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[B';
                }
            }
            break;
        case 8:
            if (ev.shiftKey) {
                result.key = EscapeSequences_1.C0.BS;
                break;
            }
            else if (ev.altKey) {
                result.key = EscapeSequences_1.C0.ESC + EscapeSequences_1.C0.DEL;
                break;
            }
            result.key = EscapeSequences_1.C0.DEL;
            break;
        case 9:
            if (ev.shiftKey) {
                result.key = EscapeSequences_1.C0.ESC + '[Z';
                break;
            }
            result.key = EscapeSequences_1.C0.HT;
            result.cancel = true;
            break;
        case 13:
            result.key = EscapeSequences_1.C0.CR;
            result.cancel = true;
            break;
        case 27:
            result.key = EscapeSequences_1.C0.ESC;
            result.cancel = true;
            break;
        case 37:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'D';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3D') {
                    result.key = isMac ? EscapeSequences_1.C0.ESC + 'b' : EscapeSequences_1.C0.ESC + '[1;5D';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OD';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[D';
            }
            break;
        case 39:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'C';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3C') {
                    result.key = isMac ? EscapeSequences_1.C0.ESC + 'f' : EscapeSequences_1.C0.ESC + '[1;5C';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OC';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[C';
            }
            break;
        case 38:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'A';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3A') {
                    result.key = EscapeSequences_1.C0.ESC + '[1;5A';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OA';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[A';
            }
            break;
        case 40:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'B';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3B') {
                    result.key = EscapeSequences_1.C0.ESC + '[1;5B';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OB';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[B';
            }
            break;
        case 45:
            if (!ev.shiftKey && !ev.ctrlKey) {
                result.key = EscapeSequences_1.C0.ESC + '[2~';
            }
            break;
        case 46:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[3;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[3~';
            }
            break;
        case 36:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'H';
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OH';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[H';
            }
            break;
        case 35:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'F';
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OF';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[F';
            }
            break;
        case 33:
            if (ev.shiftKey) {
                result.type = 2;
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[5~';
            }
            break;
        case 34:
            if (ev.shiftKey) {
                result.type = 3;
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[6~';
            }
            break;
        case 112:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'P';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OP';
            }
            break;
        case 113:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'Q';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OQ';
            }
            break;
        case 114:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'R';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OR';
            }
            break;
        case 115:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'S';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OS';
            }
            break;
        case 116:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[15;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[15~';
            }
            break;
        case 117:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[17;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[17~';
            }
            break;
        case 118:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[18;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[18~';
            }
            break;
        case 119:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[19;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[19~';
            }
            break;
        case 120:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[20;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[20~';
            }
            break;
        case 121:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[21;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[21~';
            }
            break;
        case 122:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[23;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[23~';
            }
            break;
        case 123:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[24;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[24~';
            }
            break;
        default:
            if (ev.ctrlKey && !ev.shiftKey && !ev.altKey && !ev.metaKey) {
                if (ev.keyCode >= 65 && ev.keyCode <= 90) {
                    result.key = String.fromCharCode(ev.keyCode - 64);
                }
                else if (ev.keyCode === 32) {
                    result.key = String.fromCharCode(0);
                }
                else if (ev.keyCode >= 51 && ev.keyCode <= 55) {
                    result.key = String.fromCharCode(ev.keyCode - 51 + 27);
                }
                else if (ev.keyCode === 56) {
                    result.key = String.fromCharCode(127);
                }
                else if (ev.keyCode === 219) {
                    result.key = String.fromCharCode(27);
                }
                else if (ev.keyCode === 220) {
                    result.key = String.fromCharCode(28);
                }
                else if (ev.keyCode === 221) {
                    result.key = String.fromCharCode(29);
                }
            }
            else if ((!isMac || macOptionIsMeta) && ev.altKey && !ev.metaKey) {
                var keyMapping = KEYCODE_KEY_MAPPINGS[ev.keyCode];
                var key = keyMapping && keyMapping[!ev.shiftKey ? 0 : 1];
                if (key) {
                    result.key = EscapeSequences_1.C0.ESC + key;
                }
                else if (ev.keyCode >= 65 && ev.keyCode <= 90) {
                    var keyCode = ev.ctrlKey ? ev.keyCode - 64 : ev.keyCode + 32;
                    result.key = EscapeSequences_1.C0.ESC + String.fromCharCode(keyCode);
                }
            }
            else if (isMac && !ev.altKey && !ev.ctrlKey && ev.metaKey) {
                if (ev.keyCode === 65) {
                    result.type = 1;
                }
            }
            break;
    }
    return result;
}
exports.evaluateKeyboardEvent = evaluateKeyboardEvent;
//# sourceMappingURL=Keyboard.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/handlers/AltClickHandler.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/handlers/AltClickHandler.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EscapeSequences_1 = __webpack_require__(/*! ../common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var AltClickHandler = (function () {
    function AltClickHandler(_mouseEvent, _terminal) {
        var _a;
        this._mouseEvent = _mouseEvent;
        this._terminal = _terminal;
        this._lines = this._terminal.buffer.lines;
        this._startCol = this._terminal.buffer.x;
        this._startRow = this._terminal.buffer.y;
        var coordinates = this._terminal.mouseHelper.getCoords(this._mouseEvent, this._terminal.element, this._terminal.charMeasure, this._terminal.cols, this._terminal.rows, false);
        if (coordinates) {
            _a = coordinates.map(function (coordinate) {
                return coordinate - 1;
            }), this._endCol = _a[0], this._endRow = _a[1];
        }
    }
    AltClickHandler.prototype.move = function () {
        if (this._mouseEvent.altKey && this._endCol !== undefined && this._endRow !== undefined) {
            this._terminal.handler(this._arrowSequences());
        }
    };
    AltClickHandler.prototype._arrowSequences = function () {
        if (!this._terminal.buffer.hasScrollback) {
            return this._resetStartingRow() + this._moveToRequestedRow() + this._moveToRequestedCol();
        }
        return this._moveHorizontallyOnly();
    };
    AltClickHandler.prototype._resetStartingRow = function () {
        if (this._moveToRequestedRow().length === 0) {
            return '';
        }
        return repeat(this._bufferLine(this._startCol, this._startRow, this._startCol, this._startRow - this._wrappedRowsForRow(this._startRow), false).length, this._sequence("D"));
    };
    AltClickHandler.prototype._moveToRequestedRow = function () {
        var startRow = this._startRow - this._wrappedRowsForRow(this._startRow);
        var endRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        var rowsToMove = Math.abs(startRow - endRow) - this._wrappedRowsCount();
        return repeat(rowsToMove, this._sequence(this._verticalDirection()));
    };
    AltClickHandler.prototype._moveToRequestedCol = function () {
        var startRow;
        if (this._moveToRequestedRow().length > 0) {
            startRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        }
        else {
            startRow = this._startRow;
        }
        var endRow = this._endRow;
        var direction = this._horizontalDirection();
        return repeat(this._bufferLine(this._startCol, startRow, this._endCol, endRow, direction === "C").length, this._sequence(direction));
    };
    AltClickHandler.prototype._moveHorizontallyOnly = function () {
        var direction = this._horizontalDirection();
        return repeat(Math.abs(this._startCol - this._endCol), this._sequence(direction));
    };
    AltClickHandler.prototype._wrappedRowsCount = function () {
        var wrappedRows = 0;
        var startRow = this._startRow - this._wrappedRowsForRow(this._startRow);
        var endRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        for (var i = 0; i < Math.abs(startRow - endRow); i++) {
            var direction = this._verticalDirection() === "A" ? -1 : 1;
            if (this._lines.get(startRow + (direction * i)).isWrapped) {
                wrappedRows++;
            }
        }
        return wrappedRows;
    };
    AltClickHandler.prototype._wrappedRowsForRow = function (currentRow) {
        var rowCount = 0;
        var lineWraps = this._lines.get(currentRow).isWrapped;
        while (lineWraps && currentRow >= 0 && currentRow < this._terminal.rows) {
            rowCount++;
            currentRow--;
            lineWraps = this._lines.get(currentRow).isWrapped;
        }
        return rowCount;
    };
    AltClickHandler.prototype._horizontalDirection = function () {
        var startRow;
        if (this._moveToRequestedRow().length > 0) {
            startRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        }
        else {
            startRow = this._startRow;
        }
        if ((this._startCol < this._endCol &&
            startRow <= this._endRow) ||
            (this._startCol >= this._endCol &&
                startRow < this._endRow)) {
            return "C";
        }
        return "D";
    };
    AltClickHandler.prototype._verticalDirection = function () {
        if (this._startRow > this._endRow) {
            return "A";
        }
        return "B";
    };
    AltClickHandler.prototype._bufferLine = function (startCol, startRow, endCol, endRow, forward) {
        var currentCol = startCol;
        var currentRow = startRow;
        var bufferStr = '';
        while (currentCol !== endCol || currentRow !== endRow) {
            currentCol += forward ? 1 : -1;
            if (forward && currentCol > this._terminal.cols - 1) {
                bufferStr += this._terminal.buffer.translateBufferLineToString(currentRow, false, startCol, currentCol);
                currentCol = 0;
                startCol = 0;
                currentRow++;
            }
            else if (!forward && currentCol < 0) {
                bufferStr += this._terminal.buffer.translateBufferLineToString(currentRow, false, 0, startCol + 1);
                currentCol = this._terminal.cols - 1;
                startCol = currentCol;
                currentRow--;
            }
        }
        return bufferStr + this._terminal.buffer.translateBufferLineToString(currentRow, false, startCol, currentCol);
    };
    AltClickHandler.prototype._sequence = function (direction) {
        var mod = this._terminal.applicationCursor ? 'O' : '[';
        return EscapeSequences_1.C0.ESC + mod + direction;
    };
    return AltClickHandler;
}());
exports.AltClickHandler = AltClickHandler;
function repeat(count, str) {
    count = Math.floor(count);
    var rpt = '';
    for (var i = 0; i < count; i++) {
        rpt += str;
    }
    return rpt;
}
//# sourceMappingURL=AltClickHandler.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/public/Terminal.js":
/*!***************************************************!*\
  !*** ./node_modules/xterm/lib/public/Terminal.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Terminal_1 = __webpack_require__(/*! ../Terminal */ "./node_modules/xterm/lib/Terminal.js");
var Strings = __webpack_require__(/*! ../Strings */ "./node_modules/xterm/lib/Strings.js");
var Terminal = (function () {
    function Terminal(options) {
        this._core = new Terminal_1.Terminal(options);
    }
    Object.defineProperty(Terminal.prototype, "element", {
        get: function () { return this._core.element; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "textarea", {
        get: function () { return this._core.textarea; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "rows", {
        get: function () { return this._core.rows; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "cols", {
        get: function () { return this._core.cols; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "markers", {
        get: function () { return this._core.markers; },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.blur = function () {
        this._core.blur();
    };
    Terminal.prototype.focus = function () {
        this._core.focus();
    };
    Terminal.prototype.on = function (type, listener) {
        this._core.on(type, listener);
    };
    Terminal.prototype.off = function (type, listener) {
        this._core.off(type, listener);
    };
    Terminal.prototype.emit = function (type, data) {
        this._core.emit(type, data);
    };
    Terminal.prototype.addDisposableListener = function (type, handler) {
        return this._core.addDisposableListener(type, handler);
    };
    Terminal.prototype.resize = function (columns, rows) {
        this._core.resize(columns, rows);
    };
    Terminal.prototype.writeln = function (data) {
        this._core.writeln(data);
    };
    Terminal.prototype.open = function (parent) {
        this._core.open(parent);
    };
    Terminal.prototype.attachCustomKeyEventHandler = function (customKeyEventHandler) {
        this._core.attachCustomKeyEventHandler(customKeyEventHandler);
    };
    Terminal.prototype.registerLinkMatcher = function (regex, handler, options) {
        return this._core.registerLinkMatcher(regex, handler, options);
    };
    Terminal.prototype.deregisterLinkMatcher = function (matcherId) {
        this._core.deregisterLinkMatcher(matcherId);
    };
    Terminal.prototype.registerCharacterJoiner = function (handler) {
        return this._core.registerCharacterJoiner(handler);
    };
    Terminal.prototype.deregisterCharacterJoiner = function (joinerId) {
        this._core.deregisterCharacterJoiner(joinerId);
    };
    Terminal.prototype.addMarker = function (cursorYOffset) {
        return this._core.addMarker(cursorYOffset);
    };
    Terminal.prototype.hasSelection = function () {
        return this._core.hasSelection();
    };
    Terminal.prototype.getSelection = function () {
        return this._core.getSelection();
    };
    Terminal.prototype.clearSelection = function () {
        this._core.clearSelection();
    };
    Terminal.prototype.selectAll = function () {
        this._core.selectAll();
    };
    Terminal.prototype.selectLines = function (start, end) {
        this._core.selectLines(start, end);
    };
    Terminal.prototype.dispose = function () {
        this._core.dispose();
    };
    Terminal.prototype.destroy = function () {
        this._core.destroy();
    };
    Terminal.prototype.scrollLines = function (amount) {
        this._core.scrollLines(amount);
    };
    Terminal.prototype.scrollPages = function (pageCount) {
        this._core.scrollPages(pageCount);
    };
    Terminal.prototype.scrollToTop = function () {
        this._core.scrollToTop();
    };
    Terminal.prototype.scrollToBottom = function () {
        this._core.scrollToBottom();
    };
    Terminal.prototype.scrollToLine = function (line) {
        this._core.scrollToLine(line);
    };
    Terminal.prototype.clear = function () {
        this._core.clear();
    };
    Terminal.prototype.write = function (data) {
        this._core.write(data);
    };
    Terminal.prototype.getOption = function (key) {
        return this._core.getOption(key);
    };
    Terminal.prototype.setOption = function (key, value) {
        this._core.setOption(key, value);
    };
    Terminal.prototype.refresh = function (start, end) {
        this._core.refresh(start, end);
    };
    Terminal.prototype.reset = function () {
        this._core.reset();
    };
    Terminal.applyAddon = function (addon) {
        addon.apply(Terminal);
    };
    Object.defineProperty(Terminal, "strings", {
        get: function () {
            return Strings;
        },
        enumerable: true,
        configurable: true
    });
    return Terminal;
}());
exports.Terminal = Terminal;
//# sourceMappingURL=Terminal.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/BaseRenderLayer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ./atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var CharAtlasCache_1 = __webpack_require__(/*! ./atlas/CharAtlasCache */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js");
var Buffer_1 = __webpack_require__(/*! ../Buffer */ "./node_modules/xterm/lib/Buffer.js");
var CharAtlasUtils_1 = __webpack_require__(/*! ./atlas/CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var BaseRenderLayer = (function () {
    function BaseRenderLayer(_container, id, zIndex, _alpha, _colors) {
        this._container = _container;
        this._alpha = _alpha;
        this._colors = _colors;
        this._scaledCharWidth = 0;
        this._scaledCharHeight = 0;
        this._scaledCellWidth = 0;
        this._scaledCellHeight = 0;
        this._scaledCharLeft = 0;
        this._scaledCharTop = 0;
        this._currentGlyphIdentifier = {
            chars: '',
            code: 0,
            bg: 0,
            fg: 0,
            bold: false,
            dim: false,
            italic: false
        };
        this._canvas = document.createElement('canvas');
        this._canvas.classList.add("xterm-" + id + "-layer");
        this._canvas.style.zIndex = zIndex.toString();
        this._initCanvas();
        this._container.appendChild(this._canvas);
    }
    BaseRenderLayer.prototype.dispose = function () {
        this._container.removeChild(this._canvas);
        if (this._charAtlas) {
            this._charAtlas.dispose();
        }
    };
    BaseRenderLayer.prototype._initCanvas = function () {
        this._ctx = this._canvas.getContext('2d', { alpha: this._alpha });
        if (!this._alpha) {
            this.clearAll();
        }
    };
    BaseRenderLayer.prototype.onOptionsChanged = function (terminal) { };
    BaseRenderLayer.prototype.onBlur = function (terminal) { };
    BaseRenderLayer.prototype.onFocus = function (terminal) { };
    BaseRenderLayer.prototype.onCursorMove = function (terminal) { };
    BaseRenderLayer.prototype.onGridChanged = function (terminal, startRow, endRow) { };
    BaseRenderLayer.prototype.onSelectionChanged = function (terminal, start, end, columnSelectMode) {
        if (columnSelectMode === void 0) { columnSelectMode = false; }
    };
    BaseRenderLayer.prototype.onThemeChanged = function (terminal, colorSet) {
        this._refreshCharAtlas(terminal, colorSet);
    };
    BaseRenderLayer.prototype.setTransparency = function (terminal, alpha) {
        if (alpha === this._alpha) {
            return;
        }
        var oldCanvas = this._canvas;
        this._alpha = alpha;
        this._canvas = this._canvas.cloneNode();
        this._initCanvas();
        this._container.replaceChild(this._canvas, oldCanvas);
        this._refreshCharAtlas(terminal, this._colors);
        this.onGridChanged(terminal, 0, terminal.rows - 1);
    };
    BaseRenderLayer.prototype._refreshCharAtlas = function (terminal, colorSet) {
        if (this._scaledCharWidth <= 0 && this._scaledCharHeight <= 0) {
            return;
        }
        this._charAtlas = CharAtlasCache_1.acquireCharAtlas(terminal, colorSet, this._scaledCharWidth, this._scaledCharHeight);
        this._charAtlas.warmUp();
    };
    BaseRenderLayer.prototype.resize = function (terminal, dim) {
        this._scaledCellWidth = dim.scaledCellWidth;
        this._scaledCellHeight = dim.scaledCellHeight;
        this._scaledCharWidth = dim.scaledCharWidth;
        this._scaledCharHeight = dim.scaledCharHeight;
        this._scaledCharLeft = dim.scaledCharLeft;
        this._scaledCharTop = dim.scaledCharTop;
        this._canvas.width = dim.scaledCanvasWidth;
        this._canvas.height = dim.scaledCanvasHeight;
        this._canvas.style.width = dim.canvasWidth + "px";
        this._canvas.style.height = dim.canvasHeight + "px";
        if (!this._alpha) {
            this.clearAll();
        }
        this._refreshCharAtlas(terminal, this._colors);
    };
    BaseRenderLayer.prototype.fillCells = function (x, y, width, height) {
        this._ctx.fillRect(x * this._scaledCellWidth, y * this._scaledCellHeight, width * this._scaledCellWidth, height * this._scaledCellHeight);
    };
    BaseRenderLayer.prototype.fillBottomLineAtCells = function (x, y, width) {
        if (width === void 0) { width = 1; }
        this._ctx.fillRect(x * this._scaledCellWidth, (y + 1) * this._scaledCellHeight - window.devicePixelRatio - 1, width * this._scaledCellWidth, window.devicePixelRatio);
    };
    BaseRenderLayer.prototype.fillLeftLineAtCell = function (x, y) {
        this._ctx.fillRect(x * this._scaledCellWidth, y * this._scaledCellHeight, window.devicePixelRatio, this._scaledCellHeight);
    };
    BaseRenderLayer.prototype.strokeRectAtCell = function (x, y, width, height) {
        this._ctx.lineWidth = window.devicePixelRatio;
        this._ctx.strokeRect(x * this._scaledCellWidth + window.devicePixelRatio / 2, y * this._scaledCellHeight + (window.devicePixelRatio / 2), width * this._scaledCellWidth - window.devicePixelRatio, (height * this._scaledCellHeight) - window.devicePixelRatio);
    };
    BaseRenderLayer.prototype.clearAll = function () {
        if (this._alpha) {
            this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);
        }
        else {
            this._ctx.fillStyle = this._colors.background.css;
            this._ctx.fillRect(0, 0, this._canvas.width, this._canvas.height);
        }
    };
    BaseRenderLayer.prototype.clearCells = function (x, y, width, height) {
        if (this._alpha) {
            this._ctx.clearRect(x * this._scaledCellWidth, y * this._scaledCellHeight, width * this._scaledCellWidth, height * this._scaledCellHeight);
        }
        else {
            this._ctx.fillStyle = this._colors.background.css;
            this._ctx.fillRect(x * this._scaledCellWidth, y * this._scaledCellHeight, width * this._scaledCellWidth, height * this._scaledCellHeight);
        }
    };
    BaseRenderLayer.prototype.fillCharTrueColor = function (terminal, charData, x, y) {
        this._ctx.font = this._getFont(terminal, false, false);
        this._ctx.textBaseline = 'top';
        this._clipRow(terminal, y);
        this._ctx.fillText(charData[Buffer_1.CHAR_DATA_CHAR_INDEX], x * this._scaledCellWidth + this._scaledCharLeft, y * this._scaledCellHeight + this._scaledCharTop);
    };
    BaseRenderLayer.prototype.drawChars = function (terminal, chars, code, width, x, y, fg, bg, bold, dim, italic) {
        var drawInBrightColor = terminal.options.drawBoldTextInBrightColors && bold && fg < 8 && fg !== Types_1.INVERTED_DEFAULT_COLOR;
        fg += drawInBrightColor ? 8 : 0;
        this._currentGlyphIdentifier.chars = chars;
        this._currentGlyphIdentifier.code = code;
        this._currentGlyphIdentifier.bg = bg;
        this._currentGlyphIdentifier.fg = fg;
        this._currentGlyphIdentifier.bold = bold && terminal.options.enableBold;
        this._currentGlyphIdentifier.dim = dim;
        this._currentGlyphIdentifier.italic = italic;
        var atlasDidDraw = this._charAtlas && this._charAtlas.draw(this._ctx, this._currentGlyphIdentifier, x * this._scaledCellWidth + this._scaledCharLeft, y * this._scaledCellHeight + this._scaledCharTop);
        if (!atlasDidDraw) {
            this._drawUncachedChars(terminal, chars, width, fg, x, y, bold && terminal.options.enableBold, dim, italic);
        }
    };
    BaseRenderLayer.prototype._drawUncachedChars = function (terminal, chars, width, fg, x, y, bold, dim, italic) {
        this._ctx.save();
        this._ctx.font = this._getFont(terminal, bold, italic);
        this._ctx.textBaseline = 'top';
        if (fg === Types_1.INVERTED_DEFAULT_COLOR) {
            this._ctx.fillStyle = this._colors.background.css;
        }
        else if (CharAtlasUtils_1.is256Color(fg)) {
            this._ctx.fillStyle = this._colors.ansi[fg].css;
        }
        else {
            this._ctx.fillStyle = this._colors.foreground.css;
        }
        this._clipRow(terminal, y);
        if (dim) {
            this._ctx.globalAlpha = Types_1.DIM_OPACITY;
        }
        this._ctx.fillText(chars, x * this._scaledCellWidth + this._scaledCharLeft, y * this._scaledCellHeight + this._scaledCharTop);
        this._ctx.restore();
    };
    BaseRenderLayer.prototype._clipRow = function (terminal, y) {
        this._ctx.beginPath();
        this._ctx.rect(0, y * this._scaledCellHeight, terminal.cols * this._scaledCellWidth, this._scaledCellHeight);
        this._ctx.clip();
    };
    BaseRenderLayer.prototype._getFont = function (terminal, isBold, isItalic) {
        var fontWeight = isBold ? terminal.options.fontWeightBold : terminal.options.fontWeight;
        var fontStyle = isItalic ? 'italic' : '';
        return fontStyle + " " + fontWeight + " " + terminal.options.fontSize * window.devicePixelRatio + "px " + terminal.options.fontFamily;
    };
    return BaseRenderLayer;
}());
exports.BaseRenderLayer = BaseRenderLayer;
//# sourceMappingURL=BaseRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js":
/*!********************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ../Buffer */ "./node_modules/xterm/lib/Buffer.js");
var CharacterJoinerRegistry = (function () {
    function CharacterJoinerRegistry(_terminal) {
        this._terminal = _terminal;
        this._characterJoiners = [];
        this._nextCharacterJoinerId = 0;
    }
    CharacterJoinerRegistry.prototype.registerCharacterJoiner = function (handler) {
        var joiner = {
            id: this._nextCharacterJoinerId++,
            handler: handler
        };
        this._characterJoiners.push(joiner);
        return joiner.id;
    };
    CharacterJoinerRegistry.prototype.deregisterCharacterJoiner = function (joinerId) {
        for (var i = 0; i < this._characterJoiners.length; i++) {
            if (this._characterJoiners[i].id === joinerId) {
                this._characterJoiners.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    CharacterJoinerRegistry.prototype.getJoinedCharacters = function (row) {
        if (this._characterJoiners.length === 0) {
            return [];
        }
        var line = this._terminal.buffer.lines.get(row);
        if (line.length === 0) {
            return [];
        }
        var ranges = [];
        var lineStr = this._terminal.buffer.translateBufferLineToString(row, true);
        var rangeStartColumn = 0;
        var currentStringIndex = 0;
        var rangeStartStringIndex = 0;
        var rangeAttr = line.get(0)[Buffer_1.CHAR_DATA_ATTR_INDEX] >> 9;
        for (var x = 0; x < this._terminal.cols; x++) {
            var charData = line.get(x);
            var chars = charData[Buffer_1.CHAR_DATA_CHAR_INDEX];
            var width = charData[Buffer_1.CHAR_DATA_WIDTH_INDEX];
            var attr = charData[Buffer_1.CHAR_DATA_ATTR_INDEX] >> 9;
            if (width === 0) {
                continue;
            }
            if (attr !== rangeAttr) {
                if (x - rangeStartColumn > 1) {
                    var joinedRanges = this._getJoinedRanges(lineStr, rangeStartStringIndex, currentStringIndex, line, rangeStartColumn);
                    for (var i = 0; i < joinedRanges.length; i++) {
                        ranges.push(joinedRanges[i]);
                    }
                }
                rangeStartColumn = x;
                rangeStartStringIndex = currentStringIndex;
                rangeAttr = attr;
            }
            currentStringIndex += chars.length;
        }
        if (this._terminal.cols - rangeStartColumn > 1) {
            var joinedRanges = this._getJoinedRanges(lineStr, rangeStartStringIndex, currentStringIndex, line, rangeStartColumn);
            for (var i = 0; i < joinedRanges.length; i++) {
                ranges.push(joinedRanges[i]);
            }
        }
        return ranges;
    };
    CharacterJoinerRegistry.prototype._getJoinedRanges = function (line, startIndex, endIndex, lineData, startCol) {
        var text = line.substring(startIndex, endIndex);
        var joinedRanges = this._characterJoiners[0].handler(text);
        for (var i = 1; i < this._characterJoiners.length; i++) {
            var joinerRanges = this._characterJoiners[i].handler(text);
            for (var j = 0; j < joinerRanges.length; j++) {
                CharacterJoinerRegistry._mergeRanges(joinedRanges, joinerRanges[j]);
            }
        }
        this._stringRangesToCellRanges(joinedRanges, lineData, startCol);
        return joinedRanges;
    };
    CharacterJoinerRegistry.prototype._stringRangesToCellRanges = function (ranges, line, startCol) {
        var currentRangeIndex = 0;
        var currentRangeStarted = false;
        var currentStringIndex = 0;
        var currentRange = ranges[currentRangeIndex];
        if (!currentRange) {
            return;
        }
        for (var x = startCol; x < this._terminal.cols; x++) {
            var charData = line.get(x);
            var width = charData[Buffer_1.CHAR_DATA_WIDTH_INDEX];
            var length_1 = charData[Buffer_1.CHAR_DATA_CHAR_INDEX].length;
            if (width === 0) {
                continue;
            }
            if (!currentRangeStarted && currentRange[0] <= currentStringIndex) {
                currentRange[0] = x;
                currentRangeStarted = true;
            }
            if (currentRange[1] <= currentStringIndex) {
                currentRange[1] = x;
                currentRange = ranges[++currentRangeIndex];
                if (!currentRange) {
                    break;
                }
                if (currentRange[0] <= currentStringIndex) {
                    currentRange[0] = x;
                    currentRangeStarted = true;
                }
                else {
                    currentRangeStarted = false;
                }
            }
            currentStringIndex += length_1;
        }
        if (currentRange) {
            currentRange[1] = this._terminal.cols;
        }
    };
    CharacterJoinerRegistry._mergeRanges = function (ranges, newRange) {
        var inRange = false;
        for (var i = 0; i < ranges.length; i++) {
            var range = ranges[i];
            if (!inRange) {
                if (newRange[1] <= range[0]) {
                    ranges.splice(i, 0, newRange);
                    return ranges;
                }
                if (newRange[1] <= range[1]) {
                    range[0] = Math.min(newRange[0], range[0]);
                    return ranges;
                }
                if (newRange[0] < range[1]) {
                    range[0] = Math.min(newRange[0], range[0]);
                    inRange = true;
                }
                continue;
            }
            else {
                if (newRange[1] <= range[0]) {
                    ranges[i - 1][1] = newRange[1];
                    return ranges;
                }
                if (newRange[1] <= range[1]) {
                    ranges[i - 1][1] = Math.max(newRange[1], range[1]);
                    ranges.splice(i, 1);
                    inRange = false;
                    return ranges;
                }
                ranges.splice(i, 1);
                i--;
            }
        }
        if (inRange) {
            ranges[ranges.length - 1][1] = newRange[1];
        }
        else {
            ranges.push(newRange);
        }
        return ranges;
    };
    return CharacterJoinerRegistry;
}());
exports.CharacterJoinerRegistry = CharacterJoinerRegistry;
//# sourceMappingURL=CharacterJoinerRegistry.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/ColorManager.js":
/*!*********************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/ColorManager.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var DEFAULT_FOREGROUND = fromHex('#ffffff');
var DEFAULT_BACKGROUND = fromHex('#000000');
var DEFAULT_CURSOR = fromHex('#ffffff');
var DEFAULT_CURSOR_ACCENT = fromHex('#000000');
var DEFAULT_SELECTION = {
    css: 'rgba(255, 255, 255, 0.3)',
    rgba: 0xFFFFFF77
};
exports.DEFAULT_ANSI_COLORS = (function () {
    var colors = [
        fromHex('#2e3436'),
        fromHex('#cc0000'),
        fromHex('#4e9a06'),
        fromHex('#c4a000'),
        fromHex('#3465a4'),
        fromHex('#75507b'),
        fromHex('#06989a'),
        fromHex('#d3d7cf'),
        fromHex('#555753'),
        fromHex('#ef2929'),
        fromHex('#8ae234'),
        fromHex('#fce94f'),
        fromHex('#729fcf'),
        fromHex('#ad7fa8'),
        fromHex('#34e2e2'),
        fromHex('#eeeeec')
    ];
    var v = [0x00, 0x5f, 0x87, 0xaf, 0xd7, 0xff];
    for (var i = 0; i < 216; i++) {
        var r = v[(i / 36) % 6 | 0];
        var g = v[(i / 6) % 6 | 0];
        var b = v[i % 6];
        colors.push({
            css: "#" + toPaddedHex(r) + toPaddedHex(g) + toPaddedHex(b),
            rgba: ((r << 24) | (g << 16) | (b << 8) | 0xFF) >>> 0
        });
    }
    for (var i = 0; i < 24; i++) {
        var c = 8 + i * 10;
        var ch = toPaddedHex(c);
        colors.push({
            css: "#" + ch + ch + ch,
            rgba: ((c << 24) | (c << 16) | (c << 8) | 0xFF) >>> 0
        });
    }
    return colors;
})();
function fromHex(css) {
    return {
        css: css,
        rgba: parseInt(css.slice(1), 16) << 8 | 0xFF
    };
}
function toPaddedHex(c) {
    var s = c.toString(16);
    return s.length < 2 ? '0' + s : s;
}
var ColorManager = (function () {
    function ColorManager(document, allowTransparency) {
        this.allowTransparency = allowTransparency;
        var canvas = document.createElement('canvas');
        canvas.width = 1;
        canvas.height = 1;
        this._ctx = canvas.getContext('2d');
        this._ctx.globalCompositeOperation = 'copy';
        this._litmusColor = this._ctx.createLinearGradient(0, 0, 1, 1);
        this.colors = {
            foreground: DEFAULT_FOREGROUND,
            background: DEFAULT_BACKGROUND,
            cursor: DEFAULT_CURSOR,
            cursorAccent: DEFAULT_CURSOR_ACCENT,
            selection: DEFAULT_SELECTION,
            ansi: exports.DEFAULT_ANSI_COLORS.slice()
        };
    }
    ColorManager.prototype.setTheme = function (theme) {
        this.colors.foreground = this._parseColor(theme.foreground, DEFAULT_FOREGROUND);
        this.colors.background = this._parseColor(theme.background, DEFAULT_BACKGROUND);
        this.colors.cursor = this._parseColor(theme.cursor, DEFAULT_CURSOR, true);
        this.colors.cursorAccent = this._parseColor(theme.cursorAccent, DEFAULT_CURSOR_ACCENT, true);
        this.colors.selection = this._parseColor(theme.selection, DEFAULT_SELECTION, true);
        this.colors.ansi[0] = this._parseColor(theme.black, exports.DEFAULT_ANSI_COLORS[0]);
        this.colors.ansi[1] = this._parseColor(theme.red, exports.DEFAULT_ANSI_COLORS[1]);
        this.colors.ansi[2] = this._parseColor(theme.green, exports.DEFAULT_ANSI_COLORS[2]);
        this.colors.ansi[3] = this._parseColor(theme.yellow, exports.DEFAULT_ANSI_COLORS[3]);
        this.colors.ansi[4] = this._parseColor(theme.blue, exports.DEFAULT_ANSI_COLORS[4]);
        this.colors.ansi[5] = this._parseColor(theme.magenta, exports.DEFAULT_ANSI_COLORS[5]);
        this.colors.ansi[6] = this._parseColor(theme.cyan, exports.DEFAULT_ANSI_COLORS[6]);
        this.colors.ansi[7] = this._parseColor(theme.white, exports.DEFAULT_ANSI_COLORS[7]);
        this.colors.ansi[8] = this._parseColor(theme.brightBlack, exports.DEFAULT_ANSI_COLORS[8]);
        this.colors.ansi[9] = this._parseColor(theme.brightRed, exports.DEFAULT_ANSI_COLORS[9]);
        this.colors.ansi[10] = this._parseColor(theme.brightGreen, exports.DEFAULT_ANSI_COLORS[10]);
        this.colors.ansi[11] = this._parseColor(theme.brightYellow, exports.DEFAULT_ANSI_COLORS[11]);
        this.colors.ansi[12] = this._parseColor(theme.brightBlue, exports.DEFAULT_ANSI_COLORS[12]);
        this.colors.ansi[13] = this._parseColor(theme.brightMagenta, exports.DEFAULT_ANSI_COLORS[13]);
        this.colors.ansi[14] = this._parseColor(theme.brightCyan, exports.DEFAULT_ANSI_COLORS[14]);
        this.colors.ansi[15] = this._parseColor(theme.brightWhite, exports.DEFAULT_ANSI_COLORS[15]);
    };
    ColorManager.prototype._parseColor = function (css, fallback, allowTransparency) {
        if (allowTransparency === void 0) { allowTransparency = this.allowTransparency; }
        if (!css) {
            return fallback;
        }
        this._ctx.fillStyle = this._litmusColor;
        this._ctx.fillStyle = css;
        if (typeof this._ctx.fillStyle !== 'string') {
            console.warn("Color: " + css + " is invalid using fallback " + fallback.css);
            return fallback;
        }
        this._ctx.fillRect(0, 0, 1, 1);
        var data = this._ctx.getImageData(0, 0, 1, 1).data;
        if (!allowTransparency && data[3] !== 0xFF) {
            console.warn("Color: " + css + " is using transparency, but allowTransparency is false. " +
                ("Using fallback " + fallback.css + "."));
            return fallback;
        }
        return {
            css: css,
            rgba: (data[0] << 24 | data[1] << 16 | data[2] << 8 | data[3]) >>> 0
        };
    };
    return ColorManager;
}());
exports.ColorManager = ColorManager;
//# sourceMappingURL=ColorManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/CursorRenderLayer.js":
/*!**************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/CursorRenderLayer.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ../Buffer */ "./node_modules/xterm/lib/Buffer.js");
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var BLINK_INTERVAL = 600;
var CursorRenderLayer = (function (_super) {
    __extends(CursorRenderLayer, _super);
    function CursorRenderLayer(container, zIndex, colors) {
        var _this = _super.call(this, container, 'cursor', zIndex, true, colors) || this;
        _this._state = {
            x: null,
            y: null,
            isFocused: null,
            style: null,
            width: null
        };
        _this._cursorRenderers = {
            'bar': _this._renderBarCursor.bind(_this),
            'block': _this._renderBlockCursor.bind(_this),
            'underline': _this._renderUnderlineCursor.bind(_this)
        };
        return _this;
    }
    CursorRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        this._state = {
            x: null,
            y: null,
            isFocused: null,
            style: null,
            width: null
        };
    };
    CursorRenderLayer.prototype.reset = function (terminal) {
        this._clearCursor();
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.dispose();
            this._cursorBlinkStateManager = null;
            this.onOptionsChanged(terminal);
        }
    };
    CursorRenderLayer.prototype.onBlur = function (terminal) {
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.pause();
        }
        terminal.refresh(terminal.buffer.y, terminal.buffer.y);
    };
    CursorRenderLayer.prototype.onFocus = function (terminal) {
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.resume(terminal);
        }
        else {
            terminal.refresh(terminal.buffer.y, terminal.buffer.y);
        }
    };
    CursorRenderLayer.prototype.onOptionsChanged = function (terminal) {
        var _this = this;
        if (terminal.options.cursorBlink) {
            if (!this._cursorBlinkStateManager) {
                this._cursorBlinkStateManager = new CursorBlinkStateManager(terminal, function () {
                    _this._render(terminal, true);
                });
            }
        }
        else {
            if (this._cursorBlinkStateManager) {
                this._cursorBlinkStateManager.dispose();
                this._cursorBlinkStateManager = null;
            }
            terminal.refresh(terminal.buffer.y, terminal.buffer.y);
        }
    };
    CursorRenderLayer.prototype.onCursorMove = function (terminal) {
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.restartBlinkAnimation(terminal);
        }
    };
    CursorRenderLayer.prototype.onGridChanged = function (terminal, startRow, endRow) {
        if (!this._cursorBlinkStateManager || this._cursorBlinkStateManager.isPaused) {
            this._render(terminal, false);
        }
        else {
            this._cursorBlinkStateManager.restartBlinkAnimation(terminal);
        }
    };
    CursorRenderLayer.prototype._render = function (terminal, triggeredByAnimationFrame) {
        if (!terminal.cursorState || terminal.cursorHidden) {
            this._clearCursor();
            return;
        }
        var cursorY = terminal.buffer.ybase + terminal.buffer.y;
        var viewportRelativeCursorY = cursorY - terminal.buffer.ydisp;
        if (viewportRelativeCursorY < 0 || viewportRelativeCursorY >= terminal.rows) {
            this._clearCursor();
            return;
        }
        var charData = terminal.buffer.lines.get(cursorY).get(terminal.buffer.x);
        if (!charData) {
            return;
        }
        if (!terminal.isFocused) {
            this._clearCursor();
            this._ctx.save();
            this._ctx.fillStyle = this._colors.cursor.css;
            this._renderBlurCursor(terminal, terminal.buffer.x, viewportRelativeCursorY, charData);
            this._ctx.restore();
            this._state.x = terminal.buffer.x;
            this._state.y = viewportRelativeCursorY;
            this._state.isFocused = false;
            this._state.style = terminal.options.cursorStyle;
            this._state.width = charData[Buffer_1.CHAR_DATA_WIDTH_INDEX];
            return;
        }
        if (this._cursorBlinkStateManager && !this._cursorBlinkStateManager.isCursorVisible) {
            this._clearCursor();
            return;
        }
        if (this._state) {
            if (this._state.x === terminal.buffer.x &&
                this._state.y === viewportRelativeCursorY &&
                this._state.isFocused === terminal.isFocused &&
                this._state.style === terminal.options.cursorStyle &&
                this._state.width === charData[Buffer_1.CHAR_DATA_WIDTH_INDEX]) {
                return;
            }
            this._clearCursor();
        }
        this._ctx.save();
        this._cursorRenderers[terminal.options.cursorStyle || 'block'](terminal, terminal.buffer.x, viewportRelativeCursorY, charData);
        this._ctx.restore();
        this._state.x = terminal.buffer.x;
        this._state.y = viewportRelativeCursorY;
        this._state.isFocused = false;
        this._state.style = terminal.options.cursorStyle;
        this._state.width = charData[Buffer_1.CHAR_DATA_WIDTH_INDEX];
    };
    CursorRenderLayer.prototype._clearCursor = function () {
        if (this._state) {
            this.clearCells(this._state.x, this._state.y, this._state.width, 1);
            this._state = {
                x: null,
                y: null,
                isFocused: null,
                style: null,
                width: null
            };
        }
    };
    CursorRenderLayer.prototype._renderBarCursor = function (terminal, x, y, charData) {
        this._ctx.save();
        this._ctx.fillStyle = this._colors.cursor.css;
        this.fillLeftLineAtCell(x, y);
        this._ctx.restore();
    };
    CursorRenderLayer.prototype._renderBlockCursor = function (terminal, x, y, charData) {
        this._ctx.save();
        this._ctx.fillStyle = this._colors.cursor.css;
        this.fillCells(x, y, charData[Buffer_1.CHAR_DATA_WIDTH_INDEX], 1);
        this._ctx.fillStyle = this._colors.cursorAccent.css;
        this.fillCharTrueColor(terminal, charData, x, y);
        this._ctx.restore();
    };
    CursorRenderLayer.prototype._renderUnderlineCursor = function (terminal, x, y, charData) {
        this._ctx.save();
        this._ctx.fillStyle = this._colors.cursor.css;
        this.fillBottomLineAtCells(x, y);
        this._ctx.restore();
    };
    CursorRenderLayer.prototype._renderBlurCursor = function (terminal, x, y, charData) {
        this._ctx.save();
        this._ctx.strokeStyle = this._colors.cursor.css;
        this.strokeRectAtCell(x, y, charData[Buffer_1.CHAR_DATA_WIDTH_INDEX], 1);
        this._ctx.restore();
    };
    return CursorRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.CursorRenderLayer = CursorRenderLayer;
var CursorBlinkStateManager = (function () {
    function CursorBlinkStateManager(terminal, _renderCallback) {
        this._renderCallback = _renderCallback;
        this.isCursorVisible = true;
        if (terminal.isFocused) {
            this._restartInterval();
        }
    }
    Object.defineProperty(CursorBlinkStateManager.prototype, "isPaused", {
        get: function () { return !(this._blinkStartTimeout || this._blinkInterval); },
        enumerable: true,
        configurable: true
    });
    CursorBlinkStateManager.prototype.dispose = function () {
        if (this._blinkInterval) {
            window.clearInterval(this._blinkInterval);
            this._blinkInterval = null;
        }
        if (this._blinkStartTimeout) {
            window.clearTimeout(this._blinkStartTimeout);
            this._blinkStartTimeout = null;
        }
        if (this._animationFrame) {
            window.cancelAnimationFrame(this._animationFrame);
            this._animationFrame = null;
        }
    };
    CursorBlinkStateManager.prototype.restartBlinkAnimation = function (terminal) {
        var _this = this;
        if (this.isPaused) {
            return;
        }
        this._animationTimeRestarted = Date.now();
        this.isCursorVisible = true;
        if (!this._animationFrame) {
            this._animationFrame = window.requestAnimationFrame(function () {
                _this._renderCallback();
                _this._animationFrame = null;
            });
        }
    };
    CursorBlinkStateManager.prototype._restartInterval = function (timeToStart) {
        var _this = this;
        if (timeToStart === void 0) { timeToStart = BLINK_INTERVAL; }
        if (this._blinkInterval) {
            window.clearInterval(this._blinkInterval);
        }
        this._blinkStartTimeout = setTimeout(function () {
            if (_this._animationTimeRestarted) {
                var time = BLINK_INTERVAL - (Date.now() - _this._animationTimeRestarted);
                _this._animationTimeRestarted = null;
                if (time > 0) {
                    _this._restartInterval(time);
                    return;
                }
            }
            _this.isCursorVisible = false;
            _this._animationFrame = window.requestAnimationFrame(function () {
                _this._renderCallback();
                _this._animationFrame = null;
            });
            _this._blinkInterval = setInterval(function () {
                if (_this._animationTimeRestarted) {
                    var time = BLINK_INTERVAL - (Date.now() - _this._animationTimeRestarted);
                    _this._animationTimeRestarted = null;
                    _this._restartInterval(time);
                    return;
                }
                _this.isCursorVisible = !_this.isCursorVisible;
                _this._animationFrame = window.requestAnimationFrame(function () {
                    _this._renderCallback();
                    _this._animationFrame = null;
                });
            }, BLINK_INTERVAL);
        }, timeToStart);
    };
    CursorBlinkStateManager.prototype.pause = function () {
        this.isCursorVisible = true;
        if (this._blinkInterval) {
            window.clearInterval(this._blinkInterval);
            this._blinkInterval = null;
        }
        if (this._blinkStartTimeout) {
            window.clearTimeout(this._blinkStartTimeout);
            this._blinkStartTimeout = null;
        }
        if (this._animationFrame) {
            window.cancelAnimationFrame(this._animationFrame);
            this._animationFrame = null;
        }
    };
    CursorBlinkStateManager.prototype.resume = function (terminal) {
        this._animationTimeRestarted = null;
        this._restartInterval();
        this.restartBlinkAnimation(terminal);
    };
    return CursorBlinkStateManager;
}());
//# sourceMappingURL=CursorRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/GridCache.js":
/*!******************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/GridCache.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var GridCache = (function () {
    function GridCache() {
        this.cache = [];
    }
    GridCache.prototype.resize = function (width, height) {
        for (var x = 0; x < width; x++) {
            if (this.cache.length <= x) {
                this.cache.push([]);
            }
            for (var y = this.cache[x].length; y < height; y++) {
                this.cache[x].push(null);
            }
            this.cache[x].length = height;
        }
        this.cache.length = width;
    };
    GridCache.prototype.clear = function () {
        for (var x = 0; x < this.cache.length; x++) {
            for (var y = 0; y < this.cache[x].length; y++) {
                this.cache[x][y] = null;
            }
        }
    };
    return GridCache;
}());
exports.GridCache = GridCache;
//# sourceMappingURL=GridCache.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/LinkRenderLayer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/LinkRenderLayer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var Types_1 = __webpack_require__(/*! ./atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var CharAtlasUtils_1 = __webpack_require__(/*! ./atlas/CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var LinkRenderLayer = (function (_super) {
    __extends(LinkRenderLayer, _super);
    function LinkRenderLayer(container, zIndex, colors, terminal) {
        var _this = _super.call(this, container, 'link', zIndex, true, colors) || this;
        _this._state = null;
        terminal.linkifier.on("linkhover", function (e) { return _this._onLinkHover(e); });
        terminal.linkifier.on("linkleave", function (e) { return _this._onLinkLeave(e); });
        return _this;
    }
    LinkRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        this._state = null;
    };
    LinkRenderLayer.prototype.reset = function (terminal) {
        this._clearCurrentLink();
    };
    LinkRenderLayer.prototype._clearCurrentLink = function () {
        if (this._state) {
            this.clearCells(this._state.x1, this._state.y1, this._state.cols - this._state.x1, 1);
            var middleRowCount = this._state.y2 - this._state.y1 - 1;
            if (middleRowCount > 0) {
                this.clearCells(0, this._state.y1 + 1, this._state.cols, middleRowCount);
            }
            this.clearCells(0, this._state.y2, this._state.x2, 1);
            this._state = null;
        }
    };
    LinkRenderLayer.prototype._onLinkHover = function (e) {
        if (e.fg === Types_1.INVERTED_DEFAULT_COLOR) {
            this._ctx.fillStyle = this._colors.background.css;
        }
        else if (CharAtlasUtils_1.is256Color(e.fg)) {
            this._ctx.fillStyle = this._colors.ansi[e.fg].css;
        }
        else {
            this._ctx.fillStyle = this._colors.foreground.css;
        }
        if (e.y1 === e.y2) {
            this.fillBottomLineAtCells(e.x1, e.y1, e.x2 - e.x1);
        }
        else {
            this.fillBottomLineAtCells(e.x1, e.y1, e.cols - e.x1);
            for (var y = e.y1 + 1; y < e.y2; y++) {
                this.fillBottomLineAtCells(0, y, e.cols);
            }
            this.fillBottomLineAtCells(0, e.y2, e.x2);
        }
        this._state = e;
    };
    LinkRenderLayer.prototype._onLinkLeave = function (e) {
        this._clearCurrentLink();
    };
    return LinkRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.LinkRenderLayer = LinkRenderLayer;
//# sourceMappingURL=LinkRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/Renderer.js":
/*!*****************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/Renderer.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var TextRenderLayer_1 = __webpack_require__(/*! ./TextRenderLayer */ "./node_modules/xterm/lib/renderer/TextRenderLayer.js");
var SelectionRenderLayer_1 = __webpack_require__(/*! ./SelectionRenderLayer */ "./node_modules/xterm/lib/renderer/SelectionRenderLayer.js");
var CursorRenderLayer_1 = __webpack_require__(/*! ./CursorRenderLayer */ "./node_modules/xterm/lib/renderer/CursorRenderLayer.js");
var ColorManager_1 = __webpack_require__(/*! ./ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var LinkRenderLayer_1 = __webpack_require__(/*! ./LinkRenderLayer */ "./node_modules/xterm/lib/renderer/LinkRenderLayer.js");
var EventEmitter_1 = __webpack_require__(/*! ../common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var RenderDebouncer_1 = __webpack_require__(/*! ../ui/RenderDebouncer */ "./node_modules/xterm/lib/ui/RenderDebouncer.js");
var ScreenDprMonitor_1 = __webpack_require__(/*! ../ui/ScreenDprMonitor */ "./node_modules/xterm/lib/ui/ScreenDprMonitor.js");
var CharacterJoinerRegistry_1 = __webpack_require__(/*! ../renderer/CharacterJoinerRegistry */ "./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js");
var Renderer = (function (_super) {
    __extends(Renderer, _super);
    function Renderer(_terminal, theme) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._isPaused = false;
        _this._needsFullRefresh = false;
        var allowTransparency = _this._terminal.options.allowTransparency;
        _this.colorManager = new ColorManager_1.ColorManager(document, allowTransparency);
        _this._characterJoinerRegistry = new CharacterJoinerRegistry_1.CharacterJoinerRegistry(_terminal);
        if (theme) {
            _this.colorManager.setTheme(theme);
        }
        _this._renderLayers = [
            new TextRenderLayer_1.TextRenderLayer(_this._terminal.screenElement, 0, _this.colorManager.colors, _this._characterJoinerRegistry, allowTransparency),
            new SelectionRenderLayer_1.SelectionRenderLayer(_this._terminal.screenElement, 1, _this.colorManager.colors),
            new LinkRenderLayer_1.LinkRenderLayer(_this._terminal.screenElement, 2, _this.colorManager.colors, _this._terminal),
            new CursorRenderLayer_1.CursorRenderLayer(_this._terminal.screenElement, 3, _this.colorManager.colors)
        ];
        _this.dimensions = {
            scaledCharWidth: null,
            scaledCharHeight: null,
            scaledCellWidth: null,
            scaledCellHeight: null,
            scaledCharLeft: null,
            scaledCharTop: null,
            scaledCanvasWidth: null,
            scaledCanvasHeight: null,
            canvasWidth: null,
            canvasHeight: null,
            actualCellWidth: null,
            actualCellHeight: null
        };
        _this._devicePixelRatio = window.devicePixelRatio;
        _this._updateDimensions();
        _this.onOptionsChanged();
        _this._renderDebouncer = new RenderDebouncer_1.RenderDebouncer(_this._terminal, _this._renderRows.bind(_this));
        _this._screenDprMonitor = new ScreenDprMonitor_1.ScreenDprMonitor();
        _this._screenDprMonitor.setListener(function () { return _this.onWindowResize(window.devicePixelRatio); });
        _this.register(_this._screenDprMonitor);
        if ('IntersectionObserver' in window) {
            var observer_1 = new IntersectionObserver(function (e) { return _this.onIntersectionChange(e[0]); }, { threshold: 0 });
            observer_1.observe(_this._terminal.element);
            _this.register({ dispose: function () { return observer_1.disconnect(); } });
        }
        return _this;
    }
    Renderer.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._renderLayers.forEach(function (l) { return l.dispose(); });
    };
    Renderer.prototype.onIntersectionChange = function (entry) {
        this._isPaused = entry.intersectionRatio === 0;
        if (!this._isPaused && this._needsFullRefresh) {
            this._terminal.refresh(0, this._terminal.rows - 1);
        }
    };
    Renderer.prototype.onWindowResize = function (devicePixelRatio) {
        if (this._devicePixelRatio !== devicePixelRatio) {
            this._devicePixelRatio = devicePixelRatio;
            this.onResize(this._terminal.cols, this._terminal.rows);
        }
    };
    Renderer.prototype.setTheme = function (theme) {
        var _this = this;
        this.colorManager.setTheme(theme);
        this._renderLayers.forEach(function (l) {
            l.onThemeChanged(_this._terminal, _this.colorManager.colors);
            l.reset(_this._terminal);
        });
        if (this._isPaused) {
            this._needsFullRefresh = true;
        }
        else {
            this._terminal.refresh(0, this._terminal.rows - 1);
        }
        return this.colorManager.colors;
    };
    Renderer.prototype.onResize = function (cols, rows) {
        var _this = this;
        this._updateDimensions();
        this._renderLayers.forEach(function (l) { return l.resize(_this._terminal, _this.dimensions); });
        if (this._isPaused) {
            this._needsFullRefresh = true;
        }
        else {
            this._terminal.refresh(0, this._terminal.rows - 1);
        }
        this._terminal.screenElement.style.width = this.dimensions.canvasWidth + "px";
        this._terminal.screenElement.style.height = this.dimensions.canvasHeight + "px";
        this.emit('resize', {
            width: this.dimensions.canvasWidth,
            height: this.dimensions.canvasHeight
        });
    };
    Renderer.prototype.onCharSizeChanged = function () {
        this.onResize(this._terminal.cols, this._terminal.rows);
    };
    Renderer.prototype.onBlur = function () {
        var _this = this;
        this._runOperation(function (l) { return l.onBlur(_this._terminal); });
    };
    Renderer.prototype.onFocus = function () {
        var _this = this;
        this._runOperation(function (l) { return l.onFocus(_this._terminal); });
    };
    Renderer.prototype.onSelectionChanged = function (start, end, columnSelectMode) {
        var _this = this;
        if (columnSelectMode === void 0) { columnSelectMode = false; }
        this._runOperation(function (l) { return l.onSelectionChanged(_this._terminal, start, end, columnSelectMode); });
    };
    Renderer.prototype.onCursorMove = function () {
        var _this = this;
        this._runOperation(function (l) { return l.onCursorMove(_this._terminal); });
    };
    Renderer.prototype.onOptionsChanged = function () {
        var _this = this;
        this.colorManager.allowTransparency = this._terminal.options.allowTransparency;
        this._runOperation(function (l) { return l.onOptionsChanged(_this._terminal); });
    };
    Renderer.prototype.clear = function () {
        var _this = this;
        this._runOperation(function (l) { return l.reset(_this._terminal); });
    };
    Renderer.prototype._runOperation = function (operation) {
        if (this._isPaused) {
            this._needsFullRefresh = true;
        }
        else {
            this._renderLayers.forEach(function (l) { return operation(l); });
        }
    };
    Renderer.prototype.refreshRows = function (start, end) {
        if (this._isPaused) {
            this._needsFullRefresh = true;
            return;
        }
        this._renderDebouncer.refresh(start, end);
    };
    Renderer.prototype._renderRows = function (start, end) {
        var _this = this;
        this._renderLayers.forEach(function (l) { return l.onGridChanged(_this._terminal, start, end); });
        this._terminal.emit('refresh', { start: start, end: end });
    };
    Renderer.prototype._updateDimensions = function () {
        if (!this._terminal.charMeasure.width || !this._terminal.charMeasure.height) {
            return;
        }
        this.dimensions.scaledCharWidth = Math.floor(this._terminal.charMeasure.width * window.devicePixelRatio);
        this.dimensions.scaledCharHeight = Math.ceil(this._terminal.charMeasure.height * window.devicePixelRatio);
        this.dimensions.scaledCellHeight = Math.floor(this.dimensions.scaledCharHeight * this._terminal.options.lineHeight);
        this.dimensions.scaledCharTop = this._terminal.options.lineHeight === 1 ? 0 : Math.round((this.dimensions.scaledCellHeight - this.dimensions.scaledCharHeight) / 2);
        this.dimensions.scaledCellWidth = this.dimensions.scaledCharWidth + Math.round(this._terminal.options.letterSpacing);
        this.dimensions.scaledCharLeft = Math.floor(this._terminal.options.letterSpacing / 2);
        this.dimensions.scaledCanvasHeight = this._terminal.rows * this.dimensions.scaledCellHeight;
        this.dimensions.scaledCanvasWidth = this._terminal.cols * this.dimensions.scaledCellWidth;
        this.dimensions.canvasHeight = Math.round(this.dimensions.scaledCanvasHeight / window.devicePixelRatio);
        this.dimensions.canvasWidth = Math.round(this.dimensions.scaledCanvasWidth / window.devicePixelRatio);
        this.dimensions.actualCellHeight = this.dimensions.canvasHeight / this._terminal.rows;
        this.dimensions.actualCellWidth = this.dimensions.canvasWidth / this._terminal.cols;
    };
    Renderer.prototype.registerCharacterJoiner = function (handler) {
        return this._characterJoinerRegistry.registerCharacterJoiner(handler);
    };
    Renderer.prototype.deregisterCharacterJoiner = function (joinerId) {
        return this._characterJoinerRegistry.deregisterCharacterJoiner(joinerId);
    };
    return Renderer;
}(EventEmitter_1.EventEmitter));
exports.Renderer = Renderer;
//# sourceMappingURL=Renderer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/SelectionRenderLayer.js":
/*!*****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/SelectionRenderLayer.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var SelectionRenderLayer = (function (_super) {
    __extends(SelectionRenderLayer, _super);
    function SelectionRenderLayer(container, zIndex, colors) {
        var _this = _super.call(this, container, 'selection', zIndex, true, colors) || this;
        _this._clearState();
        return _this;
    }
    SelectionRenderLayer.prototype._clearState = function () {
        this._state = {
            start: null,
            end: null,
            columnSelectMode: null,
            ydisp: null
        };
    };
    SelectionRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        this._clearState();
    };
    SelectionRenderLayer.prototype.reset = function (terminal) {
        if (this._state.start && this._state.end) {
            this._clearState();
            this.clearAll();
        }
    };
    SelectionRenderLayer.prototype.onSelectionChanged = function (terminal, start, end, columnSelectMode) {
        if (!this._didStateChange(start, end, columnSelectMode, terminal.buffer.ydisp)) {
            return;
        }
        this.clearAll();
        if (!start || !end) {
            return;
        }
        var viewportStartRow = start[1] - terminal.buffer.ydisp;
        var viewportEndRow = end[1] - terminal.buffer.ydisp;
        var viewportCappedStartRow = Math.max(viewportStartRow, 0);
        var viewportCappedEndRow = Math.min(viewportEndRow, terminal.rows - 1);
        if (viewportCappedStartRow >= terminal.rows || viewportCappedEndRow < 0) {
            return;
        }
        this._ctx.fillStyle = this._colors.selection.css;
        if (columnSelectMode) {
            var startCol = start[0];
            var width = end[0] - startCol;
            var height = viewportCappedEndRow - viewportCappedStartRow + 1;
            this.fillCells(startCol, viewportCappedStartRow, width, height);
        }
        else {
            var startCol = viewportStartRow === viewportCappedStartRow ? start[0] : 0;
            var startRowEndCol = viewportCappedStartRow === viewportCappedEndRow ? end[0] : terminal.cols;
            this.fillCells(startCol, viewportCappedStartRow, startRowEndCol - startCol, 1);
            var middleRowsCount = Math.max(viewportCappedEndRow - viewportCappedStartRow - 1, 0);
            this.fillCells(0, viewportCappedStartRow + 1, terminal.cols, middleRowsCount);
            if (viewportCappedStartRow !== viewportCappedEndRow) {
                var endCol = viewportEndRow === viewportCappedEndRow ? end[0] : terminal.cols;
                this.fillCells(0, viewportCappedEndRow, endCol, 1);
            }
        }
        this._state.start = [start[0], start[1]];
        this._state.end = [end[0], end[1]];
        this._state.columnSelectMode = columnSelectMode;
        this._state.ydisp = terminal.buffer.ydisp;
    };
    SelectionRenderLayer.prototype._didStateChange = function (start, end, columnSelectMode, ydisp) {
        return !this._areCoordinatesEqual(start, this._state.start) ||
            !this._areCoordinatesEqual(end, this._state.end) ||
            columnSelectMode !== this._state.columnSelectMode ||
            ydisp !== this._state.ydisp;
    };
    SelectionRenderLayer.prototype._areCoordinatesEqual = function (coord1, coord2) {
        if (!coord1 || !coord2) {
            return false;
        }
        return coord1[0] === coord2[0] && coord1[1] === coord2[1];
    };
    return SelectionRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.SelectionRenderLayer = SelectionRenderLayer;
//# sourceMappingURL=SelectionRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/TextRenderLayer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/TextRenderLayer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ../Buffer */ "./node_modules/xterm/lib/Buffer.js");
var Types_1 = __webpack_require__(/*! ./atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var GridCache_1 = __webpack_require__(/*! ./GridCache */ "./node_modules/xterm/lib/renderer/GridCache.js");
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var CharAtlasUtils_1 = __webpack_require__(/*! ./atlas/CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var TextRenderLayer = (function (_super) {
    __extends(TextRenderLayer, _super);
    function TextRenderLayer(container, zIndex, colors, characterJoinerRegistry, alpha) {
        var _this = _super.call(this, container, 'text', zIndex, alpha, colors) || this;
        _this._characterOverlapCache = {};
        _this._state = new GridCache_1.GridCache();
        _this._characterJoinerRegistry = characterJoinerRegistry;
        return _this;
    }
    TextRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        var terminalFont = this._getFont(terminal, false, false);
        if (this._characterWidth !== dim.scaledCharWidth || this._characterFont !== terminalFont) {
            this._characterWidth = dim.scaledCharWidth;
            this._characterFont = terminalFont;
            this._characterOverlapCache = {};
        }
        this._state.clear();
        this._state.resize(terminal.cols, terminal.rows);
    };
    TextRenderLayer.prototype.reset = function (terminal) {
        this._state.clear();
        this.clearAll();
    };
    TextRenderLayer.prototype._forEachCell = function (terminal, firstRow, lastRow, joinerRegistry, callback) {
        for (var y = firstRow; y <= lastRow; y++) {
            var row = y + terminal.buffer.ydisp;
            var line = terminal.buffer.lines.get(row);
            var joinedRanges = joinerRegistry ? joinerRegistry.getJoinedCharacters(row) : [];
            for (var x = 0; x < terminal.cols; x++) {
                var charData = line.get(x);
                var code = charData[Buffer_1.CHAR_DATA_CODE_INDEX];
                var chars = charData[Buffer_1.CHAR_DATA_CHAR_INDEX];
                var attr = charData[Buffer_1.CHAR_DATA_ATTR_INDEX];
                var width = charData[Buffer_1.CHAR_DATA_WIDTH_INDEX];
                var isJoined = false;
                var lastCharX = x;
                if (width === 0) {
                    continue;
                }
                if (joinedRanges.length > 0 && x === joinedRanges[0][0]) {
                    isJoined = true;
                    var range = joinedRanges.shift();
                    chars = terminal.buffer.translateBufferLineToString(row, true, range[0], range[1]);
                    width = range[1] - range[0];
                    code = Infinity;
                    lastCharX = range[1] - 1;
                }
                if (!isJoined && this._isOverlapping(charData)) {
                    if (lastCharX < line.length - 1 && line.get(lastCharX + 1)[Buffer_1.CHAR_DATA_CODE_INDEX] === Buffer_1.NULL_CELL_CODE) {
                        width = 2;
                    }
                }
                var flags = attr >> 18;
                var bg = attr & 0x1ff;
                var fg = (attr >> 9) & 0x1ff;
                if (flags & 8) {
                    var temp = bg;
                    bg = fg;
                    fg = temp;
                    if (fg === Types_1.DEFAULT_COLOR) {
                        fg = Types_1.INVERTED_DEFAULT_COLOR;
                    }
                    if (bg === Types_1.DEFAULT_COLOR) {
                        bg = Types_1.INVERTED_DEFAULT_COLOR;
                    }
                }
                callback(code, chars, width, x, y, fg, bg, flags);
                x = lastCharX;
            }
        }
    };
    TextRenderLayer.prototype._drawBackground = function (terminal, firstRow, lastRow) {
        var _this = this;
        var ctx = this._ctx;
        var cols = terminal.cols;
        var startX = 0;
        var startY = 0;
        var prevFillStyle = null;
        ctx.save();
        this._forEachCell(terminal, firstRow, lastRow, null, function (code, chars, width, x, y, fg, bg, flags) {
            var nextFillStyle = null;
            if (bg === Types_1.INVERTED_DEFAULT_COLOR) {
                nextFillStyle = _this._colors.foreground.css;
            }
            else if (CharAtlasUtils_1.is256Color(bg)) {
                nextFillStyle = _this._colors.ansi[bg].css;
            }
            if (prevFillStyle === null) {
                startX = x;
                startY = y;
            }
            if (y !== startY) {
                ctx.fillStyle = prevFillStyle;
                _this.fillCells(startX, startY, cols - startX, 1);
                startX = x;
                startY = y;
            }
            else if (prevFillStyle !== nextFillStyle) {
                ctx.fillStyle = prevFillStyle;
                _this.fillCells(startX, startY, x - startX, 1);
                startX = x;
                startY = y;
            }
            prevFillStyle = nextFillStyle;
        });
        if (prevFillStyle !== null) {
            ctx.fillStyle = prevFillStyle;
            this.fillCells(startX, startY, cols - startX, 1);
        }
        ctx.restore();
    };
    TextRenderLayer.prototype._drawForeground = function (terminal, firstRow, lastRow) {
        var _this = this;
        this._forEachCell(terminal, firstRow, lastRow, this._characterJoinerRegistry, function (code, chars, width, x, y, fg, bg, flags) {
            if (flags & 16) {
                return;
            }
            if (flags & 2) {
                _this._ctx.save();
                if (fg === Types_1.INVERTED_DEFAULT_COLOR) {
                    _this._ctx.fillStyle = _this._colors.background.css;
                }
                else if (CharAtlasUtils_1.is256Color(fg)) {
                    _this._ctx.fillStyle = _this._colors.ansi[fg].css;
                }
                else {
                    _this._ctx.fillStyle = _this._colors.foreground.css;
                }
                _this.fillBottomLineAtCells(x, y, width);
                _this._ctx.restore();
            }
            _this.drawChars(terminal, chars, code, width, x, y, fg, bg, !!(flags & 1), !!(flags & 32), !!(flags & 64));
        });
    };
    TextRenderLayer.prototype.onGridChanged = function (terminal, firstRow, lastRow) {
        if (this._state.cache.length === 0) {
            return;
        }
        if (this._charAtlas) {
            this._charAtlas.beginFrame();
        }
        this.clearCells(0, firstRow, terminal.cols, lastRow - firstRow + 1);
        this._drawBackground(terminal, firstRow, lastRow);
        this._drawForeground(terminal, firstRow, lastRow);
    };
    TextRenderLayer.prototype.onOptionsChanged = function (terminal) {
        this.setTransparency(terminal, terminal.options.allowTransparency);
    };
    TextRenderLayer.prototype._isOverlapping = function (charData) {
        if (charData[Buffer_1.CHAR_DATA_WIDTH_INDEX] !== 1) {
            return false;
        }
        var code = charData[Buffer_1.CHAR_DATA_CODE_INDEX];
        if (code < 256) {
            return false;
        }
        var char = charData[Buffer_1.CHAR_DATA_CHAR_INDEX];
        if (this._characterOverlapCache.hasOwnProperty(char)) {
            return this._characterOverlapCache[char];
        }
        this._ctx.save();
        this._ctx.font = this._characterFont;
        var overlaps = Math.floor(this._ctx.measureText(char).width) > this._characterWidth;
        this._ctx.restore();
        this._characterOverlapCache[char] = overlaps;
        return overlaps;
    };
    return TextRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.TextRenderLayer = TextRenderLayer;
//# sourceMappingURL=TextRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js":
/*!****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var BaseCharAtlas = (function () {
    function BaseCharAtlas() {
        this._didWarmUp = false;
    }
    BaseCharAtlas.prototype.dispose = function () { };
    BaseCharAtlas.prototype.warmUp = function () {
        if (!this._didWarmUp) {
            this._doWarmUp();
            this._didWarmUp = true;
        }
    };
    BaseCharAtlas.prototype._doWarmUp = function () { };
    BaseCharAtlas.prototype.beginFrame = function () { };
    return BaseCharAtlas;
}());
exports.default = BaseCharAtlas;
//# sourceMappingURL=BaseCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js":
/*!*****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var CharAtlasUtils_1 = __webpack_require__(/*! ./CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var DynamicCharAtlas_1 = __webpack_require__(/*! ./DynamicCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/DynamicCharAtlas.js");
var NoneCharAtlas_1 = __webpack_require__(/*! ./NoneCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/NoneCharAtlas.js");
var StaticCharAtlas_1 = __webpack_require__(/*! ./StaticCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/StaticCharAtlas.js");
var charAtlasImplementations = {
    'none': NoneCharAtlas_1.default,
    'static': StaticCharAtlas_1.default,
    'dynamic': DynamicCharAtlas_1.default
};
var charAtlasCache = [];
function acquireCharAtlas(terminal, colors, scaledCharWidth, scaledCharHeight) {
    var newConfig = CharAtlasUtils_1.generateConfig(scaledCharWidth, scaledCharHeight, terminal, colors);
    for (var i = 0; i < charAtlasCache.length; i++) {
        var entry = charAtlasCache[i];
        var ownedByIndex = entry.ownedBy.indexOf(terminal);
        if (ownedByIndex >= 0) {
            if (CharAtlasUtils_1.configEquals(entry.config, newConfig)) {
                return entry.atlas;
            }
            if (entry.ownedBy.length === 1) {
                charAtlasCache.splice(i, 1);
            }
            else {
                entry.ownedBy.splice(ownedByIndex, 1);
            }
            break;
        }
    }
    for (var i = 0; i < charAtlasCache.length; i++) {
        var entry = charAtlasCache[i];
        if (CharAtlasUtils_1.configEquals(entry.config, newConfig)) {
            entry.ownedBy.push(terminal);
            return entry.atlas;
        }
    }
    var newEntry = {
        atlas: new charAtlasImplementations[terminal.options.experimentalCharAtlas](document, newConfig),
        config: newConfig,
        ownedBy: [terminal]
    };
    charAtlasCache.push(newEntry);
    return newEntry.atlas;
}
exports.acquireCharAtlas = acquireCharAtlas;
function removeTerminalFromCache(terminal) {
    for (var i = 0; i < charAtlasCache.length; i++) {
        var index = charAtlasCache[i].ownedBy.indexOf(terminal);
        if (index !== -1) {
            if (charAtlasCache[i].ownedBy.length === 1) {
                charAtlasCache.splice(i, 1);
            }
            else {
                charAtlasCache[i].ownedBy.splice(index, 1);
            }
            break;
        }
    }
}
exports.removeTerminalFromCache = removeTerminalFromCache;
//# sourceMappingURL=CharAtlasCache.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js":
/*!*********************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Platform_1 = __webpack_require__(/*! ../../core/Platform */ "./node_modules/xterm/lib/core/Platform.js");
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
function generateStaticCharAtlasTexture(context, canvasFactory, config) {
    var cellWidth = config.scaledCharWidth + Types_1.CHAR_ATLAS_CELL_SPACING;
    var cellHeight = config.scaledCharHeight + Types_1.CHAR_ATLAS_CELL_SPACING;
    var canvas = canvasFactory(255 * cellWidth, (2 + 16 + 16) * cellHeight);
    var ctx = canvas.getContext('2d', { alpha: config.allowTransparency });
    ctx.fillStyle = config.colors.background.css;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.fillStyle = config.colors.foreground.css;
    ctx.font = getFont(config.fontWeight, config);
    ctx.textBaseline = 'top';
    for (var i = 0; i < 256; i++) {
        ctx.save();
        ctx.beginPath();
        ctx.rect(i * cellWidth, 0, cellWidth, cellHeight);
        ctx.clip();
        ctx.fillText(String.fromCharCode(i), i * cellWidth, 0);
        ctx.restore();
    }
    ctx.save();
    ctx.font = getFont(config.fontWeightBold, config);
    for (var i = 0; i < 256; i++) {
        ctx.save();
        ctx.beginPath();
        ctx.rect(i * cellWidth, cellHeight, cellWidth, cellHeight);
        ctx.clip();
        ctx.fillText(String.fromCharCode(i), i * cellWidth, cellHeight);
        ctx.restore();
    }
    ctx.restore();
    ctx.font = getFont(config.fontWeight, config);
    for (var colorIndex = 0; colorIndex < 16; colorIndex++) {
        var y = (colorIndex + 2) * cellHeight;
        for (var i = 0; i < 256; i++) {
            ctx.save();
            ctx.beginPath();
            ctx.rect(i * cellWidth, y, cellWidth, cellHeight);
            ctx.clip();
            ctx.fillStyle = config.colors.ansi[colorIndex].css;
            ctx.fillText(String.fromCharCode(i), i * cellWidth, y);
            ctx.restore();
        }
    }
    ctx.font = getFont(config.fontWeightBold, config);
    for (var colorIndex = 0; colorIndex < 16; colorIndex++) {
        var y = (colorIndex + 2 + 16) * cellHeight;
        for (var i = 0; i < 256; i++) {
            ctx.save();
            ctx.beginPath();
            ctx.rect(i * cellWidth, y, cellWidth, cellHeight);
            ctx.clip();
            ctx.fillStyle = config.colors.ansi[colorIndex].css;
            ctx.fillText(String.fromCharCode(i), i * cellWidth, y);
            ctx.restore();
        }
    }
    ctx.restore();
    if (!('createImageBitmap' in context) || Platform_1.isFirefox || Platform_1.isSafari) {
        return canvas;
    }
    var charAtlasImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    clearColor(charAtlasImageData, config.colors.background);
    return context.createImageBitmap(charAtlasImageData);
}
exports.generateStaticCharAtlasTexture = generateStaticCharAtlasTexture;
function clearColor(imageData, color) {
    var isEmpty = true;
    var r = color.rgba >>> 24;
    var g = color.rgba >>> 16 & 0xFF;
    var b = color.rgba >>> 8 & 0xFF;
    for (var offset = 0; offset < imageData.data.length; offset += 4) {
        if (imageData.data[offset] === r &&
            imageData.data[offset + 1] === g &&
            imageData.data[offset + 2] === b) {
            imageData.data[offset + 3] = 0;
        }
        else {
            isEmpty = false;
        }
    }
    return isEmpty;
}
exports.clearColor = clearColor;
function getFont(fontWeight, config) {
    return fontWeight + " " + config.fontSize * config.devicePixelRatio + "px " + config.fontFamily;
}
//# sourceMappingURL=CharAtlasGenerator.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js":
/*!*****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
function generateConfig(scaledCharWidth, scaledCharHeight, terminal, colors) {
    var clonedColors = {
        foreground: colors.foreground,
        background: colors.background,
        cursor: null,
        cursorAccent: null,
        selection: null,
        ansi: colors.ansi.slice(0, 16)
    };
    return {
        type: terminal.options.experimentalCharAtlas,
        devicePixelRatio: window.devicePixelRatio,
        scaledCharWidth: scaledCharWidth,
        scaledCharHeight: scaledCharHeight,
        fontFamily: terminal.options.fontFamily,
        fontSize: terminal.options.fontSize,
        fontWeight: terminal.options.fontWeight,
        fontWeightBold: terminal.options.fontWeightBold,
        allowTransparency: terminal.options.allowTransparency,
        colors: clonedColors
    };
}
exports.generateConfig = generateConfig;
function configEquals(a, b) {
    for (var i = 0; i < a.colors.ansi.length; i++) {
        if (a.colors.ansi[i].rgba !== b.colors.ansi[i].rgba) {
            return false;
        }
    }
    return a.type === b.type &&
        a.devicePixelRatio === b.devicePixelRatio &&
        a.fontFamily === b.fontFamily &&
        a.fontSize === b.fontSize &&
        a.fontWeight === b.fontWeight &&
        a.fontWeightBold === b.fontWeightBold &&
        a.allowTransparency === b.allowTransparency &&
        a.scaledCharWidth === b.scaledCharWidth &&
        a.scaledCharHeight === b.scaledCharHeight &&
        a.colors.foreground === b.colors.foreground &&
        a.colors.background === b.colors.background;
}
exports.configEquals = configEquals;
function is256Color(colorCode) {
    return colorCode < Types_1.DEFAULT_COLOR;
}
exports.is256Color = is256Color;
//# sourceMappingURL=CharAtlasUtils.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/DynamicCharAtlas.js":
/*!*******************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/DynamicCharAtlas.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var BaseCharAtlas_1 = __webpack_require__(/*! ./BaseCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js");
var ColorManager_1 = __webpack_require__(/*! ../ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var CharAtlasGenerator_1 = __webpack_require__(/*! ./CharAtlasGenerator */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js");
var LRUMap_1 = __webpack_require__(/*! ./LRUMap */ "./node_modules/xterm/lib/renderer/atlas/LRUMap.js");
var Platform_1 = __webpack_require__(/*! ../../core/Platform */ "./node_modules/xterm/lib/core/Platform.js");
var TEXTURE_WIDTH = 1024;
var TEXTURE_HEIGHT = 1024;
var TRANSPARENT_COLOR = {
    css: 'rgba(0, 0, 0, 0)',
    rgba: 0
};
var FRAME_CACHE_DRAW_LIMIT = 100;
var GLYPH_BITMAP_COMMIT_DELAY = 100;
function getGlyphCacheKey(glyph) {
    return glyph.code << 21 | glyph.bg << 12 | glyph.fg << 3 | (glyph.bold ? 0 : 4) + (glyph.dim ? 0 : 2) + (glyph.italic ? 0 : 1);
}
exports.getGlyphCacheKey = getGlyphCacheKey;
var DynamicCharAtlas = (function (_super) {
    __extends(DynamicCharAtlas, _super);
    function DynamicCharAtlas(document, _config) {
        var _this = _super.call(this) || this;
        _this._config = _config;
        _this._drawToCacheCount = 0;
        _this._glyphsWaitingOnBitmap = [];
        _this._bitmapCommitTimeout = null;
        _this._bitmap = null;
        _this._cacheCanvas = document.createElement('canvas');
        _this._cacheCanvas.width = TEXTURE_WIDTH;
        _this._cacheCanvas.height = TEXTURE_HEIGHT;
        _this._cacheCtx = _this._cacheCanvas.getContext('2d', { alpha: true });
        var tmpCanvas = document.createElement('canvas');
        tmpCanvas.width = _this._config.scaledCharWidth;
        tmpCanvas.height = _this._config.scaledCharHeight;
        _this._tmpCtx = tmpCanvas.getContext('2d', { alpha: _this._config.allowTransparency });
        _this._width = Math.floor(TEXTURE_WIDTH / _this._config.scaledCharWidth);
        _this._height = Math.floor(TEXTURE_HEIGHT / _this._config.scaledCharHeight);
        var capacity = _this._width * _this._height;
        _this._cacheMap = new LRUMap_1.default(capacity);
        _this._cacheMap.prealloc(capacity);
        return _this;
    }
    DynamicCharAtlas.prototype.dispose = function () {
        if (this._bitmapCommitTimeout !== null) {
            window.clearTimeout(this._bitmapCommitTimeout);
            this._bitmapCommitTimeout = null;
        }
    };
    DynamicCharAtlas.prototype.beginFrame = function () {
        this._drawToCacheCount = 0;
    };
    DynamicCharAtlas.prototype.draw = function (ctx, glyph, x, y) {
        if (glyph.code === 32) {
            return true;
        }
        if (!this._canCache(glyph)) {
            return false;
        }
        var glyphKey = getGlyphCacheKey(glyph);
        var cacheValue = this._cacheMap.get(glyphKey);
        if (cacheValue !== null && cacheValue !== undefined) {
            this._drawFromCache(ctx, cacheValue, x, y);
            return true;
        }
        else if (this._drawToCacheCount < FRAME_CACHE_DRAW_LIMIT) {
            var index = void 0;
            if (this._cacheMap.size < this._cacheMap.capacity) {
                index = this._cacheMap.size;
            }
            else {
                index = this._cacheMap.peek().index;
            }
            var cacheValue_1 = this._drawToCache(glyph, index);
            this._cacheMap.set(glyphKey, cacheValue_1);
            this._drawFromCache(ctx, cacheValue_1, x, y);
            return true;
        }
        return false;
    };
    DynamicCharAtlas.prototype._canCache = function (glyph) {
        return glyph.code < 256;
    };
    DynamicCharAtlas.prototype._toCoordinateX = function (index) {
        return (index % this._width) * this._config.scaledCharWidth;
    };
    DynamicCharAtlas.prototype._toCoordinateY = function (index) {
        return Math.floor(index / this._width) * this._config.scaledCharHeight;
    };
    DynamicCharAtlas.prototype._drawFromCache = function (ctx, cacheValue, x, y) {
        if (cacheValue.isEmpty) {
            return;
        }
        var cacheX = this._toCoordinateX(cacheValue.index);
        var cacheY = this._toCoordinateY(cacheValue.index);
        ctx.drawImage(cacheValue.inBitmap ? this._bitmap : this._cacheCanvas, cacheX, cacheY, this._config.scaledCharWidth, this._config.scaledCharHeight, x, y, this._config.scaledCharWidth, this._config.scaledCharHeight);
    };
    DynamicCharAtlas.prototype._getColorFromAnsiIndex = function (idx) {
        if (idx < this._config.colors.ansi.length) {
            return this._config.colors.ansi[idx];
        }
        return ColorManager_1.DEFAULT_ANSI_COLORS[idx];
    };
    DynamicCharAtlas.prototype._getBackgroundColor = function (glyph) {
        if (this._config.allowTransparency) {
            return TRANSPARENT_COLOR;
        }
        else if (glyph.bg === Types_1.INVERTED_DEFAULT_COLOR) {
            return this._config.colors.foreground;
        }
        else if (glyph.bg < 256) {
            return this._getColorFromAnsiIndex(glyph.bg);
        }
        return this._config.colors.background;
    };
    DynamicCharAtlas.prototype._getForegroundColor = function (glyph) {
        if (glyph.fg === Types_1.INVERTED_DEFAULT_COLOR) {
            return this._config.colors.background;
        }
        else if (glyph.fg < 256) {
            return this._getColorFromAnsiIndex(glyph.fg);
        }
        return this._config.colors.foreground;
    };
    DynamicCharAtlas.prototype._drawToCache = function (glyph, index) {
        this._drawToCacheCount++;
        this._tmpCtx.save();
        var backgroundColor = this._getBackgroundColor(glyph);
        this._tmpCtx.globalCompositeOperation = 'copy';
        this._tmpCtx.fillStyle = backgroundColor.css;
        this._tmpCtx.fillRect(0, 0, this._config.scaledCharWidth, this._config.scaledCharHeight);
        this._tmpCtx.globalCompositeOperation = 'source-over';
        var fontWeight = glyph.bold ? this._config.fontWeightBold : this._config.fontWeight;
        var fontStyle = glyph.italic ? 'italic' : '';
        this._tmpCtx.font =
            fontStyle + " " + fontWeight + " " + this._config.fontSize * this._config.devicePixelRatio + "px " + this._config.fontFamily;
        this._tmpCtx.textBaseline = 'top';
        this._tmpCtx.fillStyle = this._getForegroundColor(glyph).css;
        if (glyph.dim) {
            this._tmpCtx.globalAlpha = Types_1.DIM_OPACITY;
        }
        this._tmpCtx.fillText(glyph.chars, 0, 0);
        this._tmpCtx.restore();
        var imageData = this._tmpCtx.getImageData(0, 0, this._config.scaledCharWidth, this._config.scaledCharHeight);
        var isEmpty = false;
        if (!this._config.allowTransparency) {
            isEmpty = CharAtlasGenerator_1.clearColor(imageData, backgroundColor);
        }
        var x = this._toCoordinateX(index);
        var y = this._toCoordinateY(index);
        this._cacheCtx.putImageData(imageData, x, y);
        var cacheValue = {
            index: index,
            isEmpty: isEmpty,
            inBitmap: false
        };
        this._addGlyphToBitmap(cacheValue);
        return cacheValue;
    };
    DynamicCharAtlas.prototype._addGlyphToBitmap = function (cacheValue) {
        var _this = this;
        if (!('createImageBitmap' in window) || Platform_1.isFirefox || Platform_1.isSafari) {
            return;
        }
        this._glyphsWaitingOnBitmap.push(cacheValue);
        if (this._bitmapCommitTimeout !== null) {
            return;
        }
        this._bitmapCommitTimeout = window.setTimeout(function () { return _this._generateBitmap(); }, GLYPH_BITMAP_COMMIT_DELAY);
    };
    DynamicCharAtlas.prototype._generateBitmap = function () {
        var _this = this;
        var glyphsMovingToBitmap = this._glyphsWaitingOnBitmap;
        this._glyphsWaitingOnBitmap = [];
        window.createImageBitmap(this._cacheCanvas).then(function (bitmap) {
            _this._bitmap = bitmap;
            for (var i = 0; i < glyphsMovingToBitmap.length; i++) {
                var value = glyphsMovingToBitmap[i];
                value.inBitmap = true;
            }
        });
        this._bitmapCommitTimeout = null;
    };
    return DynamicCharAtlas;
}(BaseCharAtlas_1.default));
exports.default = DynamicCharAtlas;
//# sourceMappingURL=DynamicCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/LRUMap.js":
/*!*********************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/LRUMap.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var LRUMap = (function () {
    function LRUMap(capacity) {
        this.capacity = capacity;
        this._map = {};
        this._head = null;
        this._tail = null;
        this._nodePool = [];
        this.size = 0;
    }
    LRUMap.prototype._unlinkNode = function (node) {
        var prev = node.prev;
        var next = node.next;
        if (node === this._head) {
            this._head = next;
        }
        if (node === this._tail) {
            this._tail = prev;
        }
        if (prev !== null) {
            prev.next = next;
        }
        if (next !== null) {
            next.prev = prev;
        }
    };
    LRUMap.prototype._appendNode = function (node) {
        var tail = this._tail;
        if (tail !== null) {
            tail.next = node;
        }
        node.prev = tail;
        node.next = null;
        this._tail = node;
        if (this._head === null) {
            this._head = node;
        }
    };
    LRUMap.prototype.prealloc = function (count) {
        var nodePool = this._nodePool;
        for (var i = 0; i < count; i++) {
            nodePool.push({
                prev: null,
                next: null,
                key: null,
                value: null
            });
        }
    };
    LRUMap.prototype.get = function (key) {
        var node = this._map[key];
        if (node !== undefined) {
            this._unlinkNode(node);
            this._appendNode(node);
            return node.value;
        }
        return null;
    };
    LRUMap.prototype.peekValue = function (key) {
        var node = this._map[key];
        if (node !== undefined) {
            return node.value;
        }
        return null;
    };
    LRUMap.prototype.peek = function () {
        var head = this._head;
        return head === null ? null : head.value;
    };
    LRUMap.prototype.set = function (key, value) {
        var node = this._map[key];
        if (node !== undefined) {
            node = this._map[key];
            this._unlinkNode(node);
            node.value = value;
        }
        else if (this.size >= this.capacity) {
            node = this._head;
            this._unlinkNode(node);
            delete this._map[node.key];
            node.key = key;
            node.value = value;
            this._map[key] = node;
        }
        else {
            var nodePool = this._nodePool;
            if (nodePool.length > 0) {
                node = nodePool.pop();
                node.key = key;
                node.value = value;
            }
            else {
                node = {
                    prev: null,
                    next: null,
                    key: key,
                    value: value
                };
            }
            this._map[key] = node;
            this.size++;
        }
        this._appendNode(node);
    };
    return LRUMap;
}());
exports.default = LRUMap;
//# sourceMappingURL=LRUMap.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/NoneCharAtlas.js":
/*!****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/NoneCharAtlas.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseCharAtlas_1 = __webpack_require__(/*! ./BaseCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js");
var NoneCharAtlas = (function (_super) {
    __extends(NoneCharAtlas, _super);
    function NoneCharAtlas(document, config) {
        return _super.call(this) || this;
    }
    NoneCharAtlas.prototype.draw = function (ctx, glyph, x, y) {
        return false;
    };
    return NoneCharAtlas;
}(BaseCharAtlas_1.default));
exports.default = NoneCharAtlas;
//# sourceMappingURL=NoneCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/StaticCharAtlas.js":
/*!******************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/StaticCharAtlas.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var CharAtlasGenerator_1 = __webpack_require__(/*! ./CharAtlasGenerator */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js");
var BaseCharAtlas_1 = __webpack_require__(/*! ./BaseCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js");
var CharAtlasUtils_1 = __webpack_require__(/*! ./CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var StaticCharAtlas = (function (_super) {
    __extends(StaticCharAtlas, _super);
    function StaticCharAtlas(_document, _config) {
        var _this = _super.call(this) || this;
        _this._document = _document;
        _this._config = _config;
        _this._canvasFactory = function (width, height) {
            var canvas = _this._document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            return canvas;
        };
        return _this;
    }
    StaticCharAtlas.prototype._doWarmUp = function () {
        var _this = this;
        var result = CharAtlasGenerator_1.generateStaticCharAtlasTexture(window, this._canvasFactory, this._config);
        if (result instanceof HTMLCanvasElement) {
            this._texture = result;
        }
        else {
            result.then(function (texture) {
                _this._texture = texture;
            });
        }
    };
    StaticCharAtlas.prototype._isCached = function (glyph, colorIndex) {
        var isAscii = glyph.code < 256;
        var isBasicColor = glyph.fg < 16;
        var isDefaultColor = glyph.fg === Types_1.DEFAULT_COLOR;
        var isDefaultBackground = glyph.bg === Types_1.DEFAULT_COLOR;
        return isAscii && (isBasicColor || isDefaultColor) && isDefaultBackground && !glyph.italic;
    };
    StaticCharAtlas.prototype.draw = function (ctx, glyph, x, y) {
        if (this._texture === null || this._texture === undefined) {
            return false;
        }
        var colorIndex = 0;
        if (CharAtlasUtils_1.is256Color(glyph.fg)) {
            colorIndex = 2 + glyph.fg + (glyph.bold ? 16 : 0);
        }
        else if (glyph.fg === Types_1.DEFAULT_COLOR) {
            if (glyph.bold) {
                colorIndex = 1;
            }
        }
        if (!this._isCached(glyph, colorIndex)) {
            return false;
        }
        ctx.save();
        var charAtlasCellWidth = this._config.scaledCharWidth + Types_1.CHAR_ATLAS_CELL_SPACING;
        var charAtlasCellHeight = this._config.scaledCharHeight + Types_1.CHAR_ATLAS_CELL_SPACING;
        if (glyph.dim) {
            ctx.globalAlpha = Types_1.DIM_OPACITY;
        }
        ctx.drawImage(this._texture, glyph.code * charAtlasCellWidth, colorIndex * charAtlasCellHeight, charAtlasCellWidth, this._config.scaledCharHeight, x, y, charAtlasCellWidth, this._config.scaledCharHeight);
        ctx.restore();
        return true;
    };
    return StaticCharAtlas;
}(BaseCharAtlas_1.default));
exports.default = StaticCharAtlas;
//# sourceMappingURL=StaticCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/Types.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/Types.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_COLOR = 256;
exports.INVERTED_DEFAULT_COLOR = 257;
exports.DIM_OPACITY = 0.5;
exports.CHAR_ATLAS_CELL_SPACING = 1;
//# sourceMappingURL=Types.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/dom/DomRenderer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/dom/DomRenderer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter_1 = __webpack_require__(/*! ../../common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var ColorManager_1 = __webpack_require__(/*! ../ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var RenderDebouncer_1 = __webpack_require__(/*! ../../ui/RenderDebouncer */ "./node_modules/xterm/lib/ui/RenderDebouncer.js");
var DomRendererRowFactory_1 = __webpack_require__(/*! ./DomRendererRowFactory */ "./node_modules/xterm/lib/renderer/dom/DomRendererRowFactory.js");
var Types_1 = __webpack_require__(/*! ../atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var TERMINAL_CLASS_PREFIX = 'xterm-dom-renderer-owner-';
var ROW_CONTAINER_CLASS = 'xterm-rows';
var FG_CLASS_PREFIX = 'xterm-fg-';
var BG_CLASS_PREFIX = 'xterm-bg-';
var FOCUS_CLASS = 'xterm-focus';
var SELECTION_CLASS = 'xterm-selection';
var nextTerminalId = 1;
var DomRenderer = (function (_super) {
    __extends(DomRenderer, _super);
    function DomRenderer(_terminal, theme) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._terminalClass = nextTerminalId++;
        _this._rowElements = [];
        var allowTransparency = _this._terminal.options.allowTransparency;
        _this.colorManager = new ColorManager_1.ColorManager(document, allowTransparency);
        _this.setTheme(theme);
        _this._rowContainer = document.createElement('div');
        _this._rowContainer.classList.add(ROW_CONTAINER_CLASS);
        _this._rowContainer.style.lineHeight = 'normal';
        _this._rowContainer.setAttribute('aria-hidden', 'true');
        _this._refreshRowElements(_this._terminal.cols, _this._terminal.rows);
        _this._selectionContainer = document.createElement('div');
        _this._selectionContainer.classList.add(SELECTION_CLASS);
        _this._selectionContainer.setAttribute('aria-hidden', 'true');
        _this.dimensions = {
            scaledCharWidth: null,
            scaledCharHeight: null,
            scaledCellWidth: null,
            scaledCellHeight: null,
            scaledCharLeft: null,
            scaledCharTop: null,
            scaledCanvasWidth: null,
            scaledCanvasHeight: null,
            canvasWidth: null,
            canvasHeight: null,
            actualCellWidth: null,
            actualCellHeight: null
        };
        _this._updateDimensions();
        _this._renderDebouncer = new RenderDebouncer_1.RenderDebouncer(_this._terminal, _this._renderRows.bind(_this));
        _this._rowFactory = new DomRendererRowFactory_1.DomRendererRowFactory(document);
        _this._terminal.element.classList.add(TERMINAL_CLASS_PREFIX + _this._terminalClass);
        _this._terminal.screenElement.appendChild(_this._rowContainer);
        _this._terminal.screenElement.appendChild(_this._selectionContainer);
        _this._terminal.linkifier.on("linkhover", function (e) { return _this._onLinkHover(e); });
        _this._terminal.linkifier.on("linkleave", function (e) { return _this._onLinkLeave(e); });
        return _this;
    }
    DomRenderer.prototype.dispose = function () {
        this._terminal.element.classList.remove(TERMINAL_CLASS_PREFIX + this._terminalClass);
        this._terminal.screenElement.removeChild(this._rowContainer);
        this._terminal.screenElement.removeChild(this._selectionContainer);
        this._terminal.screenElement.removeChild(this._themeStyleElement);
        this._terminal.screenElement.removeChild(this._dimensionsStyleElement);
        _super.prototype.dispose.call(this);
    };
    DomRenderer.prototype._updateDimensions = function () {
        var _this = this;
        this.dimensions.scaledCharWidth = Math.floor(this._terminal.charMeasure.width * window.devicePixelRatio);
        this.dimensions.scaledCharHeight = Math.ceil(this._terminal.charMeasure.height * window.devicePixelRatio);
        this.dimensions.scaledCellWidth = this.dimensions.scaledCharWidth + Math.round(this._terminal.options.letterSpacing);
        this.dimensions.scaledCellHeight = Math.floor(this.dimensions.scaledCharHeight * this._terminal.options.lineHeight);
        this.dimensions.scaledCharLeft = 0;
        this.dimensions.scaledCharTop = 0;
        this.dimensions.scaledCanvasWidth = this.dimensions.scaledCellWidth * this._terminal.cols;
        this.dimensions.scaledCanvasHeight = this.dimensions.scaledCellHeight * this._terminal.rows;
        this.dimensions.canvasWidth = Math.round(this.dimensions.scaledCanvasWidth / window.devicePixelRatio);
        this.dimensions.canvasHeight = Math.round(this.dimensions.scaledCanvasHeight / window.devicePixelRatio);
        this.dimensions.actualCellWidth = this.dimensions.canvasWidth / this._terminal.cols;
        this.dimensions.actualCellHeight = this.dimensions.canvasHeight / this._terminal.rows;
        this._rowElements.forEach(function (element) {
            element.style.width = _this.dimensions.canvasWidth + "px";
            element.style.height = _this.dimensions.actualCellHeight + "px";
            element.style.lineHeight = _this.dimensions.actualCellHeight + "px";
            element.style.overflow = 'hidden';
        });
        if (!this._dimensionsStyleElement) {
            this._dimensionsStyleElement = document.createElement('style');
            this._terminal.screenElement.appendChild(this._dimensionsStyleElement);
        }
        var styles = this._terminalSelector + " ." + ROW_CONTAINER_CLASS + " span {" +
            " display: inline-block;" +
            " height: 100%;" +
            " vertical-align: top;" +
            (" width: " + this.dimensions.actualCellWidth + "px") +
            "}";
        this._dimensionsStyleElement.innerHTML = styles;
        this._selectionContainer.style.height = this._terminal._viewportElement.style.height;
        this._terminal.screenElement.style.width = this.dimensions.canvasWidth + "px";
        this._terminal.screenElement.style.height = this.dimensions.canvasHeight + "px";
    };
    DomRenderer.prototype.setTheme = function (theme) {
        var _this = this;
        if (theme) {
            this.colorManager.setTheme(theme);
        }
        if (!this._themeStyleElement) {
            this._themeStyleElement = document.createElement('style');
            this._terminal.screenElement.appendChild(this._themeStyleElement);
        }
        var styles = this._terminalSelector + " ." + ROW_CONTAINER_CLASS + " {" +
            (" color: " + this.colorManager.colors.foreground.css + ";") +
            (" background-color: " + this.colorManager.colors.background.css + ";") +
            (" font-family: " + this._terminal.getOption('fontFamily') + ";") +
            (" font-size: " + this._terminal.getOption('fontSize') + "px;") +
            "}";
        styles +=
            this._terminalSelector + " span:not(." + DomRendererRowFactory_1.BOLD_CLASS + ") {" +
                (" font-weight: " + this._terminal.options.fontWeight + ";") +
                "}" +
                (this._terminalSelector + " span." + DomRendererRowFactory_1.BOLD_CLASS + " {") +
                (" font-weight: " + this._terminal.options.fontWeightBold + ";") +
                "}" +
                (this._terminalSelector + " span." + DomRendererRowFactory_1.ITALIC_CLASS + " {") +
                " font-style: italic;" +
                "}";
        styles +=
            this._terminalSelector + " ." + ROW_CONTAINER_CLASS + ":not(." + FOCUS_CLASS + ") ." + DomRendererRowFactory_1.CURSOR_CLASS + " {" +
                (" outline: 1px solid " + this.colorManager.colors.cursor.css + ";") +
                " outline-offset: -1px;" +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_STYLE_BLOCK_CLASS + " {") +
                (" background-color: " + this.colorManager.colors.cursor.css + ";") +
                (" color: " + this.colorManager.colors.cursorAccent.css + ";") +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_STYLE_BAR_CLASS + " {") +
                (" box-shadow: 1px 0 0 " + this.colorManager.colors.cursor.css + " inset;") +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_STYLE_UNDERLINE_CLASS + " {") +
                (" box-shadow: 0 -1px 0 " + this.colorManager.colors.cursor.css + " inset;") +
                "}";
        styles +=
            this._terminalSelector + " ." + SELECTION_CLASS + " {" +
                " position: absolute;" +
                " top: 0;" +
                " left: 0;" +
                " z-index: 1;" +
                " pointer-events: none;" +
                "}" +
                (this._terminalSelector + " ." + SELECTION_CLASS + " div {") +
                " position: absolute;" +
                (" background-color: " + this.colorManager.colors.selection.css + ";") +
                "}";
        this.colorManager.colors.ansi.forEach(function (c, i) {
            styles +=
                _this._terminalSelector + " ." + FG_CLASS_PREFIX + i + " { color: " + c.css + "; }" +
                    (_this._terminalSelector + " ." + BG_CLASS_PREFIX + i + " { background-color: " + c.css + "; }");
        });
        styles +=
            this._terminalSelector + " ." + FG_CLASS_PREFIX + Types_1.INVERTED_DEFAULT_COLOR + " { color: " + this.colorManager.colors.background.css + "; }" +
                (this._terminalSelector + " ." + BG_CLASS_PREFIX + Types_1.INVERTED_DEFAULT_COLOR + " { background-color: " + this.colorManager.colors.foreground.css + "; }");
        this._themeStyleElement.innerHTML = styles;
        return this.colorManager.colors;
    };
    DomRenderer.prototype.onWindowResize = function (devicePixelRatio) {
        this._updateDimensions();
    };
    DomRenderer.prototype._refreshRowElements = function (cols, rows) {
        for (var i = this._rowElements.length; i <= rows; i++) {
            var row = document.createElement('div');
            this._rowContainer.appendChild(row);
            this._rowElements.push(row);
        }
        while (this._rowElements.length > rows) {
            this._rowContainer.removeChild(this._rowElements.pop());
        }
    };
    DomRenderer.prototype.onResize = function (cols, rows) {
        this._refreshRowElements(cols, rows);
        this._updateDimensions();
    };
    DomRenderer.prototype.onCharSizeChanged = function () {
        this._updateDimensions();
    };
    DomRenderer.prototype.onBlur = function () {
        this._rowContainer.classList.remove(FOCUS_CLASS);
    };
    DomRenderer.prototype.onFocus = function () {
        this._rowContainer.classList.add(FOCUS_CLASS);
    };
    DomRenderer.prototype.onSelectionChanged = function (start, end, columnSelectMode) {
        while (this._selectionContainer.children.length) {
            this._selectionContainer.removeChild(this._selectionContainer.children[0]);
        }
        if (!start || !end) {
            return;
        }
        var viewportStartRow = start[1] - this._terminal.buffer.ydisp;
        var viewportEndRow = end[1] - this._terminal.buffer.ydisp;
        var viewportCappedStartRow = Math.max(viewportStartRow, 0);
        var viewportCappedEndRow = Math.min(viewportEndRow, this._terminal.rows - 1);
        if (viewportCappedStartRow >= this._terminal.rows || viewportCappedEndRow < 0) {
            return;
        }
        var documentFragment = document.createDocumentFragment();
        if (columnSelectMode) {
            documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow, start[0], end[0], viewportCappedEndRow - viewportCappedStartRow + 1));
        }
        else {
            var startCol = viewportStartRow === viewportCappedStartRow ? start[0] : 0;
            var endCol = viewportCappedStartRow === viewportCappedEndRow ? end[0] : this._terminal.cols;
            documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow, startCol, endCol));
            var middleRowsCount = viewportCappedEndRow - viewportCappedStartRow - 1;
            documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow + 1, 0, this._terminal.cols, middleRowsCount));
            if (viewportCappedStartRow !== viewportCappedEndRow) {
                var endCol_1 = viewportEndRow === viewportCappedEndRow ? end[0] : this._terminal.cols;
                documentFragment.appendChild(this._createSelectionElement(viewportCappedEndRow, 0, endCol_1));
            }
        }
        this._selectionContainer.appendChild(documentFragment);
    };
    DomRenderer.prototype._createSelectionElement = function (row, colStart, colEnd, rowCount) {
        if (rowCount === void 0) { rowCount = 1; }
        var element = document.createElement('div');
        element.style.height = rowCount * this.dimensions.actualCellHeight + "px";
        element.style.top = row * this.dimensions.actualCellHeight + "px";
        element.style.left = colStart * this.dimensions.actualCellWidth + "px";
        element.style.width = this.dimensions.actualCellWidth * (colEnd - colStart) + "px";
        return element;
    };
    DomRenderer.prototype.onCursorMove = function () {
    };
    DomRenderer.prototype.onOptionsChanged = function () {
        this._updateDimensions();
        this.setTheme(undefined);
        this._terminal.refresh(0, this._terminal.rows - 1);
    };
    DomRenderer.prototype.clear = function () {
        this._rowElements.forEach(function (e) { return e.innerHTML = ''; });
    };
    DomRenderer.prototype.refreshRows = function (start, end) {
        this._renderDebouncer.refresh(start, end);
    };
    DomRenderer.prototype._renderRows = function (start, end) {
        var terminal = this._terminal;
        var cursorAbsoluteY = terminal.buffer.ybase + terminal.buffer.y;
        var cursorX = this._terminal.buffer.x;
        for (var y = start; y <= end; y++) {
            var rowElement = this._rowElements[y];
            rowElement.innerHTML = '';
            var row = y + terminal.buffer.ydisp;
            var lineData = terminal.buffer.lines.get(row);
            var cursorStyle = terminal.options.cursorStyle;
            rowElement.appendChild(this._rowFactory.createRow(lineData, row === cursorAbsoluteY, cursorStyle, cursorX, this.dimensions.actualCellWidth, terminal.cols));
        }
        this._terminal.emit('refresh', { start: start, end: end });
    };
    Object.defineProperty(DomRenderer.prototype, "_terminalSelector", {
        get: function () {
            return "." + TERMINAL_CLASS_PREFIX + this._terminalClass;
        },
        enumerable: true,
        configurable: true
    });
    DomRenderer.prototype.registerCharacterJoiner = function (handler) { return -1; };
    DomRenderer.prototype.deregisterCharacterJoiner = function (joinerId) { return false; };
    DomRenderer.prototype._onLinkHover = function (e) {
        this._setCellUnderline(e.x1, e.x2, e.y1, e.y2, e.cols, true);
    };
    DomRenderer.prototype._onLinkLeave = function (e) {
        this._setCellUnderline(e.x1, e.x2, e.y1, e.y2, e.cols, false);
    };
    DomRenderer.prototype._setCellUnderline = function (x, x2, y, y2, cols, enabled) {
        while (x !== x2 || y !== y2) {
            var row = this._rowElements[y];
            if (!row) {
                return;
            }
            var span = row.children[x];
            span.style.textDecoration = enabled ? 'underline' : 'none';
            x = (x + 1) % cols;
            if (x === 0) {
                y++;
            }
        }
    };
    return DomRenderer;
}(EventEmitter_1.EventEmitter));
exports.DomRenderer = DomRenderer;
//# sourceMappingURL=DomRenderer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/dom/DomRendererRowFactory.js":
/*!**********************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/dom/DomRendererRowFactory.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ../../Buffer */ "./node_modules/xterm/lib/Buffer.js");
var Types_1 = __webpack_require__(/*! ../atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
exports.BOLD_CLASS = 'xterm-bold';
exports.ITALIC_CLASS = 'xterm-italic';
exports.CURSOR_CLASS = 'xterm-cursor';
exports.CURSOR_STYLE_BLOCK_CLASS = 'xterm-cursor-block';
exports.CURSOR_STYLE_BAR_CLASS = 'xterm-cursor-bar';
exports.CURSOR_STYLE_UNDERLINE_CLASS = 'xterm-cursor-underline';
var DomRendererRowFactory = (function () {
    function DomRendererRowFactory(_document) {
        this._document = _document;
    }
    DomRendererRowFactory.prototype.createRow = function (lineData, isCursorRow, cursorStyle, cursorX, cellWidth, cols) {
        var fragment = this._document.createDocumentFragment();
        var lineLength = 0;
        for (var x = Math.min(lineData.length, cols) - 1; x >= 0; x--) {
            var charData = lineData.get(x);
            var code = charData[Buffer_1.CHAR_DATA_CODE_INDEX];
            if (code !== Buffer_1.NULL_CELL_CODE || (isCursorRow && x === cursorX)) {
                lineLength = x + 1;
                break;
            }
        }
        for (var x = 0; x < lineLength; x++) {
            var charData = lineData.get(x);
            var char = charData[Buffer_1.CHAR_DATA_CHAR_INDEX];
            var attr = charData[Buffer_1.CHAR_DATA_ATTR_INDEX];
            var width = charData[Buffer_1.CHAR_DATA_WIDTH_INDEX];
            if (width === 0) {
                continue;
            }
            var charElement = this._document.createElement('span');
            if (width > 1) {
                charElement.style.width = cellWidth * width + "px";
            }
            var flags = attr >> 18;
            var bg = attr & 0x1ff;
            var fg = (attr >> 9) & 0x1ff;
            if (isCursorRow && x === cursorX) {
                charElement.classList.add(exports.CURSOR_CLASS);
                switch (cursorStyle) {
                    case 'bar':
                        charElement.classList.add(exports.CURSOR_STYLE_BAR_CLASS);
                        break;
                    case 'underline':
                        charElement.classList.add(exports.CURSOR_STYLE_UNDERLINE_CLASS);
                        break;
                    default:
                        charElement.classList.add(exports.CURSOR_STYLE_BLOCK_CLASS);
                        break;
                }
            }
            if (flags & 8) {
                var temp = bg;
                bg = fg;
                fg = temp;
                if (fg === Types_1.DEFAULT_COLOR) {
                    fg = Types_1.INVERTED_DEFAULT_COLOR;
                }
                if (bg === Types_1.DEFAULT_COLOR) {
                    bg = Types_1.INVERTED_DEFAULT_COLOR;
                }
            }
            if (flags & 1) {
                if (fg < 8) {
                    fg += 8;
                }
                charElement.classList.add(exports.BOLD_CLASS);
            }
            if (flags & 64) {
                charElement.classList.add(exports.ITALIC_CLASS);
            }
            charElement.textContent = char;
            if (fg !== Types_1.DEFAULT_COLOR) {
                charElement.classList.add("xterm-fg-" + fg);
            }
            if (bg !== Types_1.DEFAULT_COLOR) {
                charElement.classList.add("xterm-bg-" + bg);
            }
            fragment.appendChild(charElement);
        }
        return fragment;
    };
    return DomRendererRowFactory;
}());
exports.DomRendererRowFactory = DomRendererRowFactory;
//# sourceMappingURL=DomRendererRowFactory.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/CharMeasure.js":
/*!**************************************************!*\
  !*** ./node_modules/xterm/lib/ui/CharMeasure.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter_1 = __webpack_require__(/*! ../common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var CharMeasure = (function (_super) {
    __extends(CharMeasure, _super);
    function CharMeasure(document, parentElement) {
        var _this = _super.call(this) || this;
        _this._document = document;
        _this._parentElement = parentElement;
        _this._measureElement = _this._document.createElement('span');
        _this._measureElement.classList.add('xterm-char-measure-element');
        _this._measureElement.textContent = 'W';
        _this._measureElement.setAttribute('aria-hidden', 'true');
        _this._parentElement.appendChild(_this._measureElement);
        return _this;
    }
    Object.defineProperty(CharMeasure.prototype, "width", {
        get: function () {
            return this._width;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CharMeasure.prototype, "height", {
        get: function () {
            return this._height;
        },
        enumerable: true,
        configurable: true
    });
    CharMeasure.prototype.measure = function (options) {
        this._measureElement.style.fontFamily = options.fontFamily;
        this._measureElement.style.fontSize = options.fontSize + "px";
        var geometry = this._measureElement.getBoundingClientRect();
        if (geometry.width === 0 || geometry.height === 0) {
            return;
        }
        if (this._width !== geometry.width || this._height !== geometry.height) {
            this._width = geometry.width;
            this._height = Math.ceil(geometry.height);
            this.emit('charsizechanged');
        }
    };
    return CharMeasure;
}(EventEmitter_1.EventEmitter));
exports.CharMeasure = CharMeasure;
//# sourceMappingURL=CharMeasure.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/Clipboard.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/ui/Clipboard.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function prepareTextForTerminal(text) {
    return text.replace(/\r?\n/g, '\r');
}
exports.prepareTextForTerminal = prepareTextForTerminal;
function bracketTextForPaste(text, bracketedPasteMode) {
    if (bracketedPasteMode) {
        return '\x1b[200~' + text + '\x1b[201~';
    }
    return text;
}
exports.bracketTextForPaste = bracketTextForPaste;
function copyHandler(ev, term, selectionManager) {
    if (term.browser.isMSIE) {
        window.clipboardData.setData('Text', selectionManager.selectionText);
    }
    else {
        ev.clipboardData.setData('text/plain', selectionManager.selectionText);
    }
    ev.preventDefault();
}
exports.copyHandler = copyHandler;
function pasteHandler(ev, term) {
    ev.stopPropagation();
    var text;
    var dispatchPaste = function (text) {
        text = prepareTextForTerminal(text);
        text = bracketTextForPaste(text, term.bracketedPasteMode);
        term.handler(text);
        term.textarea.value = '';
        term.emit('paste', text);
        term.cancel(ev);
    };
    if (term.browser.isMSIE) {
        if (window.clipboardData) {
            text = window.clipboardData.getData('Text');
            dispatchPaste(text);
        }
    }
    else {
        if (ev.clipboardData) {
            text = ev.clipboardData.getData('text/plain');
            dispatchPaste(text);
        }
    }
}
exports.pasteHandler = pasteHandler;
function moveTextAreaUnderMouseCursor(ev, textarea) {
    textarea.style.position = 'fixed';
    textarea.style.width = '20px';
    textarea.style.height = '20px';
    textarea.style.left = (ev.clientX - 10) + 'px';
    textarea.style.top = (ev.clientY - 10) + 'px';
    textarea.style.zIndex = '1000';
    textarea.focus();
    setTimeout(function () {
        textarea.style.position = null;
        textarea.style.width = null;
        textarea.style.height = null;
        textarea.style.left = null;
        textarea.style.top = null;
        textarea.style.zIndex = null;
    }, 200);
}
exports.moveTextAreaUnderMouseCursor = moveTextAreaUnderMouseCursor;
function rightClickHandler(ev, textarea, selectionManager, shouldSelectWord) {
    moveTextAreaUnderMouseCursor(ev, textarea);
    if (shouldSelectWord && !selectionManager.isClickInSelection(ev)) {
        selectionManager.selectWordAtCursor(ev);
    }
    textarea.value = selectionManager.selectionText;
    textarea.select();
}
exports.rightClickHandler = rightClickHandler;
//# sourceMappingURL=Clipboard.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/Lifecycle.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/ui/Lifecycle.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function addDisposableDomListener(node, type, handler, useCapture) {
    node.addEventListener(type, handler, useCapture);
    return {
        dispose: function () {
            if (!handler) {
                return;
            }
            node.removeEventListener(type, handler, useCapture);
            node = null;
            handler = null;
        }
    };
}
exports.addDisposableDomListener = addDisposableDomListener;
//# sourceMappingURL=Lifecycle.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/MouseZoneManager.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/ui/MouseZoneManager.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ../common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var Lifecycle_2 = __webpack_require__(/*! ./Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var HOVER_DURATION = 500;
var MouseZoneManager = (function (_super) {
    __extends(MouseZoneManager, _super);
    function MouseZoneManager(_terminal) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._zones = [];
        _this._areZonesActive = false;
        _this._tooltipTimeout = null;
        _this._currentZone = null;
        _this._lastHoverCoords = [null, null];
        _this.register(Lifecycle_2.addDisposableDomListener(_this._terminal.element, 'mousedown', function (e) { return _this._onMouseDown(e); }));
        _this._mouseMoveListener = function (e) { return _this._onMouseMove(e); };
        _this._clickListener = function (e) { return _this._onClick(e); };
        return _this;
    }
    MouseZoneManager.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._deactivate();
    };
    MouseZoneManager.prototype.add = function (zone) {
        this._zones.push(zone);
        if (this._zones.length === 1) {
            this._activate();
        }
    };
    MouseZoneManager.prototype.clearAll = function (start, end) {
        if (this._zones.length === 0) {
            return;
        }
        if (!end) {
            start = 0;
            end = this._terminal.rows - 1;
        }
        for (var i = 0; i < this._zones.length; i++) {
            var zone = this._zones[i];
            if ((zone.y1 > start && zone.y1 <= end + 1) ||
                (zone.y2 > start && zone.y2 <= end + 1) ||
                (zone.y1 < start && zone.y2 > end + 1)) {
                if (this._currentZone && this._currentZone === zone) {
                    this._currentZone.leaveCallback();
                    this._currentZone = null;
                }
                this._zones.splice(i--, 1);
            }
        }
        if (this._zones.length === 0) {
            this._deactivate();
        }
    };
    MouseZoneManager.prototype._activate = function () {
        if (!this._areZonesActive) {
            this._areZonesActive = true;
            this._terminal.element.addEventListener('mousemove', this._mouseMoveListener);
            this._terminal.element.addEventListener('click', this._clickListener);
        }
    };
    MouseZoneManager.prototype._deactivate = function () {
        if (this._areZonesActive) {
            this._areZonesActive = false;
            this._terminal.element.removeEventListener('mousemove', this._mouseMoveListener);
            this._terminal.element.removeEventListener('click', this._clickListener);
        }
    };
    MouseZoneManager.prototype._onMouseMove = function (e) {
        if (this._lastHoverCoords[0] !== e.pageX || this._lastHoverCoords[1] !== e.pageY) {
            this._onHover(e);
            this._lastHoverCoords = [e.pageX, e.pageY];
        }
    };
    MouseZoneManager.prototype._onHover = function (e) {
        var _this = this;
        var zone = this._findZoneEventAt(e);
        if (zone === this._currentZone) {
            return;
        }
        if (this._currentZone) {
            this._currentZone.leaveCallback();
            this._currentZone = null;
            if (this._tooltipTimeout) {
                clearTimeout(this._tooltipTimeout);
            }
        }
        if (!zone) {
            return;
        }
        this._currentZone = zone;
        if (zone.hoverCallback) {
            zone.hoverCallback(e);
        }
        this._tooltipTimeout = setTimeout(function () { return _this._onTooltip(e); }, HOVER_DURATION);
    };
    MouseZoneManager.prototype._onTooltip = function (e) {
        this._tooltipTimeout = null;
        var zone = this._findZoneEventAt(e);
        if (zone && zone.tooltipCallback) {
            zone.tooltipCallback(e);
        }
    };
    MouseZoneManager.prototype._onMouseDown = function (e) {
        if (!this._areZonesActive) {
            return;
        }
        var zone = this._findZoneEventAt(e);
        if (zone) {
            if (zone.willLinkActivate(e)) {
                e.preventDefault();
                e.stopImmediatePropagation();
            }
        }
    };
    MouseZoneManager.prototype._onClick = function (e) {
        var zone = this._findZoneEventAt(e);
        if (zone) {
            zone.clickCallback(e);
            e.preventDefault();
            e.stopImmediatePropagation();
        }
    };
    MouseZoneManager.prototype._findZoneEventAt = function (e) {
        var coords = this._terminal.mouseHelper.getCoords(e, this._terminal.screenElement, this._terminal.charMeasure, this._terminal.cols, this._terminal.rows);
        if (!coords) {
            return null;
        }
        var x = coords[0];
        var y = coords[1];
        for (var i = 0; i < this._zones.length; i++) {
            var zone = this._zones[i];
            if (zone.y1 === zone.y2) {
                if (y === zone.y1 && x >= zone.x1 && x < zone.x2) {
                    return zone;
                }
            }
            else {
                if ((y === zone.y1 && x >= zone.x1) ||
                    (y === zone.y2 && x < zone.x2) ||
                    (y > zone.y1 && y < zone.y2)) {
                    return zone;
                }
            }
        }
        return null;
    };
    return MouseZoneManager;
}(Lifecycle_1.Disposable));
exports.MouseZoneManager = MouseZoneManager;
var MouseZone = (function () {
    function MouseZone(x1, y1, x2, y2, clickCallback, hoverCallback, tooltipCallback, leaveCallback, willLinkActivate) {
        this.x1 = x1;
        this.y1 = y1;
        this.x2 = x2;
        this.y2 = y2;
        this.clickCallback = clickCallback;
        this.hoverCallback = hoverCallback;
        this.tooltipCallback = tooltipCallback;
        this.leaveCallback = leaveCallback;
        this.willLinkActivate = willLinkActivate;
    }
    return MouseZone;
}());
exports.MouseZone = MouseZone;
//# sourceMappingURL=MouseZoneManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/RenderDebouncer.js":
/*!******************************************************!*\
  !*** ./node_modules/xterm/lib/ui/RenderDebouncer.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var RenderDebouncer = (function () {
    function RenderDebouncer(_terminal, _callback) {
        this._terminal = _terminal;
        this._callback = _callback;
        this._animationFrame = null;
    }
    RenderDebouncer.prototype.dispose = function () {
        if (this._animationFrame) {
            window.cancelAnimationFrame(this._animationFrame);
            this._animationFrame = null;
        }
    };
    RenderDebouncer.prototype.refresh = function (rowStart, rowEnd) {
        var _this = this;
        rowStart = rowStart !== null && rowStart !== undefined ? rowStart : 0;
        rowEnd = rowEnd !== null && rowEnd !== undefined ? rowEnd : this._terminal.rows - 1;
        var isRowStartSet = this._rowStart !== undefined && this._rowStart !== null;
        var isRowEndSet = this._rowEnd !== undefined && this._rowEnd !== null;
        this._rowStart = isRowStartSet ? Math.min(this._rowStart, rowStart) : rowStart;
        this._rowEnd = isRowEndSet ? Math.max(this._rowEnd, rowEnd) : rowEnd;
        if (this._animationFrame) {
            return;
        }
        this._animationFrame = window.requestAnimationFrame(function () { return _this._innerRefresh(); });
    };
    RenderDebouncer.prototype._innerRefresh = function () {
        this._rowStart = Math.max(this._rowStart, 0);
        this._rowEnd = Math.min(this._rowEnd, this._terminal.rows - 1);
        this._callback(this._rowStart, this._rowEnd);
        this._rowStart = null;
        this._rowEnd = null;
        this._animationFrame = null;
    };
    return RenderDebouncer;
}());
exports.RenderDebouncer = RenderDebouncer;
//# sourceMappingURL=RenderDebouncer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/ScreenDprMonitor.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/ui/ScreenDprMonitor.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ../common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var ScreenDprMonitor = (function (_super) {
    __extends(ScreenDprMonitor, _super);
    function ScreenDprMonitor() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ScreenDprMonitor.prototype.setListener = function (listener) {
        var _this = this;
        if (this._listener) {
            this.clearListener();
        }
        this._listener = listener;
        this._outerListener = function () {
            _this._listener(window.devicePixelRatio, _this._currentDevicePixelRatio);
            _this._updateDpr();
        };
        this._updateDpr();
    };
    ScreenDprMonitor.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this.clearListener();
    };
    ScreenDprMonitor.prototype._updateDpr = function () {
        if (this._resolutionMediaMatchList) {
            this._resolutionMediaMatchList.removeListener(this._outerListener);
        }
        this._currentDevicePixelRatio = window.devicePixelRatio;
        this._resolutionMediaMatchList = window.matchMedia("screen and (resolution: " + window.devicePixelRatio + "dppx)");
        this._resolutionMediaMatchList.addListener(this._outerListener);
    };
    ScreenDprMonitor.prototype.clearListener = function () {
        if (!this._listener) {
            return;
        }
        this._resolutionMediaMatchList.removeListener(this._outerListener);
        this._listener = null;
        this._outerListener = null;
    };
    return ScreenDprMonitor;
}(Lifecycle_1.Disposable));
exports.ScreenDprMonitor = ScreenDprMonitor;
//# sourceMappingURL=ScreenDprMonitor.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/utils/Clone.js":
/*!***********************************************!*\
  !*** ./node_modules/xterm/lib/utils/Clone.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.clone = function (val, depth) {
    if (depth === void 0) { depth = 5; }
    if (typeof val !== 'object') {
        return val;
    }
    if (val === null) {
        return null;
    }
    var clonedObject = Array.isArray(val) ? [] : {};
    for (var key in val) {
        clonedObject[key] = depth <= 1 ? val[key] : exports.clone(val[key], depth - 1);
    }
    return clonedObject;
};
//# sourceMappingURL=Clone.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/utils/MouseHelper.js":
/*!*****************************************************!*\
  !*** ./node_modules/xterm/lib/utils/MouseHelper.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var MouseHelper = (function () {
    function MouseHelper(_renderer) {
        this._renderer = _renderer;
    }
    MouseHelper.prototype.setRenderer = function (renderer) {
        this._renderer = renderer;
    };
    MouseHelper.getCoordsRelativeToElement = function (event, element) {
        if (event.pageX === null || event.pageX === undefined) {
            return null;
        }
        var originalElement = element;
        var x = event.pageX;
        var y = event.pageY;
        while (element) {
            x -= element.offsetLeft;
            y -= element.offsetTop;
            element = element.offsetParent;
        }
        element = originalElement;
        while (element && element !== element.ownerDocument.body) {
            x += element.scrollLeft;
            y += element.scrollTop;
            element = element.parentElement;
        }
        return [x, y];
    };
    MouseHelper.prototype.getCoords = function (event, element, charMeasure, colCount, rowCount, isSelection) {
        if (!charMeasure.width || !charMeasure.height) {
            return null;
        }
        var coords = MouseHelper.getCoordsRelativeToElement(event, element);
        if (!coords) {
            return null;
        }
        coords[0] = Math.ceil((coords[0] + (isSelection ? this._renderer.dimensions.actualCellWidth / 2 : 0)) / this._renderer.dimensions.actualCellWidth);
        coords[1] = Math.ceil(coords[1] / this._renderer.dimensions.actualCellHeight);
        coords[0] = Math.min(Math.max(coords[0], 1), colCount + (isSelection ? 1 : 0));
        coords[1] = Math.min(Math.max(coords[1], 1), rowCount);
        return coords;
    };
    MouseHelper.prototype.getRawByteCoords = function (event, element, charMeasure, colCount, rowCount) {
        var coords = this.getCoords(event, element, charMeasure, colCount, rowCount);
        var x = coords[0];
        var y = coords[1];
        x += 32;
        y += 32;
        return { x: x, y: y };
    };
    return MouseHelper;
}());
exports.MouseHelper = MouseHelper;
//# sourceMappingURL=MouseHelper.js.map

/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vY2xpZW50LnRzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvQWNjZXNzaWJpbGl0eU1hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9CdWZmZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9CdWZmZXJMaW5lLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvQnVmZmVyU2V0LmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvQ2hhcldpZHRoLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvQ29tcG9zaXRpb25IZWxwZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9Fc2NhcGVTZXF1ZW5jZVBhcnNlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL0lucHV0SGFuZGxlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL0xpbmtpZmllci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL1NlbGVjdGlvbk1hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9TZWxlY3Rpb25Nb2RlbC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL1NvdW5kTWFuYWdlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL1N0cmluZ3MuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9UZXJtaW5hbC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL1ZpZXdwb3J0LmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvYWRkb25zL2F0dGFjaC9hdHRhY2guanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9hZGRvbnMvZml0L2ZpdC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2FkZG9ucy9mdWxsc2NyZWVuL2Z1bGxzY3JlZW4uanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9hZGRvbnMvc2VhcmNoL1NlYXJjaEhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2FkZG9ucy9zZWFyY2gvc2VhcmNoLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvYWRkb25zL3dlYkxpbmtzL3dlYkxpbmtzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvYWRkb25zL3dpbnB0eUNvbXBhdC93aW5wdHlDb21wYXQuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9jb21tb24vQ2lyY3VsYXJMaXN0LmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29tbW9uL0V2ZW50RW1pdHRlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvbW1vbi9MaWZlY3ljbGUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9jb21tb24vVHlwZWRBcnJheVV0aWxzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29tbW9uL2RhdGEvRXNjYXBlU2VxdWVuY2VzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29yZS9QbGF0Zm9ybS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvcmUvZGF0YS9DaGFyc2V0cy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvcmUvaW5wdXQvS2V5Ym9hcmQuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9oYW5kbGVycy9BbHRDbGlja0hhbmRsZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9wdWJsaWMvVGVybWluYWwuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9CYXNlUmVuZGVyTGF5ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9DaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL0NvbG9yTWFuYWdlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL0N1cnNvclJlbmRlckxheWVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvR3JpZENhY2hlLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvTGlua1JlbmRlckxheWVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvUmVuZGVyZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9TZWxlY3Rpb25SZW5kZXJMYXllci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL1RleHRSZW5kZXJMYXllci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL0Jhc2VDaGFyQXRsYXMuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9hdGxhcy9DaGFyQXRsYXNDYWNoZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL0NoYXJBdGxhc0dlbmVyYXRvci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL0NoYXJBdGxhc1V0aWxzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvYXRsYXMvRHluYW1pY0NoYXJBdGxhcy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL0xSVU1hcC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL05vbmVDaGFyQXRsYXMuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9hdGxhcy9TdGF0aWNDaGFyQXRsYXMuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9hdGxhcy9UeXBlcy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2RvbS9Eb21SZW5kZXJlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2RvbS9Eb21SZW5kZXJlclJvd0ZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi91aS9DaGFyTWVhc3VyZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3VpL0NsaXBib2FyZC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3VpL0xpZmVjeWNsZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3VpL01vdXNlWm9uZU1hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi91aS9SZW5kZXJEZWJvdW5jZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi91aS9TY3JlZW5EcHJNb25pdG9yLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvdXRpbHMvQ2xvbmUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi91dGlscy9Nb3VzZUhlbHBlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrREFBMEMsZ0NBQWdDO0FBQzFFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZ0VBQXdELGtCQUFrQjtBQUMxRTtBQUNBLHlEQUFpRCxjQUFjO0FBQy9EOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBeUMsaUNBQWlDO0FBQzFFLHdIQUFnSCxtQkFBbUIsRUFBRTtBQUNySTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG1DQUEyQiwwQkFBMEIsRUFBRTtBQUN2RCx5Q0FBaUMsZUFBZTtBQUNoRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4REFBc0QsK0RBQStEOztBQUVySDtBQUNBOzs7QUFHQTtBQUNBOzs7Ozs7Ozs7Ozs7O0FDbEZhO0FBQ2I7QUFDQSxhQUFhLG1CQUFPLENBQUMsd0ZBQWdDO0FBQ3JELFVBQVUsbUJBQU8sQ0FBQyw0RUFBMEI7QUFDNUMsaUJBQWlCLG1CQUFPLENBQUMsd0dBQXdDO0FBQ2pFLGFBQWEsbUJBQU8sQ0FBQyx3RkFBZ0M7QUFDckQsZUFBZSxtQkFBTyxDQUFDLGdHQUFvQztBQUMzRCxtQkFBbUIsbUJBQU8sQ0FBQyxnSEFBNEM7QUFDdkUsb0JBQW9CLG1CQUFPLENB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix1QkFBdUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxhQUFhO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGFBQWE7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGNBQWM7QUFDaEQsZ0NBQWdDLGVBQWU7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHFDOzs7Ozs7Ozs7Ozs7QUN2RmE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RCx3QkFBd0IsbUJBQU8sQ0FBQyxvRkFBMEI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsMEJBQTBCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLEdBQUcscUJBQXFCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixZQUFZO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDOzs7Ozs7Ozs7Ozs7QUM3SWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsOENBQThDLEVBQUU7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSw2Qzs7Ozs7Ozs7Ozs7O0FDdkhhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOENBQThDLGNBQWM7QUFDNUQsa0JBQWtCLG1CQUFPLENBQUMsd0VBQW9CO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixrQkFBa0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixZQUFZO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLGdFQUFnRTtBQUNoRSwwREFBMEQ7QUFDMUQsNkNBQTZDO0FBQzdDO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyw4Q0FBOEM7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQ7QUFDN0QsbURBQW1EO0FBQ25ELGdFQUFnRTtBQUNoRSx3REFBd0Q7QUFDeEQsMkRBQTJEO0FBQzNEO0FBQ0Esa0RBQWtELGNBQWM7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxFQUFFO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsZ0Q7Ozs7Ozs7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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxzQkFBc0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxtQkFBbUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IseUJBQXlCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUU7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsSUFBSTtBQUMzRTtBQUNBO0FBQ0Esd0VBQXdFLEdBQUc7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxNQUFNO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtQkFBbUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtQkFBbUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsT0FBTztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUZBQXVGO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RkFBd0Y7QUFDeEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsaUJBQWlCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRix5QkFBeUIsRUFBRTtBQUMvRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsNEJBQTRCLEVBQUU7QUFDL0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsZ0JBQWdCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxnQ0FBZ0M7QUFDakYsaURBQWlELGdDQUFnQztBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSw0Qzs7Ozs7Ozs7Ozs7O0FDN2pCYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QTtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUVBQXlFLGNBQWM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsc0JBQXNCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsbUJBQW1CO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyw0QkFBNEIsRUFBRTtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixtQkFBbUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixlQUFlO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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O0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQzs7Ozs7Ozs7Ozs7O0FDaEJhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLG9DOzs7Ozs7Ozs7Ozs7QUMvSmE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RCx3QkFBd0IsbUJBQU8sQ0FBQyxrR0FBbUM7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQsa0VBQWtFO0FBQ2xFLHlHQUF5RztBQUN6RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVELGtFQUFrRTtBQUNsRSx5R0FBeUc7QUFDekc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RCxrRUFBa0U7QUFDbEUsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQsa0VBQWtFO0FBQ2xFLGdFQUFnRTtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQzs7Ozs7Ozs7Ozs7O0FDdlZhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQsd0JBQXdCLG1CQUFPLENBQUMsK0ZBQWdDO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUNBQWlDO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwwREFBMEQsRUFBRTtBQUN0RjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLDhCQUE4QjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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LCtFQUFtQjtBQUNuRCx1QkFBdUIsbUJBQU8sQ0FBQyx5RkFBd0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsY0FBYztBQUM1QztBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsbUJBQW1CO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1FQUFtRSxnQ0FBZ0MsRUFBRTtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpQ0FBaUM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDRDOzs7Ozs7Ozs7Ozs7QUN4TWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsV0FBVztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0Esa0M7Ozs7Ozs7Ozs7OztBQzVHYTtBQUNiO0FBQ0E7QUFDQTtBQUNB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Q0EsQ0FBQztBQUNELDhDQUE4QyxjQUFjO0FBQzVELGtCQUFrQixtQkFBTyxDQUFDLHlFQUFxQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsNEM7Ozs7Ozs7Ozs7OztBQ3hEYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0EsMkJBQTJCLFdBQVc7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUM7Ozs7Ozs7Ozs7OztBQ2hCYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHVDIiwiZmlsZSI6ImNsaWVudC1idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gXCIuL2NsaWVudC50c1wiKTtcbiIsIlwidXNlIHN0cmljdFwiO1xuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbnZhciBhdHRhY2ggPSByZXF1aXJlKFwieHRlcm0vbGliL2FkZG9ucy9hdHRhY2gvYXR0YWNoXCIpO1xudmFyIGZpdCA9IHJlcXVpcmUoXCJ4dGVybS9saWIvYWRkb25zL2ZpdC9maXRcIik7XG52YXIgZnVsbHNjcmVlbiA9IHJlcXVpcmUoXCJ4dGVybS9saWIvYWRkb25zL2Z1bGxzY3JlZW4vZnVsbHNjcmVlblwiKTtcbnZhciBzZWFyY2ggPSByZXF1aXJlKFwieHRlcm0vbGliL2FkZG9ucy9zZWFyY2gvc2VhcmNoXCIpO1xudmFyIHdlYkxpbmtzID0gcmVxdWlyZShcInh0ZXJtL2xpYi9hZGRvbnMvd2ViTGlua3Mvd2ViTGlua3NcIik7XG52YXIgd2lucHR5Q29tcGF0ID0gcmVxdWlyZShcInh0ZXJtL2xpYi9hZGRvbnMvd2lucHR5Q29tcGF0L3dpbnB0eUNvbXBhdFwiKTtcbnZhciBUZXJtaW5hbF9qc18xID0gcmVxdWlyZShcInh0ZXJtL2xpYi9wdWJsaWMvVGVybWluYWwuanNcIik7XG5UZXJtaW5hbF9qc18xLlRlcm1pbmFsLmFwcGx5QWRkb24oYXR0YWNoKTtcblRlcm1pbmFsX2pzXzEuVGVybWluYWwuYXBwbHlBZGRvbihmaXQpO1xuVGVybWluYWxfanNfMS5UZXJtaW5hbC5hcHBseUFkZG9uKGZ1bGxzY3JlZW4pO1xuVGVybWluYWxfanNfMS5UZXJtaW5hbC5hcHBseUFkZG9uKHNlYXJjaCk7XG5UZXJtaW5hbF9qc18xLlRlcm1pbmFsLmFwcGx5QWRkb24od2ViTGlua3MpO1xuVGVybWluYWxfanNfMS5UZXJtaW5hbC5hcHBseUFkZG9uKHdpbnB0eUNvbXBhdCk7XG52YXIgdGVybTtcbnZhciBwcm90b2NvbDtcbnZhciBzb2NrZXRVUkw7XG52YXIgc29ja2V0O1xudmFyIHBpZDtcbnZhciB0ZXJtaW5hbENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGVybWluYWwtY29udGFpbmVyXCIpO1xudmFyIGFjdGlvbkVsZW1lbnRzID0ge1xuICAgIGZpbmROZXh0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2ZpbmQtbmV4dFwiKSxcbiAgICBmaW5kUHJldmlvdXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZmluZC1wcmV2aW91c1wiKVxufTtcbnZhciBwYWRkaW5nRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFkZGluZ1wiKTtcbmZ1bmN0aW9uIHNldFBhZGRpbmcoKSB7XG4gICAgdGVybS5lbGVtZW50LnN0eWxlLnBhZGRpbmcgPVxuICAgICAgICBwYXJzZUludChwYWRkaW5nRWxlbWVudC52YWx1ZSwgMTApLnRvU3RyaW5nKCkgKyBcInB4XCI7XG4gICAgdGVybS5maXQoKTtcbn1cbmNyZWF0ZVRlcm1pbmFsKCk7XG52YXIgZGlzcG9zZVJlY3JlYXRlQnV0dG9uSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGVybSkge1xuICAgICAgICB0ZXJtLmRpc3Bvc2UoKTtcbiAgICAgICAgdGVybSA9IG51bGw7XG4gICAgICAgIHdpbmRvdy50ZXJtID0gbnVsbDtcbiAgICAgICAgc29ja2V0ID0gbnVsbDtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXNwb3NlXCIpLmlubmVySFRNTCA9IFwiUmVjcmVhdGUgVGVybWluYWxcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNyZWF0ZVRlcm1pbmFsKCk7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGlzcG9zZVwiKS5pbm5lckhUTUwgPSBcIkRpc3Bvc2UgdGVybWluYWxcIjtcbiAgICB9XG59O1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXNwb3NlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBkaXNwb3NlUmVjcmVhdGVCdXR0b25IYW5kbGVyKTtcbmZ1bmN0aW9uIGNyZWF0ZVRlcm1pbmFsKCkge1xuICAgIHdoaWxlICh0ZXJtaW5hbENvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgdGVybWluYWxDb250YWluZXIucmVtb3ZlQ2hpbGQodGVybWluYWxDb250YWluZXIuY2hpbGRyZW5bMF0pO1xuICAgIH1cbiAgICB0ZXJtID0gbmV3IFRlcm1pbmFsX2pzXzEuVGVybWluYWwoe30pO1xuICAgIHdpbmRvdy50ZXJtID0gdGVybTtcbiAgICB0ZXJtLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgIGlmICghcGlkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbHMgPSBzaXplLmNvbHM7XG4gICAgICAgIHZhciByb3dzID0gc2l6ZS5yb3dzO1xuICAgICAgICB2YXIgdXJsID0gXCIvdGVybWluYWxzL1wiICsgcGlkICsgXCIvc2l6ZT9jb2xzPVwiICsgY29scyArIFwiJnJvd3M9XCIgKyByb3dzO1xuICAgICAgICBmZXRjaCh1cmwsIHsgbWV0aG9kOiBcIlBPU1RcIiB9KTtcbiAgICB9KTtcbiAgICBwcm90b2NvbCA9IGxvY2F0aW9uLnByb3RvY29sID09PSBcImh0dHBzOlwiID8gXCJ3c3M6Ly9cIiA6IFwid3M6Ly9cIjtcbiAgICBzb2NrZXRVUkwgPSBwcm90b2NvbCArIGxvY2F0aW9uLmhvc3RuYW1lICtcbiAgICAgICAgKGxvY2F0aW9uLnBvcnQgPyBcIjpcIiArIGxvY2F0aW9uLnBvcnQgOiBcIlwiKSArIFwiL3Rlcm1pbmFscy9cIjtcbiAgICB0ZXJtLm9wZW4odGVybWluYWxDb250YWluZXIpO1xuICAgIHRlcm0ud2lucHR5Q29tcGF0SW5pdCgpO1xuICAgIHRlcm0ud2ViTGlua3NJbml0KCk7XG4gICAgdGVybS5maXQoKTtcbiAgICB0ZXJtLmZvY3VzKCk7XG4gICAgYWRkRG9tTGlzdGVuZXIocGFkZGluZ0VsZW1lbnQsIFwiY2hhbmdlXCIsIHNldFBhZGRpbmcpO1xuICAgIGFkZERvbUxpc3RlbmVyKGFjdGlvbkVsZW1lbnRzLmZpbmROZXh0LCBcImtleXByZXNzXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB2YXIgc2VhcmNoT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICByZWdleDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZWdleFwiKS5jaGVja2VkLFxuICAgICAgICAgICAgICAgIHdob2xlV29yZDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3aG9sZS13b3JkXCIpLmNoZWNrZWQsXG4gICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYXNlLXNlbnNpdGl2ZVwiKVxuICAgICAgICAgICAgICAgICAgICAuY2hlY2tlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRlcm0uZmluZE5leHQoYWN0aW9uRWxlbWVudHMuZmluZE5leHQudmFsdWUsIHNlYXJjaE9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgYWRkRG9tTGlzdGVuZXIoYWN0aW9uRWxlbWVudHMuZmluZFByZXZpb3VzLCBcImtleXByZXNzXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB2YXIgc2VhcmNoT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICByZWdleDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZWdleFwiKS5jaGVja2VkLFxuICAgICAgICAgICAgICAgIHdob2xlV29yZDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3aG9sZS13b3JkXCIpLmNoZWNrZWQsXG4gICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYXNlLXNlbnNpdGl2ZVwiKVxuICAgICAgICAgICAgICAgICAgICAuY2hlY2tlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRlcm0uZmluZFByZXZpb3VzKGFjdGlvbkVsZW1lbnRzLmZpbmRQcmV2aW91cy52YWx1ZSwgc2VhcmNoT3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaW5pdE9wdGlvbnModGVybSk7XG4gICAgICAgIHBhZGRpbmdFbGVtZW50LnZhbHVlID0gXCIwXCI7XG4gICAgICAgIHVwZGF0ZVRlcm1pbmFsU2l6ZSgpO1xuICAgICAgICBmZXRjaChcIi90ZXJtaW5hbHM/Y29scz1cIiArIHRlcm0uY29scyArIFwiJnJvd3M9XCIgKyB0ZXJtLnJvd3MsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXMudGV4dCgpLnRoZW4oZnVuY3Rpb24gKHByb2Nlc3NJZCkge1xuICAgICAgICAgICAgICAgIHBpZCA9IHByb2Nlc3NJZDtcbiAgICAgICAgICAgICAgICBzb2NrZXRVUkwgKz0gcHJvY2Vzc0lkO1xuICAgICAgICAgICAgICAgIHNvY2tldCA9IG5ldyBXZWJTb2NrZXQoc29ja2V0VVJMKTtcbiAgICAgICAgICAgICAgICBzb2NrZXQub25vcGVuID0gcnVuUmVhbFRlcm1pbmFsO1xuICAgICAgICAgICAgICAgIHNvY2tldC5vbmNsb3NlID0gcnVuRmFrZVRlcm1pbmFsO1xuICAgICAgICAgICAgICAgIHNvY2tldC5vbmVycm9yID0gcnVuRmFrZVRlcm1pbmFsO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sIDApO1xufVxuZnVuY3Rpb24gcnVuUmVhbFRlcm1pbmFsKCkge1xuICAgIHRlcm0uYXR0YWNoKHNvY2tldCk7XG4gICAgdGVybS5faW5pdGlhbGl6ZWQgPSB0cnVlO1xufVxuZnVuY3Rpb24gcnVuRmFrZVRlcm1pbmFsKCkge1xuICAgIGlmICh0ZXJtLl9pbml0aWFsaXplZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRlcm0uX2luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB0ZXJtLnByb21wdCA9IGZ1bmN0aW9uICgpIHsgdGVybS53cml0ZShcIlxcclxcbiQgXCIpOyB9O1xuICAgIHRlcm0ud3JpdGVsbihcIldlbGNvbWUgdG8geHRlcm0uanNcIik7XG4gICAgdGVybS53cml0ZWxuKFwiVGhpcyBpcyBhIGxvY2FsIHRlcm1pbmFsIGVtdWxhdGlvbiwgd2l0aG91dCBhIHJlYWwgdGVybWluYWwgaW4gdGhlIGJhY2stZW5kLlwiKTtcbiAgICB0ZXJtLndyaXRlbG4oXCJUeXBlIHNvbWUga2V5cyBhbmQgY29tbWFuZHMgdG8gcGxheSBhcm91bmQuXCIpO1xuICAgIHRlcm0ud3JpdGVsbihcIlwiKTtcbiAgICB0ZXJtLnByb21wdCgpO1xuICAgIHRlcm0uX2NvcmUucmVnaXN0ZXIodGVybS5hZGREaXNwb3NhYmxlTGlzdGVuZXIoXCJrZXlcIiwgZnVuY3Rpb24gKGtleSwgZXYpIHtcbiAgICAgICAgdmFyIHByaW50YWJsZSA9ICFldi5hbHRLZXkgJiYgIWV2LmFsdEdyYXBoS2V5ICYmICFldi5jdHJsS2V5ICYmICFldi5tZXRhS2V5O1xuICAgICAgICBpZiAoZXYua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgICAgIHRlcm0ucHJvbXB0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gOCkge1xuICAgICAgICAgICAgLy8gRG8gbm90IGRlbGV0ZSBwcm9tcHRcbiAgICAgICAgICAgIGlmICh0ZXJtLnggPiAyKSB7XG4gICAgICAgICAgICAgICAgdGVybS53cml0ZShcIlxcYiBcXGJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocHJpbnRhYmxlKSB7XG4gICAgICAgICAgICB0ZXJtLndyaXRlKGtleSk7XG4gICAgICAgIH1cbiAgICB9KSk7XG4gICAgdGVybS5fY29yZS5yZWdpc3Rlcih0ZXJtLmFkZERpc3Bvc2FibGVMaXN0ZW5lcihcInBhc3RlXCIsIGZ1bmN0aW9uIChkYXRhLCBldikgeyB0ZXJtLndyaXRlKGRhdGEpOyB9KSk7XG59XG5mdW5jdGlvbiBpbml0T3B0aW9ucyh0ZXJtKSB7XG4gICAgdmFyIGJsYWNrbGlzdGVkT3B0aW9ucyA9IFtcbiAgICAgICAgLy8gSW50ZXJuYWwgb25seSBvcHRpb25zXG4gICAgICAgIFwiY2FuY2VsRXZlbnRzXCIsIFwiY29udmVydEVvbFwiLCBcImRlYnVnXCIsIFwiaGFuZGxlclwiLCBcInNjcmVlbktleXNcIiwgXCJ0ZXJtTmFtZVwiLFxuICAgICAgICBcInVzZUZsb3dDb250cm9sXCIsIFwidGhlbWVcIlxuICAgIF07XG4gICAgdmFyIHN0cmluZ09wdGlvbnMgPSB7XG4gICAgICAgIGJlbGxTb3VuZDogbnVsbCxcbiAgICAgICAgYmVsbFN0eXBlOiBbXCJub25lXCIsIFwic291bmRcIl0sXG4gICAgICAgIGN1cnNvclN0eWxlOiBbXCJibG9ja1wiLCBcInVuZGVybGluZVwiLCBcImJhclwiXSxcbiAgICAgICAgZXhwZXJpbWVudGFsQ2hhckF0bGFzOiBbXCJub25lXCIsIFwic3RhdGljXCIsIFwiZHluYW1pY1wiXSxcbiAgICAgICAgZm9udEZhbWlseTogbnVsbCxcbiAgICAgICAgZm9udFdlaWdodDogW1xuICAgICAgICAgICAgXCJub3JtYWxcIiwgXCJib2xkXCIsIFwiMTAwXCIsIFwiMjAwXCIsIFwiMzAwXCIsIFwiNDAwXCIsIFwiNTAwXCIsIFwiNjAwXCIsIFwiNzAwXCIsIFwiODAwXCIsXG4gICAgICAgICAgICBcIjkwMFwiXG4gICAgICAgIF0sXG4gICAgICAgIGZvbnRXZWlnaHRCb2xkOiBbXG4gICAgICAgICAgICBcIm5vcm1hbFwiLCBcImJvbGRcIiwgXCIxMDBcIiwgXCIyMDBcIiwgXCIzMDBcIiwgXCI0MDBcIiwgXCI1MDBcIiwgXCI2MDBcIiwgXCI3MDBcIiwgXCI4MDBcIixcbiAgICAgICAgICAgIFwiOTAwXCJcbiAgICAgICAgXSxcbiAgICAgICAgcmVuZGVyZXJUeXBlOiBbXCJkb21cIiwgXCJjYW52YXNcIl0sXG4gICAgICAgIGV4cGVyaW1lbnRhbEJ1ZmZlckxpbmVJbWw6IFtcIkpzQXJyYXlcIiwgXCJUeXBlZEFycmF5XCJdXG4gICAgfTtcbiAgICB2YXIgb3B0aW9ucyA9IE9iamVjdC5rZXlzKHRlcm0uX2NvcmUub3B0aW9ucyk7XG4gICAgdmFyIGJvb2xlYW5PcHRpb25zID0gW107XG4gICAgdmFyIG51bWJlck9wdGlvbnMgPSBbXTtcbiAgICBvcHRpb25zLmZpbHRlcihmdW5jdGlvbiAobykgeyByZXR1cm4gYmxhY2tsaXN0ZWRPcHRpb25zLmluZGV4T2YobykgPT09IC0xOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHN3aXRjaCAodHlwZW9mIHRlcm0uZ2V0T3B0aW9uKG8pKSB7XG4gICAgICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICAgICAgICAgIGJvb2xlYW5PcHRpb25zLnB1c2gobyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICAgICAgbnVtYmVyT3B0aW9ucy5wdXNoKG8pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoc3RyaW5nT3B0aW9ucykuaW5kZXhPZihvKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiVW5yZWNvZ25pemVkIG9wdGlvbjogJ1wiICsgbyArIFwiJ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgaHRtbCA9IFwiXCI7XG4gICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cIm9wdGlvbi1ncm91cFwiPic7XG4gICAgYm9vbGVhbk9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobykge1xuICAgICAgICBodG1sICs9IFwiPGRpdiBjbGFzcz1cXFwib3B0aW9uXFxcIj48bGFiZWw+PGlucHV0IGlkPVxcXCJvcHQtXCIgKyBvICsgXCJcXFwiIHR5cGU9XFxcImNoZWNrYm94XFxcIiBcIiArICh0ZXJtLmdldE9wdGlvbihvKSA/IFwiY2hlY2tlZFwiIDogXCJcIikgKyBcIi8+IFwiICsgbyArIFwiPC9sYWJlbD48L2Rpdj5cIjtcbiAgICB9KTtcbiAgICBodG1sICs9ICc8L2Rpdj48ZGl2IGNsYXNzPVwib3B0aW4tZ3JvdXBcIj4nO1xuICAgIG51bWJlck9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobykge1xuICAgICAgICBodG1sICs9IFwiPGRpdiBjbGFzcz1cXFwib3B0aW9uXFxcIj48bGFiZWw+XCIgKyBvICsgXCIgPGlucHV0IGlkPVxcXCJvcHQtXCIgKyBvICsgXCJcXFwiIHR5cGU9XFxcIm51bWJlclxcXCIgdmFsdWU9XFxcIlwiICsgdGVybS5nZXRPcHRpb24obykgKyBcIlxcXCIvPjwvbGFiZWw+PC9kaXY+XCI7XG4gICAgfSk7XG4gICAgaHRtbCArPSAnPC9kaXY+PGRpdiBjbGFzcz1cIm9wdGlvbi1ncm91cFwiPic7XG4gICAgT2JqZWN0LmtleXMoc3RyaW5nT3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAobykge1xuICAgICAgICBpZiAoc3RyaW5nT3B0aW9uc1tvXSkge1xuICAgICAgICAgICAgaHRtbCArPSBcIjxkaXYgY2xhc3M9XFxcIm9wdGlvblxcXCI+PGxhYmVsPlwiICsgbyArIFwiIDxzZWxlY3QgaWQ9XFxcIm9wdC1cIiArIG8gKyBcIlxcXCI+XCIgKyBzdHJpbmdPcHRpb25zW29dXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gXCI8b3B0aW9uIFwiICsgKHRlcm0uZ2V0T3B0aW9uKG8pID09PSB2ID8gXCJzZWxlY3RlZFwiIDogXCJcIikgKyBcIj5cIiArIHYgKyBcIjwvb3B0aW9uPlwiOyB9KVxuICAgICAgICAgICAgICAgIC5qb2luKFwiXCIpICsgXCI8L3NlbGVjdD48L2xhYmVsPjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaHRtbCArPSBcIjxkaXYgY2xhc3M9XFxcIm9wdGlvblxcXCI+PGxhYmVsPlwiICsgbyArIFwiIDxpbnB1dCBpZD1cXFwib3B0LVwiICsgbyArIFwiXFxcIiB0eXBlPVxcXCJ0ZXh0XFxcIiB2YWx1ZT1cXFwiXCIgKyB0ZXJtLmdldE9wdGlvbihvKSArIFwiXFxcIi8+PC9sYWJlbD48L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGh0bWwgKz0gXCI8L2Rpdj5cIjtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvcHRpb25zLWNvbnRhaW5lclwiKTtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAvLyBBdHRhY2ggbGlzdGVuZXJzXG4gICAgYm9vbGVhbk9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobykge1xuICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm9wdC1cIiArIG8pO1xuICAgICAgICBhZGREb21MaXN0ZW5lcihpbnB1dCwgXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjaGFuZ2VcIiwgbywgaW5wdXQuY2hlY2tlZCk7XG4gICAgICAgICAgICB0ZXJtLnNldE9wdGlvbihvLCBpbnB1dC5jaGVja2VkKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgbnVtYmVyT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3B0LVwiICsgbyk7XG4gICAgICAgIGFkZERvbUxpc3RlbmVyKGlucHV0LCBcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNoYW5nZVwiLCBvLCBpbnB1dC52YWx1ZSk7XG4gICAgICAgICAgICBpZiAobyA9PT0gXCJjb2xzXCIgfHwgbyA9PT0gXCJyb3dzXCIpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVUZXJtaW5hbFNpemUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRlcm0uc2V0T3B0aW9uKG8sIHBhcnNlSW50KGlucHV0LnZhbHVlLCAxMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBPYmplY3Qua2V5cyhzdHJpbmdPcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3B0LVwiICsgbyk7XG4gICAgICAgIGFkZERvbUxpc3RlbmVyKGlucHV0LCBcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNoYW5nZVwiLCBvLCBpbnB1dC52YWx1ZSk7XG4gICAgICAgICAgICB0ZXJtLnNldE9wdGlvbihvLCBpbnB1dC52YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gYWRkRG9tTGlzdGVuZXIoZWxlbWVudCwgdHlwZSwgaGFuZGxlcikge1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyKTtcbiAgICB0ZXJtLl9jb3JlLnJlZ2lzdGVyKHsgZGlzcG9zZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpOyB9IH0pO1xufVxuZnVuY3Rpb24gdXBkYXRlVGVybWluYWxTaXplKCkge1xuICAgIHZhciBjb2xzID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvcHQtY29sc1wiKS52YWx1ZSwgMTApO1xuICAgIHZhciByb3dzID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvcHQtcm93c1wiKS52YWx1ZSwgMTApO1xuICAgIHZhciB3aWR0aCA9IChjb2xzICogdGVybS5fY29yZS5yZW5kZXJlci5kaW1lbnNpb25zLmFjdHVhbENlbGxXaWR0aCArXG4gICAgICAgIHRlcm0uX2NvcmUudmlld3BvcnQuc2Nyb2xsQmFyV2lkdGgpXG4gICAgICAgIC50b1N0cmluZygpICtcbiAgICAgICAgXCJweFwiO1xuICAgIHZhciBoZWlnaHQgPSAocm93cyAqIHRlcm0uX2NvcmUucmVuZGVyZXIuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0KS50b1N0cmluZygpICtcbiAgICAgICAgXCJweFwiO1xuICAgIHRlcm1pbmFsQ29udGFpbmVyLnN0eWxlLndpZHRoID0gd2lkdGg7XG4gICAgdGVybWluYWxDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIHRlcm0uZml0KCk7XG59XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgU3RyaW5ncyA9IHJlcXVpcmUoXCIuL1N0cmluZ3NcIik7XG52YXIgUGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuL2NvcmUvUGxhdGZvcm1cIik7XG52YXIgUmVuZGVyRGVib3VuY2VyXzEgPSByZXF1aXJlKFwiLi91aS9SZW5kZXJEZWJvdW5jZXJcIik7XG52YXIgTGlmZWN5Y2xlXzEgPSByZXF1aXJlKFwiLi91aS9MaWZlY3ljbGVcIik7XG52YXIgTGlmZWN5Y2xlXzIgPSByZXF1aXJlKFwiLi9jb21tb24vTGlmZWN5Y2xlXCIpO1xudmFyIE1BWF9ST1dTX1RPX1JFQUQgPSAyMDtcbnZhciBBY2Nlc3NpYmlsaXR5TWFuYWdlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFjY2Vzc2liaWxpdHlNYW5hZ2VyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEFjY2Vzc2liaWxpdHlNYW5hZ2VyKF90ZXJtaW5hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uTGluZUNvdW50ID0gMDtcbiAgICAgICAgX3RoaXMuX2NoYXJzVG9Db25zdW1lID0gW107XG4gICAgICAgIF90aGlzLl9hY2Nlc3NpYmlsaXR5VHJlZVJvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgX3RoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdC5jbGFzc0xpc3QuYWRkKCd4dGVybS1hY2Nlc3NpYmlsaXR5Jyk7XG4gICAgICAgIF90aGlzLl9yb3dDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgX3RoaXMuX3Jvd0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCd4dGVybS1hY2Nlc3NpYmlsaXR5LXRyZWUnKTtcbiAgICAgICAgX3RoaXMuX3Jvd0VsZW1lbnRzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXMuX3Rlcm1pbmFsLnJvd3M7IGkrKykge1xuICAgICAgICAgICAgX3RoaXMuX3Jvd0VsZW1lbnRzW2ldID0gX3RoaXMuX2NyZWF0ZUFjY2Vzc2liaWxpdHlUcmVlTm9kZSgpO1xuICAgICAgICAgICAgX3RoaXMuX3Jvd0NvbnRhaW5lci5hcHBlbmRDaGlsZChfdGhpcy5fcm93RWxlbWVudHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIF90aGlzLl90b3BCb3VuZGFyeUZvY3VzTGlzdGVuZXIgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX29uQm91bmRhcnlGb2N1cyhlLCAwKTsgfTtcbiAgICAgICAgX3RoaXMuX2JvdHRvbUJvdW5kYXJ5Rm9jdXNMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25Cb3VuZGFyeUZvY3VzKGUsIDEpOyB9O1xuICAgICAgICBfdGhpcy5fcm93RWxlbWVudHNbMF0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBfdGhpcy5fdG9wQm91bmRhcnlGb2N1c0xpc3RlbmVyKTtcbiAgICAgICAgX3RoaXMuX3Jvd0VsZW1lbnRzW190aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggLSAxXS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIF90aGlzLl9ib3R0b21Cb3VuZGFyeUZvY3VzTGlzdGVuZXIpO1xuICAgICAgICBfdGhpcy5fcmVmcmVzaFJvd3NEaW1lbnNpb25zKCk7XG4gICAgICAgIF90aGlzLl9hY2Nlc3NpYmlsaXR5VHJlZVJvb3QuYXBwZW5kQ2hpbGQoX3RoaXMuX3Jvd0NvbnRhaW5lcik7XG4gICAgICAgIF90aGlzLl9yZW5kZXJSb3dzRGVib3VuY2VyID0gbmV3IFJlbmRlckRlYm91bmNlcl8xLlJlbmRlckRlYm91bmNlcihfdGhpcy5fdGVybWluYWwsIF90aGlzLl9yZW5kZXJSb3dzLmJpbmQoX3RoaXMpKTtcbiAgICAgICAgX3RoaXMuX3JlZnJlc2hSb3dzKCk7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uLmNsYXNzTGlzdC5hZGQoJ2xpdmUtcmVnaW9uJyk7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uLnNldEF0dHJpYnV0ZSgnYXJpYS1saXZlJywgJ2Fzc2VydGl2ZScpO1xuICAgICAgICBfdGhpcy5fYWNjZXNzaWJpbGl0eVRyZWVSb290LmFwcGVuZENoaWxkKF90aGlzLl9saXZlUmVnaW9uKTtcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgX3RoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdCk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl9yZW5kZXJSb3dzRGVib3VuY2VyKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLmFkZERpc3Bvc2FibGVMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF90aGlzLl9vblJlc2l6ZShkYXRhLnJvd3MpOyB9KSk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl90ZXJtaW5hbC5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ3JlZnJlc2gnLCBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gX3RoaXMuX3JlZnJlc2hSb3dzKGRhdGEuc3RhcnQsIGRhdGEuZW5kKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdzY3JvbGwnLCBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gX3RoaXMuX3JlZnJlc2hSb3dzKCk7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignYTExeS5jaGFyJywgZnVuY3Rpb24gKGNoYXIpIHsgcmV0dXJuIF90aGlzLl9vbkNoYXIoY2hhcik7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignbGluZWZlZWQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fb25DaGFyKCdcXG4nKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdhMTF5LnRhYicsIGZ1bmN0aW9uIChzcGFjZUNvdW50KSB7IHJldHVybiBfdGhpcy5fb25UYWIoc3BhY2VDb3VudCk7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLmFkZERpc3Bvc2FibGVMaXN0ZW5lcigna2V5JywgZnVuY3Rpb24gKGtleUNoYXIpIHsgcmV0dXJuIF90aGlzLl9vbktleShrZXlDaGFyKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2NsZWFyTGl2ZVJlZ2lvbigpOyB9KSk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl90ZXJtaW5hbC5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ2RwcmNoYW5nZScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoUm93c0RpbWVuc2lvbnMoKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwucmVuZGVyZXIuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fcmVmcmVzaFJvd3NEaW1lbnNpb25zKCk7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoUm93c0RpbWVuc2lvbnMoKTsgfSkpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLl9hY2Nlc3NpYmlsaXR5VHJlZVJvb3QpO1xuICAgICAgICB0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggPSAwO1xuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9vbkJvdW5kYXJ5Rm9jdXMgPSBmdW5jdGlvbiAoZSwgcG9zaXRpb24pIHtcbiAgICAgICAgdmFyIGJvdW5kYXJ5RWxlbWVudCA9IGUudGFyZ2V0O1xuICAgICAgICB2YXIgYmVmb3JlQm91bmRhcnlFbGVtZW50ID0gdGhpcy5fcm93RWxlbWVudHNbcG9zaXRpb24gPT09IDAgPyAxIDogdGhpcy5fcm93RWxlbWVudHMubGVuZ3RoIC0gMl07XG4gICAgICAgIHZhciBwb3NJblNldCA9IGJvdW5kYXJ5RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtcG9zaW5zZXQnKTtcbiAgICAgICAgdmFyIGxhc3RSb3dQb3MgPSBwb3NpdGlvbiA9PT0gMCA/ICcxJyA6IFwiXCIgKyB0aGlzLl90ZXJtaW5hbC5idWZmZXIubGluZXMubGVuZ3RoO1xuICAgICAgICBpZiAocG9zSW5TZXQgPT09IGxhc3RSb3dQb3MpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZS5yZWxhdGVkVGFyZ2V0ICE9PSBiZWZvcmVCb3VuZGFyeUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG9wQm91bmRhcnlFbGVtZW50O1xuICAgICAgICB2YXIgYm90dG9tQm91bmRhcnlFbGVtZW50O1xuICAgICAgICBpZiAocG9zaXRpb24gPT09IDApIHtcbiAgICAgICAgICAgIHRvcEJvdW5kYXJ5RWxlbWVudCA9IGJvdW5kYXJ5RWxlbWVudDtcbiAgICAgICAgICAgIGJvdHRvbUJvdW5kYXJ5RWxlbWVudCA9IHRoaXMuX3Jvd0VsZW1lbnRzLnBvcCgpO1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLnJlbW92ZUNoaWxkKGJvdHRvbUJvdW5kYXJ5RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b3BCb3VuZGFyeUVsZW1lbnQgPSB0aGlzLl9yb3dFbGVtZW50cy5zaGlmdCgpO1xuICAgICAgICAgICAgYm90dG9tQm91bmRhcnlFbGVtZW50ID0gYm91bmRhcnlFbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLnJlbW92ZUNoaWxkKHRvcEJvdW5kYXJ5RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdG9wQm91bmRhcnlFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fdG9wQm91bmRhcnlGb2N1c0xpc3RlbmVyKTtcbiAgICAgICAgYm90dG9tQm91bmRhcnlFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fYm90dG9tQm91bmRhcnlGb2N1c0xpc3RlbmVyKTtcbiAgICAgICAgaWYgKHBvc2l0aW9uID09PSAwKSB7XG4gICAgICAgICAgICB2YXIgbmV3RWxlbWVudCA9IHRoaXMuX2NyZWF0ZUFjY2Vzc2liaWxpdHlUcmVlTm9kZSgpO1xuICAgICAgICAgICAgdGhpcy5fcm93RWxlbWVudHMudW5zaGlmdChuZXdFbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuX3Jvd0NvbnRhaW5lci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBuZXdFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBuZXdFbGVtZW50ID0gdGhpcy5fY3JlYXRlQWNjZXNzaWJpbGl0eVRyZWVOb2RlKCk7XG4gICAgICAgICAgICB0aGlzLl9yb3dFbGVtZW50cy5wdXNoKG5ld0VsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLmFwcGVuZENoaWxkKG5ld0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fdG9wQm91bmRhcnlGb2N1c0xpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fcm93RWxlbWVudHNbdGhpcy5fcm93RWxlbWVudHMubGVuZ3RoIC0gMV0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9ib3R0b21Cb3VuZGFyeUZvY3VzTGlzdGVuZXIpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zY3JvbGxMaW5lcyhwb3NpdGlvbiA9PT0gMCA/IC0xIDogMSk7XG4gICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzW3Bvc2l0aW9uID09PSAwID8gMSA6IHRoaXMuX3Jvd0VsZW1lbnRzLmxlbmd0aCAtIDJdLmZvY3VzKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5fb25SZXNpemUgPSBmdW5jdGlvbiAocm93cykge1xuICAgICAgICB0aGlzLl9yb3dFbGVtZW50c1t0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggLSAxXS5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX2JvdHRvbUJvdW5kYXJ5Rm9jdXNMaXN0ZW5lcik7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl9yb3dDb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgdGhpcy5fdGVybWluYWwucm93czsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9yb3dFbGVtZW50c1tpXSA9IHRoaXMuX2NyZWF0ZUFjY2Vzc2liaWxpdHlUcmVlTm9kZSgpO1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX3Jvd0VsZW1lbnRzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAodGhpcy5fcm93RWxlbWVudHMubGVuZ3RoID4gcm93cykge1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuX3Jvd0VsZW1lbnRzLnBvcCgpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yb3dFbGVtZW50c1t0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggLSAxXS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX2JvdHRvbUJvdW5kYXJ5Rm9jdXNMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hSb3dzRGltZW5zaW9ucygpO1xuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9jcmVhdGVBY2Nlc3NpYmlsaXR5VHJlZU5vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpc3RpdGVtJyk7XG4gICAgICAgIGVsZW1lbnQudGFiSW5kZXggPSAtMTtcbiAgICAgICAgdGhpcy5fcmVmcmVzaFJvd0RpbWVuc2lvbnMoZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9vblRhYiA9IGZ1bmN0aW9uIChzcGFjZUNvdW50KSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhY2VDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9vbkNoYXIoJyAnKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9vbkNoYXIgPSBmdW5jdGlvbiAoY2hhcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5fbGl2ZVJlZ2lvbkxpbmVDb3VudCA8IE1BWF9ST1dTX1RPX1JFQUQgKyAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY2hhcnNUb0NvbnN1bWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBzaGlmdGVkQ2hhciA9IHRoaXMuX2NoYXJzVG9Db25zdW1lLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHNoaWZ0ZWRDaGFyICE9PSBjaGFyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Fubm91bmNlQ2hhcmFjdGVyKGNoYXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fubm91bmNlQ2hhcmFjdGVyKGNoYXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoYXIgPT09ICdcXG4nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGl2ZVJlZ2lvbkxpbmVDb3VudCsrO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9saXZlUmVnaW9uTGluZUNvdW50ID09PSBNQVhfUk9XU19UT19SRUFEICsgMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9saXZlUmVnaW9uLnRleHRDb250ZW50ICs9IFN0cmluZ3MudG9vTXVjaE91dHB1dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoUGxhdGZvcm1fMS5pc01hYykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9saXZlUmVnaW9uLnRleHRDb250ZW50ICYmIHRoaXMuX2xpdmVSZWdpb24udGV4dENvbnRlbnQubGVuZ3RoID4gMCAmJiAhdGhpcy5fbGl2ZVJlZ2lvbi5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdC5hcHBlbmRDaGlsZChfdGhpcy5fbGl2ZVJlZ2lvbik7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9jbGVhckxpdmVSZWdpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2xpdmVSZWdpb24udGV4dENvbnRlbnQgPSAnJztcbiAgICAgICAgdGhpcy5fbGl2ZVJlZ2lvbkxpbmVDb3VudCA9IDA7XG4gICAgICAgIGlmIChQbGF0Zm9ybV8xLmlzTWFjKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fbGl2ZVJlZ2lvbi5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWNjZXNzaWJpbGl0eVRyZWVSb290LnJlbW92ZUNoaWxkKHRoaXMuX2xpdmVSZWdpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX29uS2V5ID0gZnVuY3Rpb24gKGtleUNoYXIpIHtcbiAgICAgICAgdGhpcy5fY2xlYXJMaXZlUmVnaW9uKCk7XG4gICAgICAgIHRoaXMuX2NoYXJzVG9Db25zdW1lLnB1c2goa2V5Q2hhcik7XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX3JlZnJlc2hSb3dzID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyUm93c0RlYm91bmNlci5yZWZyZXNoKHN0YXJ0LCBlbmQpO1xuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9yZW5kZXJSb3dzID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgdmFyIHNldFNpemUgPSBidWZmZXIubGluZXMubGVuZ3RoLnRvU3RyaW5nKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykge1xuICAgICAgICAgICAgdmFyIGxpbmVEYXRhID0gYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhidWZmZXIueWRpc3AgKyBpLCB0cnVlKTtcbiAgICAgICAgICAgIHZhciBwb3NJblNldCA9IChidWZmZXIueWRpc3AgKyBpICsgMSkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5fcm93RWxlbWVudHNbaV07XG4gICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gbGluZURhdGEubGVuZ3RoID09PSAwID8gU3RyaW5ncy5ibGFua0xpbmUgOiBsaW5lRGF0YTtcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLXBvc2luc2V0JywgcG9zSW5TZXQpO1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2V0c2l6ZScsIHNldFNpemUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX3JlZnJlc2hSb3dzRGltZW5zaW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90ZXJtaW5hbC5yZW5kZXJlci5kaW1lbnNpb25zLmFjdHVhbENlbGxIZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcm93RWxlbWVudHMubGVuZ3RoICE9PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl9vblJlc2l6ZSh0aGlzLl90ZXJtaW5hbC5yb3dzKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3Rlcm1pbmFsLnJvd3M7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFJvd0RpbWVuc2lvbnModGhpcy5fcm93RWxlbWVudHNbaV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX3JlZnJlc2hSb3dEaW1lbnNpb25zID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLl90ZXJtaW5hbC5yZW5kZXJlci5kaW1lbnNpb25zLmFjdHVhbENlbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX2Fubm91bmNlQ2hhcmFjdGVyID0gZnVuY3Rpb24gKGNoYXIpIHtcbiAgICAgICAgaWYgKGNoYXIgPT09ICcgJykge1xuICAgICAgICAgICAgdGhpcy5fbGl2ZVJlZ2lvbi5pbm5lckhUTUwgKz0gJyZuYnNwOyc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9saXZlUmVnaW9uLnRleHRDb250ZW50ICs9IGNoYXI7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBBY2Nlc3NpYmlsaXR5TWFuYWdlcjtcbn0oTGlmZWN5Y2xlXzIuRGlzcG9zYWJsZSkpO1xuZXhwb3J0cy5BY2Nlc3NpYmlsaXR5TWFuYWdlciA9IEFjY2Vzc2liaWxpdHlNYW5hZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QWNjZXNzaWJpbGl0eU1hbmFnZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIENpcmN1bGFyTGlzdF8xID0gcmVxdWlyZShcIi4vY29tbW9uL0NpcmN1bGFyTGlzdFwiKTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXJcIik7XG52YXIgQnVmZmVyTGluZV8xID0gcmVxdWlyZShcIi4vQnVmZmVyTGluZVwiKTtcbnZhciBUeXBlc18xID0gcmVxdWlyZShcIi4vcmVuZGVyZXIvYXRsYXMvVHlwZXNcIik7XG5leHBvcnRzLkRFRkFVTFRfQVRUUiA9ICgwIDw8IDE4KSB8IChUeXBlc18xLkRFRkFVTFRfQ09MT1IgPDwgOSkgfCAoMjU2IDw8IDApO1xuZXhwb3J0cy5DSEFSX0RBVEFfQVRUUl9JTkRFWCA9IDA7XG5leHBvcnRzLkNIQVJfREFUQV9DSEFSX0lOREVYID0gMTtcbmV4cG9ydHMuQ0hBUl9EQVRBX1dJRFRIX0lOREVYID0gMjtcbmV4cG9ydHMuQ0hBUl9EQVRBX0NPREVfSU5ERVggPSAzO1xuZXhwb3J0cy5NQVhfQlVGRkVSX1NJWkUgPSA0Mjk0OTY3Mjk1O1xuZXhwb3J0cy5OVUxMX0NFTExfQ0hBUiA9ICcgJztcbmV4cG9ydHMuTlVMTF9DRUxMX1dJRFRIID0gMTtcbmV4cG9ydHMuTlVMTF9DRUxMX0NPREUgPSAzMjtcbnZhciBCdWZmZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJ1ZmZlcihfdGVybWluYWwsIF9oYXNTY3JvbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9oYXNTY3JvbGxiYWNrID0gX2hhc1Njcm9sbGJhY2s7XG4gICAgICAgIHRoaXMubWFya2VycyA9IFtdO1xuICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgfVxuICAgIEJ1ZmZlci5wcm90b3R5cGUuc2V0QnVmZmVyTGluZUZhY3RvcnkgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICBpZiAodHlwZSA9PT0gJ0pzQXJyYXknKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fYnVmZmVyTGluZUNvbnN0cnVjdG9yICE9PSBCdWZmZXJMaW5lXzEuQnVmZmVyTGluZUpTQXJyYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWZmZXJMaW5lQ29uc3RydWN0b3IgPSBCdWZmZXJMaW5lXzEuQnVmZmVyTGluZUpTQXJyYXk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVjcmVhdGVMaW5lcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2J1ZmZlckxpbmVDb25zdHJ1Y3RvciAhPT0gQnVmZmVyTGluZV8xLkJ1ZmZlckxpbmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWZmZXJMaW5lQ29uc3RydWN0b3IgPSBCdWZmZXJMaW5lXzEuQnVmZmVyTGluZTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWNyZWF0ZUxpbmVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuX3JlY3JlYXRlTGluZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5saW5lcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgb2xkTGluZSA9IHRoaXMubGluZXMuZ2V0KGkpO1xuICAgICAgICAgICAgdmFyIG5ld0xpbmUgPSBuZXcgdGhpcy5fYnVmZmVyTGluZUNvbnN0cnVjdG9yKG9sZExpbmUubGVuZ3RoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2xkTGluZS5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgIG5ld0xpbmUuc2V0KGosIG9sZExpbmUuZ2V0KGopKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubGluZXMuc2V0KGksIG5ld0xpbmUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmdldEJsYW5rTGluZSA9IGZ1bmN0aW9uIChhdHRyLCBpc1dyYXBwZWQpIHtcbiAgICAgICAgdmFyIGZpbGxDaGFyRGF0YSA9IFthdHRyLCBleHBvcnRzLk5VTExfQ0VMTF9DSEFSLCBleHBvcnRzLk5VTExfQ0VMTF9XSURUSCwgZXhwb3J0cy5OVUxMX0NFTExfQ09ERV07XG4gICAgICAgIHJldHVybiBuZXcgdGhpcy5fYnVmZmVyTGluZUNvbnN0cnVjdG9yKHRoaXMuX3Rlcm1pbmFsLmNvbHMsIGZpbGxDaGFyRGF0YSwgaXNXcmFwcGVkKTtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXIucHJvdG90eXBlLCBcImhhc1Njcm9sbGJhY2tcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNTY3JvbGxiYWNrICYmIHRoaXMubGluZXMubWF4TGVuZ3RoID4gdGhpcy5fdGVybWluYWwucm93cztcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlci5wcm90b3R5cGUsIFwiaXNDdXJzb3JJblZpZXdwb3J0XCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYWJzb2x1dGVZID0gdGhpcy55YmFzZSArIHRoaXMueTtcbiAgICAgICAgICAgIHZhciByZWxhdGl2ZVkgPSBhYnNvbHV0ZVkgLSB0aGlzLnlkaXNwO1xuICAgICAgICAgICAgcmV0dXJuIChyZWxhdGl2ZVkgPj0gMCAmJiByZWxhdGl2ZVkgPCB0aGlzLl90ZXJtaW5hbC5yb3dzKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgQnVmZmVyLnByb3RvdHlwZS5fZ2V0Q29ycmVjdEJ1ZmZlckxlbmd0aCA9IGZ1bmN0aW9uIChyb3dzKSB7XG4gICAgICAgIGlmICghdGhpcy5faGFzU2Nyb2xsYmFjaykge1xuICAgICAgICAgICAgcmV0dXJuIHJvd3M7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvcnJlY3RCdWZmZXJMZW5ndGggPSByb3dzICsgdGhpcy5fdGVybWluYWwub3B0aW9ucy5zY3JvbGxiYWNrO1xuICAgICAgICByZXR1cm4gY29ycmVjdEJ1ZmZlckxlbmd0aCA+IGV4cG9ydHMuTUFYX0JVRkZFUl9TSVpFID8gZXhwb3J0cy5NQVhfQlVGRkVSX1NJWkUgOiBjb3JyZWN0QnVmZmVyTGVuZ3RoO1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5maWxsVmlld3BvcnRSb3dzID0gZnVuY3Rpb24gKGZpbGxBdHRyKSB7XG4gICAgICAgIGlmICh0aGlzLmxpbmVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKGZpbGxBdHRyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBmaWxsQXR0ciA9IGV4cG9ydHMuREVGQVVMVF9BVFRSO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl90ZXJtaW5hbC5yb3dzO1xuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGluZXMucHVzaCh0aGlzLmdldEJsYW5rTGluZShmaWxsQXR0cikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNldEJ1ZmZlckxpbmVGYWN0b3J5KHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuZXhwZXJpbWVudGFsQnVmZmVyTGluZUltcGwpO1xuICAgICAgICB0aGlzLnlkaXNwID0gMDtcbiAgICAgICAgdGhpcy55YmFzZSA9IDA7XG4gICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIHRoaXMubGluZXMgPSBuZXcgQ2lyY3VsYXJMaXN0XzEuQ2lyY3VsYXJMaXN0KHRoaXMuX2dldENvcnJlY3RCdWZmZXJMZW5ndGgodGhpcy5fdGVybWluYWwucm93cykpO1xuICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIHRoaXMuc2Nyb2xsQm90dG9tID0gdGhpcy5fdGVybWluYWwucm93cyAtIDE7XG4gICAgICAgIHRoaXMuc2V0dXBUYWJTdG9wcygpO1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAobmV3Q29scywgbmV3Um93cykge1xuICAgICAgICB2YXIgbmV3TWF4TGVuZ3RoID0gdGhpcy5fZ2V0Q29ycmVjdEJ1ZmZlckxlbmd0aChuZXdSb3dzKTtcbiAgICAgICAgaWYgKG5ld01heExlbmd0aCA+IHRoaXMubGluZXMubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmxpbmVzLm1heExlbmd0aCA9IG5ld01heExlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5saW5lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuY29scyA8IG5ld0NvbHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2ggPSBbZXhwb3J0cy5ERUZBVUxUX0FUVFIsIGV4cG9ydHMuTlVMTF9DRUxMX0NIQVIsIGV4cG9ydHMuTlVMTF9DRUxMX1dJRFRILCBleHBvcnRzLk5VTExfQ0VMTF9DT0RFXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lcy5nZXQoaSkucmVzaXplKG5ld0NvbHMsIGNoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYWRkVG9ZID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5yb3dzIDwgbmV3Um93cykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHkgPSB0aGlzLl90ZXJtaW5hbC5yb3dzOyB5IDwgbmV3Um93czsgeSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxpbmVzLmxlbmd0aCA8IG5ld1Jvd3MgKyB0aGlzLnliYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy55YmFzZSA+IDAgJiYgdGhpcy5saW5lcy5sZW5ndGggPD0gdGhpcy55YmFzZSArIHRoaXMueSArIGFkZFRvWSArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnliYXNlLS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9ZKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueWRpc3AgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueWRpc3AtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsbENoYXJEYXRhID0gW2V4cG9ydHMuREVGQVVMVF9BVFRSLCBleHBvcnRzLk5VTExfQ0VMTF9DSEFSLCBleHBvcnRzLk5VTExfQ0VMTF9XSURUSCwgZXhwb3J0cy5OVUxMX0NFTExfQ09ERV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lcy5wdXNoKG5ldyB0aGlzLl9idWZmZXJMaW5lQ29uc3RydWN0b3IobmV3Q29scywgZmlsbENoYXJEYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gdGhpcy5fdGVybWluYWwucm93czsgeSA+IG5ld1Jvd3M7IHktLSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5saW5lcy5sZW5ndGggPiBuZXdSb3dzICsgdGhpcy55YmFzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubGluZXMubGVuZ3RoID4gdGhpcy55YmFzZSArIHRoaXMueSArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55YmFzZSsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueWRpc3ArKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChuZXdNYXhMZW5ndGggPCB0aGlzLmxpbmVzLm1heExlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhciBhbW91bnRUb1RyaW0gPSB0aGlzLmxpbmVzLmxlbmd0aCAtIG5ld01heExlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoYW1vdW50VG9UcmltID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLnRyaW1TdGFydChhbW91bnRUb1RyaW0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnliYXNlID0gTWF0aC5tYXgodGhpcy55YmFzZSAtIGFtb3VudFRvVHJpbSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueWRpc3AgPSBNYXRoLm1heCh0aGlzLnlkaXNwIC0gYW1vdW50VG9UcmltLCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5saW5lcy5tYXhMZW5ndGggPSBuZXdNYXhMZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnggPSBNYXRoLm1pbih0aGlzLngsIG5ld0NvbHMgLSAxKTtcbiAgICAgICAgICAgIHRoaXMueSA9IE1hdGgubWluKHRoaXMueSwgbmV3Um93cyAtIDEpO1xuICAgICAgICAgICAgaWYgKGFkZFRvWSkge1xuICAgICAgICAgICAgICAgIHRoaXMueSArPSBhZGRUb1k7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNhdmVkWSA9IE1hdGgubWluKHRoaXMuc2F2ZWRZLCBuZXdSb3dzIC0gMSk7XG4gICAgICAgICAgICB0aGlzLnNhdmVkWCA9IE1hdGgubWluKHRoaXMuc2F2ZWRYLCBuZXdDb2xzIC0gMSk7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zY3JvbGxCb3R0b20gPSBuZXdSb3dzIC0gMTtcbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuc3RyaW5nSW5kZXhUb0J1ZmZlckluZGV4ID0gZnVuY3Rpb24gKGxpbmVJbmRleCwgc3RyaW5nSW5kZXgpIHtcbiAgICAgICAgd2hpbGUgKHN0cmluZ0luZGV4KSB7XG4gICAgICAgICAgICB2YXIgbGluZSA9IHRoaXMubGluZXMuZ2V0KGxpbmVJbmRleCk7XG4gICAgICAgICAgICBpZiAoIWxpbmUpIHtcbiAgICAgICAgICAgICAgICBbLTEsIC0xXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHN0cmluZ0luZGV4IC09IGxpbmUuZ2V0KGkpW2V4cG9ydHMuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoc3RyaW5nSW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbbGluZUluZGV4LCBpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaW5lSW5kZXgrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW2xpbmVJbmRleCwgMF07XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyA9IGZ1bmN0aW9uIChsaW5lSW5kZXgsIHRyaW1SaWdodCwgc3RhcnRDb2wsIGVuZENvbCkge1xuICAgICAgICBpZiAoc3RhcnRDb2wgPT09IHZvaWQgMCkgeyBzdGFydENvbCA9IDA7IH1cbiAgICAgICAgaWYgKGVuZENvbCA9PT0gdm9pZCAwKSB7IGVuZENvbCA9IG51bGw7IH1cbiAgICAgICAgdmFyIGxpbmVTdHJpbmcgPSAnJztcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmxpbmVzLmdldChsaW5lSW5kZXgpO1xuICAgICAgICBpZiAoIWxpbmUpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICB2YXIgc3RhcnRJbmRleCA9IHN0YXJ0Q29sO1xuICAgICAgICBpZiAoZW5kQ29sID09PSBudWxsKSB7XG4gICAgICAgICAgICBlbmRDb2wgPSBsaW5lLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZW5kSW5kZXggPSBlbmRDb2w7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGNoYXIgPSBsaW5lLmdldChpKTtcbiAgICAgICAgICAgIGxpbmVTdHJpbmcgKz0gY2hhcltleHBvcnRzLkNIQVJfREFUQV9DSEFSX0lOREVYXTtcbiAgICAgICAgICAgIGlmIChjaGFyW2V4cG9ydHMuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChzdGFydENvbCA+PSBpKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXgtLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVuZENvbCA+IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5kSW5kZXgtLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcltleHBvcnRzLkNIQVJfREFUQV9DSEFSX0lOREVYXS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydENvbCA+IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXggKz0gY2hhcltleHBvcnRzLkNIQVJfREFUQV9DSEFSX0lOREVYXS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmRDb2wgPiBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRJbmRleCArPSBjaGFyW2V4cG9ydHMuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRyaW1SaWdodCkge1xuICAgICAgICAgICAgdmFyIHJpZ2h0V2hpdGVzcGFjZUluZGV4ID0gbGluZVN0cmluZy5zZWFyY2goL1xccyskLyk7XG4gICAgICAgICAgICBpZiAocmlnaHRXaGl0ZXNwYWNlSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgZW5kSW5kZXggPSBNYXRoLm1pbihlbmRJbmRleCwgcmlnaHRXaGl0ZXNwYWNlSW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVuZEluZGV4IDw9IHN0YXJ0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmVTdHJpbmcuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuZ2V0V3JhcHBlZFJhbmdlRm9yTGluZSA9IGZ1bmN0aW9uICh5KSB7XG4gICAgICAgIHZhciBmaXJzdCA9IHk7XG4gICAgICAgIHZhciBsYXN0ID0geTtcbiAgICAgICAgd2hpbGUgKGZpcnN0ID4gMCAmJiB0aGlzLmxpbmVzLmdldChmaXJzdCkuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICBmaXJzdC0tO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChsYXN0ICsgMSA8IHRoaXMubGluZXMubGVuZ3RoICYmIHRoaXMubGluZXMuZ2V0KGxhc3QgKyAxKS5pc1dyYXBwZWQpIHtcbiAgICAgICAgICAgIGxhc3QrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBmaXJzdDogZmlyc3QsIGxhc3Q6IGxhc3QgfTtcbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuc2V0dXBUYWJTdG9wcyA9IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIGlmIChpICE9PSBudWxsICYmIGkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnRhYnNbaV0pIHtcbiAgICAgICAgICAgICAgICBpID0gdGhpcy5wcmV2U3RvcChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGFicyA9IHt9O1xuICAgICAgICAgICAgaSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICg7IGkgPCB0aGlzLl90ZXJtaW5hbC5jb2xzOyBpICs9IHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMudGFiU3RvcFdpZHRoKSB7XG4gICAgICAgICAgICB0aGlzLnRhYnNbaV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLnByZXZTdG9wID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgaWYgKHggPT09IG51bGwgfHwgeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB4ID0gdGhpcy54O1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlICghdGhpcy50YWJzWy0teF0gJiYgeCA+IDApXG4gICAgICAgICAgICA7XG4gICAgICAgIHJldHVybiB4ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMgPyB0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMSA6IHggPCAwID8gMCA6IHg7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLm5leHRTdG9wID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgaWYgKHggPT09IG51bGwgfHwgeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB4ID0gdGhpcy54O1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlICghdGhpcy50YWJzWysreF0gJiYgeCA8IHRoaXMuX3Rlcm1pbmFsLmNvbHMpXG4gICAgICAgICAgICA7XG4gICAgICAgIHJldHVybiB4ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMgPyB0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMSA6IHggPCAwID8gMCA6IHg7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmFkZE1hcmtlciA9IGZ1bmN0aW9uICh5KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtYXJrZXIgPSBuZXcgTWFya2VyKHkpO1xuICAgICAgICB0aGlzLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICAgICAgICBtYXJrZXIucmVnaXN0ZXIodGhpcy5saW5lcy5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ3RyaW0nLCBmdW5jdGlvbiAoYW1vdW50KSB7XG4gICAgICAgICAgICBtYXJrZXIubGluZSAtPSBhbW91bnQ7XG4gICAgICAgICAgICBpZiAobWFya2VyLmxpbmUgPCAwKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICBtYXJrZXIucmVnaXN0ZXIobWFya2VyLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignZGlzcG9zZScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZW1vdmVNYXJrZXIobWFya2VyKTsgfSkpO1xuICAgICAgICByZXR1cm4gbWFya2VyO1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5fcmVtb3ZlTWFya2VyID0gZnVuY3Rpb24gKG1hcmtlcikge1xuICAgICAgICB0aGlzLm1hcmtlcnMuc3BsaWNlKHRoaXMubWFya2Vycy5pbmRleE9mKG1hcmtlciksIDEpO1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5pdGVyYXRvciA9IGZ1bmN0aW9uICh0cmltUmlnaHQsIHN0YXJ0SW5kZXgsIGVuZEluZGV4LCBzdGFydE92ZXJzY2FuLCBlbmRPdmVyc2Nhbikge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlclN0cmluZ0l0ZXJhdG9yKHRoaXMsIHRyaW1SaWdodCwgc3RhcnRJbmRleCwgZW5kSW5kZXgsIHN0YXJ0T3ZlcnNjYW4sIGVuZE92ZXJzY2FuKTtcbiAgICB9O1xuICAgIHJldHVybiBCdWZmZXI7XG59KCkpO1xuZXhwb3J0cy5CdWZmZXIgPSBCdWZmZXI7XG52YXIgTWFya2VyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWFya2VyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE1hcmtlcihsaW5lKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmxpbmUgPSBsaW5lO1xuICAgICAgICBfdGhpcy5faWQgPSBNYXJrZXIuX25leHRJZCsrO1xuICAgICAgICBfdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hcmtlci5wcm90b3R5cGUsIFwiaWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2lkOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBNYXJrZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGlzcG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmVtaXQoJ2Rpc3Bvc2UnKTtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgfTtcbiAgICBNYXJrZXIuX25leHRJZCA9IDE7XG4gICAgcmV0dXJuIE1hcmtlcjtcbn0oRXZlbnRFbWl0dGVyXzEuRXZlbnRFbWl0dGVyKSk7XG5leHBvcnRzLk1hcmtlciA9IE1hcmtlcjtcbnZhciBCdWZmZXJTdHJpbmdJdGVyYXRvciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnVmZmVyU3RyaW5nSXRlcmF0b3IoX2J1ZmZlciwgX3RyaW1SaWdodCwgX3N0YXJ0SW5kZXgsIF9lbmRJbmRleCwgX3N0YXJ0T3ZlcnNjYW4sIF9lbmRPdmVyc2Nhbikge1xuICAgICAgICBpZiAoX3N0YXJ0SW5kZXggPT09IHZvaWQgMCkgeyBfc3RhcnRJbmRleCA9IDA7IH1cbiAgICAgICAgaWYgKF9lbmRJbmRleCA9PT0gdm9pZCAwKSB7IF9lbmRJbmRleCA9IF9idWZmZXIubGluZXMubGVuZ3RoOyB9XG4gICAgICAgIGlmIChfc3RhcnRPdmVyc2NhbiA9PT0gdm9pZCAwKSB7IF9zdGFydE92ZXJzY2FuID0gMDsgfVxuICAgICAgICBpZiAoX2VuZE92ZXJzY2FuID09PSB2b2lkIDApIHsgX2VuZE92ZXJzY2FuID0gMDsgfVxuICAgICAgICB0aGlzLl9idWZmZXIgPSBfYnVmZmVyO1xuICAgICAgICB0aGlzLl90cmltUmlnaHQgPSBfdHJpbVJpZ2h0O1xuICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gX3N0YXJ0SW5kZXg7XG4gICAgICAgIHRoaXMuX2VuZEluZGV4ID0gX2VuZEluZGV4O1xuICAgICAgICB0aGlzLl9zdGFydE92ZXJzY2FuID0gX3N0YXJ0T3ZlcnNjYW47XG4gICAgICAgIHRoaXMuX2VuZE92ZXJzY2FuID0gX2VuZE92ZXJzY2FuO1xuICAgICAgICBpZiAodGhpcy5fc3RhcnRJbmRleCA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9lbmRJbmRleCA+IHRoaXMuX2J1ZmZlci5saW5lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2VuZEluZGV4ID0gdGhpcy5fYnVmZmVyLmxpbmVzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fc3RhcnRJbmRleDtcbiAgICB9XG4gICAgQnVmZmVyU3RyaW5nSXRlcmF0b3IucHJvdG90eXBlLmhhc05leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50IDwgdGhpcy5fZW5kSW5kZXg7XG4gICAgfTtcbiAgICBCdWZmZXJTdHJpbmdJdGVyYXRvci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJhbmdlID0gdGhpcy5fYnVmZmVyLmdldFdyYXBwZWRSYW5nZUZvckxpbmUodGhpcy5fY3VycmVudCk7XG4gICAgICAgIGlmIChyYW5nZS5maXJzdCA8IHRoaXMuX3N0YXJ0SW5kZXggLSB0aGlzLl9zdGFydE92ZXJzY2FuKSB7XG4gICAgICAgICAgICByYW5nZS5maXJzdCA9IHRoaXMuX3N0YXJ0SW5kZXggLSB0aGlzLl9zdGFydE92ZXJzY2FuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyYW5nZS5sYXN0ID4gdGhpcy5fZW5kSW5kZXggKyB0aGlzLl9lbmRPdmVyc2Nhbikge1xuICAgICAgICAgICAgcmFuZ2UubGFzdCA9IHRoaXMuX2VuZEluZGV4ICsgdGhpcy5fZW5kT3ZlcnNjYW47XG4gICAgICAgIH1cbiAgICAgICAgcmFuZ2UuZmlyc3QgPSBNYXRoLm1heChyYW5nZS5maXJzdCwgMCk7XG4gICAgICAgIHJhbmdlLmxhc3QgPSBNYXRoLm1pbihyYW5nZS5sYXN0LCB0aGlzLl9idWZmZXIubGluZXMubGVuZ3RoKTtcbiAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xuICAgICAgICBmb3IgKHZhciBpID0gcmFuZ2UuZmlyc3Q7IGkgPD0gcmFuZ2UubGFzdDsgKytpKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5fYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhpLCAodGhpcy5fdHJpbVJpZ2h0KSA/IGkgPT09IHJhbmdlLmxhc3QgOiBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3VycmVudCA9IHJhbmdlLmxhc3QgKyAxO1xuICAgICAgICByZXR1cm4geyByYW5nZTogcmFuZ2UsIGNvbnRlbnQ6IHJlc3VsdCB9O1xuICAgIH07XG4gICAgcmV0dXJuIEJ1ZmZlclN0cmluZ0l0ZXJhdG9yO1xufSgpKTtcbmV4cG9ydHMuQnVmZmVyU3RyaW5nSXRlcmF0b3IgPSBCdWZmZXJTdHJpbmdJdGVyYXRvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUJ1ZmZlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBCdWZmZXJfMSA9IHJlcXVpcmUoXCIuL0J1ZmZlclwiKTtcbnZhciBCdWZmZXJMaW5lSlNBcnJheSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnVmZmVyTGluZUpTQXJyYXkoY29scywgZmlsbENoYXJEYXRhLCBpc1dyYXBwZWQpIHtcbiAgICAgICAgdGhpcy5pc1dyYXBwZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fZGF0YSA9IFtdO1xuICAgICAgICBpZiAoIWZpbGxDaGFyRGF0YSkge1xuICAgICAgICAgICAgZmlsbENoYXJEYXRhID0gWzAsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DSEFSLCBCdWZmZXJfMS5OVUxMX0NFTExfV0lEVEgsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DT0RFXTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbHM7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5fcHVzaChmaWxsQ2hhckRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1dyYXBwZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaXNXcmFwcGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuX2RhdGEubGVuZ3RoO1xuICAgIH1cbiAgICBCdWZmZXJMaW5lSlNBcnJheS5wcm90b3R5cGUuX3BvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhLnBvcCgpO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuX2RhdGEubGVuZ3RoO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmVKU0FycmF5LnByb3RvdHlwZS5fcHVzaCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuX2RhdGEucHVzaChkYXRhKTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLl9kYXRhLmxlbmd0aDtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmVKU0FycmF5LnByb3RvdHlwZS5fc3BsaWNlID0gZnVuY3Rpb24gKHN0YXJ0LCBkZWxldGVDb3VudCkge1xuICAgICAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGl0ZW1zW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdmFyIHJlbW92ZWQgPSAoX2EgPSB0aGlzLl9kYXRhKS5zcGxpY2UuYXBwbHkoX2EsIFtzdGFydCwgZGVsZXRlQ291bnRdLmNvbmNhdChpdGVtcykpO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuX2RhdGEubGVuZ3RoO1xuICAgICAgICByZXR1cm4gcmVtb3ZlZDtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmVKU0FycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFbaW5kZXhdO1xuICAgIH07XG4gICAgQnVmZmVyTGluZUpTQXJyYXkucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChpbmRleCwgZGF0YSkge1xuICAgICAgICB0aGlzLl9kYXRhW2luZGV4XSA9IGRhdGE7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lSlNBcnJheS5wcm90b3R5cGUuaW5zZXJ0Q2VsbHMgPSBmdW5jdGlvbiAocG9zLCBuLCBjaCkge1xuICAgICAgICB3aGlsZSAobi0tKSB7XG4gICAgICAgICAgICB0aGlzLl9zcGxpY2UocG9zLCAwLCBjaCk7XG4gICAgICAgICAgICB0aGlzLl9wb3AoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZUpTQXJyYXkucHJvdG90eXBlLmRlbGV0ZUNlbGxzID0gZnVuY3Rpb24gKHBvcywgbiwgZmlsbENoYXJEYXRhKSB7XG4gICAgICAgIHdoaWxlIChuLS0pIHtcbiAgICAgICAgICAgIHRoaXMuX3NwbGljZShwb3MsIDEpO1xuICAgICAgICAgICAgdGhpcy5fcHVzaChmaWxsQ2hhckRhdGEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lSlNBcnJheS5wcm90b3R5cGUucmVwbGFjZUNlbGxzID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIGZpbGxDaGFyRGF0YSkge1xuICAgICAgICB3aGlsZSAoc3RhcnQgPCBlbmQgJiYgc3RhcnQgPCB0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5zZXQoc3RhcnQrKywgZmlsbENoYXJEYXRhKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZUpTQXJyYXkucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uIChjb2xzLCBmaWxsQ2hhckRhdGEsIHNocmluaykge1xuICAgICAgICBpZiAoc2hyaW5rID09PSB2b2lkIDApIHsgc2hyaW5rID0gZmFsc2U7IH1cbiAgICAgICAgd2hpbGUgKHRoaXMuX2RhdGEubGVuZ3RoIDwgY29scykge1xuICAgICAgICAgICAgdGhpcy5fZGF0YS5wdXNoKGZpbGxDaGFyRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNocmluaykge1xuICAgICAgICAgICAgd2hpbGUgKHRoaXMuX2RhdGEubGVuZ3RoID4gY29scykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEucG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLl9kYXRhLmxlbmd0aDtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmVKU0FycmF5LnByb3RvdHlwZS5maWxsID0gZnVuY3Rpb24gKGZpbGxDaGFyRGF0YSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KGksIGZpbGxDaGFyRGF0YSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJ1ZmZlckxpbmVKU0FycmF5LnByb3RvdHlwZS5jb3B5RnJvbSA9IGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICAgIHRoaXMuX2RhdGEgPSBsaW5lLl9kYXRhLnNsaWNlKDApO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxpbmUubGVuZ3RoO1xuICAgICAgICB0aGlzLmlzV3JhcHBlZCA9IGxpbmUuaXNXcmFwcGVkO1xuICAgIH07XG4gICAgQnVmZmVyTGluZUpTQXJyYXkucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbmV3TGluZSA9IG5ldyBCdWZmZXJMaW5lSlNBcnJheSgwKTtcbiAgICAgICAgbmV3TGluZS5jb3B5RnJvbSh0aGlzKTtcbiAgICAgICAgcmV0dXJuIG5ld0xpbmU7XG4gICAgfTtcbiAgICByZXR1cm4gQnVmZmVyTGluZUpTQXJyYXk7XG59KCkpO1xuZXhwb3J0cy5CdWZmZXJMaW5lSlNBcnJheSA9IEJ1ZmZlckxpbmVKU0FycmF5O1xudmFyIENFTExfU0laRSA9IDM7XG52YXIgQnVmZmVyTGluZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnVmZmVyTGluZShjb2xzLCBmaWxsQ2hhckRhdGEsIGlzV3JhcHBlZCkge1xuICAgICAgICBpZiAoaXNXcmFwcGVkID09PSB2b2lkIDApIHsgaXNXcmFwcGVkID0gZmFsc2U7IH1cbiAgICAgICAgdGhpcy5pc1dyYXBwZWQgPSBpc1dyYXBwZWQ7XG4gICAgICAgIHRoaXMuX2RhdGEgPSBudWxsO1xuICAgICAgICB0aGlzLl9jb21iaW5lZCA9IHt9O1xuICAgICAgICBpZiAoIWZpbGxDaGFyRGF0YSkge1xuICAgICAgICAgICAgZmlsbENoYXJEYXRhID0gWzAsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DSEFSLCBCdWZmZXJfMS5OVUxMX0NFTExfV0lEVEgsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DT0RFXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29scykge1xuICAgICAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyBVaW50MzJBcnJheShjb2xzICogQ0VMTF9TSVpFKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29sczsgKytpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoaSwgZmlsbENoYXJEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxlbmd0aCA9IGNvbHM7XG4gICAgfVxuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICB2YXIgc3RyaW5nRGF0YSA9IHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAxXTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXSxcbiAgICAgICAgICAgIChzdHJpbmdEYXRhICYgMHg4MDAwMDAwMClcbiAgICAgICAgICAgICAgICA/IHRoaXMuX2NvbWJpbmVkW2luZGV4XVxuICAgICAgICAgICAgICAgIDogKHN0cmluZ0RhdGEpID8gU3RyaW5nLmZyb21DaGFyQ29kZShzdHJpbmdEYXRhKSA6ICcnLFxuICAgICAgICAgICAgdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDJdLFxuICAgICAgICAgICAgKHN0cmluZ0RhdGEgJiAweDgwMDAwMDAwKVxuICAgICAgICAgICAgICAgID8gdGhpcy5fY29tYmluZWRbaW5kZXhdLmNoYXJDb2RlQXQodGhpcy5fY29tYmluZWRbaW5kZXhdLmxlbmd0aCAtIDEpXG4gICAgICAgICAgICAgICAgOiBzdHJpbmdEYXRhXG4gICAgICAgIF07XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXSA9IHZhbHVlWzBdO1xuICAgICAgICBpZiAodmFsdWVbMV0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhpcy5fY29tYmluZWRbaW5kZXhdID0gdmFsdWVbMV07XG4gICAgICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMV0gPSBpbmRleCB8IDB4ODAwMDAwMDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMV0gPSB2YWx1ZVsxXS5jaGFyQ29kZUF0KDApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAyXSA9IHZhbHVlWzJdO1xuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuaW5zZXJ0Q2VsbHMgPSBmdW5jdGlvbiAocG9zLCBuLCBmaWxsQ2hhckRhdGEpIHtcbiAgICAgICAgcG9zICU9IHRoaXMubGVuZ3RoO1xuICAgICAgICBpZiAobiA8IHRoaXMubGVuZ3RoIC0gcG9zKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5sZW5ndGggLSBwb3MgLSBuIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChwb3MgKyBuICsgaSwgdGhpcy5nZXQocG9zICsgaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChwb3MgKyBpLCBmaWxsQ2hhckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHBvczsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChpLCBmaWxsQ2hhckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5kZWxldGVDZWxscyA9IGZ1bmN0aW9uIChwb3MsIG4sIGZpbGxDaGFyRGF0YSkge1xuICAgICAgICBwb3MgJT0gdGhpcy5sZW5ndGg7XG4gICAgICAgIGlmIChuIDwgdGhpcy5sZW5ndGggLSBwb3MpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGggLSBwb3MgLSBuOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChwb3MgKyBpLCB0aGlzLmdldChwb3MgKyBuICsgaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMubGVuZ3RoIC0gbjsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChpLCBmaWxsQ2hhckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHBvczsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChpLCBmaWxsQ2hhckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5yZXBsYWNlQ2VsbHMgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgZmlsbENoYXJEYXRhKSB7XG4gICAgICAgIHdoaWxlIChzdGFydCA8IGVuZCAmJiBzdGFydCA8IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNldChzdGFydCsrLCBmaWxsQ2hhckRhdGEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAoY29scywgZmlsbENoYXJEYXRhLCBzaHJpbmspIHtcbiAgICAgICAgaWYgKHNocmluayA9PT0gdm9pZCAwKSB7IHNocmluayA9IGZhbHNlOyB9XG4gICAgICAgIGlmIChjb2xzID09PSB0aGlzLmxlbmd0aCB8fCAoIXNocmluayAmJiBjb2xzIDwgdGhpcy5sZW5ndGgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbHMgPiB0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBuZXcgVWludDMyQXJyYXkoY29scyAqIENFTExfU0laRSk7XG4gICAgICAgICAgICBpZiAodGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29scyAqIENFTExfU0laRSA8IHRoaXMuX2RhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2V0KHRoaXMuX2RhdGEuc3ViYXJyYXkoMCwgY29scyAqIENFTExfU0laRSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zZXQodGhpcy5fZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5sZW5ndGg7IGkgPCBjb2xzOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChpLCBmaWxsQ2hhckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNocmluaykge1xuICAgICAgICAgICAgaWYgKGNvbHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBVaW50MzJBcnJheShjb2xzICogQ0VMTF9TSVpFKTtcbiAgICAgICAgICAgICAgICBkYXRhLnNldCh0aGlzLl9kYXRhLnN1YmFycmF5KDAsIGNvbHMgKiBDRUxMX1NJWkUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGVuZ3RoID0gY29scztcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbiAoZmlsbENoYXJEYXRhKSB7XG4gICAgICAgIHRoaXMuX2NvbWJpbmVkID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5zZXQoaSwgZmlsbENoYXJEYXRhKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuY29weUZyb20gPSBmdW5jdGlvbiAobGluZSkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggIT09IGxpbmUubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9kYXRhID0gbmV3IFVpbnQzMkFycmF5KGxpbmUuX2RhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fZGF0YS5zZXQobGluZS5fZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sZW5ndGggPSBsaW5lLmxlbmd0aDtcbiAgICAgICAgdGhpcy5fY29tYmluZWQgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgZWwgaW4gbGluZS5fY29tYmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbWJpbmVkW2VsXSA9IGxpbmUuX2NvbWJpbmVkW2VsXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzV3JhcHBlZCA9IGxpbmUuaXNXcmFwcGVkO1xuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBuZXdMaW5lID0gbmV3IEJ1ZmZlckxpbmUoMCk7XG4gICAgICAgIG5ld0xpbmUuX2RhdGEgPSBuZXcgVWludDMyQXJyYXkodGhpcy5fZGF0YSk7XG4gICAgICAgIG5ld0xpbmUubGVuZ3RoID0gdGhpcy5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGVsIGluIHRoaXMuX2NvbWJpbmVkKSB7XG4gICAgICAgICAgICBuZXdMaW5lLl9jb21iaW5lZFtlbF0gPSB0aGlzLl9jb21iaW5lZFtlbF07XG4gICAgICAgIH1cbiAgICAgICAgbmV3TGluZS5pc1dyYXBwZWQgPSB0aGlzLmlzV3JhcHBlZDtcbiAgICAgICAgcmV0dXJuIG5ld0xpbmU7XG4gICAgfTtcbiAgICByZXR1cm4gQnVmZmVyTGluZTtcbn0oKSk7XG5leHBvcnRzLkJ1ZmZlckxpbmUgPSBCdWZmZXJMaW5lO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QnVmZmVyTGluZS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQnVmZmVyXzEgPSByZXF1aXJlKFwiLi9CdWZmZXJcIik7XG52YXIgRXZlbnRFbWl0dGVyXzEgPSByZXF1aXJlKFwiLi9jb21tb24vRXZlbnRFbWl0dGVyXCIpO1xudmFyIEJ1ZmZlclNldCA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEJ1ZmZlclNldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBCdWZmZXJTZXQoX3Rlcm1pbmFsKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgX3RoaXMuX25vcm1hbCA9IG5ldyBCdWZmZXJfMS5CdWZmZXIoX3RoaXMuX3Rlcm1pbmFsLCB0cnVlKTtcbiAgICAgICAgX3RoaXMuX25vcm1hbC5maWxsVmlld3BvcnRSb3dzKCk7XG4gICAgICAgIF90aGlzLl9hbHQgPSBuZXcgQnVmZmVyXzEuQnVmZmVyKF90aGlzLl90ZXJtaW5hbCwgZmFsc2UpO1xuICAgICAgICBfdGhpcy5fYWN0aXZlQnVmZmVyID0gX3RoaXMuX25vcm1hbDtcbiAgICAgICAgX3RoaXMuc2V0dXBUYWJTdG9wcygpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXJTZXQucHJvdG90eXBlLCBcImFsdFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsdDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlclNldC5wcm90b3R5cGUsIFwiYWN0aXZlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlQnVmZmVyO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyU2V0LnByb3RvdHlwZSwgXCJub3JtYWxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ub3JtYWw7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIEJ1ZmZlclNldC5wcm90b3R5cGUuYWN0aXZhdGVOb3JtYWxCdWZmZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVCdWZmZXIgPT09IHRoaXMuX25vcm1hbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX25vcm1hbC54ID0gdGhpcy5fYWx0Lng7XG4gICAgICAgIHRoaXMuX25vcm1hbC55ID0gdGhpcy5fYWx0Lnk7XG4gICAgICAgIHRoaXMuX2FsdC5jbGVhcigpO1xuICAgICAgICB0aGlzLl9hY3RpdmVCdWZmZXIgPSB0aGlzLl9ub3JtYWw7XG4gICAgICAgIHRoaXMuZW1pdCgnYWN0aXZhdGUnLCB7XG4gICAgICAgICAgICBhY3RpdmVCdWZmZXI6IHRoaXMuX25vcm1hbCxcbiAgICAgICAgICAgIGluYWN0aXZlQnVmZmVyOiB0aGlzLl9hbHRcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBCdWZmZXJTZXQucHJvdG90eXBlLmFjdGl2YXRlQWx0QnVmZmVyID0gZnVuY3Rpb24gKGZpbGxBdHRyKSB7XG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVCdWZmZXIgPT09IHRoaXMuX2FsdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FsdC5maWxsVmlld3BvcnRSb3dzKGZpbGxBdHRyKTtcbiAgICAgICAgdGhpcy5fYWx0LnggPSB0aGlzLl9ub3JtYWwueDtcbiAgICAgICAgdGhpcy5fYWx0LnkgPSB0aGlzLl9ub3JtYWwueTtcbiAgICAgICAgdGhpcy5fYWN0aXZlQnVmZmVyID0gdGhpcy5fYWx0O1xuICAgICAgICB0aGlzLmVtaXQoJ2FjdGl2YXRlJywge1xuICAgICAgICAgICAgYWN0aXZlQnVmZmVyOiB0aGlzLl9hbHQsXG4gICAgICAgICAgICBpbmFjdGl2ZUJ1ZmZlcjogdGhpcy5fbm9ybWFsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQnVmZmVyU2V0LnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAobmV3Q29scywgbmV3Um93cykge1xuICAgICAgICB0aGlzLl9ub3JtYWwucmVzaXplKG5ld0NvbHMsIG5ld1Jvd3MpO1xuICAgICAgICB0aGlzLl9hbHQucmVzaXplKG5ld0NvbHMsIG5ld1Jvd3MpO1xuICAgIH07XG4gICAgQnVmZmVyU2V0LnByb3RvdHlwZS5zZXR1cFRhYlN0b3BzID0gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgdGhpcy5fbm9ybWFsLnNldHVwVGFiU3RvcHMoaSk7XG4gICAgICAgIHRoaXMuX2FsdC5zZXR1cFRhYlN0b3BzKGkpO1xuICAgIH07XG4gICAgcmV0dXJuIEJ1ZmZlclNldDtcbn0oRXZlbnRFbWl0dGVyXzEuRXZlbnRFbWl0dGVyKSk7XG5leHBvcnRzLkJ1ZmZlclNldCA9IEJ1ZmZlclNldDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUJ1ZmZlclNldC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBUeXBlZEFycmF5VXRpbHNfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9UeXBlZEFycmF5VXRpbHNcIik7XG5leHBvcnRzLndjd2lkdGggPSAoZnVuY3Rpb24gKG9wdHMpIHtcbiAgICB2YXIgQ09NQklOSU5HX0JNUCA9IFtcbiAgICAgICAgWzB4MDMwMCwgMHgwMzZGXSwgWzB4MDQ4MywgMHgwNDg2XSwgWzB4MDQ4OCwgMHgwNDg5XSxcbiAgICAgICAgWzB4MDU5MSwgMHgwNUJEXSwgWzB4MDVCRiwgMHgwNUJGXSwgWzB4MDVDMSwgMHgwNUMyXSxcbiAgICAgICAgWzB4MDVDNCwgMHgwNUM1XSwgWzB4MDVDNywgMHgwNUM3XSwgWzB4MDYwMCwgMHgwNjAzXSxcbiAgICAgICAgWzB4MDYxMCwgMHgwNjE1XSwgWzB4MDY0QiwgMHgwNjVFXSwgWzB4MDY3MCwgMHgwNjcwXSxcbiAgICAgICAgWzB4MDZENiwgMHgwNkU0XSwgWzB4MDZFNywgMHgwNkU4XSwgWzB4MDZFQSwgMHgwNkVEXSxcbiAgICAgICAgWzB4MDcwRiwgMHgwNzBGXSwgWzB4MDcxMSwgMHgwNzExXSwgWzB4MDczMCwgMHgwNzRBXSxcbiAgICAgICAgWzB4MDdBNiwgMHgwN0IwXSwgWzB4MDdFQiwgMHgwN0YzXSwgWzB4MDkwMSwgMHgwOTAyXSxcbiAgICAgICAgWzB4MDkzQywgMHgwOTNDXSwgWzB4MDk0MSwgMHgwOTQ4XSwgWzB4MDk0RCwgMHgwOTREXSxcbiAgICAgICAgWzB4MDk1MSwgMHgwOTU0XSwgWzB4MDk2MiwgMHgwOTYzXSwgWzB4MDk4MSwgMHgwOTgxXSxcbiAgICAgICAgWzB4MDlCQywgMHgwOUJDXSwgWzB4MDlDMSwgMHgwOUM0XSwgWzB4MDlDRCwgMHgwOUNEXSxcbiAgICAgICAgWzB4MDlFMiwgMHgwOUUzXSwgWzB4MEEwMSwgMHgwQTAyXSwgWzB4MEEzQywgMHgwQTNDXSxcbiAgICAgICAgWzB4MEE0MSwgMHgwQTQyXSwgWzB4MEE0NywgMHgwQTQ4XSwgWzB4MEE0QiwgMHgwQTREXSxcbiAgICAgICAgWzB4MEE3MCwgMHgwQTcxXSwgWzB4MEE4MSwgMHgwQTgyXSwgWzB4MEFCQywgMHgwQUJDXSxcbiAgICAgICAgWzB4MEFDMSwgMHgwQUM1XSwgWzB4MEFDNywgMHgwQUM4XSwgWzB4MEFDRCwgMHgwQUNEXSxcbiAgICAgICAgWzB4MEFFMiwgMHgwQUUzXSwgWzB4MEIwMSwgMHgwQjAxXSwgWzB4MEIzQywgMHgwQjNDXSxcbiAgICAgICAgWzB4MEIzRiwgMHgwQjNGXSwgWzB4MEI0MSwgMHgwQjQzXSwgWzB4MEI0RCwgMHgwQjREXSxcbiAgICAgICAgWzB4MEI1NiwgMHgwQjU2XSwgWzB4MEI4MiwgMHgwQjgyXSwgWzB4MEJDMCwgMHgwQkMwXSxcbiAgICAgICAgWzB4MEJDRCwgMHgwQkNEXSwgWzB4MEMzRSwgMHgwQzQwXSwgWzB4MEM0NiwgMHgwQzQ4XSxcbiAgICAgICAgWzB4MEM0QSwgMHgwQzREXSwgWzB4MEM1NSwgMHgwQzU2XSwgWzB4MENCQywgMHgwQ0JDXSxcbiAgICAgICAgWzB4MENCRiwgMHgwQ0JGXSwgWzB4MENDNiwgMHgwQ0M2XSwgWzB4MENDQywgMHgwQ0NEXSxcbiAgICAgICAgWzB4MENFMiwgMHgwQ0UzXSwgWzB4MEQ0MSwgMHgwRDQzXSwgWzB4MEQ0RCwgMHgwRDREXSxcbiAgICAgICAgWzB4MERDQSwgMHgwRENBXSwgWzB4MEREMiwgMHgwREQ0XSwgWzB4MERENiwgMHgwREQ2XSxcbiAgICAgICAgWzB4MEUzMSwgMHgwRTMxXSwgWzB4MEUzNCwgMHgwRTNBXSwgWzB4MEU0NywgMHgwRTRFXSxcbiAgICAgICAgWzB4MEVCMSwgMHgwRUIxXSwgWzB4MEVCNCwgMHgwRUI5XSwgWzB4MEVCQiwgMHgwRUJDXSxcbiAgICAgICAgWzB4MEVDOCwgMHgwRUNEXSwgWzB4MEYxOCwgMHgwRjE5XSwgWzB4MEYzNSwgMHgwRjM1XSxcbiAgICAgICAgWzB4MEYzNywgMHgwRjM3XSwgWzB4MEYzOSwgMHgwRjM5XSwgWzB4MEY3MSwgMHgwRjdFXSxcbiAgICAgICAgWzB4MEY4MCwgMHgwRjg0XSwgWzB4MEY4NiwgMHgwRjg3XSwgWzB4MEY5MCwgMHgwRjk3XSxcbiAgICAgICAgWzB4MEY5OSwgMHgwRkJDXSwgWzB4MEZDNiwgMHgwRkM2XSwgWzB4MTAyRCwgMHgxMDMwXSxcbiAgICAgICAgWzB4MTAzMiwgMHgxMDMyXSwgWzB4MTAzNiwgMHgxMDM3XSwgWzB4MTAzOSwgMHgxMDM5XSxcbiAgICAgICAgWzB4MTA1OCwgMHgxMDU5XSwgWzB4MTE2MCwgMHgxMUZGXSwgWzB4MTM1RiwgMHgxMzVGXSxcbiAgICAgICAgWzB4MTcxMiwgMHgxNzE0XSwgWzB4MTczMiwgMHgxNzM0XSwgWzB4MTc1MiwgMHgxNzUzXSxcbiAgICAgICAgWzB4MTc3MiwgMHgxNzczXSwgWzB4MTdCNCwgMHgxN0I1XSwgWzB4MTdCNywgMHgxN0JEXSxcbiAgICAgICAgWzB4MTdDNiwgMHgxN0M2XSwgWzB4MTdDOSwgMHgxN0QzXSwgWzB4MTdERCwgMHgxN0REXSxcbiAgICAgICAgWzB4MTgwQiwgMHgxODBEXSwgWzB4MThBOSwgMHgxOEE5XSwgWzB4MTkyMCwgMHgxOTIyXSxcbiAgICAgICAgWzB4MTkyNywgMHgxOTI4XSwgWzB4MTkzMiwgMHgxOTMyXSwgWzB4MTkzOSwgMHgxOTNCXSxcbiAgICAgICAgWzB4MUExNywgMHgxQTE4XSwgWzB4MUIwMCwgMHgxQjAzXSwgWzB4MUIzNCwgMHgxQjM0XSxcbiAgICAgICAgWzB4MUIzNiwgMHgxQjNBXSwgWzB4MUIzQywgMHgxQjNDXSwgWzB4MUI0MiwgMHgxQjQyXSxcbiAgICAgICAgWzB4MUI2QiwgMHgxQjczXSwgWzB4MURDMCwgMHgxRENBXSwgWzB4MURGRSwgMHgxREZGXSxcbiAgICAgICAgWzB4MjAwQiwgMHgyMDBGXSwgWzB4MjAyQSwgMHgyMDJFXSwgWzB4MjA2MCwgMHgyMDYzXSxcbiAgICAgICAgWzB4MjA2QSwgMHgyMDZGXSwgWzB4MjBEMCwgMHgyMEVGXSwgWzB4MzAyQSwgMHgzMDJGXSxcbiAgICAgICAgWzB4MzA5OSwgMHgzMDlBXSwgWzB4QTgwNiwgMHhBODA2XSwgWzB4QTgwQiwgMHhBODBCXSxcbiAgICAgICAgWzB4QTgyNSwgMHhBODI2XSwgWzB4RkIxRSwgMHhGQjFFXSwgWzB4RkUwMCwgMHhGRTBGXSxcbiAgICAgICAgWzB4RkUyMCwgMHhGRTIzXSwgWzB4RkVGRiwgMHhGRUZGXSwgWzB4RkZGOSwgMHhGRkZCXVxuICAgIF07XG4gICAgdmFyIENPTUJJTklOR19ISUdIID0gW1xuICAgICAgICBbMHgxMEEwMSwgMHgxMEEwM10sIFsweDEwQTA1LCAweDEwQTA2XSwgWzB4MTBBMEMsIDB4MTBBMEZdLFxuICAgICAgICBbMHgxMEEzOCwgMHgxMEEzQV0sIFsweDEwQTNGLCAweDEwQTNGXSwgWzB4MUQxNjcsIDB4MUQxNjldLFxuICAgICAgICBbMHgxRDE3MywgMHgxRDE4Ml0sIFsweDFEMTg1LCAweDFEMThCXSwgWzB4MUQxQUEsIDB4MUQxQURdLFxuICAgICAgICBbMHgxRDI0MiwgMHgxRDI0NF0sIFsweEUwMDAxLCAweEUwMDAxXSwgWzB4RTAwMjAsIDB4RTAwN0ZdLFxuICAgICAgICBbMHhFMDEwMCwgMHhFMDFFRl1cbiAgICBdO1xuICAgIGZ1bmN0aW9uIGJpc2VhcmNoKHVjcywgZGF0YSkge1xuICAgICAgICB2YXIgbWluID0gMDtcbiAgICAgICAgdmFyIG1heCA9IGRhdGEubGVuZ3RoIC0gMTtcbiAgICAgICAgdmFyIG1pZDtcbiAgICAgICAgaWYgKHVjcyA8IGRhdGFbMF1bMF0gfHwgdWNzID4gZGF0YVttYXhdWzFdKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKG1heCA+PSBtaW4pIHtcbiAgICAgICAgICAgIG1pZCA9IChtaW4gKyBtYXgpID4+IDE7XG4gICAgICAgICAgICBpZiAodWNzID4gZGF0YVttaWRdWzFdKSB7XG4gICAgICAgICAgICAgICAgbWluID0gbWlkICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHVjcyA8IGRhdGFbbWlkXVswXSkge1xuICAgICAgICAgICAgICAgIG1heCA9IG1pZCAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHdjd2lkdGhIaWdoKHVjcykge1xuICAgICAgICBpZiAoYmlzZWFyY2godWNzLCBDT01CSU5JTkdfSElHSCkpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGlmICgodWNzID49IDB4MjAwMDAgJiYgdWNzIDw9IDB4MmZmZmQpIHx8ICh1Y3MgPj0gMHgzMDAwMCAmJiB1Y3MgPD0gMHgzZmZmZCkpIHtcbiAgICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICB2YXIgY29udHJvbCA9IG9wdHMuY29udHJvbCB8IDA7XG4gICAgdmFyIHRhYmxlID0gbmV3IFVpbnQ4QXJyYXkoNjU1MzYpO1xuICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDEpO1xuICAgIHRhYmxlWzBdID0gb3B0cy5udWw7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgb3B0cy5jb250cm9sLCAxLCAzMik7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgb3B0cy5jb250cm9sLCAweDdmLCAweGEwKTtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAyLCAweDExMDAsIDB4MTE2MCk7XG4gICAgdGFibGVbMHgyMzI5XSA9IDI7XG4gICAgdGFibGVbMHgyMzJhXSA9IDI7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgMiwgMHgyZTgwLCAweGE0ZDApO1xuICAgIHRhYmxlWzB4MzAzZl0gPSAxO1xuICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDIsIDB4YWMwMCwgMHhkN2E0KTtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAyLCAweGY5MDAsIDB4ZmIwMCk7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgMiwgMHhmZTEwLCAweGZlMWEpO1xuICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDIsIDB4ZmUzMCwgMHhmZTcwKTtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAyLCAweGZmMDAsIDB4ZmY2MSk7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgMiwgMHhmZmUwLCAweGZmZTcpO1xuICAgIGZvciAodmFyIHIgPSAwOyByIDwgQ09NQklOSU5HX0JNUC5sZW5ndGg7ICsrcikge1xuICAgICAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAwLCBDT01CSU5JTkdfQk1QW3JdWzBdLCBDT01CSU5JTkdfQk1QW3JdWzFdICsgMSk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAobnVtKSB7XG4gICAgICAgIGlmIChudW0gPCAzMikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2wgfCAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChudW0gPCAxMjcpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChudW0gPCA2NTUzNikge1xuICAgICAgICAgICAgcmV0dXJuIHRhYmxlW251bV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdjd2lkdGhIaWdoKG51bSk7XG4gICAgfTtcbn0pKHsgbnVsOiAwLCBjb250cm9sOiAwIH0pO1xuZnVuY3Rpb24gZ2V0U3RyaW5nQ2VsbFdpZHRoKHMpIHtcbiAgICB2YXIgcmVzdWx0ID0gMDtcbiAgICB2YXIgbGVuZ3RoID0gcy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY29kZSA9IHMuY2hhckNvZGVBdChpKTtcbiAgICAgICAgaWYgKDB4RDgwMCA8PSBjb2RlICYmIGNvZGUgPD0gMHhEQkZGKSB7XG4gICAgICAgICAgICBpZiAoKytpID49IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQgKyBleHBvcnRzLndjd2lkdGgoY29kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2Vjb25kID0gcy5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgaWYgKDB4REMwMCA8PSBzZWNvbmQgJiYgc2Vjb25kIDw9IDB4REZGRikge1xuICAgICAgICAgICAgICAgIGNvZGUgPSAoY29kZSAtIDB4RDgwMCkgKiAweDQwMCArIHNlY29uZCAtIDB4REMwMCArIDB4MTAwMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gZXhwb3J0cy53Y3dpZHRoKHNlY29uZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0ICs9IGV4cG9ydHMud2N3aWR0aChjb2RlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydHMuZ2V0U3RyaW5nQ2VsbFdpZHRoID0gZ2V0U3RyaW5nQ2VsbFdpZHRoO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhcldpZHRoLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIENvbXBvc2l0aW9uSGVscGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb21wb3NpdGlvbkhlbHBlcihfdGV4dGFyZWEsIF9jb21wb3NpdGlvblZpZXcsIF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXh0YXJlYSA9IF90ZXh0YXJlYTtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3ID0gX2NvbXBvc2l0aW9uVmlldztcbiAgICAgICAgdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIHRoaXMuX2lzQ29tcG9zaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2lzU2VuZGluZ0NvbXBvc2l0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uUG9zaXRpb24gPSB7IHN0YXJ0OiBudWxsLCBlbmQ6IG51bGwgfTtcbiAgICB9XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLmNvbXBvc2l0aW9uc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2lzQ29tcG9zaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25Qb3NpdGlvbi5zdGFydCA9IHRoaXMuX3RleHRhcmVhLnZhbHVlLmxlbmd0aDtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LnRleHRDb250ZW50ID0gJyc7XG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uVmlldy5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICB9O1xuICAgIENvbXBvc2l0aW9uSGVscGVyLnByb3RvdHlwZS5jb21wb3NpdGlvbnVwZGF0ZSA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcudGV4dENvbnRlbnQgPSBldi5kYXRhO1xuICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvc2l0aW9uRWxlbWVudHMoKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fY29tcG9zaXRpb25Qb3NpdGlvbi5lbmQgPSBfdGhpcy5fdGV4dGFyZWEudmFsdWUubGVuZ3RoO1xuICAgICAgICB9LCAwKTtcbiAgICB9O1xuICAgIENvbXBvc2l0aW9uSGVscGVyLnByb3RvdHlwZS5jb21wb3NpdGlvbmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZmluYWxpemVDb21wb3NpdGlvbih0cnVlKTtcbiAgICB9O1xuICAgIENvbXBvc2l0aW9uSGVscGVyLnByb3RvdHlwZS5rZXlkb3duID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIGlmICh0aGlzLl9pc0NvbXBvc2luZyB8fCB0aGlzLl9pc1NlbmRpbmdDb21wb3NpdGlvbikge1xuICAgICAgICAgICAgaWYgKGV2LmtleUNvZGUgPT09IDIyOSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LmtleUNvZGUgPT09IDE2IHx8IGV2LmtleUNvZGUgPT09IDE3IHx8IGV2LmtleUNvZGUgPT09IDE4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZmluYWxpemVDb21wb3NpdGlvbihmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2LmtleUNvZGUgPT09IDIyOSkge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlQW55VGV4dGFyZWFDaGFuZ2VzKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICBDb21wb3NpdGlvbkhlbHBlci5wcm90b3R5cGUuX2ZpbmFsaXplQ29tcG9zaXRpb24gPSBmdW5jdGlvbiAod2FpdEZvclByb3BvZ2F0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgdGhpcy5faXNDb21wb3NpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY2xlYXJUZXh0YXJlYVBvc2l0aW9uKCk7XG4gICAgICAgIGlmICghd2FpdEZvclByb3BvZ2F0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLl9pc1NlbmRpbmdDb21wb3NpdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gdGhpcy5fdGV4dGFyZWEudmFsdWUuc3Vic3RyaW5nKHRoaXMuX2NvbXBvc2l0aW9uUG9zaXRpb24uc3RhcnQsIHRoaXMuX2NvbXBvc2l0aW9uUG9zaXRpb24uZW5kKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoaW5wdXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRDb21wb3NpdGlvblBvc2l0aW9uXzEgPSB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IHRoaXMuX2NvbXBvc2l0aW9uUG9zaXRpb24uc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiB0aGlzLl9jb21wb3NpdGlvblBvc2l0aW9uLmVuZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuX2lzU2VuZGluZ0NvbXBvc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5faXNTZW5kaW5nQ29tcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2lzU2VuZGluZ0NvbXBvc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IHZvaWQgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLl9pc0NvbXBvc2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBfdGhpcy5fdGV4dGFyZWEudmFsdWUuc3Vic3RyaW5nKGN1cnJlbnRDb21wb3NpdGlvblBvc2l0aW9uXzEuc3RhcnQsIGN1cnJlbnRDb21wb3NpdGlvblBvc2l0aW9uXzEuZW5kKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gX3RoaXMuX3RleHRhcmVhLnZhbHVlLnN1YnN0cmluZyhjdXJyZW50Q29tcG9zaXRpb25Qb3NpdGlvbl8xLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fdGVybWluYWwuaGFuZGxlcihpbnB1dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENvbXBvc2l0aW9uSGVscGVyLnByb3RvdHlwZS5faGFuZGxlQW55VGV4dGFyZWFDaGFuZ2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLl90ZXh0YXJlYS52YWx1ZTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIV90aGlzLl9pc0NvbXBvc2luZykge1xuICAgICAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IF90aGlzLl90ZXh0YXJlYS52YWx1ZTtcbiAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IG5ld1ZhbHVlLnJlcGxhY2Uob2xkVmFsdWUsICcnKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5oYW5kbGVyKGRpZmYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICBDb21wb3NpdGlvbkhlbHBlci5wcm90b3R5cGUudXBkYXRlQ29tcG9zaXRpb25FbGVtZW50cyA9IGZ1bmN0aW9uIChkb250UmVjdXJzZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoIXRoaXMuX2lzQ29tcG9zaW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5pc0N1cnNvckluVmlld3BvcnQpIHtcbiAgICAgICAgICAgIHZhciBjZWxsSGVpZ2h0ID0gTWF0aC5jZWlsKHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLmhlaWdodCAqIHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMubGluZUhlaWdodCk7XG4gICAgICAgICAgICB2YXIgY3Vyc29yVG9wID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKiBjZWxsSGVpZ2h0O1xuICAgICAgICAgICAgdmFyIGN1cnNvckxlZnQgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCAqIHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLndpZHRoO1xuICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LnN0eWxlLmxlZnQgPSBjdXJzb3JMZWZ0ICsgJ3B4JztcbiAgICAgICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uVmlldy5zdHlsZS50b3AgPSBjdXJzb3JUb3AgKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LnN0eWxlLmhlaWdodCA9IGNlbGxIZWlnaHQgKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LnN0eWxlLmxpbmVIZWlnaHQgPSBjZWxsSGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgICAgIHZhciBjb21wb3NpdGlvblZpZXdCb3VuZHMgPSB0aGlzLl9jb21wb3NpdGlvblZpZXcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICB0aGlzLl90ZXh0YXJlYS5zdHlsZS5sZWZ0ID0gY3Vyc29yTGVmdCArICdweCc7XG4gICAgICAgICAgICB0aGlzLl90ZXh0YXJlYS5zdHlsZS50b3AgPSBjdXJzb3JUb3AgKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fdGV4dGFyZWEuc3R5bGUud2lkdGggPSBjb21wb3NpdGlvblZpZXdCb3VuZHMud2lkdGggKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gY29tcG9zaXRpb25WaWV3Qm91bmRzLmhlaWdodCArICdweCc7XG4gICAgICAgICAgICB0aGlzLl90ZXh0YXJlYS5zdHlsZS5saW5lSGVpZ2h0ID0gY29tcG9zaXRpb25WaWV3Qm91bmRzLmhlaWdodCArICdweCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkb250UmVjdXJzZSkge1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy51cGRhdGVDb21wb3NpdGlvbkVsZW1lbnRzKHRydWUpOyB9LCAwKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLl9jbGVhclRleHRhcmVhUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3RleHRhcmVhLnN0eWxlLmxlZnQgPSAnJztcbiAgICAgICAgdGhpcy5fdGV4dGFyZWEuc3R5bGUudG9wID0gJyc7XG4gICAgfTtcbiAgICByZXR1cm4gQ29tcG9zaXRpb25IZWxwZXI7XG59KCkpO1xuZXhwb3J0cy5Db21wb3NpdGlvbkhlbHBlciA9IENvbXBvc2l0aW9uSGVscGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q29tcG9zaXRpb25IZWxwZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIExpZmVjeWNsZV8xID0gcmVxdWlyZShcIi4vY29tbW9uL0xpZmVjeWNsZVwiKTtcbmZ1bmN0aW9uIHIobG93LCBoaWdoKSB7XG4gICAgdmFyIGMgPSBoaWdoIC0gbG93O1xuICAgIHZhciBhcnIgPSBuZXcgQXJyYXkoYyk7XG4gICAgd2hpbGUgKGMtLSkge1xuICAgICAgICBhcnJbY10gPSAtLWhpZ2g7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG59XG52YXIgVHJhbnNpdGlvblRhYmxlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUcmFuc2l0aW9uVGFibGUobGVuZ3RoKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSAodHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgPyBuZXcgQXJyYXkobGVuZ3RoKVxuICAgICAgICAgICAgOiBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICAgIH1cbiAgICBUcmFuc2l0aW9uVGFibGUucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChjb2RlLCBzdGF0ZSwgYWN0aW9uLCBuZXh0KSB7XG4gICAgICAgIHRoaXMudGFibGVbc3RhdGUgPDwgOCB8IGNvZGVdID0gKChhY3Rpb24gfCAwKSA8PCA0KSB8ICgobmV4dCA9PT0gdW5kZWZpbmVkKSA/IHN0YXRlIDogbmV4dCk7XG4gICAgfTtcbiAgICBUcmFuc2l0aW9uVGFibGUucHJvdG90eXBlLmFkZE1hbnkgPSBmdW5jdGlvbiAoY29kZXMsIHN0YXRlLCBhY3Rpb24sIG5leHQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5hZGQoY29kZXNbaV0sIHN0YXRlLCBhY3Rpb24sIG5leHQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gVHJhbnNpdGlvblRhYmxlO1xufSgpKTtcbmV4cG9ydHMuVHJhbnNpdGlvblRhYmxlID0gVHJhbnNpdGlvblRhYmxlO1xudmFyIFBSSU5UQUJMRVMgPSByKDB4MjAsIDB4N2YpO1xudmFyIEVYRUNVVEFCTEVTID0gcigweDAwLCAweDE4KTtcbkVYRUNVVEFCTEVTLnB1c2goMHgxOSk7XG5FWEVDVVRBQkxFUy5wdXNoLmFwcGx5KEVYRUNVVEFCTEVTLCByKDB4MWMsIDB4MjApKTtcbnZhciBERUZBVUxUX1RSQU5TSVRJT04gPSAxIDw8IDQgfCAwO1xuZXhwb3J0cy5WVDUwMF9UUkFOU0lUSU9OX1RBQkxFID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGFibGUgPSBuZXcgVHJhbnNpdGlvblRhYmxlKDQwOTUpO1xuICAgIHZhciBzdGF0ZXMgPSByKDAsIDEzICsgMSk7XG4gICAgdmFyIHN0YXRlO1xuICAgIGZvciAoc3RhdGUgaW4gc3RhdGVzKSB7XG4gICAgICAgIGZvciAodmFyIGNvZGUgPSAwOyBjb2RlIDwgMTYwOyArK2NvZGUpIHtcbiAgICAgICAgICAgIHRhYmxlLmFkZChjb2RlLCBzdGF0ZSwgMSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGFibGUuYWRkTWFueShQUklOVEFCTEVTLCAwLCAyLCAwKTtcbiAgICBmb3IgKHN0YXRlIGluIHN0YXRlcykge1xuICAgICAgICB0YWJsZS5hZGRNYW55KFsweDE4LCAweDFhLCAweDk5LCAweDlhXSwgc3RhdGUsIDMsIDApO1xuICAgICAgICB0YWJsZS5hZGRNYW55KHIoMHg4MCwgMHg5MCksIHN0YXRlLCAzLCAwKTtcbiAgICAgICAgdGFibGUuYWRkTWFueShyKDB4OTAsIDB4OTgpLCBzdGF0ZSwgMywgMCk7XG4gICAgICAgIHRhYmxlLmFkZCgweDljLCBzdGF0ZSwgMCwgMCk7XG4gICAgICAgIHRhYmxlLmFkZCgweDFiLCBzdGF0ZSwgMTEsIDEpO1xuICAgICAgICB0YWJsZS5hZGQoMHg5ZCwgc3RhdGUsIDQsIDgpO1xuICAgICAgICB0YWJsZS5hZGRNYW55KFsweDk4LCAweDllLCAweDlmXSwgc3RhdGUsIDAsIDcpO1xuICAgICAgICB0YWJsZS5hZGQoMHg5Yiwgc3RhdGUsIDExLCAzKTtcbiAgICAgICAgdGFibGUuYWRkKDB4OTAsIHN0YXRlLCAxMSwgOSk7XG4gICAgfVxuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDAsIDMsIDApO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDEsIDMsIDEpO1xuICAgIHRhYmxlLmFkZCgweDdmLCAxLCAwLCAxKTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCA4LCAwLCA4KTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCAzLCAzLCAzKTtcbiAgICB0YWJsZS5hZGQoMHg3ZiwgMywgMCwgMyk7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgNCwgMywgNCk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDQsIDAsIDQpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDYsIDMsIDYpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDUsIDMsIDUpO1xuICAgIHRhYmxlLmFkZCgweDdmLCA1LCAwLCA1KTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCAyLCAzLCAyKTtcbiAgICB0YWJsZS5hZGQoMHg3ZiwgMiwgMCwgMik7XG4gICAgdGFibGUuYWRkKDB4NWQsIDEsIDQsIDgpO1xuICAgIHRhYmxlLmFkZE1hbnkoUFJJTlRBQkxFUywgOCwgNSwgOCk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDgsIDUsIDgpO1xuICAgIHRhYmxlLmFkZE1hbnkoWzB4OWMsIDB4MWIsIDB4MTgsIDB4MWEsIDB4MDddLCA4LCA2LCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgxYywgMHgyMCksIDgsIDAsIDgpO1xuICAgIHRhYmxlLmFkZE1hbnkoWzB4NTgsIDB4NWUsIDB4NWZdLCAxLCAwLCA3KTtcbiAgICB0YWJsZS5hZGRNYW55KFBSSU5UQUJMRVMsIDcsIDAsIDcpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDcsIDAsIDcpO1xuICAgIHRhYmxlLmFkZCgweDljLCA3LCAwLCAwKTtcbiAgICB0YWJsZS5hZGQoMHg1YiwgMSwgMTEsIDMpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDQwLCAweDdmKSwgMywgNywgMCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MzAsIDB4M2EpLCAzLCA4LCA0KTtcbiAgICB0YWJsZS5hZGQoMHgzYiwgMywgOCwgNCk7XG4gICAgdGFibGUuYWRkTWFueShbMHgzYywgMHgzZCwgMHgzZSwgMHgzZl0sIDMsIDksIDQpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDMwLCAweDNhKSwgNCwgOCwgNCk7XG4gICAgdGFibGUuYWRkKDB4M2IsIDQsIDgsIDQpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDQwLCAweDdmKSwgNCwgNywgMCk7XG4gICAgdGFibGUuYWRkTWFueShbMHgzYSwgMHgzYywgMHgzZCwgMHgzZSwgMHgzZl0sIDQsIDAsIDYpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDIwLCAweDQwKSwgNiwgMCwgNik7XG4gICAgdGFibGUuYWRkKDB4N2YsIDYsIDAsIDYpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDQwLCAweDdmKSwgNiwgMCwgMCk7XG4gICAgdGFibGUuYWRkKDB4M2EsIDMsIDAsIDYpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDIwLCAweDMwKSwgMywgOSwgNSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCA1LCA5LCA1KTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHg0MCksIDUsIDAsIDYpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDQwLCAweDdmKSwgNSwgNywgMCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCA0LCA5LCA1KTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgyMCwgMHgzMCksIDEsIDksIDIpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDIwLCAweDMwKSwgMiwgOSwgMik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MzAsIDB4N2YpLCAyLCAxMCwgMCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MzAsIDB4NTApLCAxLCAxMCwgMCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NTEsIDB4NTgpLCAxLCAxMCwgMCk7XG4gICAgdGFibGUuYWRkTWFueShbMHg1OSwgMHg1YSwgMHg1Y10sIDEsIDEwLCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHg2MCwgMHg3ZiksIDEsIDEwLCAwKTtcbiAgICB0YWJsZS5hZGQoMHg1MCwgMSwgMTEsIDkpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDksIDAsIDkpO1xuICAgIHRhYmxlLmFkZCgweDdmLCA5LCAwLCA5KTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgxYywgMHgyMCksIDksIDAsIDkpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDIwLCAweDMwKSwgOSwgOSwgMTIpO1xuICAgIHRhYmxlLmFkZCgweDNhLCA5LCAwLCAxMSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MzAsIDB4M2EpLCA5LCA4LCAxMCk7XG4gICAgdGFibGUuYWRkKDB4M2IsIDksIDgsIDEwKTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDNjLCAweDNkLCAweDNlLCAweDNmXSwgOSwgOSwgMTApO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDExLCAwLCAxMSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4ODApLCAxMSwgMCwgMTEpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDFjLCAweDIwKSwgMTEsIDAsIDExKTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCAxMCwgMCwgMTApO1xuICAgIHRhYmxlLmFkZCgweDdmLCAxMCwgMCwgMTApO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDFjLCAweDIwKSwgMTAsIDAsIDEwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHgzYSksIDEwLCA4LCAxMCk7XG4gICAgdGFibGUuYWRkKDB4M2IsIDEwLCA4LCAxMCk7XG4gICAgdGFibGUuYWRkTWFueShbMHgzYSwgMHgzYywgMHgzZCwgMHgzZSwgMHgzZl0sIDEwLCAwLCAxMSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCAxMCwgOSwgMTIpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDEyLCAwLCAxMik7XG4gICAgdGFibGUuYWRkKDB4N2YsIDEyLCAwLCAxMik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MWMsIDB4MjApLCAxMiwgMCwgMTIpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDIwLCAweDMwKSwgMTIsIDksIDEyKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHg0MCksIDEyLCAwLCAxMSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NDAsIDB4N2YpLCAxMiwgMTIsIDEzKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHg0MCwgMHg3ZiksIDEwLCAxMiwgMTMpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDQwLCAweDdmKSwgOSwgMTIsIDEzKTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCAxMywgMTMsIDEzKTtcbiAgICB0YWJsZS5hZGRNYW55KFBSSU5UQUJMRVMsIDEzLCAxMywgMTMpO1xuICAgIHRhYmxlLmFkZCgweDdmLCAxMywgMCwgMTMpO1xuICAgIHRhYmxlLmFkZE1hbnkoWzB4MWIsIDB4OWNdLCAxMywgMTQsIDApO1xuICAgIHJldHVybiB0YWJsZTtcbn0pKCk7XG52YXIgRGNzRHVtbXkgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERjc0R1bW15KCkge1xuICAgIH1cbiAgICBEY3NEdW1teS5wcm90b3R5cGUuaG9vayA9IGZ1bmN0aW9uIChjb2xsZWN0LCBwYXJhbXMsIGZsYWcpIHsgfTtcbiAgICBEY3NEdW1teS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHsgfTtcbiAgICBEY3NEdW1teS5wcm90b3R5cGUudW5ob29rID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIHJldHVybiBEY3NEdW1teTtcbn0oKSk7XG52YXIgRXNjYXBlU2VxdWVuY2VQYXJzZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhFc2NhcGVTZXF1ZW5jZVBhcnNlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBFc2NhcGVTZXF1ZW5jZVBhcnNlcihUUkFOU0lUSU9OUykge1xuICAgICAgICBpZiAoVFJBTlNJVElPTlMgPT09IHZvaWQgMCkgeyBUUkFOU0lUSU9OUyA9IGV4cG9ydHMuVlQ1MDBfVFJBTlNJVElPTl9UQUJMRTsgfVxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5UUkFOU0lUSU9OUyA9IFRSQU5TSVRJT05TO1xuICAgICAgICBfdGhpcy5pbml0aWFsU3RhdGUgPSAwO1xuICAgICAgICBfdGhpcy5jdXJyZW50U3RhdGUgPSBfdGhpcy5pbml0aWFsU3RhdGU7XG4gICAgICAgIF90aGlzLl9vc2MgPSAnJztcbiAgICAgICAgX3RoaXMuX3BhcmFtcyA9IFswXTtcbiAgICAgICAgX3RoaXMuX2NvbGxlY3QgPSAnJztcbiAgICAgICAgX3RoaXMuX3ByaW50SGFuZGxlckZiID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHsgfTtcbiAgICAgICAgX3RoaXMuX2V4ZWN1dGVIYW5kbGVyRmIgPSBmdW5jdGlvbiAoY29kZSkgeyB9O1xuICAgICAgICBfdGhpcy5fY3NpSGFuZGxlckZiID0gZnVuY3Rpb24gKGNvbGxlY3QsIHBhcmFtcywgZmxhZykgeyB9O1xuICAgICAgICBfdGhpcy5fZXNjSGFuZGxlckZiID0gZnVuY3Rpb24gKGNvbGxlY3QsIGZsYWcpIHsgfTtcbiAgICAgICAgX3RoaXMuX29zY0hhbmRsZXJGYiA9IGZ1bmN0aW9uIChpZGVudGlmaWVyLCBkYXRhKSB7IH07XG4gICAgICAgIF90aGlzLl9kY3NIYW5kbGVyRmIgPSBuZXcgRGNzRHVtbXkoKTtcbiAgICAgICAgX3RoaXMuX2Vycm9ySGFuZGxlckZiID0gZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZTsgfTtcbiAgICAgICAgX3RoaXMuX3ByaW50SGFuZGxlciA9IF90aGlzLl9wcmludEhhbmRsZXJGYjtcbiAgICAgICAgX3RoaXMuX2V4ZWN1dGVIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9jc2lIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9lc2NIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9vc2NIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9kY3NIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9hY3RpdmVEY3NIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2Vycm9ySGFuZGxlciA9IF90aGlzLl9lcnJvckhhbmRsZXJGYjtcbiAgICAgICAgX3RoaXMuc2V0RXNjSGFuZGxlcignXFxcXCcsIGZ1bmN0aW9uICgpIHsgfSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3ByaW50SGFuZGxlckZiID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXhlY3V0ZUhhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NzaUhhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2VzY0hhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX29zY0hhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2Rjc0hhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2Vycm9ySGFuZGxlckZiID0gbnVsbDtcbiAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXhlY3V0ZUhhbmRsZXJzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY3NpSGFuZGxlcnMgPSBudWxsO1xuICAgICAgICB0aGlzLl9lc2NIYW5kbGVycyA9IG51bGw7XG4gICAgICAgIHRoaXMuX29zY0hhbmRsZXJzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZGNzSGFuZGxlcnMgPSBudWxsO1xuICAgICAgICB0aGlzLl9hY3RpdmVEY3NIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXJyb3JIYW5kbGVyID0gbnVsbDtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRQcmludEhhbmRsZXIgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyID0gY2FsbGJhY2s7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuY2xlYXJQcmludEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3ByaW50SGFuZGxlciA9IHRoaXMuX3ByaW50SGFuZGxlckZiO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldEV4ZWN1dGVIYW5kbGVyID0gZnVuY3Rpb24gKGZsYWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2V4ZWN1dGVIYW5kbGVyc1tmbGFnLmNoYXJDb2RlQXQoMCldID0gY2FsbGJhY2s7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuY2xlYXJFeGVjdXRlSGFuZGxlciA9IGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICAgIGlmICh0aGlzLl9leGVjdXRlSGFuZGxlcnNbZmxhZy5jaGFyQ29kZUF0KDApXSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9leGVjdXRlSGFuZGxlcnNbZmxhZy5jaGFyQ29kZUF0KDApXTtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRFeGVjdXRlSGFuZGxlckZhbGxiYWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2V4ZWN1dGVIYW5kbGVyRmIgPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRDc2lIYW5kbGVyID0gZnVuY3Rpb24gKGZsYWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2NzaUhhbmRsZXJzW2ZsYWcuY2hhckNvZGVBdCgwKV0gPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5jbGVhckNzaUhhbmRsZXIgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgICBpZiAodGhpcy5fY3NpSGFuZGxlcnNbZmxhZy5jaGFyQ29kZUF0KDApXSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9jc2lIYW5kbGVyc1tmbGFnLmNoYXJDb2RlQXQoMCldO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldENzaUhhbmRsZXJGYWxsYmFjayA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9jc2lIYW5kbGVyRmIgPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRFc2NIYW5kbGVyID0gZnVuY3Rpb24gKGNvbGxlY3RBbmRGbGFnLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9lc2NIYW5kbGVyc1tjb2xsZWN0QW5kRmxhZ10gPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5jbGVhckVzY0hhbmRsZXIgPSBmdW5jdGlvbiAoY29sbGVjdEFuZEZsYWcpIHtcbiAgICAgICAgaWYgKHRoaXMuX2VzY0hhbmRsZXJzW2NvbGxlY3RBbmRGbGFnXSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9lc2NIYW5kbGVyc1tjb2xsZWN0QW5kRmxhZ107XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuc2V0RXNjSGFuZGxlckZhbGxiYWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2VzY0hhbmRsZXJGYiA9IGNhbGxiYWNrO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldE9zY0hhbmRsZXIgPSBmdW5jdGlvbiAoaWRlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX29zY0hhbmRsZXJzW2lkZW50XSA9IGNhbGxiYWNrO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLmNsZWFyT3NjSGFuZGxlciA9IGZ1bmN0aW9uIChpZGVudCkge1xuICAgICAgICBpZiAodGhpcy5fb3NjSGFuZGxlcnNbaWRlbnRdKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX29zY0hhbmRsZXJzW2lkZW50XTtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRPc2NIYW5kbGVyRmFsbGJhY2sgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fb3NjSGFuZGxlckZiID0gY2FsbGJhY2s7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuc2V0RGNzSGFuZGxlciA9IGZ1bmN0aW9uIChjb2xsZWN0QW5kRmxhZywgaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9kY3NIYW5kbGVyc1tjb2xsZWN0QW5kRmxhZ10gPSBoYW5kbGVyO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLmNsZWFyRGNzSGFuZGxlciA9IGZ1bmN0aW9uIChjb2xsZWN0QW5kRmxhZykge1xuICAgICAgICBpZiAodGhpcy5fZGNzSGFuZGxlcnNbY29sbGVjdEFuZEZsYWddKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2Rjc0hhbmRsZXJzW2NvbGxlY3RBbmRGbGFnXTtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXREY3NIYW5kbGVyRmFsbGJhY2sgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9kY3NIYW5kbGVyRmIgPSBoYW5kbGVyO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldEVycm9ySGFuZGxlciA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9lcnJvckhhbmRsZXIgPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5jbGVhckVycm9ySGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZXJyb3JIYW5kbGVyID0gdGhpcy5fZXJyb3JIYW5kbGVyRmI7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gdGhpcy5pbml0aWFsU3RhdGU7XG4gICAgICAgIHRoaXMuX29zYyA9ICcnO1xuICAgICAgICB0aGlzLl9wYXJhbXMgPSBbMF07XG4gICAgICAgIHRoaXMuX2NvbGxlY3QgPSAnJztcbiAgICAgICAgdGhpcy5fYWN0aXZlRGNzSGFuZGxlciA9IG51bGw7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgY29kZSA9IDA7XG4gICAgICAgIHZhciB0cmFuc2l0aW9uID0gMDtcbiAgICAgICAgdmFyIGVycm9yID0gZmFsc2U7XG4gICAgICAgIHZhciBjdXJyZW50U3RhdGUgPSB0aGlzLmN1cnJlbnRTdGF0ZTtcbiAgICAgICAgdmFyIHByaW50ID0gLTE7XG4gICAgICAgIHZhciBkY3MgPSAtMTtcbiAgICAgICAgdmFyIG9zYyA9IHRoaXMuX29zYztcbiAgICAgICAgdmFyIGNvbGxlY3QgPSB0aGlzLl9jb2xsZWN0O1xuICAgICAgICB2YXIgcGFyYW1zID0gdGhpcy5fcGFyYW1zO1xuICAgICAgICB2YXIgdGFibGUgPSB0aGlzLlRSQU5TSVRJT05TLnRhYmxlO1xuICAgICAgICB2YXIgZGNzSGFuZGxlciA9IHRoaXMuX2FjdGl2ZURjc0hhbmRsZXI7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IG51bGw7XG4gICAgICAgIHZhciBsID0gZGF0YS5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgKytpKSB7XG4gICAgICAgICAgICBjb2RlID0gZGF0YS5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMCAmJiBjb2RlID4gMHgxZiAmJiBjb2RlIDwgMHg4MCkge1xuICAgICAgICAgICAgICAgIHByaW50ID0gKH5wcmludCkgPyBwcmludCA6IGk7XG4gICAgICAgICAgICAgICAgZG9cbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgbCAmJiBkYXRhLmNoYXJDb2RlQXQoaSkgPiAweDFmICYmIGRhdGEuY2hhckNvZGVBdChpKSA8IDB4ODApO1xuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQgJiYgKGNvZGUgPiAweDJmICYmIGNvZGUgPCAweDM5KSkge1xuICAgICAgICAgICAgICAgIHBhcmFtc1twYXJhbXMubGVuZ3RoIC0gMV0gPSBwYXJhbXNbcGFyYW1zLmxlbmd0aCAtIDFdICogMTAgKyBjb2RlIC0gNDg7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cmFuc2l0aW9uID0gKGNvZGUgPCAweGEwKSA/ICh0YWJsZVtjdXJyZW50U3RhdGUgPDwgOCB8IGNvZGVdKSA6IERFRkFVTFRfVFJBTlNJVElPTjtcbiAgICAgICAgICAgIHN3aXRjaCAodHJhbnNpdGlvbiA+PiA0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICBwcmludCA9ICh+cHJpbnQpID8gcHJpbnQgOiBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIGlmICh+cHJpbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByaW50SGFuZGxlcihkYXRhLCBwcmludCwgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gdGhpcy5fZXhlY3V0ZUhhbmRsZXJzW2NvZGVdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9leGVjdXRlSGFuZGxlckZiKGNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIGlmICh+cHJpbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByaW50SGFuZGxlcihkYXRhLCBwcmludCwgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKH5kY3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRjc0hhbmRsZXIucHV0KGRhdGEsIGRjcywgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkY3MgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID4gMHg5Zikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjdXJyZW50U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ID0gKH5wcmludCkgPyBwcmludCA6IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3NjICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24gfD0gODtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uIHw9IDY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24gfD0gMTE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRjcyA9ICh+ZGNzKSA/IGRjcyA6IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24gfD0gMTM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmplY3QgPSB0aGlzLl9lcnJvckhhbmRsZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlOiBjdXJyZW50U3RhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQ6IHByaW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRjczogZGNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zYzogb3NjLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Q6IGNvbGxlY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmplY3QuYWJvcnQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gdGhpcy5fY3NpSGFuZGxlcnNbY29kZV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaylcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHBhcmFtcywgY29sbGVjdCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NzaUhhbmRsZXJGYihjb2xsZWN0LCBwYXJhbXMsIGNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAweDNiKVxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goMCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1twYXJhbXMubGVuZ3RoIC0gMV0gPSBwYXJhbXNbcGFyYW1zLmxlbmd0aCAtIDFdICogMTAgKyBjb2RlIC0gNDg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHRoaXMuX2VzY0hhbmRsZXJzW2NvbGxlY3QgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soY29sbGVjdCwgY29kZSk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VzY0hhbmRsZXJGYihjb2xsZWN0LCBjb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKH5wcmludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyKGRhdGEsIHByaW50LCBpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb3NjID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IFswXTtcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBkY3MgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlciA9IHRoaXMuX2Rjc0hhbmRsZXJzW2NvbGxlY3QgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkY3NIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlciA9IHRoaXMuX2Rjc0hhbmRsZXJGYjtcbiAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlci5ob29rKGNvbGxlY3QsIHBhcmFtcywgY29kZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgICAgICAgIGRjcyA9ICh+ZGNzKSA/IGRjcyA6IGk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICAgICAgICAgIGlmIChkY3NIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAofmRjcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkY3NIYW5kbGVyLnB1dChkYXRhLCBkY3MsIGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlci51bmhvb2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRjc0hhbmRsZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAweDFiKVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbiB8PSAxO1xuICAgICAgICAgICAgICAgICAgICBvc2MgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGRjcyA9IC0xO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICh+cHJpbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByaW50SGFuZGxlcihkYXRhLCBwcmludCwgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9zYyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgIG9zYyArPSBkYXRhLmNoYXJBdChpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICBpZiAob3NjICYmIGNvZGUgIT09IDB4MTggJiYgY29kZSAhPT0gMHgxYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IG9zYy5pbmRleE9mKCc7Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29zY0hhbmRsZXJGYigtMSwgb3NjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZGVudGlmaWVyID0gcGFyc2VJbnQob3NjLnN1YnN0cmluZygwLCBpZHgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG9zYy5zdWJzdHJpbmcoaWR4ICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSB0aGlzLl9vc2NIYW5kbGVyc1tpZGVudGlmaWVyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3NjSGFuZGxlckZiKGlkZW50aWZpZXIsIGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAweDFiKVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbiB8PSAxO1xuICAgICAgICAgICAgICAgICAgICBvc2MgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGRjcyA9IC0xO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSA9IHRyYW5zaXRpb24gJiAxNTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAwICYmIH5wcmludCkge1xuICAgICAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyKGRhdGEsIHByaW50LCBkYXRhLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudFN0YXRlID09PSAxMyAmJiB+ZGNzICYmIGRjc0hhbmRsZXIpIHtcbiAgICAgICAgICAgIGRjc0hhbmRsZXIucHV0KGRhdGEsIGRjcywgZGF0YS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX29zYyA9IG9zYztcbiAgICAgICAgdGhpcy5fY29sbGVjdCA9IGNvbGxlY3Q7XG4gICAgICAgIHRoaXMuX3BhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgdGhpcy5fYWN0aXZlRGNzSGFuZGxlciA9IGRjc0hhbmRsZXI7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gY3VycmVudFN0YXRlO1xuICAgIH07XG4gICAgcmV0dXJuIEVzY2FwZVNlcXVlbmNlUGFyc2VyO1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLkVzY2FwZVNlcXVlbmNlUGFyc2VyID0gRXNjYXBlU2VxdWVuY2VQYXJzZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Fc2NhcGVTZXF1ZW5jZVBhcnNlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXNjYXBlU2VxdWVuY2VzXzEgPSByZXF1aXJlKFwiLi9jb21tb24vZGF0YS9Fc2NhcGVTZXF1ZW5jZXNcIik7XG52YXIgQ2hhcnNldHNfMSA9IHJlcXVpcmUoXCIuL2NvcmUvZGF0YS9DaGFyc2V0c1wiKTtcbnZhciBCdWZmZXJfMSA9IHJlcXVpcmUoXCIuL0J1ZmZlclwiKTtcbnZhciBDaGFyV2lkdGhfMSA9IHJlcXVpcmUoXCIuL0NoYXJXaWR0aFwiKTtcbnZhciBFc2NhcGVTZXF1ZW5jZVBhcnNlcl8xID0gcmVxdWlyZShcIi4vRXNjYXBlU2VxdWVuY2VQYXJzZXJcIik7XG52YXIgTGlmZWN5Y2xlXzEgPSByZXF1aXJlKFwiLi9jb21tb24vTGlmZWN5Y2xlXCIpO1xudmFyIEdMRVZFTCA9IHsgJygnOiAwLCAnKSc6IDEsICcqJzogMiwgJysnOiAzLCAnLSc6IDEsICcuJzogMiB9O1xudmFyIFJlcXVlc3RUZXJtaW5mbyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUmVxdWVzdFRlcm1pbmZvKF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICB9XG4gICAgUmVxdWVzdFRlcm1pbmZvLnByb3RvdHlwZS5ob29rID0gZnVuY3Rpb24gKGNvbGxlY3QsIHBhcmFtcywgZmxhZykge1xuICAgICAgICB0aGlzLl9kYXRhID0gJyc7XG4gICAgfTtcbiAgICBSZXF1ZXN0VGVybWluZm8ucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uIChkYXRhLCBzdGFydCwgZW5kKSB7XG4gICAgICAgIHRoaXMuX2RhdGEgKz0gZGF0YS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7XG4gICAgfTtcbiAgICBSZXF1ZXN0VGVybWluZm8ucHJvdG90eXBlLnVuaG9vayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAwK3JcIiArIHRoaXMuX2RhdGEgKyBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlxcXFxcIik7XG4gICAgfTtcbiAgICByZXR1cm4gUmVxdWVzdFRlcm1pbmZvO1xufSgpKTtcbnZhciBERUNSUVNTID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBERUNSUVNTKF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICB9XG4gICAgREVDUlFTUy5wcm90b3R5cGUuaG9vayA9IGZ1bmN0aW9uIChjb2xsZWN0LCBwYXJhbXMsIGZsYWcpIHtcbiAgICAgICAgdGhpcy5fZGF0YSA9ICcnO1xuICAgIH07XG4gICAgREVDUlFTUy5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdGhpcy5fZGF0YSArPSBkYXRhLnN1YnN0cmluZyhzdGFydCwgZW5kKTtcbiAgICB9O1xuICAgIERFQ1JRU1MucHJvdG90eXBlLnVuaG9vayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLl9kYXRhKSB7XG4gICAgICAgICAgICBjYXNlICdcInEnOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiUDEkcjBcXFwicVwiICsgRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJcXFxcXCIpO1xuICAgICAgICAgICAgY2FzZSAnXCJwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAxJHI2MVxcXCJwXCIgKyBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlxcXFxcIik7XG4gICAgICAgICAgICBjYXNlICdyJzpcbiAgICAgICAgICAgICAgICB2YXIgcHQgPSAnJyArICh0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2Nyb2xsVG9wICsgMSkgK1xuICAgICAgICAgICAgICAgICAgICAnOycgKyAodGhpcy5fdGVybWluYWwuYnVmZmVyLnNjcm9sbEJvdHRvbSArIDEpICsgJ3InO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiUDEkclwiICsgcHQgKyBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlxcXFxcIik7XG4gICAgICAgICAgICBjYXNlICdtJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAxJHIwbVwiICsgRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJcXFxcXCIpO1xuICAgICAgICAgICAgY2FzZSAnIHEnOlxuICAgICAgICAgICAgICAgIHZhciBTVFlMRVMgPSB7ICdibG9jayc6IDIsICd1bmRlcmxpbmUnOiA0LCAnYmFyJzogNiB9O1xuICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IFNUWUxFU1t0aGlzLl90ZXJtaW5hbC5nZXRPcHRpb24oJ2N1cnNvclN0eWxlJyldO1xuICAgICAgICAgICAgICAgIHN0eWxlIC09IHRoaXMuX3Rlcm1pbmFsLmdldE9wdGlvbignY3Vyc29yQmxpbmsnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAxJHJcIiArIHN0eWxlICsgXCIgcVwiICsgRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJcXFxcXCIpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lcnJvcignVW5rbm93biBEQ1MgJHEgJXMnLCB0aGlzLl9kYXRhKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiUDAkclwiICsgdGhpcy5fZGF0YSArIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiXFxcXFwiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIERFQ1JRU1M7XG59KCkpO1xudmFyIElucHV0SGFuZGxlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKElucHV0SGFuZGxlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBJbnB1dEhhbmRsZXIoX3Rlcm1pbmFsLCBfcGFyc2VyKSB7XG4gICAgICAgIGlmIChfcGFyc2VyID09PSB2b2lkIDApIHsgX3BhcnNlciA9IG5ldyBFc2NhcGVTZXF1ZW5jZVBhcnNlcl8xLkVzY2FwZVNlcXVlbmNlUGFyc2VyKCk7IH1cbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fcGFyc2VyID0gX3BhcnNlcjtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3BhcnNlcik7XG4gICAgICAgIF90aGlzLl9zdXJyb2dhdGVGaXJzdCA9ICcnO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXJGYWxsYmFjayhmdW5jdGlvbiAoY29sbGVjdCwgcGFyYW1zLCBmbGFnKSB7XG4gICAgICAgICAgICBfdGhpcy5fdGVybWluYWwuZXJyb3IoJ1Vua25vd24gQ1NJIGNvZGU6ICcsIHsgY29sbGVjdDogY29sbGVjdCwgcGFyYW1zOiBwYXJhbXMsIGZsYWc6IFN0cmluZy5mcm9tQ2hhckNvZGUoZmxhZykgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXJGYWxsYmFjayhmdW5jdGlvbiAoY29sbGVjdCwgZmxhZykge1xuICAgICAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmVycm9yKCdVbmtub3duIEVTQyBjb2RlOiAnLCB7IGNvbGxlY3Q6IGNvbGxlY3QsIGZsYWc6IFN0cmluZy5mcm9tQ2hhckNvZGUoZmxhZykgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyRmFsbGJhY2soZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5lcnJvcignVW5rbm93biBFWEVDVVRFIGNvZGU6ICcsIHsgY29kZTogY29kZSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0T3NjSGFuZGxlckZhbGxiYWNrKGZ1bmN0aW9uIChpZGVudGlmaWVyLCBkYXRhKSB7XG4gICAgICAgICAgICBfdGhpcy5fdGVybWluYWwuZXJyb3IoJ1Vua25vd24gT1NDIGNvZGU6ICcsIHsgaWRlbnRpZmllcjogaWRlbnRpZmllciwgZGF0YTogZGF0YSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0UHJpbnRIYW5kbGVyKGZ1bmN0aW9uIChkYXRhLCBzdGFydCwgZW5kKSB7IHJldHVybiBfdGhpcy5wcmludChkYXRhLCBzdGFydCwgZW5kKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignQCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmluc2VydENoYXJzKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0EnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JVcChwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdCJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY3Vyc29yRG93bihwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdDJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY3Vyc29yRm9yd2FyZChwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdEJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY3Vyc29yQmFja3dhcmQocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignRScsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmN1cnNvck5leHRMaW5lKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0YnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JQcmVjZWRpbmdMaW5lKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0cnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JDaGFyQWJzb2x1dGUocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignSCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmN1cnNvclBvc2l0aW9uKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0knLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JGb3J3YXJkVGFiKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0onLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5lcmFzZUluRGlzcGxheShwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdLJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuZXJhc2VJbkxpbmUocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignTCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmluc2VydExpbmVzKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ00nLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5kZWxldGVMaW5lcyhwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdQJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuZGVsZXRlQ2hhcnMocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignUycsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLnNjcm9sbFVwKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ1QnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zY3JvbGxEb3duKHBhcmFtcywgY29sbGVjdCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ1gnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5lcmFzZUNoYXJzKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ1onLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JCYWNrd2FyZFRhYihwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdgJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY2hhclBvc0Fic29sdXRlKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ2EnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5oUG9zaXRpb25SZWxhdGl2ZShwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdiJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMucmVwZWF0UHJlY2VkaW5nQ2hhcmFjdGVyKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ2MnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zZW5kRGV2aWNlQXR0cmlidXRlcyhwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdkJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMubGluZVBvc0Fic29sdXRlKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ2UnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy52UG9zaXRpb25SZWxhdGl2ZShwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdmJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuaFZQb3NpdGlvbihwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdnJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMudGFiQ2xlYXIocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignaCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLnNldE1vZGUocGFyYW1zLCBjb2xsZWN0KTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignbCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLnJlc2V0TW9kZShwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdtJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY2hhckF0dHJpYnV0ZXMocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignbicsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmRldmljZVN0YXR1cyhwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdwJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuc29mdFJlc2V0KHBhcmFtcywgY29sbGVjdCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ3EnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zZXRDdXJzb3JTdHlsZShwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdyJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuc2V0U2Nyb2xsUmVnaW9uKHBhcmFtcywgY29sbGVjdCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ3MnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zYXZlQ3Vyc29yKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ3UnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5yZXN0b3JlQ3Vyc29yKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkJFTCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuYmVsbCgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5MRiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMubGluZUZlZWQoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXhlY3V0ZUhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuVlQsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmxpbmVGZWVkKCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkZGLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5saW5lRmVlZCgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5DUiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuY2FycmlhZ2VSZXR1cm4oKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXhlY3V0ZUhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuQlMsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmJhY2tzcGFjZSgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5IVCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudGFiKCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLlNPLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zaGlmdE91dCgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5TSSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2hpZnRJbigpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMS5JTkQsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmluZGV4KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMxLk5FTCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMubmV4dExpbmUoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXhlY3V0ZUhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzEuSFRTLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy50YWJTZXQoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0T3NjSGFuZGxlcigwLCBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gX3RoaXMuc2V0VGl0bGUoZGF0YSk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldE9zY0hhbmRsZXIoMiwgZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF90aGlzLnNldFRpdGxlKGRhdGEpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCc3JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2F2ZUN1cnNvcihbXSk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJzgnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZXN0b3JlQ3Vyc29yKFtdKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignRCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmluZGV4KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ0UnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5uZXh0TGluZSgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCdIJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudGFiU2V0KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ00nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZXZlcnNlSW5kZXgoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignPScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmtleXBhZEFwcGxpY2F0aW9uTW9kZSgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCc+JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMua2V5cGFkTnVtZXJpY01vZGUoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignYycsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnJlc2V0KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ24nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMik7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ28nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ3wnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ30nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMik7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ34nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMSk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJyVAJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2VsZWN0RGVmYXVsdENoYXJzZXQoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignJUcnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3REZWZhdWx0Q2hhcnNldCgpOyB9KTtcbiAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgICAgICAgdGhpc18xLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignKCcgKyBmbGFnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3RDaGFyc2V0KCcoJyArIGZsYWcpOyB9KTtcbiAgICAgICAgICAgIHRoaXNfMS5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJyknICsgZmxhZywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2VsZWN0Q2hhcnNldCgnKScgKyBmbGFnKTsgfSk7XG4gICAgICAgICAgICB0aGlzXzEuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCcqJyArIGZsYWcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbGVjdENoYXJzZXQoJyonICsgZmxhZyk7IH0pO1xuICAgICAgICAgICAgdGhpc18xLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignKycgKyBmbGFnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3RDaGFyc2V0KCcrJyArIGZsYWcpOyB9KTtcbiAgICAgICAgICAgIHRoaXNfMS5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJy0nICsgZmxhZywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2VsZWN0Q2hhcnNldCgnLScgKyBmbGFnKTsgfSk7XG4gICAgICAgICAgICB0aGlzXzEuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCcuJyArIGZsYWcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbGVjdENoYXJzZXQoJy4nICsgZmxhZyk7IH0pO1xuICAgICAgICAgICAgdGhpc18xLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignLycgKyBmbGFnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3RDaGFyc2V0KCcvJyArIGZsYWcpOyB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHRoaXNfMSA9IHRoaXM7XG4gICAgICAgIGZvciAodmFyIGZsYWcgaW4gQ2hhcnNldHNfMS5DSEFSU0VUUykge1xuICAgICAgICAgICAgX2xvb3BfMShmbGFnKTtcbiAgICAgICAgfVxuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVycm9ySGFuZGxlcihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5lcnJvcignUGFyc2luZyBlcnJvcjogJywgc3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXREY3NIYW5kbGVyKCckcScsIG5ldyBERUNSUVNTKF90aGlzLl90ZXJtaW5hbCkpO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldERjc0hhbmRsZXIoJytxJywgbmV3IFJlcXVlc3RUZXJtaW5mbyhfdGhpcy5fdGVybWluYWwpKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IG51bGw7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90ZXJtaW5hbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIHZhciBjdXJzb3JTdGFydFggPSBidWZmZXIueDtcbiAgICAgICAgdmFyIGN1cnNvclN0YXJ0WSA9IGJ1ZmZlci55O1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuZGVidWcpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnZGF0YTogJyArIGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9zdXJyb2dhdGVGaXJzdCkge1xuICAgICAgICAgICAgZGF0YSA9IHRoaXMuX3N1cnJvZ2F0ZUZpcnN0ICsgZGF0YTtcbiAgICAgICAgICAgIHRoaXMuX3N1cnJvZ2F0ZUZpcnN0ID0gJyc7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcGFyc2VyLnBhcnNlKGRhdGEpO1xuICAgICAgICBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIGlmIChidWZmZXIueCAhPT0gY3Vyc29yU3RhcnRYIHx8IGJ1ZmZlci55ICE9PSBjdXJzb3JTdGFydFkpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVtaXQoJ2N1cnNvcm1vdmUnKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5wcmludCA9IGZ1bmN0aW9uIChkYXRhLCBzdGFydCwgZW5kKSB7XG4gICAgICAgIHZhciBjaGFyO1xuICAgICAgICB2YXIgY29kZTtcbiAgICAgICAgdmFyIGNoV2lkdGg7XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIHZhciBjaGFyc2V0ID0gdGhpcy5fdGVybWluYWwuY2hhcnNldDtcbiAgICAgICAgdmFyIHNjcmVlblJlYWRlck1vZGUgPSB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLnNjcmVlblJlYWRlck1vZGU7XG4gICAgICAgIHZhciBjb2xzID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgdmFyIHdyYXBhcm91bmRNb2RlID0gdGhpcy5fdGVybWluYWwud3JhcGFyb3VuZE1vZGU7XG4gICAgICAgIHZhciBpbnNlcnRNb2RlID0gdGhpcy5fdGVybWluYWwuaW5zZXJ0TW9kZTtcbiAgICAgICAgdmFyIGN1ckF0dHIgPSB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyO1xuICAgICAgICB2YXIgYnVmZmVyUm93ID0gYnVmZmVyLmxpbmVzLmdldChidWZmZXIueSArIGJ1ZmZlci55YmFzZSk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci55KTtcbiAgICAgICAgZm9yICh2YXIgc3RyaW5nUG9zaXRpb24gPSBzdGFydDsgc3RyaW5nUG9zaXRpb24gPCBlbmQ7ICsrc3RyaW5nUG9zaXRpb24pIHtcbiAgICAgICAgICAgIGNoYXIgPSBkYXRhLmNoYXJBdChzdHJpbmdQb3NpdGlvbik7XG4gICAgICAgICAgICBjb2RlID0gZGF0YS5jaGFyQ29kZUF0KHN0cmluZ1Bvc2l0aW9uKTtcbiAgICAgICAgICAgIGlmICgweEQ4MDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4REJGRikge1xuICAgICAgICAgICAgICAgIGlmICgrK3N0cmluZ1Bvc2l0aW9uID49IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdXJyb2dhdGVGaXJzdCA9IGNoYXI7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgc2Vjb25kID0gZGF0YS5jaGFyQ29kZUF0KHN0cmluZ1Bvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBpZiAoMHhEQzAwIDw9IHNlY29uZCAmJiBzZWNvbmQgPD0gMHhERkZGKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGUgPSAoY29kZSAtIDB4RDgwMCkgKiAweDQwMCArIHNlY29uZCAtIDB4REMwMCArIDB4MTAwMDA7XG4gICAgICAgICAgICAgICAgICAgIGNoYXIgKz0gZGF0YS5jaGFyQXQoc3RyaW5nUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nUG9zaXRpb24tLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaFdpZHRoID0gQ2hhcldpZHRoXzEud2N3aWR0aChjb2RlKTtcbiAgICAgICAgICAgIGlmIChjaGFyc2V0KSB7XG4gICAgICAgICAgICAgICAgY2hhciA9IGNoYXJzZXRbY2hhcl0gfHwgY2hhcjtcbiAgICAgICAgICAgICAgICBjb2RlID0gY2hhci5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNjcmVlblJlYWRlck1vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbWl0KCdhMTF5LmNoYXInLCBjaGFyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY2hXaWR0aCAmJiBidWZmZXIueCkge1xuICAgICAgICAgICAgICAgIHZhciBjaE1pbnVzT25lID0gYnVmZmVyUm93LmdldChidWZmZXIueCAtIDEpO1xuICAgICAgICAgICAgICAgIGlmIChjaE1pbnVzT25lKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2hNaW51c09uZVtCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hNaW51c1R3byA9IGJ1ZmZlclJvdy5nZXQoYnVmZmVyLnggLSAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaE1pbnVzVHdvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hNaW51c1R3b1tCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0gKz0gY2hhcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaE1pbnVzVHdvW0J1ZmZlcl8xLkNIQVJfREFUQV9DT0RFX0lOREVYXSA9IGNvZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyUm93LnNldChidWZmZXIueCAtIDIsIGNoTWludXNUd28pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hNaW51c09uZVtCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0gKz0gY2hhcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoTWludXNPbmVbQnVmZmVyXzEuQ0hBUl9EQVRBX0NPREVfSU5ERVhdID0gY29kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlclJvdy5zZXQoYnVmZmVyLnggLSAxLCBjaE1pbnVzT25lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChidWZmZXIueCArIGNoV2lkdGggLSAxID49IGNvbHMpIHtcbiAgICAgICAgICAgICAgICBpZiAod3JhcGFyb3VuZE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnggPSAwO1xuICAgICAgICAgICAgICAgICAgICBidWZmZXIueSsrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnVmZmVyLnkgPiBidWZmZXIuc2Nyb2xsQm90dG9tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIueS0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2Nyb2xsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmxpbmVzLmdldChidWZmZXIueSkuaXNXcmFwcGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBidWZmZXJSb3cgPSBidWZmZXIubGluZXMuZ2V0KGJ1ZmZlci55ICsgYnVmZmVyLnliYXNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaFdpZHRoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbnNlcnRNb2RlKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyUm93Lmluc2VydENlbGxzKGJ1ZmZlci54LCBjaFdpZHRoLCBbY3VyQXR0ciwgQnVmZmVyXzEuTlVMTF9DRUxMX0NIQVIsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9XSURUSCwgQnVmZmVyXzEuTlVMTF9DRUxMX0NPREVdKTtcbiAgICAgICAgICAgICAgICB2YXIgbGFzdENlbGwgPSBidWZmZXJSb3cuZ2V0KGNvbHMgLSAxKTtcbiAgICAgICAgICAgICAgICBpZiAobGFzdENlbGxbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICBidWZmZXJSb3cuc2V0KGNvbHMgLSAxLCBbY3VyQXR0ciwgQnVmZmVyXzEuTlVMTF9DRUxMX0NIQVIsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9XSURUSCwgQnVmZmVyXzEuTlVMTF9DRUxMX0NPREVdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidWZmZXJSb3cuc2V0KGJ1ZmZlci54KyssIFtjdXJBdHRyLCBjaGFyLCBjaFdpZHRoLCBjb2RlXSk7XG4gICAgICAgICAgICBpZiAoY2hXaWR0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoLS1jaFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlclJvdy5zZXQoYnVmZmVyLngrKywgW2N1ckF0dHIsICcnLCAwLCB1bmRlZmluZWRdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnkpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5iZWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5iZWxsKCk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmxpbmVGZWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwub3B0aW9ucy5jb252ZXJ0RW9sKSB7XG4gICAgICAgICAgICBidWZmZXIueCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgYnVmZmVyLnkrKztcbiAgICAgICAgaWYgKGJ1ZmZlci55ID4gYnVmZmVyLnNjcm9sbEJvdHRvbSkge1xuICAgICAgICAgICAgYnVmZmVyLnktLTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcm9sbCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChidWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICBidWZmZXIueC0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVtaXQoJ2xpbmVmZWVkJyk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmNhcnJpYWdlUmV0dXJuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IDA7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmJhY2tzcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLngtLTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS50YWIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvcmlnaW5hbFggPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueDtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIubmV4dFN0b3AoKTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuc2NyZWVuUmVhZGVyTW9kZSkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZW1pdCgnYTExeS50YWInLCB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCAtIG9yaWdpbmFsWCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2hpZnRPdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdMZXZlbCgxKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2hpZnRJbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0Z0xldmVsKDApO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5pbnNlcnRDaGFycyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmdldCh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSArIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55YmFzZSkuaW5zZXJ0Q2VsbHModGhpcy5fdGVybWluYWwuYnVmZmVyLngsIHBhcmFtc1swXSB8fCAxLCBbdGhpcy5fdGVybWluYWwuZXJhc2VBdHRyKCksIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DSEFSLCBCdWZmZXJfMS5OVUxMX0NFTExfV0lEVEgsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DT0RFXSk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY3Vyc29yVXAgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55IC09IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IDA7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY3Vyc29yRG93biA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKz0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueC0tO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvckZvcndhcmQgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICs9IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnggPj0gdGhpcy5fdGVybWluYWwuY29scykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSB0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jdXJzb3JCYWNrd2FyZCA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54LS07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggLT0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gMDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jdXJzb3JOZXh0TGluZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKz0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gMDtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY3Vyc29yUHJlY2VkaW5nTGluZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgLT0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IDA7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvckNoYXJBYnNvbHV0ZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSBwYXJhbSAtIDE7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvclBvc2l0aW9uID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgY29sO1xuICAgICAgICB2YXIgcm93ID0gcGFyYW1zWzBdIC0gMTtcbiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgY29sID0gcGFyYW1zWzFdIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvdyA8IDApIHtcbiAgICAgICAgICAgIHJvdyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocm93ID49IHRoaXMuX3Rlcm1pbmFsLnJvd3MpIHtcbiAgICAgICAgICAgIHJvdyA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb2wgPCAwKSB7XG4gICAgICAgICAgICBjb2wgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICBjb2wgPSB0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IGNvbDtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSByb3c7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvckZvcndhcmRUYWIgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXSB8fCAxO1xuICAgICAgICB3aGlsZSAocGFyYW0tLSkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIubmV4dFN0b3AoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5fZXJhc2VJbkJ1ZmZlckxpbmUgPSBmdW5jdGlvbiAoeSwgc3RhcnQsIGVuZCwgY2xlYXJXcmFwKSB7XG4gICAgICAgIGlmIChjbGVhcldyYXAgPT09IHZvaWQgMCkgeyBjbGVhcldyYXAgPSBmYWxzZTsgfVxuICAgICAgICB2YXIgbGluZSA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQodGhpcy5fdGVybWluYWwuYnVmZmVyLnliYXNlICsgeSk7XG4gICAgICAgIGxpbmUucmVwbGFjZUNlbGxzKHN0YXJ0LCBlbmQsIFt0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHIoKSwgQnVmZmVyXzEuTlVMTF9DRUxMX0NIQVIsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9XSURUSCwgQnVmZmVyXzEuTlVMTF9DRUxMX0NPREVdKTtcbiAgICAgICAgaWYgKGNsZWFyV3JhcCkge1xuICAgICAgICAgICAgbGluZS5pc1dyYXBwZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5fcmVzZXRCdWZmZXJMaW5lID0gZnVuY3Rpb24gKHkpIHtcbiAgICAgICAgdGhpcy5fZXJhc2VJbkJ1ZmZlckxpbmUoeSwgMCwgdGhpcy5fdGVybWluYWwuY29scywgdHJ1ZSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmVyYXNlSW5EaXNwbGF5ID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgajtcbiAgICAgICAgc3dpdGNoIChwYXJhbXNbMF0pIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBqID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2Uoaik7XG4gICAgICAgICAgICAgICAgdGhpcy5fZXJhc2VJbkJ1ZmZlckxpbmUoaisrLCB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCwgdGhpcy5fdGVybWluYWwuY29scywgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPT09IDApO1xuICAgICAgICAgICAgICAgIGZvciAoOyBqIDwgdGhpcy5fdGVybWluYWwucm93czsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QnVmZmVyTGluZShqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2Uoaik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgaiA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55O1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGopO1xuICAgICAgICAgICAgICAgIHRoaXMuX2VyYXNlSW5CdWZmZXJMaW5lKGosIDAsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICsgMSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICsgMSA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQoaiArIDEpLmlzV3JhcHBlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3aGlsZSAoai0tKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QnVmZmVyTGluZShqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgaiA9IHRoaXMuX3Rlcm1pbmFsLnJvd3M7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoaiAtIDEpO1xuICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzZXRCdWZmZXJMaW5lKGopO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZSgwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsQmFja1NpemUgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIubGluZXMubGVuZ3RoIC0gdGhpcy5fdGVybWluYWwucm93cztcbiAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsQmFja1NpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy50cmltU3RhcnQoc2Nyb2xsQmFja1NpemUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWJhc2UgPSBNYXRoLm1heCh0aGlzLl90ZXJtaW5hbC5idWZmZXIueWJhc2UgLSBzY3JvbGxCYWNrU2l6ZSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcCA9IE1hdGgubWF4KHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcCAtIHNjcm9sbEJhY2tTaXplLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZW1pdCgnc2Nyb2xsJywgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmVyYXNlSW5MaW5lID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIHRoaXMuX2VyYXNlSW5CdWZmZXJMaW5lKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55LCB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCwgdGhpcy5fdGVybWluYWwuY29scyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgdGhpcy5fZXJhc2VJbkJ1ZmZlckxpbmUodGhpcy5fdGVybWluYWwuYnVmZmVyLnksIDAsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICsgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgdGhpcy5fZXJhc2VJbkJ1ZmZlckxpbmUodGhpcy5fdGVybWluYWwuYnVmZmVyLnksIDAsIHRoaXMuX3Rlcm1pbmFsLmNvbHMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuaW5zZXJ0TGluZXMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIHZhciByb3cgPSBidWZmZXIueSArIGJ1ZmZlci55YmFzZTtcbiAgICAgICAgdmFyIHNjcm9sbEJvdHRvbVJvd3NPZmZzZXQgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSAtIGJ1ZmZlci5zY3JvbGxCb3R0b207XG4gICAgICAgIHZhciBzY3JvbGxCb3R0b21BYnNvbHV0ZSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxICsgYnVmZmVyLnliYXNlIC0gc2Nyb2xsQm90dG9tUm93c09mZnNldCArIDE7XG4gICAgICAgIHdoaWxlIChwYXJhbS0tKSB7XG4gICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKHNjcm9sbEJvdHRvbUFic29sdXRlIC0gMSwgMSk7XG4gICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKHJvdywgMCwgYnVmZmVyLmdldEJsYW5rTGluZSh0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHIoKSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci55KTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnNjcm9sbEJvdHRvbSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmRlbGV0ZUxpbmVzID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF07XG4gICAgICAgIGlmIChwYXJhbSA8IDEpIHtcbiAgICAgICAgICAgIHBhcmFtID0gMTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICB2YXIgcm93ID0gYnVmZmVyLnkgKyBidWZmZXIueWJhc2U7XG4gICAgICAgIHZhciBqO1xuICAgICAgICBqID0gdGhpcy5fdGVybWluYWwucm93cyAtIDEgLSBidWZmZXIuc2Nyb2xsQm90dG9tO1xuICAgICAgICBqID0gdGhpcy5fdGVybWluYWwucm93cyAtIDEgKyBidWZmZXIueWJhc2UgLSBqO1xuICAgICAgICB3aGlsZSAocGFyYW0tLSkge1xuICAgICAgICAgICAgYnVmZmVyLmxpbmVzLnNwbGljZShyb3csIDEpO1xuICAgICAgICAgICAgYnVmZmVyLmxpbmVzLnNwbGljZShqLCAwLCBidWZmZXIuZ2V0QmxhbmtMaW5lKHRoaXMuX3Rlcm1pbmFsLmVyYXNlQXR0cigpKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnkpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZShidWZmZXIuc2Nyb2xsQm90dG9tKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuZGVsZXRlQ2hhcnMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKyB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWJhc2UpLmRlbGV0ZUNlbGxzKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54LCBwYXJhbXNbMF0gfHwgMSwgW3RoaXMuX3Rlcm1pbmFsLmVyYXNlQXR0cigpLCBCdWZmZXJfMS5OVUxMX0NFTExfQ0hBUiwgQnVmZmVyXzEuTlVMTF9DRUxMX1dJRFRILCBCdWZmZXJfMS5OVUxMX0NFTExfQ09ERV0pO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZSh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnNjcm9sbFVwID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF0gfHwgMTtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgd2hpbGUgKHBhcmFtLS0pIHtcbiAgICAgICAgICAgIGJ1ZmZlci5saW5lcy5zcGxpY2UoYnVmZmVyLnliYXNlICsgYnVmZmVyLnNjcm9sbFRvcCwgMSk7XG4gICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKGJ1ZmZlci55YmFzZSArIGJ1ZmZlci5zY3JvbGxCb3R0b20sIDAsIGJ1ZmZlci5nZXRCbGFua0xpbmUoQnVmZmVyXzEuREVGQVVMVF9BVFRSKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnNjcm9sbFRvcCk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci5zY3JvbGxCb3R0b20pO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5zY3JvbGxEb3duID0gZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkge1xuICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA8IDIgJiYgIWNvbGxlY3QpIHtcbiAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXSB8fCAxO1xuICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgICAgIHdoaWxlIChwYXJhbS0tKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyLmxpbmVzLnNwbGljZShidWZmZXIueWJhc2UgKyBidWZmZXIuc2Nyb2xsQm90dG9tLCAxKTtcbiAgICAgICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKGJ1ZmZlci55YmFzZSArIGJ1ZmZlci5zY3JvbGxCb3R0b20sIDAsIGJ1ZmZlci5nZXRCbGFua0xpbmUoQnVmZmVyXzEuREVGQVVMVF9BVFRSKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZShidWZmZXIuc2Nyb2xsVG9wKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci5zY3JvbGxCb3R0b20pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmVyYXNlQ2hhcnMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKyB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWJhc2UpLnJlcGxhY2VDZWxscyh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCwgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggKyAocGFyYW1zWzBdIHx8IDEpLCBbdGhpcy5fdGVybWluYWwuZXJhc2VBdHRyKCksIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DSEFSLCBCdWZmZXJfMS5OVUxMX0NFTExfV0lEVEgsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DT0RFXSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvckJhY2t3YXJkVGFiID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF0gfHwgMTtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgd2hpbGUgKHBhcmFtLS0pIHtcbiAgICAgICAgICAgIGJ1ZmZlci54ID0gYnVmZmVyLnByZXZTdG9wKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY2hhclBvc0Fic29sdXRlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF07XG4gICAgICAgIGlmIChwYXJhbSA8IDEpIHtcbiAgICAgICAgICAgIHBhcmFtID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IHBhcmFtIC0gMTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuaFBvc2l0aW9uUmVsYXRpdmUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICs9IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnggPj0gdGhpcy5fdGVybWluYWwuY29scykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSB0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5yZXBlYXRQcmVjZWRpbmdDaGFyYWN0ZXIgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIHZhciBsaW5lID0gYnVmZmVyLmxpbmVzLmdldChidWZmZXIueWJhc2UgKyBidWZmZXIueSk7XG4gICAgICAgIGxpbmUucmVwbGFjZUNlbGxzKGJ1ZmZlci54LCBidWZmZXIueCArIChwYXJhbXNbMF0gfHwgMSksIGxpbmUuZ2V0KGJ1ZmZlci54IC0gMSkgfHwgW0J1ZmZlcl8xLkRFRkFVTFRfQVRUUiwgQnVmZmVyXzEuTlVMTF9DRUxMX0NIQVIsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9XSURUSCwgQnVmZmVyXzEuTlVMTF9DRUxMX0NPREVdKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2VuZERldmljZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7XG4gICAgICAgIGlmIChwYXJhbXNbMF0gPiAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuaXMoJ3h0ZXJtJykgfHwgdGhpcy5fdGVybWluYWwuaXMoJ3J4dnQtdW5pY29kZScpIHx8IHRoaXMuX3Rlcm1pbmFsLmlzKCdzY3JlZW4nKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1s/MTsyYycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fdGVybWluYWwuaXMoJ2xpbnV4JykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPzZjJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29sbGVjdCA9PT0gJz4nKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuaXMoJ3h0ZXJtJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPjA7Mjc2OzBjJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLl90ZXJtaW5hbC5pcygncnh2dC11bmljb2RlJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPjg1Ozk1OzBjJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLl90ZXJtaW5hbC5pcygnbGludXgnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIocGFyYW1zWzBdICsgJ2MnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX3Rlcm1pbmFsLmlzKCdzY3JlZW4nKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1s+ODM7NDAwMDM7MGMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5saW5lUG9zQWJzb2x1dGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gcGFyYW0gLSAxO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPj0gdGhpcy5fdGVybWluYWwucm93cykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS52UG9zaXRpb25SZWxhdGl2ZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKz0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueC0tO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmhWUG9zaXRpb24gPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIGlmIChwYXJhbXNbMF0gPCAxKVxuICAgICAgICAgICAgcGFyYW1zWzBdID0gMTtcbiAgICAgICAgaWYgKHBhcmFtc1sxXSA8IDEpXG4gICAgICAgICAgICBwYXJhbXNbMV0gPSAxO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHBhcmFtc1swXSAtIDE7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gcGFyYW1zWzFdIC0gMTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUudGFiQ2xlYXIgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDw9IDApIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl90ZXJtaW5hbC5idWZmZXIudGFic1t0aGlzLl90ZXJtaW5hbC5idWZmZXIueF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFyYW0gPT09IDMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci50YWJzID0ge307XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2V0TW9kZSA9IGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHtcbiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0TW9kZShbcGFyYW1zW2ldXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuaW5zZXJ0TW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjA6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbGxlY3QgPT09ICc/Jykge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbXNbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uQ3Vyc29yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRnQ2hhcnNldCgwLCBDaGFyc2V0c18xLkRFRkFVTFRfQ0hBUlNFVCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdDaGFyc2V0KDEsIENoYXJzZXRzXzEuREVGQVVMVF9DSEFSU0VUKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0Z0NoYXJzZXQoMiwgQ2hhcnNldHNfMS5ERUZBVUxUX0NIQVJTRVQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRnQ2hhcnNldCgzLCBDaGFyc2V0c18xLkRFRkFVTFRfQ0hBUlNFVCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2F2ZWRDb2xzID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwucmVzaXplKDEzMiwgdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwub3JpZ2luTW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwud3JhcGFyb3VuZE1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDY2OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5sb2coJ1NlcmlhbCBwb3J0IHJlcXVlc3RlZCBhcHBsaWNhdGlvbiBrZXlwYWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uS2V5cGFkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICBjYXNlIDEwMDA6XG4gICAgICAgICAgICAgICAgY2FzZSAxMDAyOlxuICAgICAgICAgICAgICAgIGNhc2UgMTAwMzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwueDEwTW91c2UgPSBwYXJhbXNbMF0gPT09IDk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZ0MjAwTW91c2UgPSBwYXJhbXNbMF0gPT09IDEwMDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLm5vcm1hbE1vdXNlID0gcGFyYW1zWzBdID4gMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwubW91c2VFdmVudHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2VuYWJsZS1tb3VzZS1ldmVudHMnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2VsZWN0aW9uTWFuYWdlci5kaXNhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnQmluZGluZyB0byBtb3VzZSBldmVudHMuJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAwNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2VuZEZvY3VzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDA1OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC51dGZNb3VzZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAwNjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2dyTW91c2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwMTU6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVyeHZ0TW91c2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDI1OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJzb3JIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ4OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVDdXJzb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ5OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVDdXJzb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICBjYXNlIDQ3OlxuICAgICAgICAgICAgICAgIGNhc2UgMTA0NzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVycy5hY3RpdmF0ZUFsdEJ1ZmZlcih0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHIoKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnJlZnJlc2goMCwgdGhpcy5fdGVybWluYWwucm93cyAtIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwudmlld3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0LnN5bmNTY3JvbGxBcmVhKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2hvd0N1cnNvcigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDIwMDQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJyYWNrZXRlZFBhc3RlTW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnJlc2V0TW9kZSA9IGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHtcbiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRNb2RlKFtwYXJhbXNbaV1dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbGxlY3QpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocGFyYW1zWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5pbnNlcnRNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjA6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbGxlY3QgPT09ICc/Jykge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbXNbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uQ3Vyc29yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmNvbHMgPT09IDEzMiAmJiB0aGlzLl90ZXJtaW5hbC5zYXZlZENvbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnJlc2l6ZSh0aGlzLl90ZXJtaW5hbC5zYXZlZENvbHMsIHRoaXMuX3Rlcm1pbmFsLnJvd3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl90ZXJtaW5hbC5zYXZlZENvbHM7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwub3JpZ2luTW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLndyYXBhcm91bmRNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTI6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNjY6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnU3dpdGNoaW5nIGJhY2sgdG8gbm9ybWFsIGtleXBhZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYXBwbGljYXRpb25LZXlwYWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICBjYXNlIDEwMDA6XG4gICAgICAgICAgICAgICAgY2FzZSAxMDAyOlxuICAgICAgICAgICAgICAgIGNhc2UgMTAwMzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwueDEwTW91c2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudnQyMDBNb3VzZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5ub3JtYWxNb3VzZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5tb3VzZUV2ZW50cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2VuYWJsZS1tb3VzZS1ldmVudHMnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2VsZWN0aW9uTWFuYWdlci5lbmFibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDA0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZW5kRm9jdXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDA1OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC51dGZNb3VzZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwMDY6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNnck1vdXNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAxNTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXJ4dnRNb3VzZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDI1OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJzb3JIaWRkZW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwNDg6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdG9yZUN1cnNvcihwYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwNDk6XG4gICAgICAgICAgICAgICAgY2FzZSA0NzpcbiAgICAgICAgICAgICAgICBjYXNlIDEwNDc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcnMuYWN0aXZhdGVOb3JtYWxCdWZmZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtc1swXSA9PT0gMTA0OSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlQ3Vyc29yKHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwucmVmcmVzaCgwLCB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC52aWV3cG9ydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zaG93Q3Vyc29yKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjAwNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnJhY2tldGVkUGFzdGVNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmNoYXJBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PT0gMSAmJiBwYXJhbXNbMF0gPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmN1ckF0dHIgPSBCdWZmZXJfMS5ERUZBVUxUX0FUVFI7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGwgPSBwYXJhbXMubGVuZ3RoO1xuICAgICAgICB2YXIgZmxhZ3MgPSB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyID4+IDE4O1xuICAgICAgICB2YXIgZmcgPSAodGhpcy5fdGVybWluYWwuY3VyQXR0ciA+PiA5KSAmIDB4MWZmO1xuICAgICAgICB2YXIgYmcgPSB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyICYgMHgxZmY7XG4gICAgICAgIHZhciBwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgcCA9IHBhcmFtc1tpXTtcbiAgICAgICAgICAgIGlmIChwID49IDMwICYmIHAgPD0gMzcpIHtcbiAgICAgICAgICAgICAgICBmZyA9IHAgLSAzMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPj0gNDAgJiYgcCA8PSA0Nykge1xuICAgICAgICAgICAgICAgIGJnID0gcCAtIDQwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA+PSA5MCAmJiBwIDw9IDk3KSB7XG4gICAgICAgICAgICAgICAgcCArPSA4O1xuICAgICAgICAgICAgICAgIGZnID0gcCAtIDkwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA+PSAxMDAgJiYgcCA8PSAxMDcpIHtcbiAgICAgICAgICAgICAgICBwICs9IDg7XG4gICAgICAgICAgICAgICAgYmcgPSBwIC0gMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGZsYWdzID0gQnVmZmVyXzEuREVGQVVMVF9BVFRSID4+IDE4O1xuICAgICAgICAgICAgICAgIGZnID0gKEJ1ZmZlcl8xLkRFRkFVTFRfQVRUUiA+PiA5KSAmIDB4MWZmO1xuICAgICAgICAgICAgICAgIGJnID0gQnVmZmVyXzEuREVGQVVMVF9BVFRSICYgMHgxZmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAxKSB7XG4gICAgICAgICAgICAgICAgZmxhZ3MgfD0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDMpIHtcbiAgICAgICAgICAgICAgICBmbGFncyB8PSA2NDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDQpIHtcbiAgICAgICAgICAgICAgICBmbGFncyB8PSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gNSkge1xuICAgICAgICAgICAgICAgIGZsYWdzIHw9IDQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSA3KSB7XG4gICAgICAgICAgICAgICAgZmxhZ3MgfD0gODtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDgpIHtcbiAgICAgICAgICAgICAgICBmbGFncyB8PSAxNjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDIpIHtcbiAgICAgICAgICAgICAgICBmbGFncyB8PSAzMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDIyKSB7XG4gICAgICAgICAgICAgICAgZmxhZ3MgJj0gfjE7XG4gICAgICAgICAgICAgICAgZmxhZ3MgJj0gfjMyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMjMpIHtcbiAgICAgICAgICAgICAgICBmbGFncyAmPSB+NjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyNCkge1xuICAgICAgICAgICAgICAgIGZsYWdzICY9IH4yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMjUpIHtcbiAgICAgICAgICAgICAgICBmbGFncyAmPSB+NDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDI3KSB7XG4gICAgICAgICAgICAgICAgZmxhZ3MgJj0gfjg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyOCkge1xuICAgICAgICAgICAgICAgIGZsYWdzICY9IH4xNjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDM5KSB7XG4gICAgICAgICAgICAgICAgZmcgPSAoQnVmZmVyXzEuREVGQVVMVF9BVFRSID4+IDkpICYgMHgxZmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSA0OSkge1xuICAgICAgICAgICAgICAgIGJnID0gQnVmZmVyXzEuREVGQVVMVF9BVFRSICYgMHgxZmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAzOCkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXNbaSArIDFdID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgZmcgPSB0aGlzLl90ZXJtaW5hbC5tYXRjaENvbG9yKHBhcmFtc1tpXSAmIDB4ZmYsIHBhcmFtc1tpICsgMV0gJiAweGZmLCBwYXJhbXNbaSArIDJdICYgMHhmZik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmZyA9PT0gLTEpXG4gICAgICAgICAgICAgICAgICAgICAgICBmZyA9IDB4MWZmO1xuICAgICAgICAgICAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtc1tpICsgMV0gPT09IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgaSArPSAyO1xuICAgICAgICAgICAgICAgICAgICBwID0gcGFyYW1zW2ldICYgMHhmZjtcbiAgICAgICAgICAgICAgICAgICAgZmcgPSBwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDQ4KSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtc1tpICsgMV0gPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgaSArPSAyO1xuICAgICAgICAgICAgICAgICAgICBiZyA9IHRoaXMuX3Rlcm1pbmFsLm1hdGNoQ29sb3IocGFyYW1zW2ldICYgMHhmZiwgcGFyYW1zW2kgKyAxXSAmIDB4ZmYsIHBhcmFtc1tpICsgMl0gJiAweGZmKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJnID09PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnID0gMHgxZmY7XG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1zW2kgKyAxXSA9PT0gNSkge1xuICAgICAgICAgICAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBwYXJhbXNbaV0gJiAweGZmO1xuICAgICAgICAgICAgICAgICAgICBiZyA9IHA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgZmcgPSAoQnVmZmVyXzEuREVGQVVMVF9BVFRSID4+IDkpICYgMHgxZmY7XG4gICAgICAgICAgICAgICAgYmcgPSBCdWZmZXJfMS5ERUZBVUxUX0FUVFIgJiAweDFmZjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVycm9yKCdVbmtub3duIFNHUiBhdHRyaWJ1dGU6ICVkLicsIHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmN1ckF0dHIgPSAoZmxhZ3MgPDwgMTgpIHwgKGZnIDw8IDkpIHwgYmc7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmRldmljZVN0YXR1cyA9IGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHtcbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZW1pdCgnZGF0YScsIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiWzBuXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgIHZhciB5ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKyAxO1xuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICsgMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZW1pdCgnZGF0YScsIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiW1wiICsgeSArIFwiO1wiICsgeCArIFwiUlwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29sbGVjdCA9PT0gJz8nKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSArIDE7XG4gICAgICAgICAgICAgICAgICAgIHZhciB4ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnggKyAxO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbWl0KCdkYXRhJywgRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJbP1wiICsgeSArIFwiO1wiICsgeCArIFwiUlwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxNTpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyNTpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyNjpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA1MzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc29mdFJlc2V0ID0gZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkge1xuICAgICAgICBpZiAoY29sbGVjdCA9PT0gJyEnKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJzb3JIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmluc2VydE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLm9yaWdpbk1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLndyYXBhcm91bmRNb2RlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uS2V5cGFkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwudmlld3BvcnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYXBwbGljYXRpb25DdXJzb3IgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zY3JvbGxUb3AgPSAwO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnNjcm9sbEJvdHRvbSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuY3VyQXR0ciA9IEJ1ZmZlcl8xLkRFRkFVTFRfQVRUUjtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSAwO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuY2hhcnNldCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5nbGV2ZWwgPSAwO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuY2hhcnNldHMgPSBbbnVsbF07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2V0Q3Vyc29yU3R5bGUgPSBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7XG4gICAgICAgIGlmIChjb2xsZWN0ID09PSAnICcpIHtcbiAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXSA8IDEgPyAxIDogcGFyYW1zWzBdO1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldE9wdGlvbignY3Vyc29yU3R5bGUnLCAnYmxvY2snKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0T3B0aW9uKCdjdXJzb3JTdHlsZScsICd1bmRlcmxpbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0T3B0aW9uKCdjdXJzb3JTdHlsZScsICdiYXInKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaXNCbGlua2luZyA9IHBhcmFtICUgMiA9PT0gMTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldE9wdGlvbignY3Vyc29yQmxpbmsnLCBpc0JsaW5raW5nKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5zZXRTY3JvbGxSZWdpb24gPSBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7XG4gICAgICAgIGlmIChjb2xsZWN0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2Nyb2xsVG9wID0gKHBhcmFtc1swXSB8fCAxKSAtIDE7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zY3JvbGxCb3R0b20gPSAocGFyYW1zWzFdICYmIHBhcmFtc1sxXSA8PSB0aGlzLl90ZXJtaW5hbC5yb3dzID8gcGFyYW1zWzFdIDogdGhpcy5fdGVybWluYWwucm93cykgLSAxO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IDA7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gMDtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2F2ZUN1cnNvciA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnNhdmVkWCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54O1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2F2ZWRZID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zYXZlZEN1ckF0dHIgPSB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5yZXN0b3JlQ3Vyc29yID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zYXZlZFggfHwgMDtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2F2ZWRZIHx8IDA7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmN1ckF0dHIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2F2ZWRDdXJBdHRyIHx8IEJ1ZmZlcl8xLkRFRkFVTFRfQVRUUjtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2V0VGl0bGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVUaXRsZShkYXRhKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUubmV4dExpbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gMDtcbiAgICAgICAgdGhpcy5pbmRleCgpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5rZXlwYWRBcHBsaWNhdGlvbk1vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnU2VyaWFsIHBvcnQgcmVxdWVzdGVkIGFwcGxpY2F0aW9uIGtleXBhZC4nKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYXBwbGljYXRpb25LZXlwYWQgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwudmlld3BvcnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0LnN5bmNTY3JvbGxBcmVhKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUua2V5cGFkTnVtZXJpY01vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnU3dpdGNoaW5nIGJhY2sgdG8gbm9ybWFsIGtleXBhZC4nKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYXBwbGljYXRpb25LZXlwYWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnNlbGVjdERlZmF1bHRDaGFyc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRnTGV2ZWwoMCk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdDaGFyc2V0KDAsIENoYXJzZXRzXzEuREVGQVVMVF9DSEFSU0VUKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2VsZWN0Q2hhcnNldCA9IGZ1bmN0aW9uIChjb2xsZWN0QW5kRmxhZykge1xuICAgICAgICBpZiAoY29sbGVjdEFuZEZsYWcubGVuZ3RoICE9PSAyKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0RGVmYXVsdENoYXJzZXQoKTtcbiAgICAgICAgaWYgKGNvbGxlY3RBbmRGbGFnWzBdID09PSAnLycpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdDaGFyc2V0KEdMRVZFTFtjb2xsZWN0QW5kRmxhZ1swXV0sIENoYXJzZXRzXzEuQ0hBUlNFVFNbY29sbGVjdEFuZEZsYWdbMV1dIHx8IENoYXJzZXRzXzEuREVGQVVMVF9DSEFSU0VUKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmluZGV4KCk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnRhYlNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwudGFiU2V0KCk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnJldmVyc2VJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwucmV2ZXJzZUluZGV4KCk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9wYXJzZXIucmVzZXQoKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwucmVzZXQoKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2V0Z0xldmVsID0gZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdMZXZlbChsZXZlbCk7XG4gICAgfTtcbiAgICByZXR1cm4gSW5wdXRIYW5kbGVyO1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLklucHV0SGFuZGxlciA9IElucHV0SGFuZGxlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUlucHV0SGFuZGxlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTW91c2Vab25lTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vdWkvTW91c2Vab25lTWFuYWdlclwiKTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXJcIik7XG52YXIgQnVmZmVyXzEgPSByZXF1aXJlKFwiLi9CdWZmZXJcIik7XG52YXIgQ2hhcldpZHRoXzEgPSByZXF1aXJlKFwiLi9DaGFyV2lkdGhcIik7XG52YXIgTGlua2lmaWVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGlua2lmaWVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExpbmtpZmllcihfdGVybWluYWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fbGlua01hdGNoZXJzID0gW107XG4gICAgICAgIF90aGlzLl9uZXh0TGlua01hdGNoZXJJZCA9IDA7XG4gICAgICAgIF90aGlzLl9yb3dzVG9MaW5raWZ5ID0ge1xuICAgICAgICAgICAgc3RhcnQ6IG51bGwsXG4gICAgICAgICAgICBlbmQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBMaW5raWZpZXIucHJvdG90eXBlLmF0dGFjaFRvRG9tID0gZnVuY3Rpb24gKG1vdXNlWm9uZU1hbmFnZXIpIHtcbiAgICAgICAgdGhpcy5fbW91c2Vab25lTWFuYWdlciA9IG1vdXNlWm9uZU1hbmFnZXI7XG4gICAgfTtcbiAgICBMaW5raWZpZXIucHJvdG90eXBlLmxpbmtpZnlSb3dzID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKCF0aGlzLl9tb3VzZVpvbmVNYW5hZ2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3Jvd3NUb0xpbmtpZnkuc3RhcnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jvd3NUb0xpbmtpZnkuc3RhcnQgPSBzdGFydDtcbiAgICAgICAgICAgIHRoaXMuX3Jvd3NUb0xpbmtpZnkuZW5kID0gZW5kO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcm93c1RvTGlua2lmeS5zdGFydCA9IE1hdGgubWluKHRoaXMuX3Jvd3NUb0xpbmtpZnkuc3RhcnQsIHN0YXJ0KTtcbiAgICAgICAgICAgIHRoaXMuX3Jvd3NUb0xpbmtpZnkuZW5kID0gTWF0aC5tYXgodGhpcy5fcm93c1RvTGlua2lmeS5lbmQsIGVuZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbW91c2Vab25lTWFuYWdlci5jbGVhckFsbChzdGFydCwgZW5kKTtcbiAgICAgICAgaWYgKHRoaXMuX3Jvd3NUaW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9yb3dzVGltZW91dElkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yb3dzVGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fbGlua2lmeVJvd3MoKTsgfSwgTGlua2lmaWVyLlRJTUVfQkVGT1JFX0xJTktJRlkpO1xuICAgIH07XG4gICAgTGlua2lmaWVyLnByb3RvdHlwZS5fbGlua2lmeVJvd3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Jvd3NUaW1lb3V0SWQgPSBudWxsO1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICB2YXIgYWJzb2x1dGVSb3dJbmRleFN0YXJ0ID0gYnVmZmVyLnlkaXNwICsgdGhpcy5fcm93c1RvTGlua2lmeS5zdGFydDtcbiAgICAgICAgaWYgKGFic29sdXRlUm93SW5kZXhTdGFydCA+PSBidWZmZXIubGluZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFic29sdXRlUm93SW5kZXhFbmQgPSBidWZmZXIueWRpc3AgKyBNYXRoLm1pbih0aGlzLl9yb3dzVG9MaW5raWZ5LmVuZCwgdGhpcy5fdGVybWluYWwucm93cykgKyAxO1xuICAgICAgICB2YXIgb3ZlcnNjYW5MaW5lTGltaXQgPSBNYXRoLmNlaWwoTGlua2lmaWVyLk9WRVJTQ0FOX0NIQVJfTElNSVQgLyB0aGlzLl90ZXJtaW5hbC5jb2xzKTtcbiAgICAgICAgdmFyIGl0ZXJhdG9yID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLml0ZXJhdG9yKGZhbHNlLCBhYnNvbHV0ZVJvd0luZGV4U3RhcnQsIGFic29sdXRlUm93SW5kZXhFbmQsIG92ZXJzY2FuTGluZUxpbWl0LCBvdmVyc2NhbkxpbmVMaW1pdCk7XG4gICAgICAgIHdoaWxlIChpdGVyYXRvci5oYXNOZXh0KCkpIHtcbiAgICAgICAgICAgIHZhciBsaW5lRGF0YSA9IGl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fbGlua01hdGNoZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZG9MaW5raWZ5Um93KGxpbmVEYXRhLnJhbmdlLmZpcnN0LCBsaW5lRGF0YS5jb250ZW50LCB0aGlzLl9saW5rTWF0Y2hlcnNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Jvd3NUb0xpbmtpZnkuc3RhcnQgPSBudWxsO1xuICAgICAgICB0aGlzLl9yb3dzVG9MaW5raWZ5LmVuZCA9IG51bGw7XG4gICAgfTtcbiAgICBMaW5raWZpZXIucHJvdG90eXBlLnJlZ2lzdGVyTGlua01hdGNoZXIgPSBmdW5jdGlvbiAocmVnZXgsIGhhbmRsZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICAgICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2hhbmRsZXIgbXVzdCBiZSBkZWZpbmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG1hdGNoZXIgPSB7XG4gICAgICAgICAgICBpZDogdGhpcy5fbmV4dExpbmtNYXRjaGVySWQrKyxcbiAgICAgICAgICAgIHJlZ2V4OiByZWdleCxcbiAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIsXG4gICAgICAgICAgICBtYXRjaEluZGV4OiBvcHRpb25zLm1hdGNoSW5kZXgsXG4gICAgICAgICAgICB2YWxpZGF0aW9uQ2FsbGJhY2s6IG9wdGlvbnMudmFsaWRhdGlvbkNhbGxiYWNrLFxuICAgICAgICAgICAgaG92ZXJUb29sdGlwQ2FsbGJhY2s6IG9wdGlvbnMudG9vbHRpcENhbGxiYWNrLFxuICAgICAgICAgICAgaG92ZXJMZWF2ZUNhbGxiYWNrOiBvcHRpb25zLmxlYXZlQ2FsbGJhY2ssXG4gICAgICAgICAgICB3aWxsTGlua0FjdGl2YXRlOiBvcHRpb25zLndpbGxMaW5rQWN0aXZhdGUsXG4gICAgICAgICAgICBwcmlvcml0eTogb3B0aW9ucy5wcmlvcml0eSB8fCAwXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2FkZExpbmtNYXRjaGVyVG9MaXN0KG1hdGNoZXIpO1xuICAgICAgICByZXR1cm4gbWF0Y2hlci5pZDtcbiAgICB9O1xuICAgIExpbmtpZmllci5wcm90b3R5cGUuX2FkZExpbmtNYXRjaGVyVG9MaXN0ID0gZnVuY3Rpb24gKG1hdGNoZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpbmtNYXRjaGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2xpbmtNYXRjaGVycy5wdXNoKG1hdGNoZXIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl9saW5rTWF0Y2hlcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVyLnByaW9yaXR5IDw9IHRoaXMuX2xpbmtNYXRjaGVyc1tpXS5wcmlvcml0eSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xpbmtNYXRjaGVycy5zcGxpY2UoaSArIDEsIDAsIG1hdGNoZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9saW5rTWF0Y2hlcnMuc3BsaWNlKDAsIDAsIG1hdGNoZXIpO1xuICAgIH07XG4gICAgTGlua2lmaWVyLnByb3RvdHlwZS5kZXJlZ2lzdGVyTGlua01hdGNoZXIgPSBmdW5jdGlvbiAobWF0Y2hlcklkKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fbGlua01hdGNoZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fbGlua01hdGNoZXJzW2ldLmlkID09PSBtYXRjaGVySWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9saW5rTWF0Y2hlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIExpbmtpZmllci5wcm90b3R5cGUuX2RvTGlua2lmeVJvdyA9IGZ1bmN0aW9uIChyb3dJbmRleCwgdGV4dCwgbWF0Y2hlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgcmV4ID0gbmV3IFJlZ0V4cChtYXRjaGVyLnJlZ2V4LnNvdXJjZSwgbWF0Y2hlci5yZWdleC5mbGFncyArICdnJyk7XG4gICAgICAgIHZhciBtYXRjaDtcbiAgICAgICAgdmFyIHN0cmluZ0luZGV4ID0gLTE7XG4gICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHVyaSA9IG1hdGNoW3R5cGVvZiBtYXRjaGVyLm1hdGNoSW5kZXggIT09ICdudW1iZXInID8gMCA6IG1hdGNoZXIubWF0Y2hJbmRleF07XG4gICAgICAgICAgICBpZiAoIXVyaSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzXzEuX3Rlcm1pbmFsLmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHsgbWF0Y2g6IG1hdGNoLCBtYXRjaGVyOiBtYXRjaGVyIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hdGNoIGZvdW5kIHdpdGhvdXQgY29ycmVzcG9uZGluZyBtYXRjaEluZGV4Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBcImJyZWFrXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdHJpbmdJbmRleCA9IHRleHQuaW5kZXhPZih1cmksIHN0cmluZ0luZGV4ICsgMSk7XG4gICAgICAgICAgICByZXgubGFzdEluZGV4ID0gc3RyaW5nSW5kZXggKyB1cmkubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIGJ1ZmZlckluZGV4ID0gdGhpc18xLl90ZXJtaW5hbC5idWZmZXIuc3RyaW5nSW5kZXhUb0J1ZmZlckluZGV4KHJvd0luZGV4LCBzdHJpbmdJbmRleCk7XG4gICAgICAgICAgICB2YXIgbGluZSA9IHRoaXNfMS5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmdldChidWZmZXJJbmRleFswXSk7XG4gICAgICAgICAgICB2YXIgY2hhciA9IGxpbmUuZ2V0KGJ1ZmZlckluZGV4WzFdKTtcbiAgICAgICAgICAgIHZhciBmZztcbiAgICAgICAgICAgIGlmIChjaGFyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBjaGFyW0J1ZmZlcl8xLkNIQVJfREFUQV9BVFRSX0lOREVYXTtcbiAgICAgICAgICAgICAgICBmZyA9IChhdHRyID4+IDkpICYgMHgxZmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF0Y2hlci52YWxpZGF0aW9uQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVyLnZhbGlkYXRpb25DYWxsYmFjayh1cmksIGZ1bmN0aW9uIChpc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fcm93c1RpbWVvdXRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fYWRkTGluayhidWZmZXJJbmRleFsxXSwgYnVmZmVySW5kZXhbMF0gLSBfdGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwLCB1cmksIG1hdGNoZXIsIGZnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpc18xLl9hZGRMaW5rKGJ1ZmZlckluZGV4WzFdLCBidWZmZXJJbmRleFswXSAtIHRoaXNfMS5fdGVybWluYWwuYnVmZmVyLnlkaXNwLCB1cmksIG1hdGNoZXIsIGZnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHRoaXNfMSA9IHRoaXM7XG4gICAgICAgIHdoaWxlICgobWF0Y2ggPSByZXguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBzdGF0ZV8xID0gX2xvb3BfMSgpO1xuICAgICAgICAgICAgaWYgKHN0YXRlXzEgPT09IFwiYnJlYWtcIilcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgTGlua2lmaWVyLnByb3RvdHlwZS5fYWRkTGluayA9IGZ1bmN0aW9uICh4LCB5LCB1cmksIG1hdGNoZXIsIGZnKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB3aWR0aCA9IENoYXJXaWR0aF8xLmdldFN0cmluZ0NlbGxXaWR0aCh1cmkpO1xuICAgICAgICB2YXIgeDEgPSB4ICUgdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgdmFyIHkxID0geSArIE1hdGguZmxvb3IoeCAvIHRoaXMuX3Rlcm1pbmFsLmNvbHMpO1xuICAgICAgICB2YXIgeDIgPSAoeDEgKyB3aWR0aCkgJSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICB2YXIgeTIgPSB5MSArIE1hdGguZmxvb3IoKHgxICsgd2lkdGgpIC8gdGhpcy5fdGVybWluYWwuY29scyk7XG4gICAgICAgIGlmICh4MiA9PT0gMCkge1xuICAgICAgICAgICAgeDIgPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgeTItLTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tb3VzZVpvbmVNYW5hZ2VyLmFkZChuZXcgTW91c2Vab25lTWFuYWdlcl8xLk1vdXNlWm9uZSh4MSArIDEsIHkxICsgMSwgeDIgKyAxLCB5MiArIDEsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlci5oYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXIuaGFuZGxlcihlLCB1cmkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2luZG93Lm9wZW4odXJpLCAnX2JsYW5rJyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBfdGhpcy5lbWl0KFwibGlua2hvdmVyXCIsIF90aGlzLl9jcmVhdGVMaW5rSG92ZXJFdmVudCh4MSwgeTEsIHgyLCB5MiwgZmcpKTtcbiAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLWN1cnNvci1wb2ludGVyJyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBfdGhpcy5lbWl0KFwibGlua3Rvb2x0aXBcIiwgX3RoaXMuX2NyZWF0ZUxpbmtIb3ZlckV2ZW50KHgxLCB5MSwgeDIsIHkyLCBmZykpO1xuICAgICAgICAgICAgaWYgKG1hdGNoZXIuaG92ZXJUb29sdGlwQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVyLmhvdmVyVG9vbHRpcENhbGxiYWNrKGUsIHVyaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLmVtaXQoXCJsaW5rbGVhdmVcIiwgX3RoaXMuX2NyZWF0ZUxpbmtIb3ZlckV2ZW50KHgxLCB5MSwgeDIsIHkyLCBmZykpO1xuICAgICAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgneHRlcm0tY3Vyc29yLXBvaW50ZXInKTtcbiAgICAgICAgICAgIGlmIChtYXRjaGVyLmhvdmVyTGVhdmVDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIG1hdGNoZXIuaG92ZXJMZWF2ZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlci53aWxsTGlua0FjdGl2YXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXIud2lsbExpbmtBY3RpdmF0ZShlLCB1cmkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pKTtcbiAgICB9O1xuICAgIExpbmtpZmllci5wcm90b3R5cGUuX2NyZWF0ZUxpbmtIb3ZlckV2ZW50ID0gZnVuY3Rpb24gKHgxLCB5MSwgeDIsIHkyLCBmZykge1xuICAgICAgICByZXR1cm4geyB4MTogeDEsIHkxOiB5MSwgeDI6IHgyLCB5MjogeTIsIGNvbHM6IHRoaXMuX3Rlcm1pbmFsLmNvbHMsIGZnOiBmZyB9O1xuICAgIH07XG4gICAgTGlua2lmaWVyLlRJTUVfQkVGT1JFX0xJTktJRlkgPSAyMDA7XG4gICAgTGlua2lmaWVyLk9WRVJTQ0FOX0NIQVJfTElNSVQgPSAyMDAwO1xuICAgIHJldHVybiBMaW5raWZpZXI7XG59KEV2ZW50RW1pdHRlcl8xLkV2ZW50RW1pdHRlcikpO1xuZXhwb3J0cy5MaW5raWZpZXIgPSBMaW5raWZpZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1MaW5raWZpZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIE1vdXNlSGVscGVyXzEgPSByZXF1aXJlKFwiLi91dGlscy9Nb3VzZUhlbHBlclwiKTtcbnZhciBCcm93c2VyID0gcmVxdWlyZShcIi4vY29yZS9QbGF0Zm9ybVwiKTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXJcIik7XG52YXIgU2VsZWN0aW9uTW9kZWxfMSA9IHJlcXVpcmUoXCIuL1NlbGVjdGlvbk1vZGVsXCIpO1xudmFyIEJ1ZmZlcl8xID0gcmVxdWlyZShcIi4vQnVmZmVyXCIpO1xudmFyIEFsdENsaWNrSGFuZGxlcl8xID0gcmVxdWlyZShcIi4vaGFuZGxlcnMvQWx0Q2xpY2tIYW5kbGVyXCIpO1xudmFyIERSQUdfU0NST0xMX01BWF9USFJFU0hPTEQgPSA1MDtcbnZhciBEUkFHX1NDUk9MTF9NQVhfU1BFRUQgPSAxNTtcbnZhciBEUkFHX1NDUk9MTF9JTlRFUlZBTCA9IDUwO1xudmFyIEFMVF9DTElDS19NT1ZFX0NVUlNPUl9USU1FID0gNTAwO1xudmFyIFdPUkRfU0VQQVJBVE9SUyA9ICcgKClbXXt9XFwnXCInO1xudmFyIE5PTl9CUkVBS0lOR19TUEFDRV9DSEFSID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApO1xudmFyIEFMTF9OT05fQlJFQUtJTkdfU1BBQ0VfUkVHRVggPSBuZXcgUmVnRXhwKE5PTl9CUkVBS0lOR19TUEFDRV9DSEFSLCAnZycpO1xudmFyIFNlbGVjdGlvbk1hbmFnZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTZWxlY3Rpb25NYW5hZ2VyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFNlbGVjdGlvbk1hbmFnZXIoX3Rlcm1pbmFsLCBfY2hhck1lYXN1cmUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fY2hhck1lYXN1cmUgPSBfY2hhck1lYXN1cmU7XG4gICAgICAgIF90aGlzLl9lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgX3RoaXMuX2luaXRMaXN0ZW5lcnMoKTtcbiAgICAgICAgX3RoaXMuZW5hYmxlKCk7XG4gICAgICAgIF90aGlzLl9tb2RlbCA9IG5ldyBTZWxlY3Rpb25Nb2RlbF8xLlNlbGVjdGlvbk1vZGVsKF90ZXJtaW5hbCk7XG4gICAgICAgIF90aGlzLl9hY3RpdmVTZWxlY3Rpb25Nb2RlID0gMDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fcmVtb3ZlTW91c2VEb3duTGlzdGVuZXJzKCk7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUsIFwiX2J1ZmZlclwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcnMuYWN0aXZlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5faW5pdExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fbW91c2VNb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHsgcmV0dXJuIF90aGlzLl9vbk1vdXNlTW92ZShldmVudCk7IH07XG4gICAgICAgIHRoaXMuX21vdXNlVXBMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gX3RoaXMuX29uTW91c2VVcChldmVudCk7IH07XG4gICAgICAgIHRoaXMuX3RyaW1MaXN0ZW5lciA9IGZ1bmN0aW9uIChhbW91bnQpIHsgcmV0dXJuIF90aGlzLl9vblRyaW0oYW1vdW50KTsgfTtcbiAgICAgICAgdGhpcy5pbml0QnVmZmVyc0xpc3RlbmVycygpO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuaW5pdEJ1ZmZlcnNMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5vbigndHJpbScsIHRoaXMuX3RyaW1MaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcnMub24oJ2FjdGl2YXRlJywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbkJ1ZmZlckFjdGl2YXRlKGUpOyB9KTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgdGhpcy5fZW5hYmxlZCA9IGZhbHNlO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9lbmFibGVkID0gdHJ1ZTtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZSwgXCJzZWxlY3Rpb25TdGFydFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25TdGFydDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLCBcInNlbGVjdGlvbkVuZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25FbmQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZSwgXCJoYXNTZWxlY3Rpb25cIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgICAgICB2YXIgZW5kID0gdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25FbmQ7XG4gICAgICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3RhcnRbMF0gIT09IGVuZFswXSB8fCBzdGFydFsxXSAhPT0gZW5kWzFdO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUsIFwic2VsZWN0aW9uVGV4dFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25TdGFydDtcbiAgICAgICAgICAgIHZhciBlbmQgPSB0aGlzLl9tb2RlbC5maW5hbFNlbGVjdGlvbkVuZDtcbiAgICAgICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9hY3RpdmVTZWxlY3Rpb25Nb2RlID09PSAzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0WzBdID09PSBlbmRbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRbMV07IGkgPD0gZW5kWzFdOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmVUZXh0ID0gdGhpcy5fYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhpLCB0cnVlLCBzdGFydFswXSwgZW5kWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGluZVRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBzdGFydFJvd0VuZENvbCA9IHN0YXJ0WzFdID09PSBlbmRbMV0gPyBlbmRbMF0gOiBudWxsO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuX2J1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoc3RhcnRbMV0sIHRydWUsIHN0YXJ0WzBdLCBzdGFydFJvd0VuZENvbCkpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydFsxXSArIDE7IGkgPD0gZW5kWzFdIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXJMaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldChpKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmVUZXh0ID0gdGhpcy5fYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZmZlckxpbmUuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdICs9IGxpbmVUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGluZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdGFydFsxXSAhPT0gZW5kWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXJMaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldChlbmRbMV0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGluZVRleHQgPSB0aGlzLl9idWZmZXIudHJhbnNsYXRlQnVmZmVyTGluZVRvU3RyaW5nKGVuZFsxXSwgdHJ1ZSwgMCwgZW5kWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZmZlckxpbmUuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdICs9IGxpbmVUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGluZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZvcm1hdHRlZFJlc3VsdCA9IHJlc3VsdC5tYXAoZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGluZS5yZXBsYWNlKEFMTF9OT05fQlJFQUtJTkdfU1BBQ0VfUkVHRVgsICcgJyk7XG4gICAgICAgICAgICB9KS5qb2luKEJyb3dzZXIuaXNNU1dpbmRvd3MgPyAnXFxyXFxuJyA6ICdcXG4nKTtcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRSZXN1bHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLmNsZWFyU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9tb2RlbC5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKGlzTmV3U2VsZWN0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5fcmVmcmVzaEFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoQW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoKCk7IH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChCcm93c2VyLmlzTGludXggJiYgaXNOZXdTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rpb25UZXh0ID0gdGhpcy5zZWxlY3Rpb25UZXh0O1xuICAgICAgICAgICAgaWYgKHNlbGVjdGlvblRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCduZXdzZWxlY3Rpb24nLCB0aGlzLnNlbGVjdGlvblRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fcmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fcmVmcmVzaEFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgdGhpcy5lbWl0KCdyZWZyZXNoJywge1xuICAgICAgICAgICAgc3RhcnQ6IHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uU3RhcnQsXG4gICAgICAgICAgICBlbmQ6IHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uRW5kLFxuICAgICAgICAgICAgY29sdW1uU2VsZWN0TW9kZTogdGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSA9PT0gM1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLmlzQ2xpY2tJblNlbGVjdGlvbiA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgY29vcmRzID0gdGhpcy5fZ2V0TW91c2VCdWZmZXJDb29yZHMoZXZlbnQpO1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLl9tb2RlbC5maW5hbFNlbGVjdGlvblN0YXJ0O1xuICAgICAgICB2YXIgZW5kID0gdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25FbmQ7XG4gICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9hcmVDb29yZHNJblNlbGVjdGlvbihjb29yZHMsIHN0YXJ0LCBlbmQpO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX2FyZUNvb3Jkc0luU2VsZWN0aW9uID0gZnVuY3Rpb24gKGNvb3Jkcywgc3RhcnQsIGVuZCkge1xuICAgICAgICByZXR1cm4gKGNvb3Jkc1sxXSA+IHN0YXJ0WzFdICYmIGNvb3Jkc1sxXSA8IGVuZFsxXSkgfHxcbiAgICAgICAgICAgIChzdGFydFsxXSA9PT0gZW5kWzFdICYmIGNvb3Jkc1sxXSA9PT0gc3RhcnRbMV0gJiYgY29vcmRzWzBdID49IHN0YXJ0WzBdICYmIGNvb3Jkc1swXSA8IGVuZFswXSkgfHxcbiAgICAgICAgICAgIChzdGFydFsxXSA8IGVuZFsxXSAmJiBjb29yZHNbMV0gPT09IGVuZFsxXSAmJiBjb29yZHNbMF0gPCBlbmRbMF0pIHx8XG4gICAgICAgICAgICAoc3RhcnRbMV0gPCBlbmRbMV0gJiYgY29vcmRzWzFdID09PSBzdGFydFsxXSAmJiBjb29yZHNbMF0gPj0gc3RhcnRbMF0pO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuc2VsZWN0V29yZEF0Q3Vyc29yID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBjb29yZHMgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIGlmIChjb29yZHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdFdvcmRBdChjb29yZHMsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2godHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLnNlbGVjdEFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fbW9kZWwuaXNTZWxlY3RBbGxBY3RpdmUgPSB0cnVlO1xuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuZW1pdCgnc2VsZWN0aW9uJyk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5zZWxlY3RMaW5lcyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHRoaXMuX21vZGVsLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoc3RhcnQsIDApO1xuICAgICAgICBlbmQgPSBNYXRoLm1pbihlbmQsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5sZW5ndGggLSAxKTtcbiAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQgPSBbMCwgc3RhcnRdO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSBbdGhpcy5fdGVybWluYWwuY29scywgZW5kXTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVtaXQoJ3NlbGVjdGlvbicpO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX29uVHJpbSA9IGZ1bmN0aW9uIChhbW91bnQpIHtcbiAgICAgICAgdmFyIG5lZWRzUmVmcmVzaCA9IHRoaXMuX21vZGVsLm9uVHJpbShhbW91bnQpO1xuICAgICAgICBpZiAobmVlZHNSZWZyZXNoKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX2dldE1vdXNlQnVmZmVyQ29vcmRzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBjb29yZHMgPSB0aGlzLl90ZXJtaW5hbC5tb3VzZUhlbHBlci5nZXRDb29yZHMoZXZlbnQsIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQsIHRoaXMuX2NoYXJNZWFzdXJlLCB0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLl90ZXJtaW5hbC5yb3dzLCB0cnVlKTtcbiAgICAgICAgaWYgKCFjb29yZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvb3Jkc1swXS0tO1xuICAgICAgICBjb29yZHNbMV0tLTtcbiAgICAgICAgY29vcmRzWzFdICs9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgcmV0dXJuIGNvb3JkcztcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9nZXRNb3VzZUV2ZW50U2Nyb2xsQW1vdW50ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSBNb3VzZUhlbHBlcl8xLk1vdXNlSGVscGVyLmdldENvb3Jkc1JlbGF0aXZlVG9FbGVtZW50KGV2ZW50LCB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50KVsxXTtcbiAgICAgICAgdmFyIHRlcm1pbmFsSGVpZ2h0ID0gdGhpcy5fdGVybWluYWwucm93cyAqIE1hdGguY2VpbCh0aGlzLl9jaGFyTWVhc3VyZS5oZWlnaHQgKiB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmxpbmVIZWlnaHQpO1xuICAgICAgICBpZiAob2Zmc2V0ID49IDAgJiYgb2Zmc2V0IDw9IHRlcm1pbmFsSGVpZ2h0KSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2Zmc2V0ID4gdGVybWluYWxIZWlnaHQpIHtcbiAgICAgICAgICAgIG9mZnNldCAtPSB0ZXJtaW5hbEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBvZmZzZXQgPSBNYXRoLm1pbihNYXRoLm1heChvZmZzZXQsIC1EUkFHX1NDUk9MTF9NQVhfVEhSRVNIT0xEKSwgRFJBR19TQ1JPTExfTUFYX1RIUkVTSE9MRCk7XG4gICAgICAgIG9mZnNldCAvPSBEUkFHX1NDUk9MTF9NQVhfVEhSRVNIT0xEO1xuICAgICAgICByZXR1cm4gKG9mZnNldCAvIE1hdGguYWJzKG9mZnNldCkpICsgTWF0aC5yb3VuZChvZmZzZXQgKiAoRFJBR19TQ1JPTExfTUFYX1NQRUVEIC0gMSkpO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuc2hvdWxkRm9yY2VTZWxlY3Rpb24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKEJyb3dzZXIuaXNNYWMpIHtcbiAgICAgICAgICAgIHJldHVybiBldmVudC5hbHRLZXkgJiYgdGhpcy5fdGVybWluYWwub3B0aW9ucy5tYWNPcHRpb25DbGlja0ZvcmNlc1NlbGVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXZlbnQuc2hpZnRLZXk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5vbk1vdXNlRG93biA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB0aGlzLl9tb3VzZURvd25UaW1lU3RhbXAgPSBldmVudC50aW1lU3RhbXA7XG4gICAgICAgIGlmIChldmVudC5idXR0b24gPT09IDIgJiYgdGhpcy5oYXNTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZlbnQuYnV0dG9uICE9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9lbmFibGVkKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc2hvdWxkRm9yY2VTZWxlY3Rpb24oZXZlbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5fZHJhZ1Njcm9sbEFtb3VudCA9IDA7XG4gICAgICAgIGlmICh0aGlzLl9lbmFibGVkICYmIGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICB0aGlzLl9vbkluY3JlbWVudGFsQ2xpY2soZXZlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmRldGFpbCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29uU2luZ2xlQ2xpY2soZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnQuZGV0YWlsID09PSAyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25Eb3VibGVDbGljayhldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChldmVudC5kZXRhaWwgPT09IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vblRyaXBsZUNsaWNrKGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9hZGRNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKHRydWUpO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX2FkZE1vdXNlRG93bkxpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5vd25lckRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX21vdXNlTW92ZUxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5vd25lckRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9tb3VzZVVwTGlzdGVuZXIpO1xuICAgICAgICB0aGlzLl9kcmFnU2Nyb2xsSW50ZXJ2YWxUaW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9kcmFnU2Nyb2xsKCk7IH0sIERSQUdfU0NST0xMX0lOVEVSVkFMKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5lbGVtZW50Lm93bmVyRG9jdW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQub3duZXJEb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9tb3VzZU1vdmVMaXN0ZW5lcik7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50Lm93bmVyRG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX21vdXNlVXBMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9kcmFnU2Nyb2xsSW50ZXJ2YWxUaW1lcik7XG4gICAgICAgIHRoaXMuX2RyYWdTY3JvbGxJbnRlcnZhbFRpbWVyID0gbnVsbDtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vbkluY3JlbWVudGFsQ2xpY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX21vZGVsLnNlbGVjdGlvblN0YXJ0KSB7XG4gICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vblNpbmdsZUNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvblN0YXJ0TGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5fbW9kZWwuaXNTZWxlY3RBbGxBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSA9IHRoaXMuc2hvdWxkQ29sdW1uU2VsZWN0KGV2ZW50KSA/IDMgOiAwO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuX2dldE1vdXNlQnVmZmVyQ29vcmRzKGV2ZW50KTtcbiAgICAgICAgaWYgKCF0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZCA9IG51bGw7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldCh0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydFsxXSk7XG4gICAgICAgIGlmICghbGluZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsaW5lLmxlbmd0aCA+PSB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydFswXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjaGFyID0gbGluZS5nZXQodGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnRbMF0pO1xuICAgICAgICBpZiAoY2hhcltCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydFswXSsrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fb25Eb3VibGVDbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgY29vcmRzID0gdGhpcy5fZ2V0TW91c2VCdWZmZXJDb29yZHMoZXZlbnQpO1xuICAgICAgICBpZiAoY29vcmRzKSB7XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVTZWxlY3Rpb25Nb2RlID0gMTtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdFdvcmRBdChjb29yZHMsIHRydWUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fb25UcmlwbGVDbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgY29vcmRzID0gdGhpcy5fZ2V0TW91c2VCdWZmZXJDb29yZHMoZXZlbnQpO1xuICAgICAgICBpZiAoY29vcmRzKSB7XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVTZWxlY3Rpb25Nb2RlID0gMjtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdExpbmVBdChjb29yZHNbMV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5zaG91bGRDb2x1bW5TZWxlY3QgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50LmFsdEtleSAmJiAhKEJyb3dzZXIuaXNNYWMgJiYgdGhpcy5fdGVybWluYWwub3B0aW9ucy5tYWNPcHRpb25DbGlja0ZvcmNlc1NlbGVjdGlvbik7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fb25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHZhciBwcmV2aW91c1NlbGVjdGlvbkVuZCA9IHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZCA/IFt0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMF0sIHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFsxXV0gOiBudWxsO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIGlmICghdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2godHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgPT09IDIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMV0gPCB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydFsxXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFswXSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMF0gPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdFRvV29yZEF0KHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZHJhZ1Njcm9sbEFtb3VudCA9IHRoaXMuX2dldE1vdXNlRXZlbnRTY3JvbGxBbW91bnQoZXZlbnQpO1xuICAgICAgICBpZiAodGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSAhPT0gMykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2RyYWdTY3JvbGxBbW91bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2RyYWdTY3JvbGxBbW91bnQgPCAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdIDwgdGhpcy5fYnVmZmVyLmxpbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGNoYXIgPSB0aGlzLl9idWZmZXIubGluZXMuZ2V0KHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFsxXSkuZ2V0KHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFswXSk7XG4gICAgICAgICAgICBpZiAoY2hhciAmJiBjaGFyW0J1ZmZlcl8xLkNIQVJfREFUQV9XSURUSF9JTkRFWF0gPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMF0rKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXByZXZpb3VzU2VsZWN0aW9uRW5kIHx8XG4gICAgICAgICAgICBwcmV2aW91c1NlbGVjdGlvbkVuZFswXSAhPT0gdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdIHx8XG4gICAgICAgICAgICBwcmV2aW91c1NlbGVjdGlvbkVuZFsxXSAhPT0gdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2godHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9kcmFnU2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZHJhZ1Njcm9sbEFtb3VudCkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2Nyb2xsTGluZXModGhpcy5fZHJhZ1Njcm9sbEFtb3VudCwgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2RyYWdTY3JvbGxBbW91bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgIT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdID0gTWF0aC5taW4odGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwICsgdGhpcy5fdGVybWluYWwucm93cywgdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgIT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHRpbWVFbGFwc2VkID0gZXZlbnQudGltZVN0YW1wIC0gdGhpcy5fbW91c2VEb3duVGltZVN0YW1wO1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uVGV4dC5sZW5ndGggPD0gMSAmJiB0aW1lRWxhcHNlZCA8IEFMVF9DTElDS19NT1ZFX0NVUlNPUl9USU1FKSB7XG4gICAgICAgICAgICAobmV3IEFsdENsaWNrSGFuZGxlcl8xLkFsdENsaWNrSGFuZGxlcihldmVudCwgdGhpcy5fdGVybWluYWwpKS5tb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5oYXNTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVtaXQoJ3NlbGVjdGlvbicpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fb25CdWZmZXJBY3RpdmF0ZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgZS5pbmFjdGl2ZUJ1ZmZlci5saW5lcy5vZmYoJ3RyaW0nLCB0aGlzLl90cmltTGlzdGVuZXIpO1xuICAgICAgICBlLmFjdGl2ZUJ1ZmZlci5saW5lcy5vbigndHJpbScsIHRoaXMuX3RyaW1MaXN0ZW5lcik7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fY29udmVydFZpZXdwb3J0Q29sVG9DaGFyYWN0ZXJJbmRleCA9IGZ1bmN0aW9uIChidWZmZXJMaW5lLCBjb29yZHMpIHtcbiAgICAgICAgdmFyIGNoYXJJbmRleCA9IGNvb3Jkc1swXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGNvb3Jkc1swXSA+PSBpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBjaGFyID0gYnVmZmVyTGluZS5nZXQoaSk7XG4gICAgICAgICAgICBpZiAoY2hhcltCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY2hhckluZGV4LS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFyW0J1ZmZlcl8xLkNIQVJfREFUQV9DSEFSX0lOREVYXS5sZW5ndGggPiAxICYmIGNvb3Jkc1swXSAhPT0gaSkge1xuICAgICAgICAgICAgICAgIGNoYXJJbmRleCArPSBjaGFyW0J1ZmZlcl8xLkNIQVJfREFUQV9DSEFSX0lOREVYXS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFySW5kZXg7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5zZXRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoY29sLCByb3csIGxlbmd0aCkge1xuICAgICAgICB0aGlzLl9tb2RlbC5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQgPSBbY29sLCByb3ddO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydExlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fZ2V0V29yZEF0ID0gZnVuY3Rpb24gKGNvb3JkcywgYWxsb3dXaGl0ZXNwYWNlT25seVNlbGVjdGlvbiwgZm9sbG93V3JhcHBlZExpbmVzQWJvdmUsIGZvbGxvd1dyYXBwZWRMaW5lc0JlbG93KSB7XG4gICAgICAgIGlmIChmb2xsb3dXcmFwcGVkTGluZXNBYm92ZSA9PT0gdm9pZCAwKSB7IGZvbGxvd1dyYXBwZWRMaW5lc0Fib3ZlID0gdHJ1ZTsgfVxuICAgICAgICBpZiAoZm9sbG93V3JhcHBlZExpbmVzQmVsb3cgPT09IHZvaWQgMCkgeyBmb2xsb3dXcmFwcGVkTGluZXNCZWxvdyA9IHRydWU7IH1cbiAgICAgICAgaWYgKGNvb3Jkc1swXSA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYnVmZmVyTGluZSA9IHRoaXMuX2J1ZmZlci5saW5lcy5nZXQoY29vcmRzWzFdKTtcbiAgICAgICAgaWYgKCFidWZmZXJMaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGluZSA9IHRoaXMuX2J1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoY29vcmRzWzFdLCBmYWxzZSk7XG4gICAgICAgIHZhciBzdGFydEluZGV4ID0gdGhpcy5fY29udmVydFZpZXdwb3J0Q29sVG9DaGFyYWN0ZXJJbmRleChidWZmZXJMaW5lLCBjb29yZHMpO1xuICAgICAgICB2YXIgZW5kSW5kZXggPSBzdGFydEluZGV4O1xuICAgICAgICB2YXIgY2hhck9mZnNldCA9IGNvb3Jkc1swXSAtIHN0YXJ0SW5kZXg7XG4gICAgICAgIHZhciBsZWZ0V2lkZUNoYXJDb3VudCA9IDA7XG4gICAgICAgIHZhciByaWdodFdpZGVDaGFyQ291bnQgPSAwO1xuICAgICAgICB2YXIgbGVmdExvbmdDaGFyT2Zmc2V0ID0gMDtcbiAgICAgICAgdmFyIHJpZ2h0TG9uZ0NoYXJPZmZzZXQgPSAwO1xuICAgICAgICBpZiAobGluZS5jaGFyQXQoc3RhcnRJbmRleCkgPT09ICcgJykge1xuICAgICAgICAgICAgd2hpbGUgKHN0YXJ0SW5kZXggPiAwICYmIGxpbmUuY2hhckF0KHN0YXJ0SW5kZXggLSAxKSA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgc3RhcnRJbmRleC0tO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUgKGVuZEluZGV4IDwgbGluZS5sZW5ndGggJiYgbGluZS5jaGFyQXQoZW5kSW5kZXggKyAxKSA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgZW5kSW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBzdGFydENvbCA9IGNvb3Jkc1swXTtcbiAgICAgICAgICAgIHZhciBlbmRDb2wgPSBjb29yZHNbMF07XG4gICAgICAgICAgICBpZiAoYnVmZmVyTGluZS5nZXQoc3RhcnRDb2wpW0J1ZmZlcl8xLkNIQVJfREFUQV9XSURUSF9JTkRFWF0gPT09IDApIHtcbiAgICAgICAgICAgICAgICBsZWZ0V2lkZUNoYXJDb3VudCsrO1xuICAgICAgICAgICAgICAgIHN0YXJ0Q29sLS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYnVmZmVyTGluZS5nZXQoZW5kQ29sKVtCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdID09PSAyKSB7XG4gICAgICAgICAgICAgICAgcmlnaHRXaWRlQ2hhckNvdW50Kys7XG4gICAgICAgICAgICAgICAgZW5kQ29sKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYnVmZmVyTGluZS5nZXQoZW5kQ29sKVtCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHJpZ2h0TG9uZ0NoYXJPZmZzZXQgKz0gYnVmZmVyTGluZS5nZXQoZW5kQ29sKVtCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICBlbmRJbmRleCArPSBidWZmZXJMaW5lLmdldChlbmRDb2wpW0J1ZmZlcl8xLkNIQVJfREFUQV9DSEFSX0lOREVYXS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUgKHN0YXJ0Q29sID4gMCAmJiBzdGFydEluZGV4ID4gMCAmJiAhdGhpcy5faXNDaGFyV29yZFNlcGFyYXRvcihidWZmZXJMaW5lLmdldChzdGFydENvbCAtIDEpKSkge1xuICAgICAgICAgICAgICAgIHZhciBjaGFyID0gYnVmZmVyTGluZS5nZXQoc3RhcnRDb2wgLSAxKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcltCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZnRXaWRlQ2hhckNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sLS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYXJbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdExvbmdDaGFyT2Zmc2V0ICs9IGNoYXJbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXggLT0gY2hhcltCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RhcnRJbmRleC0tO1xuICAgICAgICAgICAgICAgIHN0YXJ0Q29sLS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aGlsZSAoZW5kQ29sIDwgYnVmZmVyTGluZS5sZW5ndGggJiYgZW5kSW5kZXggKyAxIDwgbGluZS5sZW5ndGggJiYgIXRoaXMuX2lzQ2hhcldvcmRTZXBhcmF0b3IoYnVmZmVyTGluZS5nZXQoZW5kQ29sICsgMSkpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoYXIgPSBidWZmZXJMaW5lLmdldChlbmRDb2wgKyAxKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcltCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0V2lkZUNoYXJDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBlbmRDb2wrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY2hhcltCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICByaWdodExvbmdDaGFyT2Zmc2V0ICs9IGNoYXJbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgIGVuZEluZGV4ICs9IGNoYXJbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVuZEluZGV4Kys7XG4gICAgICAgICAgICAgICAgZW5kQ29sKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZW5kSW5kZXgrKztcbiAgICAgICAgdmFyIHN0YXJ0ID0gc3RhcnRJbmRleFxuICAgICAgICAgICAgKyBjaGFyT2Zmc2V0XG4gICAgICAgICAgICAtIGxlZnRXaWRlQ2hhckNvdW50XG4gICAgICAgICAgICArIGxlZnRMb25nQ2hhck9mZnNldDtcbiAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGgubWluKHRoaXMuX3Rlcm1pbmFsLmNvbHMsIGVuZEluZGV4XG4gICAgICAgICAgICAtIHN0YXJ0SW5kZXhcbiAgICAgICAgICAgICsgbGVmdFdpZGVDaGFyQ291bnRcbiAgICAgICAgICAgICsgcmlnaHRXaWRlQ2hhckNvdW50XG4gICAgICAgICAgICAtIGxlZnRMb25nQ2hhck9mZnNldFxuICAgICAgICAgICAgLSByaWdodExvbmdDaGFyT2Zmc2V0KTtcbiAgICAgICAgaWYgKCFhbGxvd1doaXRlc3BhY2VPbmx5U2VsZWN0aW9uICYmIGxpbmUuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXgpLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmb2xsb3dXcmFwcGVkTGluZXNBYm92ZSkge1xuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSAwICYmIGJ1ZmZlckxpbmUuZ2V0KDApW0J1ZmZlcl8xLkNIQVJfREFUQV9DT0RFX0lOREVYXSAhPT0gMzIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJldmlvdXNCdWZmZXJMaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldChjb29yZHNbMV0gLSAxKTtcbiAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNCdWZmZXJMaW5lICYmIGJ1ZmZlckxpbmUuaXNXcmFwcGVkICYmIHByZXZpb3VzQnVmZmVyTGluZS5nZXQodGhpcy5fdGVybWluYWwuY29scyAtIDEpW0J1ZmZlcl8xLkNIQVJfREFUQV9DT0RFX0lOREVYXSAhPT0gMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByZXZpb3VzTGluZVdvcmRQb3NpdGlvbiA9IHRoaXMuX2dldFdvcmRBdChbdGhpcy5fdGVybWluYWwuY29scyAtIDEsIGNvb3Jkc1sxXSAtIDFdLCBmYWxzZSwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNMaW5lV29yZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gdGhpcy5fdGVybWluYWwuY29scyAtIHByZXZpb3VzTGluZVdvcmRQb3NpdGlvbi5zdGFydDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0IC09IG9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCArPSBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvbGxvd1dyYXBwZWRMaW5lc0JlbG93KSB7XG4gICAgICAgICAgICBpZiAoc3RhcnQgKyBsZW5ndGggPT09IHRoaXMuX3Rlcm1pbmFsLmNvbHMgJiYgYnVmZmVyTGluZS5nZXQodGhpcy5fdGVybWluYWwuY29scyAtIDEpW0J1ZmZlcl8xLkNIQVJfREFUQV9DT0RFX0lOREVYXSAhPT0gMzIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEJ1ZmZlckxpbmUgPSB0aGlzLl9idWZmZXIubGluZXMuZ2V0KGNvb3Jkc1sxXSArIDEpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0QnVmZmVyTGluZSAmJiBuZXh0QnVmZmVyTGluZS5pc1dyYXBwZWQgJiYgbmV4dEJ1ZmZlckxpbmUuZ2V0KDApW0J1ZmZlcl8xLkNIQVJfREFUQV9DT0RFX0lOREVYXSAhPT0gMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRMaW5lV29yZFBvc2l0aW9uID0gdGhpcy5fZ2V0V29yZEF0KFswLCBjb29yZHNbMV0gKyAxXSwgZmFsc2UsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRMaW5lV29yZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggKz0gbmV4dExpbmVXb3JkUG9zaXRpb24ubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN0YXJ0OiBzdGFydCwgbGVuZ3RoOiBsZW5ndGggfTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9zZWxlY3RXb3JkQXQgPSBmdW5jdGlvbiAoY29vcmRzLCBhbGxvd1doaXRlc3BhY2VPbmx5U2VsZWN0aW9uKSB7XG4gICAgICAgIHZhciB3b3JkUG9zaXRpb24gPSB0aGlzLl9nZXRXb3JkQXQoY29vcmRzLCBhbGxvd1doaXRlc3BhY2VPbmx5U2VsZWN0aW9uKTtcbiAgICAgICAgaWYgKHdvcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgd2hpbGUgKHdvcmRQb3NpdGlvbi5zdGFydCA8IDApIHtcbiAgICAgICAgICAgICAgICB3b3JkUG9zaXRpb24uc3RhcnQgKz0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgICAgICBjb29yZHNbMV0tLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvblN0YXJ0ID0gW3dvcmRQb3NpdGlvbi5zdGFydCwgY29vcmRzWzFdXTtcbiAgICAgICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvblN0YXJ0TGVuZ3RoID0gd29yZFBvc2l0aW9uLmxlbmd0aDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX3NlbGVjdFRvV29yZEF0ID0gZnVuY3Rpb24gKGNvb3Jkcykge1xuICAgICAgICB2YXIgd29yZFBvc2l0aW9uID0gdGhpcy5fZ2V0V29yZEF0KGNvb3JkcywgdHJ1ZSk7XG4gICAgICAgIGlmICh3b3JkUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHZhciBlbmRSb3cgPSBjb29yZHNbMV07XG4gICAgICAgICAgICB3aGlsZSAod29yZFBvc2l0aW9uLnN0YXJ0IDwgMCkge1xuICAgICAgICAgICAgICAgIHdvcmRQb3NpdGlvbi5zdGFydCArPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgICAgIGVuZFJvdy0tO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLl9tb2RlbC5hcmVTZWxlY3Rpb25WYWx1ZXNSZXZlcnNlZCgpKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHdvcmRQb3NpdGlvbi5zdGFydCArIHdvcmRQb3NpdGlvbi5sZW5ndGggPiB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRQb3NpdGlvbi5sZW5ndGggLT0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgICAgICAgICAgZW5kUm93Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kID0gW3RoaXMuX21vZGVsLmFyZVNlbGVjdGlvblZhbHVlc1JldmVyc2VkKCkgPyB3b3JkUG9zaXRpb24uc3RhcnQgOiB3b3JkUG9zaXRpb24uc3RhcnQgKyB3b3JkUG9zaXRpb24ubGVuZ3RoLCBlbmRSb3ddO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5faXNDaGFyV29yZFNlcGFyYXRvciA9IGZ1bmN0aW9uIChjaGFyRGF0YSkge1xuICAgICAgICBpZiAoY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBXT1JEX1NFUEFSQVRPUlMuaW5kZXhPZihjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0pID49IDA7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fc2VsZWN0TGluZUF0ID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgdmFyIHdyYXBwZWRSYW5nZSA9IHRoaXMuX2J1ZmZlci5nZXRXcmFwcGVkUmFuZ2VGb3JMaW5lKGxpbmUpO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydCA9IFswLCB3cmFwcGVkUmFuZ2UuZmlyc3RdO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSBbdGhpcy5fdGVybWluYWwuY29scywgd3JhcHBlZFJhbmdlLmxhc3RdO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydExlbmd0aCA9IDA7XG4gICAgfTtcbiAgICByZXR1cm4gU2VsZWN0aW9uTWFuYWdlcjtcbn0oRXZlbnRFbWl0dGVyXzEuRXZlbnRFbWl0dGVyKSk7XG5leHBvcnRzLlNlbGVjdGlvbk1hbmFnZXIgPSBTZWxlY3Rpb25NYW5hZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VsZWN0aW9uTWFuYWdlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBTZWxlY3Rpb25Nb2RlbCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU2VsZWN0aW9uTW9kZWwoX3Rlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIFNlbGVjdGlvbk1vZGVsLnByb3RvdHlwZS5jbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc1NlbGVjdEFsbEFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdGlvblN0YXJ0TGVuZ3RoID0gMDtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25Nb2RlbC5wcm90b3R5cGUsIFwiZmluYWxTZWxlY3Rpb25TdGFydFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RBbGxBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzAsIDBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbkVuZCB8fCAhdGhpcy5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXJlU2VsZWN0aW9uVmFsdWVzUmV2ZXJzZWQoKSA/IHRoaXMuc2VsZWN0aW9uRW5kIDogdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlbGVjdGlvbk1vZGVsLnByb3RvdHlwZSwgXCJmaW5hbFNlbGVjdGlvbkVuZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RBbGxBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW3RoaXMuX3Rlcm1pbmFsLmNvbHMsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55YmFzZSArIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbkVuZCB8fCB0aGlzLmFyZVNlbGVjdGlvblZhbHVlc1JldmVyc2VkKCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnRQbHVzTGVuZ3RoID0gdGhpcy5zZWxlY3Rpb25TdGFydFswXSArIHRoaXMuc2VsZWN0aW9uU3RhcnRMZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0UGx1c0xlbmd0aCA+IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtzdGFydFBsdXNMZW5ndGggJSB0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLnNlbGVjdGlvblN0YXJ0WzFdICsgTWF0aC5mbG9vcihzdGFydFBsdXNMZW5ndGggLyB0aGlzLl90ZXJtaW5hbC5jb2xzKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbc3RhcnRQbHVzTGVuZ3RoLCB0aGlzLnNlbGVjdGlvblN0YXJ0WzFdXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvblN0YXJ0TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRW5kWzFdID09PSB0aGlzLnNlbGVjdGlvblN0YXJ0WzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbTWF0aC5tYXgodGhpcy5zZWxlY3Rpb25TdGFydFswXSArIHRoaXMuc2VsZWN0aW9uU3RhcnRMZW5ndGgsIHRoaXMuc2VsZWN0aW9uRW5kWzBdKSwgdGhpcy5zZWxlY3Rpb25FbmRbMV1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbkVuZDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgU2VsZWN0aW9uTW9kZWwucHJvdG90eXBlLmFyZVNlbGVjdGlvblZhbHVlc1JldmVyc2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICB2YXIgZW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XG4gICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGFydFsxXSA+IGVuZFsxXSB8fCAoc3RhcnRbMV0gPT09IGVuZFsxXSAmJiBzdGFydFswXSA+IGVuZFswXSk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25Nb2RlbC5wcm90b3R5cGUub25UcmltID0gZnVuY3Rpb24gKGFtb3VudCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydFsxXSAtPSBhbW91bnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRW5kKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbkVuZFsxXSAtPSBhbW91bnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRW5kICYmIHRoaXMuc2VsZWN0aW9uRW5kWzFdIDwgMCkge1xuICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uU3RhcnQgJiYgdGhpcy5zZWxlY3Rpb25TdGFydFsxXSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uU3RhcnRbMV0gPSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHJldHVybiBTZWxlY3Rpb25Nb2RlbDtcbn0oKSk7XG5leHBvcnRzLlNlbGVjdGlvbk1vZGVsID0gU2VsZWN0aW9uTW9kZWw7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1TZWxlY3Rpb25Nb2RlbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuREVGQVVMVF9CRUxMX1NPVU5EID0gJ2RhdGE6YXVkaW8vd2F2O2Jhc2U2NCxVa2xHUmlnQkFBQlhRVlpGWm0xMElCQUFBQUFCQUFFQVJLd0FBSWhZQVFBQ0FCQUFaR0YwWVFRQkFBRHBBRmdDd0FNbEJab0cvd2RtQ2NvS1JBeXBEUThQYlJEQkVRUVRPeFJ0RlljV2xCZVBHSVVaWGhvaUc4OGJjQno3SEhJZHpoMFdIbE1lWng1MUhta2VVeDRXSHM4ZGFoMEFIWHdjM2hzOUc0c2F4Um55R0JJWUdCY1FGdjhVNFJQQUVvWVJRQkFDRDcwTld3d0hDNmdKT3dqV0Jsb0Y3Z09CQWhBQmtmOGIvcXY4Ui92ZStYZjRJZmU3OVcvMEpmUFo4Wi93ZGU5TjdpanRFK3dVNnh2cU0rbGI2SDdudytZWDVtcmx4dVF6NU16amUrTWE0OWZpb2VLRDRuWGlZZUp5NHBIaXRPTDA0ai9qbitNTjVJUGtGT1dzNVUzbURlZk01NS9vZ09sMzZtN3JkT3lFN2FidXl1OEQ4VW55ai9QZzlELzJxZmNiK1luNi92dUsvUWovbEFBbEFnPT0nO1xudmFyIFNvdW5kTWFuYWdlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU291bmRNYW5hZ2VyKF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNvdW5kTWFuYWdlciwgXCJhdWRpb0NvbnRleHRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghU291bmRNYW5hZ2VyLl9hdWRpb0NvbnRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXVkaW9Db250ZXh0Q3RvciA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcbiAgICAgICAgICAgICAgICBpZiAoIWF1ZGlvQ29udGV4dEN0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdXZWIgQXVkaW8gQVBJIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBicm93c2VyLiBDb25zaWRlciB1cGdyYWRpbmcgdG8gdGhlIGxhdGVzdCB2ZXJzaW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBTb3VuZE1hbmFnZXIuX2F1ZGlvQ29udGV4dCA9IG5ldyBhdWRpb0NvbnRleHRDdG9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU291bmRNYW5hZ2VyLl9hdWRpb0NvbnRleHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFNvdW5kTWFuYWdlci5wcm90b3R5cGUucGxheUJlbGxTb3VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN0eCA9IFNvdW5kTWFuYWdlci5hdWRpb0NvbnRleHQ7XG4gICAgICAgIGlmICghY3R4KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGJlbGxBdWRpb1NvdXJjZSA9IGN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgY3R4LmRlY29kZUF1ZGlvRGF0YSh0aGlzLl9iYXNlNjRUb0FycmF5QnVmZmVyKHRoaXMuX3JlbW92ZU1pbWVUeXBlKHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuYmVsbFNvdW5kKSksIGZ1bmN0aW9uIChidWZmZXIpIHtcbiAgICAgICAgICAgIGJlbGxBdWRpb1NvdXJjZS5idWZmZXIgPSBidWZmZXI7XG4gICAgICAgICAgICBiZWxsQXVkaW9Tb3VyY2UuY29ubmVjdChjdHguZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgYmVsbEF1ZGlvU291cmNlLnN0YXJ0KDApO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFNvdW5kTWFuYWdlci5wcm90b3R5cGUuX2Jhc2U2NFRvQXJyYXlCdWZmZXIgPSBmdW5jdGlvbiAoYmFzZTY0KSB7XG4gICAgICAgIHZhciBiaW5hcnlTdHJpbmcgPSB3aW5kb3cuYXRvYihiYXNlNjQpO1xuICAgICAgICB2YXIgbGVuID0gYmluYXJ5U3RyaW5nLmxlbmd0aDtcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnl0ZXMuYnVmZmVyO1xuICAgIH07XG4gICAgU291bmRNYW5hZ2VyLnByb3RvdHlwZS5fcmVtb3ZlTWltZVR5cGUgPSBmdW5jdGlvbiAoZGF0YVVSSSkge1xuICAgICAgICB2YXIgc3BsaXRVcmkgPSBkYXRhVVJJLnNwbGl0KCcsJyk7XG4gICAgICAgIHJldHVybiBzcGxpdFVyaVsxXTtcbiAgICB9O1xuICAgIHJldHVybiBTb3VuZE1hbmFnZXI7XG59KCkpO1xuZXhwb3J0cy5Tb3VuZE1hbmFnZXIgPSBTb3VuZE1hbmFnZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Tb3VuZE1hbmFnZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmJsYW5rTGluZSA9ICdCbGFuayBsaW5lJztcbmV4cG9ydHMucHJvbXB0TGFiZWwgPSAnVGVybWluYWwgaW5wdXQnO1xuZXhwb3J0cy50b29NdWNoT3V0cHV0ID0gJ1RvbyBtdWNoIG91dHB1dCB0byBhbm5vdW5jZSwgbmF2aWdhdGUgdG8gcm93cyBtYW51YWxseSB0byByZWFkJztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVN0cmluZ3MuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJ1ZmZlclNldF8xID0gcmVxdWlyZShcIi4vQnVmZmVyU2V0XCIpO1xudmFyIEJ1ZmZlcl8xID0gcmVxdWlyZShcIi4vQnVmZmVyXCIpO1xudmFyIENvbXBvc2l0aW9uSGVscGVyXzEgPSByZXF1aXJlKFwiLi9Db21wb3NpdGlvbkhlbHBlclwiKTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXJcIik7XG52YXIgVmlld3BvcnRfMSA9IHJlcXVpcmUoXCIuL1ZpZXdwb3J0XCIpO1xudmFyIENsaXBib2FyZF8xID0gcmVxdWlyZShcIi4vdWkvQ2xpcGJvYXJkXCIpO1xudmFyIEVzY2FwZVNlcXVlbmNlc18xID0gcmVxdWlyZShcIi4vY29tbW9uL2RhdGEvRXNjYXBlU2VxdWVuY2VzXCIpO1xudmFyIElucHV0SGFuZGxlcl8xID0gcmVxdWlyZShcIi4vSW5wdXRIYW5kbGVyXCIpO1xudmFyIFJlbmRlcmVyXzEgPSByZXF1aXJlKFwiLi9yZW5kZXJlci9SZW5kZXJlclwiKTtcbnZhciBMaW5raWZpZXJfMSA9IHJlcXVpcmUoXCIuL0xpbmtpZmllclwiKTtcbnZhciBTZWxlY3Rpb25NYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi9TZWxlY3Rpb25NYW5hZ2VyXCIpO1xudmFyIENoYXJNZWFzdXJlXzEgPSByZXF1aXJlKFwiLi91aS9DaGFyTWVhc3VyZVwiKTtcbnZhciBCcm93c2VyID0gcmVxdWlyZShcIi4vY29yZS9QbGF0Zm9ybVwiKTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuL3VpL0xpZmVjeWNsZVwiKTtcbnZhciBTdHJpbmdzID0gcmVxdWlyZShcIi4vU3RyaW5nc1wiKTtcbnZhciBNb3VzZUhlbHBlcl8xID0gcmVxdWlyZShcIi4vdXRpbHMvTW91c2VIZWxwZXJcIik7XG52YXIgQ2xvbmVfMSA9IHJlcXVpcmUoXCIuL3V0aWxzL0Nsb25lXCIpO1xudmFyIFNvdW5kTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vU291bmRNYW5hZ2VyXCIpO1xudmFyIENvbG9yTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vcmVuZGVyZXIvQ29sb3JNYW5hZ2VyXCIpO1xudmFyIE1vdXNlWm9uZU1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuL3VpL01vdXNlWm9uZU1hbmFnZXJcIik7XG52YXIgQWNjZXNzaWJpbGl0eU1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuL0FjY2Vzc2liaWxpdHlNYW5hZ2VyXCIpO1xudmFyIFNjcmVlbkRwck1vbml0b3JfMSA9IHJlcXVpcmUoXCIuL3VpL1NjcmVlbkRwck1vbml0b3JcIik7XG52YXIgQ2hhckF0bGFzQ2FjaGVfMSA9IHJlcXVpcmUoXCIuL3JlbmRlcmVyL2F0bGFzL0NoYXJBdGxhc0NhY2hlXCIpO1xudmFyIERvbVJlbmRlcmVyXzEgPSByZXF1aXJlKFwiLi9yZW5kZXJlci9kb20vRG9tUmVuZGVyZXJcIik7XG52YXIgS2V5Ym9hcmRfMSA9IHJlcXVpcmUoXCIuL2NvcmUvaW5wdXQvS2V5Ym9hcmRcIik7XG52YXIgZG9jdW1lbnQgPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpID8gd2luZG93LmRvY3VtZW50IDogbnVsbDtcbnZhciBXUklURV9CVUZGRVJfUEFVU0VfVEhSRVNIT0xEID0gNTtcbnZhciBXUklURV9CQVRDSF9TSVpFID0gMzAwO1xudmFyIENPTlNUUlVDVE9SX09OTFlfT1BUSU9OUyA9IFsnY29scycsICdyb3dzJ107XG52YXIgREVGQVVMVF9PUFRJT05TID0ge1xuICAgIGNvbHM6IDgwLFxuICAgIHJvd3M6IDI0LFxuICAgIGNvbnZlcnRFb2w6IGZhbHNlLFxuICAgIHRlcm1OYW1lOiAneHRlcm0nLFxuICAgIGN1cnNvckJsaW5rOiBmYWxzZSxcbiAgICBjdXJzb3JTdHlsZTogJ2Jsb2NrJyxcbiAgICBiZWxsU291bmQ6IFNvdW5kTWFuYWdlcl8xLkRFRkFVTFRfQkVMTF9TT1VORCxcbiAgICBiZWxsU3R5bGU6ICdub25lJyxcbiAgICBkcmF3Qm9sZFRleHRJbkJyaWdodENvbG9yczogdHJ1ZSxcbiAgICBlbmFibGVCb2xkOiB0cnVlLFxuICAgIGV4cGVyaW1lbnRhbENoYXJBdGxhczogJ3N0YXRpYycsXG4gICAgZm9udEZhbWlseTogJ2NvdXJpZXItbmV3LCBjb3VyaWVyLCBtb25vc3BhY2UnLFxuICAgIGZvbnRTaXplOiAxNSxcbiAgICBmb250V2VpZ2h0OiAnbm9ybWFsJyxcbiAgICBmb250V2VpZ2h0Qm9sZDogJ2JvbGQnLFxuICAgIGxpbmVIZWlnaHQ6IDEuMCxcbiAgICBsZXR0ZXJTcGFjaW5nOiAwLFxuICAgIHNjcm9sbGJhY2s6IDEwMDAsXG4gICAgc2NyZWVuS2V5czogZmFsc2UsXG4gICAgc2NyZWVuUmVhZGVyTW9kZTogZmFsc2UsXG4gICAgZGVidWc6IGZhbHNlLFxuICAgIG1hY09wdGlvbklzTWV0YTogZmFsc2UsXG4gICAgbWFjT3B0aW9uQ2xpY2tGb3JjZXNTZWxlY3Rpb246IGZhbHNlLFxuICAgIGNhbmNlbEV2ZW50czogZmFsc2UsXG4gICAgZGlzYWJsZVN0ZGluOiBmYWxzZSxcbiAgICB1c2VGbG93Q29udHJvbDogZmFsc2UsXG4gICAgYWxsb3dUcmFuc3BhcmVuY3k6IGZhbHNlLFxuICAgIHRhYlN0b3BXaWR0aDogOCxcbiAgICB0aGVtZTogbnVsbCxcbiAgICByaWdodENsaWNrU2VsZWN0c1dvcmQ6IEJyb3dzZXIuaXNNYWMsXG4gICAgcmVuZGVyZXJUeXBlOiAnY2FudmFzJyxcbiAgICBleHBlcmltZW50YWxCdWZmZXJMaW5lSW1wbDogJ1R5cGVkQXJyYXknXG59O1xudmFyIFRlcm1pbmFsID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGVybWluYWwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGVybWluYWwob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5icm93c2VyID0gQnJvd3NlcjtcbiAgICAgICAgX3RoaXMuX2JsYW5rTGluZSA9IG51bGw7XG4gICAgICAgIF90aGlzLm9wdGlvbnMgPSBDbG9uZV8xLmNsb25lKG9wdGlvbnMpO1xuICAgICAgICBfdGhpcy5fc2V0dXAoKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuX2N1c3RvbUtleUV2ZW50SGFuZGxlciA9IG51bGw7XG4gICAgICAgIENoYXJBdGxhc0NhY2hlXzEucmVtb3ZlVGVybWluYWxGcm9tQ2FjaGUodGhpcyk7XG4gICAgICAgIHRoaXMuaGFuZGxlciA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICAgICAgdGhpcy53cml0ZSA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudCAmJiB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZGlzcG9zZSgpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9zZXR1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgT2JqZWN0LmtleXMoREVGQVVMVF9PUFRJT05TKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zW2tleV0gPT09IG51bGwgfHwgX3RoaXMub3B0aW9uc1trZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5vcHRpb25zW2tleV0gPSBERUZBVUxUX09QVElPTlNba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3BhcmVudCA9IGRvY3VtZW50ID8gZG9jdW1lbnQuYm9keSA6IG51bGw7XG4gICAgICAgIHRoaXMuY29scyA9IHRoaXMub3B0aW9ucy5jb2xzO1xuICAgICAgICB0aGlzLnJvd3MgPSB0aGlzLm9wdGlvbnMucm93cztcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oYW5kbGVyKSB7XG4gICAgICAgICAgICB0aGlzLm9uKCdkYXRhJywgdGhpcy5vcHRpb25zLmhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3Vyc29yU3RhdGUgPSAwO1xuICAgICAgICB0aGlzLmN1cnNvckhpZGRlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgPSBudWxsO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uS2V5cGFkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb25DdXJzb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcmlnaW5Nb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5zZXJ0TW9kZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLndyYXBhcm91bmRNb2RlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5icmFja2V0ZWRQYXN0ZU1vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jaGFyc2V0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5nY2hhcnNldCA9IG51bGw7XG4gICAgICAgIHRoaXMuZ2xldmVsID0gMDtcbiAgICAgICAgdGhpcy5jaGFyc2V0cyA9IFtudWxsXTtcbiAgICAgICAgdGhpcy5jdXJBdHRyID0gQnVmZmVyXzEuREVGQVVMVF9BVFRSO1xuICAgICAgICB0aGlzLnBhcmFtcyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRQYXJhbSA9IDA7XG4gICAgICAgIHRoaXMud3JpdGVCdWZmZXIgPSBbXTtcbiAgICAgICAgdGhpcy5fd3JpdGVJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3hvZmZTZW50VG9DYXRjaFVwID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3VzZXJTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyID0gbmV3IElucHV0SGFuZGxlcl8xLklucHV0SGFuZGxlcih0aGlzKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLl9pbnB1dEhhbmRsZXIpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gdGhpcy5yZW5kZXJlciB8fCBudWxsO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgPSB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5saW5raWZpZXIgPSB0aGlzLmxpbmtpZmllciB8fCBuZXcgTGlua2lmaWVyXzEuTGlua2lmaWVyKHRoaXMpO1xuICAgICAgICB0aGlzLl9tb3VzZVpvbmVNYW5hZ2VyID0gdGhpcy5fbW91c2Vab25lTWFuYWdlciB8fCBudWxsO1xuICAgICAgICB0aGlzLnNvdW5kTWFuYWdlciA9IHRoaXMuc291bmRNYW5hZ2VyIHx8IG5ldyBTb3VuZE1hbmFnZXJfMS5Tb3VuZE1hbmFnZXIodGhpcyk7XG4gICAgICAgIHRoaXMuYnVmZmVycyA9IG5ldyBCdWZmZXJTZXRfMS5CdWZmZXJTZXQodGhpcyk7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uTWFuYWdlci5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLmluaXRCdWZmZXJzTGlzdGVuZXJzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwiYnVmZmVyXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5idWZmZXJzLmFjdGl2ZTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgVGVybWluYWwucHJvdG90eXBlLmVyYXNlQXR0ciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIChCdWZmZXJfMS5ERUZBVUxUX0FUVFIgJiB+MHgxZmYpIHwgKHRoaXMuY3VyQXR0ciAmIDB4MWZmKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudGV4dGFyZWEpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJpc0ZvY3VzZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLnRleHRhcmVhICYmIGRvY3VtZW50Lmhhc0ZvY3VzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5nZXRPcHRpb24gPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGlmICghKGtleSBpbiBERUZBVUxUX09QVElPTlMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG9wdGlvbiB3aXRoIGtleSBcIicgKyBrZXkgKyAnXCInKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zW2tleV07XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2V0T3B0aW9uID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKCEoa2V5IGluIERFRkFVTFRfT1BUSU9OUykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gb3B0aW9uIHdpdGgga2V5IFwiJyArIGtleSArICdcIicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChDT05TVFJVQ1RPUl9PTkxZX09QVElPTlMuaW5kZXhPZihrZXkpICE9PSAtMSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIk9wdGlvbiBcXFwiXCIgKyBrZXkgKyBcIlxcXCIgY2FuIG9ubHkgYmUgc2V0IGluIHRoZSBjb25zdHJ1Y3RvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zW2tleV0gPT09IHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgJ2JlbGxTdHlsZSc6XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdub25lJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjdXJzb3JTdHlsZSc6XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdibG9jayc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZm9udFdlaWdodCc6XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdub3JtYWwnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZvbnRXZWlnaHRCb2xkJzpcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJ2JvbGQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xpbmVIZWlnaHQnOlxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGtleSArIFwiIGNhbm5vdCBiZSBsZXNzIHRoYW4gMSwgdmFsdWU6IFwiICsgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAncmVuZGVyZXJUeXBlJzpcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJ2NhbnZhcyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndGFiU3RvcFdpZHRoJzpcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihrZXkgKyBcIiBjYW5ub3QgYmUgbGVzcyB0aGFuIDEsIHZhbHVlOiBcIiArIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RoZW1lJzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJlcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRUaGVtZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzY3JvbGxiYWNrJzpcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IE1hdGgubWluKHZhbHVlLCBCdWZmZXJfMS5NQVhfQlVGRkVSX1NJWkUpO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGtleSArIFwiIGNhbm5vdCBiZSBsZXNzIHRoYW4gMCwgdmFsdWU6IFwiICsgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnNba2V5XSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0J1ZmZlckxlbmd0aCA9IHRoaXMucm93cyArIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5idWZmZXIubGluZXMubGVuZ3RoID4gbmV3QnVmZmVyTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYW1vdW50VG9UcmltID0gdGhpcy5idWZmZXIubGluZXMubGVuZ3RoIC0gbmV3QnVmZmVyTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5lZWRzUmVmcmVzaCA9ICh0aGlzLmJ1ZmZlci55ZGlzcCAtIGFtb3VudFRvVHJpbSA8IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMudHJpbVN0YXJ0KGFtb3VudFRvVHJpbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci55YmFzZSA9IE1hdGgubWF4KHRoaXMuYnVmZmVyLnliYXNlIC0gYW1vdW50VG9UcmltLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gTWF0aC5tYXgodGhpcy5idWZmZXIueWRpc3AgLSBhbW91bnRUb1RyaW0sIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZWRzUmVmcmVzaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9wdGlvbnNba2V5XSA9IHZhbHVlO1xuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSAnZm9udEZhbWlseSc6XG4gICAgICAgICAgICBjYXNlICdmb250U2l6ZSc6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5jbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJNZWFzdXJlLm1lYXN1cmUodGhpcy5vcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkcmF3Qm9sZFRleHRJbkJyaWdodENvbG9ycyc6XG4gICAgICAgICAgICBjYXNlICdleHBlcmltZW50YWxDaGFyQXRsYXMnOlxuICAgICAgICAgICAgY2FzZSAnZW5hYmxlQm9sZCc6XG4gICAgICAgICAgICBjYXNlICdsZXR0ZXJTcGFjaW5nJzpcbiAgICAgICAgICAgIGNhc2UgJ2xpbmVIZWlnaHQnOlxuICAgICAgICAgICAgY2FzZSAnZm9udFdlaWdodCc6XG4gICAgICAgICAgICBjYXNlICdmb250V2VpZ2h0Qm9sZCc6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5jbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLm9uUmVzaXplKHRoaXMuY29scywgdGhpcy5yb3dzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ3JlbmRlcmVyVHlwZSc6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnJlZ2lzdGVyKHRoaXMucmVuZGVyZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLm9uQ2hhclNpemVDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RoZW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0VGhlbWUodGhpcy5fdGhlbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlSGVscGVyLnNldFJlbmRlcmVyKHRoaXMucmVuZGVyZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc2Nyb2xsYmFjayc6XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJzLnJlc2l6ZSh0aGlzLmNvbHMsIHRoaXMucm93cyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudmlld3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3NjcmVlblJlYWRlck1vZGUnOlxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlciA9IG5ldyBBY2Nlc3NpYmlsaXR5TWFuYWdlcl8xLkFjY2Vzc2liaWxpdHlNYW5hZ2VyKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWNjZXNzaWJpbGl0eU1hbmFnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RhYlN0b3BXaWR0aCc6XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJzLnNldHVwVGFiU3RvcHMoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2V4cGVyaW1lbnRhbEJ1ZmZlckxpbmVJbXBsJzpcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcnMubm9ybWFsLnNldEJ1ZmZlckxpbmVGYWN0b3J5KHZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcnMuYWx0LnNldEJ1ZmZlckxpbmVGYWN0b3J5KHZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9ibGFua0xpbmUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLm9uT3B0aW9uc0NoYW5nZWQoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9vblRleHRBcmVhRm9jdXMgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VuZEZvY3VzKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tJJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JTdHlsZShldik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmb2N1cycpO1xuICAgICAgICB0aGlzLnNob3dDdXJzb3IoKTtcbiAgICAgICAgdGhpcy5lbWl0KCdmb2N1cycpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHRhcmVhLmJsdXIoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fb25UZXh0QXJlYUJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudGV4dGFyZWEudmFsdWUgPSAnJztcbiAgICAgICAgdGhpcy5yZWZyZXNoKHRoaXMuYnVmZmVyLnksIHRoaXMuYnVmZmVyLnkpO1xuICAgICAgICBpZiAodGhpcy5zZW5kRm9jdXMpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW08nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZm9jdXMnKTtcbiAgICAgICAgdGhpcy5lbWl0KCdibHVyJyk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX2luaXRHbG9iYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX2JpbmRLZXlzKCk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMuZWxlbWVudCwgJ2NvcHknLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMuaGFzU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBDbGlwYm9hcmRfMS5jb3B5SGFuZGxlcihldmVudCwgX3RoaXMsIF90aGlzLnNlbGVjdGlvbk1hbmFnZXIpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHZhciBwYXN0ZUhhbmRsZXJXcmFwcGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7IHJldHVybiBDbGlwYm9hcmRfMS5wYXN0ZUhhbmRsZXIoZXZlbnQsIF90aGlzKTsgfTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy50ZXh0YXJlYSwgJ3Bhc3RlJywgcGFzdGVIYW5kbGVyV3JhcHBlcikpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLmVsZW1lbnQsICdwYXN0ZScsIHBhc3RlSGFuZGxlcldyYXBwZXIpKTtcbiAgICAgICAgaWYgKEJyb3dzZXIuaXNGaXJlZm94KSB7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLmVsZW1lbnQsICdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIENsaXBib2FyZF8xLnJpZ2h0Q2xpY2tIYW5kbGVyKGV2ZW50LCBfdGhpcy50ZXh0YXJlYSwgX3RoaXMuc2VsZWN0aW9uTWFuYWdlciwgX3RoaXMub3B0aW9ucy5yaWdodENsaWNrU2VsZWN0c1dvcmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMuZWxlbWVudCwgJ2NvbnRleHRtZW51JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgQ2xpcGJvYXJkXzEucmlnaHRDbGlja0hhbmRsZXIoZXZlbnQsIF90aGlzLnRleHRhcmVhLCBfdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLCBfdGhpcy5vcHRpb25zLnJpZ2h0Q2xpY2tTZWxlY3RzV29yZCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEJyb3dzZXIuaXNMaW51eCkge1xuICAgICAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAnYXV4Y2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIENsaXBib2FyZF8xLm1vdmVUZXh0QXJlYVVuZGVyTW91c2VDdXJzb3IoZXZlbnQsIF90aGlzLnRleHRhcmVhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fYmluZEtleXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAna2V5ZG93bicsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLl9rZXlEb3duKGV2KTtcbiAgICAgICAgfSwgdHJ1ZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLmVsZW1lbnQsICdrZXlwcmVzcycsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLl9rZXlQcmVzcyhldik7XG4gICAgICAgIH0sIHRydWUpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAna2V5dXAnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIGlmICghd2FzTW9kaWZpZXJLZXlPbmx5RXZlbnQoZXYpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuX2tleVVwKGV2KTtcbiAgICAgICAgfSwgdHJ1ZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAna2V5ZG93bicsIGZ1bmN0aW9uIChldikgeyByZXR1cm4gX3RoaXMuX2tleURvd24oZXYpOyB9LCB0cnVlKSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMudGV4dGFyZWEsICdrZXlwcmVzcycsIGZ1bmN0aW9uIChldikgeyByZXR1cm4gX3RoaXMuX2tleVByZXNzKGV2KTsgfSwgdHJ1ZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAnY29tcG9zaXRpb25zdGFydCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9jb21wb3NpdGlvbkhlbHBlci5jb21wb3NpdGlvbnN0YXJ0KCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy50ZXh0YXJlYSwgJ2NvbXBvc2l0aW9udXBkYXRlJywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9jb21wb3NpdGlvbkhlbHBlci5jb21wb3NpdGlvbnVwZGF0ZShlKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAnY29tcG9zaXRpb25lbmQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fY29tcG9zaXRpb25IZWxwZXIuY29tcG9zaXRpb25lbmQoKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdyZWZyZXNoJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2NvbXBvc2l0aW9uSGVscGVyLnVwZGF0ZUNvbXBvc2l0aW9uRWxlbWVudHMoKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdyZWZyZXNoJywgZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF90aGlzLl9xdWV1ZUxpbmtpZmljYXRpb24oZGF0YS5zdGFydCwgZGF0YS5lbmQpOyB9KSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIChwYXJlbnQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gcGFyZW50IHx8IHRoaXMuX3BhcmVudDtcbiAgICAgICAgaWYgKCF0aGlzLl9wYXJlbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGVybWluYWwgcmVxdWlyZXMgYSBwYXJlbnQgZWxlbWVudC4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jb250ZXh0ID0gdGhpcy5fcGFyZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50ID0gdGhpcy5fcGFyZW50Lm93bmVyRG9jdW1lbnQ7XG4gICAgICAgIHRoaXMuX3NjcmVlbkRwck1vbml0b3IgPSBuZXcgU2NyZWVuRHByTW9uaXRvcl8xLlNjcmVlbkRwck1vbml0b3IoKTtcbiAgICAgICAgdGhpcy5fc2NyZWVuRHByTW9uaXRvci5zZXRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5lbWl0KCdkcHJjaGFuZ2UnLCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7IH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuX3NjcmVlbkRwck1vbml0b3IpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmRpciA9ICdsdHInO1xuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgndGVybWluYWwnKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3h0ZXJtJyk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICAgICAgdGhpcy5fcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG4gICAgICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgdGhpcy5fdmlld3BvcnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCd4dGVybS12aWV3cG9ydCcpO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0aGlzLl92aWV3cG9ydEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl92aWV3cG9ydFNjcm9sbEFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5fdmlld3BvcnRTY3JvbGxBcmVhLmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLXNjcm9sbC1hcmVhJyk7XG4gICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl92aWV3cG9ydFNjcm9sbEFyZWEpO1xuICAgICAgICB0aGlzLnNjcmVlbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5zY3JlZW5FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLXNjcmVlbicpO1xuICAgICAgICB0aGlzLl9oZWxwZXJDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5faGVscGVyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLWhlbHBlcnMnKTtcbiAgICAgICAgdGhpcy5zY3JlZW5FbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX2hlbHBlckNvbnRhaW5lcik7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRoaXMuc2NyZWVuRWxlbWVudCk7XG4gICAgICAgIHRoaXMuX21vdXNlWm9uZU1hbmFnZXIgPSBuZXcgTW91c2Vab25lTWFuYWdlcl8xLk1vdXNlWm9uZU1hbmFnZXIodGhpcyk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5fbW91c2Vab25lTWFuYWdlcik7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9tb3VzZVpvbmVNYW5hZ2VyLmNsZWFyQWxsKCk7IH0pKTtcbiAgICAgICAgdGhpcy5saW5raWZpZXIuYXR0YWNoVG9Eb20odGhpcy5fbW91c2Vab25lTWFuYWdlcik7XG4gICAgICAgIHRoaXMudGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLWhlbHBlci10ZXh0YXJlYScpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIFN0cmluZ3MucHJvbXB0TGFiZWwpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZSgnYXJpYS1tdWx0aWxpbmUnLCAnZmFsc2UnKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoJ2F1dG9jb3JyZWN0JywgJ29mZicpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZSgnYXV0b2NhcGl0YWxpemUnLCAnb2ZmJyk7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKCdzcGVsbGNoZWNrJywgJ2ZhbHNlJyk7XG4gICAgICAgIHRoaXMudGV4dGFyZWEudGFiSW5kZXggPSAwO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAnZm9jdXMnLCBmdW5jdGlvbiAoZXYpIHsgcmV0dXJuIF90aGlzLl9vblRleHRBcmVhRm9jdXMoZXYpOyB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMudGV4dGFyZWEsICdibHVyJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX29uVGV4dEFyZWFCbHVyKCk7IH0pKTtcbiAgICAgICAgdGhpcy5faGVscGVyQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMudGV4dGFyZWEpO1xuICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LmNsYXNzTGlzdC5hZGQoJ2NvbXBvc2l0aW9uLXZpZXcnKTtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25IZWxwZXIgPSBuZXcgQ29tcG9zaXRpb25IZWxwZXJfMS5Db21wb3NpdGlvbkhlbHBlcih0aGlzLnRleHRhcmVhLCB0aGlzLl9jb21wb3NpdGlvblZpZXcsIHRoaXMpO1xuICAgICAgICB0aGlzLl9oZWxwZXJDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5fY29tcG9zaXRpb25WaWV3KTtcbiAgICAgICAgdGhpcy5jaGFyTWVhc3VyZSA9IG5ldyBDaGFyTWVhc3VyZV8xLkNoYXJNZWFzdXJlKGRvY3VtZW50LCB0aGlzLl9oZWxwZXJDb250YWluZXIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgICAgICB0aGlzLl9zZXR1cFJlbmRlcmVyKCk7XG4gICAgICAgIHRoaXMuX3RoZW1lID0gdGhpcy5vcHRpb25zLnRoZW1lO1xuICAgICAgICB0aGlzLm9wdGlvbnMudGhlbWUgPSBudWxsO1xuICAgICAgICB0aGlzLnZpZXdwb3J0ID0gbmV3IFZpZXdwb3J0XzEuVmlld3BvcnQodGhpcywgdGhpcy5fdmlld3BvcnRFbGVtZW50LCB0aGlzLl92aWV3cG9ydFNjcm9sbEFyZWEsIHRoaXMuY2hhck1lYXN1cmUpO1xuICAgICAgICB0aGlzLnZpZXdwb3J0Lm9uVGhlbWVDaGFuZ2VkKHRoaXMucmVuZGVyZXIuY29sb3JNYW5hZ2VyLmNvbG9ycyk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy52aWV3cG9ydCk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ2N1cnNvcm1vdmUnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vbkN1cnNvck1vdmUoKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vblJlc2l6ZShfdGhpcy5jb2xzLCBfdGhpcy5yb3dzKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMucmVuZGVyZXIub25CbHVyKCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vbkZvY3VzKCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignZHByY2hhbmdlJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMucmVuZGVyZXIub25XaW5kb3dSZXNpemUod2luZG93LmRldmljZVBpeGVsUmF0aW8pOyB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnJlbmRlcmVyLm9uV2luZG93UmVzaXplKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuY2hhck1lYXN1cmUuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdjaGFyc2l6ZWNoYW5nZWQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vbkNoYXJTaXplQ2hhbmdlZCgpOyB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5yZW5kZXJlci5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uIChkaW1lbnNpb25zKSB7IHJldHVybiBfdGhpcy52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpOyB9KSk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uTWFuYWdlciA9IG5ldyBTZWxlY3Rpb25NYW5hZ2VyXzEuU2VsZWN0aW9uTWFuYWdlcih0aGlzLCB0aGlzLmNoYXJNZWFzdXJlKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAnbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLnNlbGVjdGlvbk1hbmFnZXIub25Nb3VzZURvd24oZSk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLnNlbGVjdGlvbk1hbmFnZXIuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdyZWZyZXNoJywgZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF90aGlzLnJlbmRlcmVyLm9uU2VsZWN0aW9uQ2hhbmdlZChkYXRhLnN0YXJ0LCBkYXRhLmVuZCwgZGF0YS5jb2x1bW5TZWxlY3RNb2RlKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuc2VsZWN0aW9uTWFuYWdlci5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ25ld3NlbGVjdGlvbicsIGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgICBfdGhpcy50ZXh0YXJlYS52YWx1ZSA9IHRleHQ7XG4gICAgICAgICAgICBfdGhpcy50ZXh0YXJlYS5mb2N1cygpO1xuICAgICAgICAgICAgX3RoaXMudGV4dGFyZWEuc2VsZWN0KCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTtcbiAgICAgICAgICAgIF90aGlzLnNlbGVjdGlvbk1hbmFnZXIucmVmcmVzaCgpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMuX3ZpZXdwb3J0RWxlbWVudCwgJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbGVjdGlvbk1hbmFnZXIucmVmcmVzaCgpOyB9KSk7XG4gICAgICAgIHRoaXMubW91c2VIZWxwZXIgPSBuZXcgTW91c2VIZWxwZXJfMS5Nb3VzZUhlbHBlcih0aGlzLnJlbmRlcmVyKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zY3JlZW5SZWFkZXJNb2RlKSB7XG4gICAgICAgICAgICB0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlciA9IG5ldyBBY2Nlc3NpYmlsaXR5TWFuYWdlcl8xLkFjY2Vzc2liaWxpdHlNYW5hZ2VyKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhck1lYXN1cmUubWVhc3VyZSh0aGlzLm9wdGlvbnMpO1xuICAgICAgICB0aGlzLnJlZnJlc2goMCwgdGhpcy5yb3dzIC0gMSk7XG4gICAgICAgIHRoaXMuX2luaXRHbG9iYWwoKTtcbiAgICAgICAgdGhpcy5iaW5kTW91c2UoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fc2V0dXBSZW5kZXJlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMucmVuZGVyZXJUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdjYW52YXMnOlxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgUmVuZGVyZXJfMS5SZW5kZXJlcih0aGlzLCB0aGlzLm9wdGlvbnMudGhlbWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZG9tJzpcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gbmV3IERvbVJlbmRlcmVyXzEuRG9tUmVuZGVyZXIodGhpcywgdGhpcy5vcHRpb25zLnRoZW1lKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIlVucmVjb2duaXplZCByZW5kZXJlclR5cGUgXFxcIlwiICsgdGhpcy5vcHRpb25zLnJlbmRlcmVyVHlwZSArIFwiXFxcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMucmVuZGVyZXIpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9zZXRUaGVtZSA9IGZ1bmN0aW9uICh0aGVtZSkge1xuICAgICAgICB0aGlzLl90aGVtZSA9IHRoZW1lO1xuICAgICAgICB2YXIgY29sb3JzID0gdGhpcy5yZW5kZXJlci5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgIGlmICh0aGlzLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0Lm9uVGhlbWVDaGFuZ2VkKGNvbG9ycyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5iaW5kTW91c2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBlbCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXIgcHJlc3NlZCA9IDMyO1xuICAgICAgICBmdW5jdGlvbiBzZW5kQnV0dG9uKGV2KSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uO1xuICAgICAgICAgICAgdmFyIHBvcztcbiAgICAgICAgICAgIGJ1dHRvbiA9IGdldEJ1dHRvbihldik7XG4gICAgICAgICAgICBwb3MgPSBzZWxmLm1vdXNlSGVscGVyLmdldFJhd0J5dGVDb29yZHMoZXYsIHNlbGYuc2NyZWVuRWxlbWVudCwgc2VsZi5jaGFyTWVhc3VyZSwgc2VsZi5jb2xzLCBzZWxmLnJvd3MpO1xuICAgICAgICAgICAgaWYgKCFwb3MpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgc2VuZEV2ZW50KGJ1dHRvbiwgcG9zKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXYub3ZlcnJpZGVUeXBlIHx8IGV2LnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdtb3VzZWRvd24nOlxuICAgICAgICAgICAgICAgICAgICBwcmVzc2VkID0gYnV0dG9uO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdtb3VzZXVwJzpcbiAgICAgICAgICAgICAgICAgICAgcHJlc3NlZCA9IDMyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlbmRNb3ZlKGV2KSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uID0gcHJlc3NlZDtcbiAgICAgICAgICAgIHZhciBwb3MgPSBzZWxmLm1vdXNlSGVscGVyLmdldFJhd0J5dGVDb29yZHMoZXYsIHNlbGYuc2NyZWVuRWxlbWVudCwgc2VsZi5jaGFyTWVhc3VyZSwgc2VsZi5jb2xzLCBzZWxmLnJvd3MpO1xuICAgICAgICAgICAgaWYgKCFwb3MpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgYnV0dG9uICs9IDMyO1xuICAgICAgICAgICAgc2VuZEV2ZW50KGJ1dHRvbiwgcG9zKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBlbmNvZGUoZGF0YSwgY2gpIHtcbiAgICAgICAgICAgIGlmICghc2VsZi51dGZNb3VzZSkge1xuICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCgwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2ggPiAxMjcpXG4gICAgICAgICAgICAgICAgICAgIGNoID0gMTI3O1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaChjaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDIwNDcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKDApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjaCA8IDEyNykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goY2gpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID4gMjA0NylcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoID0gMjA0NztcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKDB4QzAgfCAoY2ggPj4gNikpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goMHg4MCB8IChjaCAmIDB4M0YpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2VuZEV2ZW50KGJ1dHRvbiwgcG9zKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5fdnQzMDBNb3VzZSkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbiAmPSAzO1xuICAgICAgICAgICAgICAgIHBvcy54IC09IDMyO1xuICAgICAgICAgICAgICAgIHBvcy55IC09IDMyO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhXzEgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzI0JztcbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uID09PSAwKVxuICAgICAgICAgICAgICAgICAgICBkYXRhXzEgKz0gJzEnO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJ1dHRvbiA9PT0gMSlcbiAgICAgICAgICAgICAgICAgICAgZGF0YV8xICs9ICczJztcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChidXR0b24gPT09IDIpXG4gICAgICAgICAgICAgICAgICAgIGRhdGFfMSArPSAnNSc7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYnV0dG9uID09PSAzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBkYXRhXzEgKz0gJzAnO1xuICAgICAgICAgICAgICAgIGRhdGFfMSArPSAnflsnICsgcG9zLnggKyAnLCcgKyBwb3MueSArICddXFxyJztcbiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZXIoZGF0YV8xKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VsZi5fZGVjTG9jYXRvcikge1xuICAgICAgICAgICAgICAgIGJ1dHRvbiAmPSAzO1xuICAgICAgICAgICAgICAgIHBvcy54IC09IDMyO1xuICAgICAgICAgICAgICAgIHBvcy55IC09IDMyO1xuICAgICAgICAgICAgICAgIGlmIChidXR0b24gPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IDI7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYnV0dG9uID09PSAxKVxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSA0O1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJ1dHRvbiA9PT0gMilcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gNjtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChidXR0b24gPT09IDMpXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IDM7XG4gICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbJ1xuICAgICAgICAgICAgICAgICAgICArIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICArICc7J1xuICAgICAgICAgICAgICAgICAgICArIChidXR0b24gPT09IDMgPyA0IDogMClcbiAgICAgICAgICAgICAgICAgICAgKyAnOydcbiAgICAgICAgICAgICAgICAgICAgKyBwb3MueVxuICAgICAgICAgICAgICAgICAgICArICc7J1xuICAgICAgICAgICAgICAgICAgICArIHBvcy54XG4gICAgICAgICAgICAgICAgICAgICsgJzsnXG4gICAgICAgICAgICAgICAgICAgICsgcG9zLnBhZ2UgfHwgMFxuICAgICAgICAgICAgICAgICAgICArICcmdycpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzZWxmLnVyeHZ0TW91c2UpIHtcbiAgICAgICAgICAgICAgICBwb3MueCAtPSAzMjtcbiAgICAgICAgICAgICAgICBwb3MueSAtPSAzMjtcbiAgICAgICAgICAgICAgICBwb3MueCsrO1xuICAgICAgICAgICAgICAgIHBvcy55Kys7XG4gICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbJyArIGJ1dHRvbiArICc7JyArIHBvcy54ICsgJzsnICsgcG9zLnkgKyAnTScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzZWxmLnNnck1vdXNlKSB7XG4gICAgICAgICAgICAgICAgcG9zLnggLT0gMzI7XG4gICAgICAgICAgICAgICAgcG9zLnkgLT0gMzI7XG4gICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPCdcbiAgICAgICAgICAgICAgICAgICAgKyAoKChidXR0b24gJiAzKSA9PT0gMyA/IGJ1dHRvbiAmIH4zIDogYnV0dG9uKSAtIDMyKVxuICAgICAgICAgICAgICAgICAgICArICc7J1xuICAgICAgICAgICAgICAgICAgICArIHBvcy54XG4gICAgICAgICAgICAgICAgICAgICsgJzsnXG4gICAgICAgICAgICAgICAgICAgICsgcG9zLnlcbiAgICAgICAgICAgICAgICAgICAgKyAoKGJ1dHRvbiAmIDMpID09PSAzID8gJ20nIDogJ00nKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgIGVuY29kZShkYXRhLCBidXR0b24pO1xuICAgICAgICAgICAgZW5jb2RlKGRhdGEsIHBvcy54KTtcbiAgICAgICAgICAgIGVuY29kZShkYXRhLCBwb3MueSk7XG4gICAgICAgICAgICBzZWxmLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tNJyArIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBkYXRhKSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0QnV0dG9uKGV2KSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uO1xuICAgICAgICAgICAgdmFyIHNoaWZ0O1xuICAgICAgICAgICAgdmFyIG1ldGE7XG4gICAgICAgICAgICB2YXIgY3RybDtcbiAgICAgICAgICAgIHZhciBtb2Q7XG4gICAgICAgICAgICBzd2l0Y2ggKGV2Lm92ZXJyaWRlVHlwZSB8fCBldi50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbW91c2Vkb3duJzpcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gZXYuYnV0dG9uICE9PSBudWxsICYmIGV2LmJ1dHRvbiAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICAgICA/ICtldi5idXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgIDogZXYud2hpY2ggIT09IG51bGwgJiYgZXYud2hpY2ggIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gZXYud2hpY2ggLSAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoQnJvd3Nlci5pc01TSUUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGJ1dHRvbiA9PT0gMSA/IDAgOiBidXR0b24gPT09IDQgPyAxIDogYnV0dG9uO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ21vdXNldXAnOlxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSAzO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdET01Nb3VzZVNjcm9sbCc6XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGV2LmRldGFpbCA8IDBcbiAgICAgICAgICAgICAgICAgICAgICAgID8gNjRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogNjU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3doZWVsJzpcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gZXYuZGVsdGFZIDwgMFxuICAgICAgICAgICAgICAgICAgICAgICAgPyA2NFxuICAgICAgICAgICAgICAgICAgICAgICAgOiA2NTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzaGlmdCA9IGV2LnNoaWZ0S2V5ID8gNCA6IDA7XG4gICAgICAgICAgICBtZXRhID0gZXYubWV0YUtleSA/IDggOiAwO1xuICAgICAgICAgICAgY3RybCA9IGV2LmN0cmxLZXkgPyAxNiA6IDA7XG4gICAgICAgICAgICBtb2QgPSBzaGlmdCB8IG1ldGEgfCBjdHJsO1xuICAgICAgICAgICAgaWYgKHNlbGYudnQyMDBNb3VzZSkge1xuICAgICAgICAgICAgICAgIG1vZCAmPSBjdHJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIXNlbGYubm9ybWFsTW91c2UpIHtcbiAgICAgICAgICAgICAgICBtb2QgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnV0dG9uID0gKDMyICsgKG1vZCA8PCAyKSkgKyBidXR0b247XG4gICAgICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKGVsLCAnbW91c2Vkb3duJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgX3RoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgIGlmICghX3RoaXMubW91c2VFdmVudHMgfHwgX3RoaXMuc2VsZWN0aW9uTWFuYWdlci5zaG91bGRGb3JjZVNlbGVjdGlvbihldikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZW5kQnV0dG9uKGV2KTtcbiAgICAgICAgICAgIGlmIChfdGhpcy52dDIwME1vdXNlKSB7XG4gICAgICAgICAgICAgICAgZXYub3ZlcnJpZGVUeXBlID0gJ21vdXNldXAnO1xuICAgICAgICAgICAgICAgIHNlbmRCdXR0b24oZXYpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG1vdmVIYW5kbGVyO1xuICAgICAgICAgICAgaWYgKF90aGlzLm5vcm1hbE1vdXNlKSB7XG4gICAgICAgICAgICAgICAgbW92ZUhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5ub3JtYWxNb3VzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNlbmRNb3ZlKGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIF90aGlzLl9kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBtb3ZlSGFuZGxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaGFuZGxlciA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5ub3JtYWxNb3VzZSAmJiAhX3RoaXMueDEwTW91c2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VuZEJ1dHRvbihldik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtb3ZlSGFuZGxlcikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgbW92ZUhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBtb3ZlSGFuZGxlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLl9kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNhbmNlbChldik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgX3RoaXMuX2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKGVsLCAnd2hlZWwnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMubW91c2VFdmVudHMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLmJ1ZmZlci5oYXNTY3JvbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhbW91bnQgPSBfdGhpcy52aWV3cG9ydC5nZXRMaW5lc1Njcm9sbGVkKGV2KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFtb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXF1ZW5jZSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIChfdGhpcy5hcHBsaWNhdGlvbkN1cnNvciA/ICdPJyA6ICdbJykgKyAoZXYuZGVsdGFZIDwgMCA/ICdBJyA6ICdCJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTWF0aC5hYnMoYW1vdW50KTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhICs9IHNlcXVlbmNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfdGhpcy54MTBNb3VzZSB8fCBfdGhpcy5fdnQzMDBNb3VzZSB8fCBfdGhpcy5fZGVjTG9jYXRvcilcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBzZW5kQnV0dG9uKGV2KTtcbiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIoZWwsICd3aGVlbCcsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKF90aGlzLm1vdXNlRXZlbnRzKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIF90aGlzLnZpZXdwb3J0Lm9uV2hlZWwoZXYpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNhbmNlbChldik7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIoZWwsICd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMubW91c2VFdmVudHMpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgX3RoaXMudmlld3BvcnQub25Ub3VjaFN0YXJ0KGV2KTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKGVsLCAndG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMubW91c2VFdmVudHMpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgX3RoaXMudmlld3BvcnQub25Ub3VjaE1vdmUoZXYpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNhbmNlbChldik7XG4gICAgICAgIH0pKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVmcmVzaFJvd3Moc3RhcnQsIGVuZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fcXVldWVMaW5raWZpY2F0aW9uID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgaWYgKHRoaXMubGlua2lmaWVyKSB7XG4gICAgICAgICAgICB0aGlzLmxpbmtpZmllci5saW5raWZ5Um93cyhzdGFydCwgZW5kKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnVwZGF0ZUN1cnNvclN0eWxlID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk1hbmFnZXIgJiYgdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLnNob3VsZENvbHVtblNlbGVjdChldikpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb2x1bW4tc2VsZWN0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnY29sdW1uLXNlbGVjdCcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2hvd0N1cnNvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnNvclN0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnNvclN0YXRlID0gMTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCh0aGlzLmJ1ZmZlci55LCB0aGlzLmJ1ZmZlci55KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbCA9IGZ1bmN0aW9uIChpc1dyYXBwZWQpIHtcbiAgICAgICAgaWYgKGlzV3JhcHBlZCA9PT0gdm9pZCAwKSB7IGlzV3JhcHBlZCA9IGZhbHNlOyB9XG4gICAgICAgIHZhciBuZXdMaW5lO1xuICAgICAgICB2YXIgdXNlUmVjeWNsaW5nID0gdGhpcy5vcHRpb25zLmV4cGVyaW1lbnRhbEJ1ZmZlckxpbmVJbXBsICE9PSAnSnNBcnJheSc7XG4gICAgICAgIGlmICh1c2VSZWN5Y2xpbmcpIHtcbiAgICAgICAgICAgIG5ld0xpbmUgPSB0aGlzLl9ibGFua0xpbmU7XG4gICAgICAgICAgICBpZiAoIW5ld0xpbmUgfHwgbmV3TGluZS5sZW5ndGggIT09IHRoaXMuY29scyB8fCBuZXdMaW5lLmdldCgwKVtCdWZmZXJfMS5DSEFSX0RBVEFfQVRUUl9JTkRFWF0gIT09IHRoaXMuZXJhc2VBdHRyKCkpIHtcbiAgICAgICAgICAgICAgICBuZXdMaW5lID0gdGhpcy5idWZmZXIuZ2V0QmxhbmtMaW5lKHRoaXMuZXJhc2VBdHRyKCksIGlzV3JhcHBlZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmxhbmtMaW5lID0gbmV3TGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld0xpbmUuaXNXcmFwcGVkID0gaXNXcmFwcGVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3TGluZSA9IHRoaXMuYnVmZmVyLmdldEJsYW5rTGluZSh0aGlzLmVyYXNlQXR0cigpLCBpc1dyYXBwZWQpO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0b3BSb3cgPSB0aGlzLmJ1ZmZlci55YmFzZSArIHRoaXMuYnVmZmVyLnNjcm9sbFRvcDtcbiAgICAgICAgdmFyIGJvdHRvbVJvdyA9IHRoaXMuYnVmZmVyLnliYXNlICsgdGhpcy5idWZmZXIuc2Nyb2xsQm90dG9tO1xuICAgICAgICBpZiAodGhpcy5idWZmZXIuc2Nyb2xsVG9wID09PSAwKSB7XG4gICAgICAgICAgICB2YXIgd2lsbEJ1ZmZlckJlVHJpbW1lZCA9IHRoaXMuYnVmZmVyLmxpbmVzLmlzRnVsbDtcbiAgICAgICAgICAgIGlmIChib3R0b21Sb3cgPT09IHRoaXMuYnVmZmVyLmxpbmVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBpZiAodXNlUmVjeWNsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWxsQnVmZmVyQmVUcmltbWVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5saW5lcy5yZWN5Y2xlKCkuY29weUZyb20obmV3TGluZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5saW5lcy5wdXNoKG5ld0xpbmUuY2xvbmUoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnB1c2gobmV3TGluZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMuc3BsaWNlKGJvdHRvbVJvdyArIDEsIDAsICh1c2VSZWN5Y2xpbmcpID8gbmV3TGluZS5jbG9uZSgpIDogbmV3TGluZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXdpbGxCdWZmZXJCZVRyaW1tZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci55YmFzZSsrO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdXNlclNjcm9sbGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci55ZGlzcCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl91c2VyU2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gTWF0aC5tYXgodGhpcy5idWZmZXIueWRpc3AgLSAxLCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2Nyb2xsUmVnaW9uSGVpZ2h0ID0gYm90dG9tUm93IC0gdG9wUm93ICsgMTtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnNoaWZ0RWxlbWVudHModG9wUm93ICsgMSwgc2Nyb2xsUmVnaW9uSGVpZ2h0IC0gMSwgLTEpO1xuICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMuc2V0KGJvdHRvbVJvdywgKHVzZVJlY3ljbGluZykgPyBuZXdMaW5lLmNsb25lKCkgOiBuZXdMaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3VzZXJTY3JvbGxpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gdGhpcy5idWZmZXIueWJhc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVSYW5nZSh0aGlzLmJ1ZmZlci5zY3JvbGxUb3ApO1xuICAgICAgICB0aGlzLnVwZGF0ZVJhbmdlKHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSk7XG4gICAgICAgIHRoaXMuZW1pdCgnc2Nyb2xsJywgdGhpcy5idWZmZXIueWRpc3ApO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbExpbmVzID0gZnVuY3Rpb24gKGRpc3AsIHN1cHByZXNzU2Nyb2xsRXZlbnQpIHtcbiAgICAgICAgaWYgKGRpc3AgPCAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5idWZmZXIueWRpc3AgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl91c2VyU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkaXNwICsgdGhpcy5idWZmZXIueWRpc3AgPj0gdGhpcy5idWZmZXIueWJhc2UpIHtcbiAgICAgICAgICAgIHRoaXMuX3VzZXJTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb2xkWWRpc3AgPSB0aGlzLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgdGhpcy5idWZmZXIueWRpc3AgPSBNYXRoLm1heChNYXRoLm1pbih0aGlzLmJ1ZmZlci55ZGlzcCArIGRpc3AsIHRoaXMuYnVmZmVyLnliYXNlKSwgMCk7XG4gICAgICAgIGlmIChvbGRZZGlzcCA9PT0gdGhpcy5idWZmZXIueWRpc3ApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXN1cHByZXNzU2Nyb2xsRXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnc2Nyb2xsJywgdGhpcy5idWZmZXIueWRpc3ApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zY3JvbGxQYWdlcyA9IGZ1bmN0aW9uIChwYWdlQ291bnQpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxMaW5lcyhwYWdlQ291bnQgKiAodGhpcy5yb3dzIC0gMSkpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbFRvVG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNjcm9sbExpbmVzKC10aGlzLmJ1ZmZlci55ZGlzcCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsVG9Cb3R0b20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsTGluZXModGhpcy5idWZmZXIueWJhc2UgLSB0aGlzLmJ1ZmZlci55ZGlzcCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsVG9MaW5lID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgdmFyIHNjcm9sbEFtb3VudCA9IGxpbmUgLSB0aGlzLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgaWYgKHNjcm9sbEFtb3VudCAhPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxMaW5lcyhzY3JvbGxBbW91bnQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5faXNEaXNwb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdGVCdWZmZXIucHVzaChkYXRhKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51c2VGbG93Q29udHJvbCAmJiAhdGhpcy5feG9mZlNlbnRUb0NhdGNoVXAgJiYgdGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPj0gV1JJVEVfQlVGRkVSX1BBVVNFX1RIUkVTSE9MRCkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkRDMyk7XG4gICAgICAgICAgICB0aGlzLl94b2ZmU2VudFRvQ2F0Y2hVcCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl93cml0ZUluUHJvZ3Jlc3MgJiYgdGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl93cml0ZUluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2lubmVyV3JpdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX2lubmVyV3JpdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLl9pc0Rpc3Bvc2VkKSB7XG4gICAgICAgICAgICB0aGlzLndyaXRlQnVmZmVyID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHdyaXRlQmF0Y2ggPSB0aGlzLndyaXRlQnVmZmVyLnNwbGljZSgwLCBXUklURV9CQVRDSF9TSVpFKTtcbiAgICAgICAgd2hpbGUgKHdyaXRlQmF0Y2gubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB3cml0ZUJhdGNoLnNoaWZ0KCk7XG4gICAgICAgICAgICBpZiAodGhpcy5feG9mZlNlbnRUb0NhdGNoVXAgJiYgd3JpdGVCYXRjaC5sZW5ndGggPT09IDAgJiYgdGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuREMxKTtcbiAgICAgICAgICAgICAgICB0aGlzLl94b2ZmU2VudFRvQ2F0Y2hVcCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFN0YXJ0ID0gdGhpcy5idWZmZXIueTtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hFbmQgPSB0aGlzLmJ1ZmZlci55O1xuICAgICAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyLnBhcnNlKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVSYW5nZSh0aGlzLmJ1ZmZlci55KTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCh0aGlzLl9yZWZyZXNoU3RhcnQsIHRoaXMuX3JlZnJlc2hFbmQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2lubmVyV3JpdGUoKTsgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl93cml0ZUluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLndyaXRlbG4gPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB0aGlzLndyaXRlKGRhdGEgKyAnXFxyXFxuJyk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYXR0YWNoQ3VzdG9tS2V5RXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKGN1c3RvbUtleUV2ZW50SGFuZGxlcikge1xuICAgICAgICB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgPSBjdXN0b21LZXlFdmVudEhhbmRsZXI7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVnaXN0ZXJMaW5rTWF0Y2hlciA9IGZ1bmN0aW9uIChyZWdleCwgaGFuZGxlciwgb3B0aW9ucykge1xuICAgICAgICB2YXIgbWF0Y2hlcklkID0gdGhpcy5saW5raWZpZXIucmVnaXN0ZXJMaW5rTWF0Y2hlcihyZWdleCwgaGFuZGxlciwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICAgICAgcmV0dXJuIG1hdGNoZXJJZDtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5kZXJlZ2lzdGVyTGlua01hdGNoZXIgPSBmdW5jdGlvbiAobWF0Y2hlcklkKSB7XG4gICAgICAgIGlmICh0aGlzLmxpbmtpZmllci5kZXJlZ2lzdGVyTGlua01hdGNoZXIobWF0Y2hlcklkKSkge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICB2YXIgam9pbmVySWQgPSB0aGlzLnJlbmRlcmVyLnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyKGhhbmRsZXIpO1xuICAgICAgICB0aGlzLnJlZnJlc2goMCwgdGhpcy5yb3dzIC0gMSk7XG4gICAgICAgIHJldHVybiBqb2luZXJJZDtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGpvaW5lcklkKSB7XG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVyLmRlcmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIoam9pbmVySWQpKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goMCwgdGhpcy5yb3dzIC0gMSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwibWFya2Vyc1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLm1hcmtlcnM7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5hZGRNYXJrZXIgPSBmdW5jdGlvbiAoY3Vyc29yWU9mZnNldCkge1xuICAgICAgICBpZiAodGhpcy5idWZmZXIgIT09IHRoaXMuYnVmZmVycy5ub3JtYWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIuYWRkTWFya2VyKHRoaXMuYnVmZmVyLnliYXNlICsgdGhpcy5idWZmZXIueSArIGN1cnNvcllPZmZzZXQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmhhc1NlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uTWFuYWdlciA/IHRoaXMuc2VsZWN0aW9uTWFuYWdlci5oYXNTZWxlY3Rpb24gOiBmYWxzZTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5nZXRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgPyB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uVGV4dCA6ICcnO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmNsZWFyU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25NYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNlbGVjdEFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uTWFuYWdlcikge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLnNlbGVjdEFsbCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2VsZWN0TGluZXMgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25NYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0TGluZXMoc3RhcnQsIGVuZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fa2V5RG93biA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fY3VzdG9tS2V5RXZlbnRIYW5kbGVyICYmIHRoaXMuX2N1c3RvbUtleUV2ZW50SGFuZGxlcihldmVudCkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9jb21wb3NpdGlvbkhlbHBlci5rZXlkb3duKGV2ZW50KSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyLnliYXNlICE9PSB0aGlzLmJ1ZmZlci55ZGlzcCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVzdWx0ID0gS2V5Ym9hcmRfMS5ldmFsdWF0ZUtleWJvYXJkRXZlbnQoZXZlbnQsIHRoaXMuYXBwbGljYXRpb25DdXJzb3IsIHRoaXMuYnJvd3Nlci5pc01hYywgdGhpcy5vcHRpb25zLm1hY09wdGlvbklzTWV0YSk7XG4gICAgICAgIHRoaXMudXBkYXRlQ3Vyc29yU3R5bGUoZXZlbnQpO1xuICAgICAgICBpZiAocmVzdWx0LnR5cGUgPT09IDMgfHwgcmVzdWx0LnR5cGUgPT09IDIpIHtcbiAgICAgICAgICAgIHZhciBzY3JvbGxDb3VudCA9IHRoaXMucm93cyAtIDE7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbExpbmVzKHJlc3VsdC50eXBlID09PSAyID8gLXNjcm9sbENvdW50IDogc2Nyb2xsQ291bnQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsKGV2ZW50LCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LnR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0QWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2lzVGhpcmRMZXZlbFNoaWZ0KHRoaXMuYnJvd3NlciwgZXZlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmNhbmNlbCkge1xuICAgICAgICAgICAgdGhpcy5jYW5jZWwoZXZlbnQsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcmVzdWx0LmtleSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbWl0KCdrZXlkb3duJywgZXZlbnQpO1xuICAgICAgICB0aGlzLmVtaXQoJ2tleScsIHJlc3VsdC5rZXksIGV2ZW50KTtcbiAgICAgICAgdGhpcy5zaG93Q3Vyc29yKCk7XG4gICAgICAgIHRoaXMuaGFuZGxlcihyZXN1bHQua2V5KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsKGV2ZW50LCB0cnVlKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5faXNUaGlyZExldmVsU2hpZnQgPSBmdW5jdGlvbiAoYnJvd3NlciwgZXYpIHtcbiAgICAgICAgdmFyIHRoaXJkTGV2ZWxLZXkgPSAoYnJvd3Nlci5pc01hYyAmJiAhdGhpcy5vcHRpb25zLm1hY09wdGlvbklzTWV0YSAmJiBldi5hbHRLZXkgJiYgIWV2LmN0cmxLZXkgJiYgIWV2Lm1ldGFLZXkpIHx8XG4gICAgICAgICAgICAoYnJvd3Nlci5pc01TV2luZG93cyAmJiBldi5hbHRLZXkgJiYgZXYuY3RybEtleSAmJiAhZXYubWV0YUtleSk7XG4gICAgICAgIGlmIChldi50eXBlID09PSAna2V5cHJlc3MnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcmRMZXZlbEtleTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcmRMZXZlbEtleSAmJiAoIWV2LmtleUNvZGUgfHwgZXYua2V5Q29kZSA+IDQ3KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zZXRnTGV2ZWwgPSBmdW5jdGlvbiAoZykge1xuICAgICAgICB0aGlzLmdsZXZlbCA9IGc7XG4gICAgICAgIHRoaXMuY2hhcnNldCA9IHRoaXMuY2hhcnNldHNbZ107XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2V0Z0NoYXJzZXQgPSBmdW5jdGlvbiAoZywgY2hhcnNldCkge1xuICAgICAgICB0aGlzLmNoYXJzZXRzW2ddID0gY2hhcnNldDtcbiAgICAgICAgaWYgKHRoaXMuZ2xldmVsID09PSBnKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXJzZXQgPSBjaGFyc2V0O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX2tleVVwID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHRoaXMudXBkYXRlQ3Vyc29yU3R5bGUoZXYpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9rZXlQcmVzcyA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB2YXIga2V5O1xuICAgICAgICBpZiAodGhpcy5fY3VzdG9tS2V5RXZlbnRIYW5kbGVyICYmIHRoaXMuX2N1c3RvbUtleUV2ZW50SGFuZGxlcihldikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICBpZiAoZXYuY2hhckNvZGUpIHtcbiAgICAgICAgICAgIGtleSA9IGV2LmNoYXJDb2RlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2LndoaWNoID09PSBudWxsIHx8IGV2LndoaWNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGtleSA9IGV2LmtleUNvZGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXYud2hpY2ggIT09IDAgJiYgZXYuY2hhckNvZGUgIT09IDApIHtcbiAgICAgICAgICAgIGtleSA9IGV2LndoaWNoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgha2V5IHx8ICgoZXYuYWx0S2V5IHx8IGV2LmN0cmxLZXkgfHwgZXYubWV0YUtleSkgJiYgIXRoaXMuX2lzVGhpcmRMZXZlbFNoaWZ0KHRoaXMuYnJvd3NlciwgZXYpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5KTtcbiAgICAgICAgdGhpcy5lbWl0KCdrZXlwcmVzcycsIGtleSwgZXYpO1xuICAgICAgICB0aGlzLmVtaXQoJ2tleScsIGtleSwgZXYpO1xuICAgICAgICB0aGlzLnNob3dDdXJzb3IoKTtcbiAgICAgICAgdGhpcy5oYW5kbGVyKGtleSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmJlbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZW1pdCgnYmVsbCcpO1xuICAgICAgICBpZiAodGhpcy5fc291bmRCZWxsKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc291bmRNYW5hZ2VyLnBsYXlCZWxsU291bmQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fdmlzdWFsQmVsbCgpKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgndmlzdWFsLWJlbGwtYWN0aXZlJyk7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdmlzdWFsQmVsbFRpbWVyKTtcbiAgICAgICAgICAgIHRoaXMuX3Zpc3VhbEJlbGxUaW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc3VhbC1iZWxsLWFjdGl2ZScpO1xuICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uICh0ZXh0LCBkYXRhKSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmRlYnVnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoIXRoaXMuX2NvbnRleHQuY29uc29sZSB8fCAhdGhpcy5fY29udGV4dC5jb25zb2xlLmxvZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5fY29udGV4dC5jb25zb2xlLmxvZyh0ZXh0LCBkYXRhKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uICh0ZXh0LCBkYXRhKSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmRlYnVnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoIXRoaXMuX2NvbnRleHQuY29uc29sZSB8fCAhdGhpcy5fY29udGV4dC5jb25zb2xlLmVycm9yKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmNvbnNvbGUuZXJyb3IodGV4dCwgZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgaWYgKGlzTmFOKHgpIHx8IGlzTmFOKHkpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHggPT09IHRoaXMuY29scyAmJiB5ID09PSB0aGlzLnJvd3MpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXJNZWFzdXJlICYmICghdGhpcy5jaGFyTWVhc3VyZS53aWR0aCB8fCAhdGhpcy5jaGFyTWVhc3VyZS5oZWlnaHQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFyTWVhc3VyZS5tZWFzdXJlKHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHggPCAxKVxuICAgICAgICAgICAgeCA9IDE7XG4gICAgICAgIGlmICh5IDwgMSlcbiAgICAgICAgICAgIHkgPSAxO1xuICAgICAgICB0aGlzLmJ1ZmZlcnMucmVzaXplKHgsIHkpO1xuICAgICAgICB0aGlzLmNvbHMgPSB4O1xuICAgICAgICB0aGlzLnJvd3MgPSB5O1xuICAgICAgICB0aGlzLmJ1ZmZlcnMuc2V0dXBUYWJTdG9wcyh0aGlzLmNvbHMpO1xuICAgICAgICBpZiAodGhpcy5jaGFyTWVhc3VyZSkge1xuICAgICAgICAgICAgdGhpcy5jaGFyTWVhc3VyZS5tZWFzdXJlKHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB0aGlzLmVtaXQoJ3Jlc2l6ZScsIHsgY29sczogeCwgcm93czogeSB9KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS51cGRhdGVSYW5nZSA9IGZ1bmN0aW9uICh5KSB7XG4gICAgICAgIGlmICh5IDwgdGhpcy5fcmVmcmVzaFN0YXJ0KVxuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFN0YXJ0ID0geTtcbiAgICAgICAgaWYgKHkgPiB0aGlzLl9yZWZyZXNoRW5kKVxuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaEVuZCA9IHk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUubWF4UmFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hTdGFydCA9IDA7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hFbmQgPSB0aGlzLnJvd3MgLSAxO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5idWZmZXIueWJhc2UgPT09IDAgJiYgdGhpcy5idWZmZXIueSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnNldCgwLCB0aGlzLmJ1ZmZlci5saW5lcy5nZXQodGhpcy5idWZmZXIueWJhc2UgKyB0aGlzLmJ1ZmZlci55KSk7XG4gICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLmxlbmd0aCA9IDE7XG4gICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gMDtcbiAgICAgICAgdGhpcy5idWZmZXIueWJhc2UgPSAwO1xuICAgICAgICB0aGlzLmJ1ZmZlci55ID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLnJvd3M7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMucHVzaCh0aGlzLmJ1ZmZlci5nZXRCbGFua0xpbmUoQnVmZmVyXzEuREVGQVVMVF9BVFRSKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB0aGlzLmVtaXQoJ3Njcm9sbCcsIHRoaXMuYnVmZmVyLnlkaXNwKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5jaCA9IGZ1bmN0aW9uIChjdXIpIHtcbiAgICAgICAgaWYgKGN1cikge1xuICAgICAgICAgICAgcmV0dXJuIFt0aGlzLmVyYXNlQXR0cigpLCBCdWZmZXJfMS5OVUxMX0NFTExfQ0hBUiwgQnVmZmVyXzEuTlVMTF9DRUxMX1dJRFRILCBCdWZmZXJfMS5OVUxMX0NFTExfQ09ERV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtCdWZmZXJfMS5ERUZBVUxUX0FUVFIsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DSEFSLCBCdWZmZXJfMS5OVUxMX0NFTExfV0lEVEgsIEJ1ZmZlcl8xLk5VTExfQ0VMTF9DT0RFXTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uICh0ZXJtKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5vcHRpb25zLnRlcm1OYW1lICsgJycpLmluZGV4T2YodGVybSkgPT09IDA7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuaGFuZGxlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZVN0ZGluKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uTWFuYWdlciAmJiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuaGFzU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5idWZmZXIueWJhc2UgIT09IHRoaXMuYnVmZmVyLnlkaXNwKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbWl0KCdkYXRhJywgZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuaGFuZGxlVGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcbiAgICAgICAgdGhpcy5lbWl0KCd0aXRsZScsIHRpdGxlKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5idWZmZXIueSsrO1xuICAgICAgICBpZiAodGhpcy5idWZmZXIueSA+IHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSkge1xuICAgICAgICAgICAgdGhpcy5idWZmZXIueS0tO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGwoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5idWZmZXIueCA+PSB0aGlzLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLngtLTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJldmVyc2VJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyLnkgPT09IHRoaXMuYnVmZmVyLnNjcm9sbFRvcCkge1xuICAgICAgICAgICAgdmFyIHNjcm9sbFJlZ2lvbkhlaWdodCA9IHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSAtIHRoaXMuYnVmZmVyLnNjcm9sbFRvcDtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnNoaWZ0RWxlbWVudHModGhpcy5idWZmZXIueSArIHRoaXMuYnVmZmVyLnliYXNlLCBzY3JvbGxSZWdpb25IZWlnaHQsIDEpO1xuICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMuc2V0KHRoaXMuYnVmZmVyLnkgKyB0aGlzLmJ1ZmZlci55YmFzZSwgdGhpcy5idWZmZXIuZ2V0QmxhbmtMaW5lKHRoaXMuZXJhc2VBdHRyKCkpKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUmFuZ2UodGhpcy5idWZmZXIuc2Nyb2xsVG9wKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUmFuZ2UodGhpcy5idWZmZXIuc2Nyb2xsQm90dG9tKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLnktLTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMucm93cyA9IHRoaXMucm93cztcbiAgICAgICAgdGhpcy5vcHRpb25zLmNvbHMgPSB0aGlzLmNvbHM7XG4gICAgICAgIHZhciBjdXN0b21LZXlFdmVudEhhbmRsZXIgPSB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXI7XG4gICAgICAgIHZhciBpbnB1dEhhbmRsZXIgPSB0aGlzLl9pbnB1dEhhbmRsZXI7XG4gICAgICAgIHZhciBjdXJzb3JTdGF0ZSA9IHRoaXMuY3Vyc29yU3RhdGU7XG4gICAgICAgIHRoaXMuX3NldHVwKCk7XG4gICAgICAgIHRoaXMuX2N1c3RvbUtleUV2ZW50SGFuZGxlciA9IGN1c3RvbUtleUV2ZW50SGFuZGxlcjtcbiAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyID0gaW5wdXRIYW5kbGVyO1xuICAgICAgICB0aGlzLmN1cnNvclN0YXRlID0gY3Vyc29yU3RhdGU7XG4gICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICAgICAgaWYgKHRoaXMudmlld3BvcnQpIHtcbiAgICAgICAgICAgIHRoaXMudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnRhYlNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5idWZmZXIudGFic1t0aGlzLmJ1ZmZlci54XSA9IHRydWU7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuY2FuY2VsID0gZnVuY3Rpb24gKGV2LCBmb3JjZSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5jYW5jZWxFdmVudHMgJiYgIWZvcmNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5tYXRjaENvbG9yID0gZnVuY3Rpb24gKHIxLCBnMSwgYjEpIHtcbiAgICAgICAgdmFyIGhhc2ggPSAocjEgPDwgMTYpIHwgKGcxIDw8IDgpIHwgYjE7XG4gICAgICAgIGlmIChtYXRjaENvbG9yQ2FjaGVbaGFzaF0gIT09IG51bGwgJiYgbWF0Y2hDb2xvckNhY2hlW2hhc2hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaENvbG9yQ2FjaGVbaGFzaF07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxkaWZmID0gSW5maW5pdHk7XG4gICAgICAgIHZhciBsaSA9IC0xO1xuICAgICAgICB2YXIgaSA9IDA7XG4gICAgICAgIHZhciBjO1xuICAgICAgICB2YXIgcjI7XG4gICAgICAgIHZhciBnMjtcbiAgICAgICAgdmFyIGIyO1xuICAgICAgICB2YXIgZGlmZjtcbiAgICAgICAgZm9yICg7IGkgPCBDb2xvck1hbmFnZXJfMS5ERUZBVUxUX0FOU0lfQ09MT1JTLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjID0gQ29sb3JNYW5hZ2VyXzEuREVGQVVMVF9BTlNJX0NPTE9SU1tpXS5yZ2JhO1xuICAgICAgICAgICAgcjIgPSBjID4+PiAyNDtcbiAgICAgICAgICAgIGcyID0gYyA+Pj4gMTYgJiAweEZGO1xuICAgICAgICAgICAgYjIgPSBjID4+PiA4ICYgMHhGRjtcbiAgICAgICAgICAgIGRpZmYgPSBtYXRjaENvbG9yRGlzdGFuY2UocjEsIGcxLCBiMSwgcjIsIGcyLCBiMik7XG4gICAgICAgICAgICBpZiAoZGlmZiA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGxpID0gaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkaWZmIDwgbGRpZmYpIHtcbiAgICAgICAgICAgICAgICBsZGlmZiA9IGRpZmY7XG4gICAgICAgICAgICAgICAgbGkgPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXRjaENvbG9yQ2FjaGVbaGFzaF0gPSBsaTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fdmlzdWFsQmVsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9zb3VuZEJlbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYmVsbFN0eWxlID09PSAnc291bmQnO1xuICAgIH07XG4gICAgcmV0dXJuIFRlcm1pbmFsO1xufShFdmVudEVtaXR0ZXJfMS5FdmVudEVtaXR0ZXIpKTtcbmV4cG9ydHMuVGVybWluYWwgPSBUZXJtaW5hbDtcbmZ1bmN0aW9uIHdhc01vZGlmaWVyS2V5T25seUV2ZW50KGV2KSB7XG4gICAgcmV0dXJuIGV2LmtleUNvZGUgPT09IDE2IHx8XG4gICAgICAgIGV2LmtleUNvZGUgPT09IDE3IHx8XG4gICAgICAgIGV2LmtleUNvZGUgPT09IDE4O1xufVxudmFyIG1hdGNoQ29sb3JDYWNoZSA9IHt9O1xuZnVuY3Rpb24gbWF0Y2hDb2xvckRpc3RhbmNlKHIxLCBnMSwgYjEsIHIyLCBnMiwgYjIpIHtcbiAgICByZXR1cm4gTWF0aC5wb3coMzAgKiAocjEgLSByMiksIDIpXG4gICAgICAgICsgTWF0aC5wb3coNTkgKiAoZzEgLSBnMiksIDIpXG4gICAgICAgICsgTWF0aC5wb3coMTEgKiAoYjEgLSBiMiksIDIpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VGVybWluYWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIExpZmVjeWNsZV8xID0gcmVxdWlyZShcIi4vY29tbW9uL0xpZmVjeWNsZVwiKTtcbnZhciBMaWZlY3ljbGVfMiA9IHJlcXVpcmUoXCIuL3VpL0xpZmVjeWNsZVwiKTtcbnZhciBGQUxMQkFDS19TQ1JPTExfQkFSX1dJRFRIID0gMTU7XG52YXIgVmlld3BvcnQgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhWaWV3cG9ydCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBWaWV3cG9ydChfdGVybWluYWwsIF92aWV3cG9ydEVsZW1lbnQsIF9zY3JvbGxBcmVhLCBfY2hhck1lYXN1cmUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fdmlld3BvcnRFbGVtZW50ID0gX3ZpZXdwb3J0RWxlbWVudDtcbiAgICAgICAgX3RoaXMuX3Njcm9sbEFyZWEgPSBfc2Nyb2xsQXJlYTtcbiAgICAgICAgX3RoaXMuX2NoYXJNZWFzdXJlID0gX2NoYXJNZWFzdXJlO1xuICAgICAgICBfdGhpcy5zY3JvbGxCYXJXaWR0aCA9IDA7XG4gICAgICAgIF90aGlzLl9jdXJyZW50Um93SGVpZ2h0ID0gMDtcbiAgICAgICAgX3RoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckxlbmd0aCA9IDA7XG4gICAgICAgIF90aGlzLl9sYXN0UmVjb3JkZWRWaWV3cG9ydEhlaWdodCA9IDA7XG4gICAgICAgIF90aGlzLl9sYXN0UmVjb3JkZWRCdWZmZXJIZWlnaHQgPSAwO1xuICAgICAgICBfdGhpcy5fbGFzdFNjcm9sbFRvcCA9IDA7XG4gICAgICAgIF90aGlzLl93aGVlbFBhcnRpYWxTY3JvbGwgPSAwO1xuICAgICAgICBfdGhpcy5fcmVmcmVzaEFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2lnbm9yZU5leHRTY3JvbGxFdmVudCA9IGZhbHNlO1xuICAgICAgICBfdGhpcy5zY3JvbGxCYXJXaWR0aCA9IChfdGhpcy5fdmlld3BvcnRFbGVtZW50Lm9mZnNldFdpZHRoIC0gX3RoaXMuX3Njcm9sbEFyZWEub2Zmc2V0V2lkdGgpIHx8IEZBTExCQUNLX1NDUk9MTF9CQVJfV0lEVEg7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8yLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcihfdGhpcy5fdmlld3BvcnRFbGVtZW50LCAnc2Nyb2xsJywgX3RoaXMuX29uU2Nyb2xsLmJpbmQoX3RoaXMpKSk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc3luY1Njcm9sbEFyZWEoKTsgfSwgMCk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgVmlld3BvcnQucHJvdG90eXBlLm9uVGhlbWVDaGFuZ2VkID0gZnVuY3Rpb24gKGNvbG9ycykge1xuICAgICAgICB0aGlzLl92aWV3cG9ydEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JzLmJhY2tncm91bmQuY3NzO1xuICAgIH07XG4gICAgVmlld3BvcnQucHJvdG90eXBlLl9yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5fcmVmcmVzaEFuaW1hdGlvbkZyYW1lID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoQW5pbWF0aW9uRnJhbWUgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2lubmVyUmVmcmVzaCgpOyB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVmlld3BvcnQucHJvdG90eXBlLl9pbm5lclJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jaGFyTWVhc3VyZS5oZWlnaHQgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Um93SGVpZ2h0ID0gdGhpcy5fdGVybWluYWwucmVuZGVyZXIuZGltZW5zaW9ucy5zY2FsZWRDZWxsSGVpZ2h0IC8gd2luZG93LmRldmljZVBpeGVsUmF0aW87XG4gICAgICAgICAgICB0aGlzLl9sYXN0UmVjb3JkZWRWaWV3cG9ydEhlaWdodCA9IHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgbmV3QnVmZmVySGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLl9jdXJyZW50Um93SGVpZ2h0ICogdGhpcy5fbGFzdFJlY29yZGVkQnVmZmVyTGVuZ3RoKSArICh0aGlzLl9sYXN0UmVjb3JkZWRWaWV3cG9ydEhlaWdodCAtIHRoaXMuX3Rlcm1pbmFsLnJlbmRlcmVyLmRpbWVuc2lvbnMuY2FudmFzSGVpZ2h0KTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9sYXN0UmVjb3JkZWRCdWZmZXJIZWlnaHQgIT09IG5ld0J1ZmZlckhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckhlaWdodCA9IG5ld0J1ZmZlckhlaWdodDtcbiAgICAgICAgICAgICAgICB0aGlzLl9zY3JvbGxBcmVhLnN0eWxlLmhlaWdodCA9IHRoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckhlaWdodCArICdweCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNjcm9sbFRvcCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcCAqIHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQ7XG4gICAgICAgIGlmICh0aGlzLl92aWV3cG9ydEVsZW1lbnQuc2Nyb2xsVG9wICE9PSBzY3JvbGxUb3ApIHtcbiAgICAgICAgICAgIHRoaXMuX2lnbm9yZU5leHRTY3JvbGxFdmVudCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl92aWV3cG9ydEVsZW1lbnQuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3JlZnJlc2hBbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUuc3luY1Njcm9sbEFyZWEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9sYXN0UmVjb3JkZWRCdWZmZXJMZW5ndGggIT09IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckxlbmd0aCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5sZW5ndGg7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2xhc3RSZWNvcmRlZFZpZXdwb3J0SGVpZ2h0ICE9PSB0aGlzLl90ZXJtaW5hbC5yZW5kZXJlci5kaW1lbnNpb25zLmNhbnZhc0hlaWdodCkge1xuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBuZXdTY3JvbGxUb3AgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3AgKiB0aGlzLl9jdXJyZW50Um93SGVpZ2h0O1xuICAgICAgICBpZiAodGhpcy5fbGFzdFNjcm9sbFRvcCAhPT0gbmV3U2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2xhc3RTY3JvbGxUb3AgIT09IHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5zY3JvbGxUb3ApIHtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2goKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwucmVuZGVyZXIuZGltZW5zaW9ucy5zY2FsZWRDZWxsSGVpZ2h0IC8gd2luZG93LmRldmljZVBpeGVsUmF0aW8gIT09IHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2goKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVmlld3BvcnQucHJvdG90eXBlLl9vblNjcm9sbCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsVG9wID0gdGhpcy5fdmlld3BvcnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgaWYgKCF0aGlzLl92aWV3cG9ydEVsZW1lbnQub2Zmc2V0UGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2lnbm9yZU5leHRTY3JvbGxFdmVudCkge1xuICAgICAgICAgICAgdGhpcy5faWdub3JlTmV4dFNjcm9sbEV2ZW50ID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5ld1JvdyA9IE1hdGgucm91bmQodGhpcy5fbGFzdFNjcm9sbFRvcCAvIHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQpO1xuICAgICAgICB2YXIgZGlmZiA9IG5ld1JvdyAtIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2Nyb2xsTGluZXMoZGlmZiwgdHJ1ZSk7XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUub25XaGVlbCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB2YXIgYW1vdW50ID0gdGhpcy5fZ2V0UGl4ZWxzU2Nyb2xsZWQoZXYpO1xuICAgICAgICBpZiAoYW1vdW50ID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdmlld3BvcnRFbGVtZW50LnNjcm9sbFRvcCArPSBhbW91bnQ7XG4gICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUuX2dldFBpeGVsc1Njcm9sbGVkID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIGlmIChldi5kZWx0YVkgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhbW91bnQgPSBldi5kZWx0YVk7XG4gICAgICAgIGlmIChldi5kZWx0YU1vZGUgPT09IFdoZWVsRXZlbnQuRE9NX0RFTFRBX0xJTkUpIHtcbiAgICAgICAgICAgIGFtb3VudCAqPSB0aGlzLl9jdXJyZW50Um93SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2LmRlbHRhTW9kZSA9PT0gV2hlZWxFdmVudC5ET01fREVMVEFfUEFHRSkge1xuICAgICAgICAgICAgYW1vdW50ICo9IHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQgKiB0aGlzLl90ZXJtaW5hbC5yb3dzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUuZ2V0TGluZXNTY3JvbGxlZCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICBpZiAoZXYuZGVsdGFZID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYW1vdW50ID0gZXYuZGVsdGFZO1xuICAgICAgICBpZiAoZXYuZGVsdGFNb2RlID09PSBXaGVlbEV2ZW50LkRPTV9ERUxUQV9QSVhFTCkge1xuICAgICAgICAgICAgYW1vdW50IC89IHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQgKyAwLjA7XG4gICAgICAgICAgICB0aGlzLl93aGVlbFBhcnRpYWxTY3JvbGwgKz0gYW1vdW50O1xuICAgICAgICAgICAgYW1vdW50ID0gTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLl93aGVlbFBhcnRpYWxTY3JvbGwpKSAqICh0aGlzLl93aGVlbFBhcnRpYWxTY3JvbGwgPiAwID8gMSA6IC0xKTtcbiAgICAgICAgICAgIHRoaXMuX3doZWVsUGFydGlhbFNjcm9sbCAlPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2LmRlbHRhTW9kZSA9PT0gV2hlZWxFdmVudC5ET01fREVMVEFfUEFHRSkge1xuICAgICAgICAgICAgYW1vdW50ICo9IHRoaXMuX3Rlcm1pbmFsLnJvd3M7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFtb3VudDtcbiAgICB9O1xuICAgIFZpZXdwb3J0LnByb3RvdHlwZS5vblRvdWNoU3RhcnQgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgdGhpcy5fbGFzdFRvdWNoWSA9IGV2LnRvdWNoZXNbMF0ucGFnZVk7XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUub25Ub3VjaE1vdmUgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgdmFyIGRlbHRhWSA9IHRoaXMuX2xhc3RUb3VjaFkgLSBldi50b3VjaGVzWzBdLnBhZ2VZO1xuICAgICAgICB0aGlzLl9sYXN0VG91Y2hZID0gZXYudG91Y2hlc1swXS5wYWdlWTtcbiAgICAgICAgaWYgKGRlbHRhWSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5zY3JvbGxUb3AgKz0gZGVsdGFZO1xuICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH07XG4gICAgcmV0dXJuIFZpZXdwb3J0O1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLlZpZXdwb3J0ID0gVmlld3BvcnQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1WaWV3cG9ydC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmZ1bmN0aW9uIGF0dGFjaCh0ZXJtLCBzb2NrZXQsIGJpZGlyZWN0aW9uYWwsIGJ1ZmZlcmVkKSB7XG4gICAgdmFyIGFkZG9uVGVybWluYWwgPSB0ZXJtO1xuICAgIGJpZGlyZWN0aW9uYWwgPSAodHlwZW9mIGJpZGlyZWN0aW9uYWwgPT09ICd1bmRlZmluZWQnKSA/IHRydWUgOiBiaWRpcmVjdGlvbmFsO1xuICAgIGFkZG9uVGVybWluYWwuX19zb2NrZXQgPSBzb2NrZXQ7XG4gICAgYWRkb25UZXJtaW5hbC5fX2ZsdXNoQnVmZmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBhZGRvblRlcm1pbmFsLndyaXRlKGFkZG9uVGVybWluYWwuX19hdHRhY2hTb2NrZXRCdWZmZXIpO1xuICAgICAgICBhZGRvblRlcm1pbmFsLl9fYXR0YWNoU29ja2V0QnVmZmVyID0gbnVsbDtcbiAgICB9O1xuICAgIGFkZG9uVGVybWluYWwuX19wdXNoVG9CdWZmZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBpZiAoYWRkb25UZXJtaW5hbC5fX2F0dGFjaFNvY2tldEJ1ZmZlcikge1xuICAgICAgICAgICAgYWRkb25UZXJtaW5hbC5fX2F0dGFjaFNvY2tldEJ1ZmZlciArPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWRkb25UZXJtaW5hbC5fX2F0dGFjaFNvY2tldEJ1ZmZlciA9IGRhdGE7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGFkZG9uVGVybWluYWwuX19mbHVzaEJ1ZmZlciwgMTApO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgbXlUZXh0RGVjb2RlcjtcbiAgICBhZGRvblRlcm1pbmFsLl9fZ2V0TWVzc2FnZSA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB2YXIgc3RyO1xuICAgICAgICBpZiAodHlwZW9mIGV2LmRhdGEgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZiAoIW15VGV4dERlY29kZXIpIHtcbiAgICAgICAgICAgICAgICBteVRleHREZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXYuZGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgICAgICAgICAgICAgc3RyID0gbXlUZXh0RGVjb2Rlci5kZWNvZGUoZXYuZGF0YSk7XG4gICAgICAgICAgICAgICAgZGlzcGxheURhdGEoc3RyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlUmVhZGVyXzEgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICAgICAgICAgIGZpbGVSZWFkZXJfMS5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzdHIgPSBteVRleHREZWNvZGVyLmRlY29kZShmaWxlUmVhZGVyXzEucmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheURhdGEoc3RyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBmaWxlUmVhZGVyXzEucmVhZEFzQXJyYXlCdWZmZXIoZXYuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGV2LmRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBkaXNwbGF5RGF0YShldi5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IGhhbmRsZSBcXFwiXCIgKyB0eXBlb2YgZXYuZGF0YSArIFwiXFxcIiB3ZWJzb2NrZXQgbWVzc2FnZS5cIik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGZ1bmN0aW9uIGRpc3BsYXlEYXRhKHN0ciwgZGF0YSkge1xuICAgICAgICBpZiAoYnVmZmVyZWQpIHtcbiAgICAgICAgICAgIGFkZG9uVGVybWluYWwuX19wdXNoVG9CdWZmZXIoc3RyIHx8IGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWRkb25UZXJtaW5hbC53cml0ZShzdHIgfHwgZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkb25UZXJtaW5hbC5fX3NlbmREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgaWYgKHNvY2tldC5yZWFkeVN0YXRlICE9PSAxKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc29ja2V0LnNlbmQoZGF0YSk7XG4gICAgfTtcbiAgICBhZGRvblRlcm1pbmFsLl9jb3JlLnJlZ2lzdGVyKGFkZFNvY2tldExpc3RlbmVyKHNvY2tldCwgJ21lc3NhZ2UnLCBhZGRvblRlcm1pbmFsLl9fZ2V0TWVzc2FnZSkpO1xuICAgIGlmIChiaWRpcmVjdGlvbmFsKSB7XG4gICAgICAgIGFkZG9uVGVybWluYWwuX2NvcmUucmVnaXN0ZXIoYWRkb25UZXJtaW5hbC5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ2RhdGEnLCBhZGRvblRlcm1pbmFsLl9fc2VuZERhdGEpKTtcbiAgICB9XG4gICAgYWRkb25UZXJtaW5hbC5fY29yZS5yZWdpc3RlcihhZGRTb2NrZXRMaXN0ZW5lcihzb2NrZXQsICdjbG9zZScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRldGFjaChhZGRvblRlcm1pbmFsLCBzb2NrZXQpOyB9KSk7XG4gICAgYWRkb25UZXJtaW5hbC5fY29yZS5yZWdpc3RlcihhZGRTb2NrZXRMaXN0ZW5lcihzb2NrZXQsICdlcnJvcicsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRldGFjaChhZGRvblRlcm1pbmFsLCBzb2NrZXQpOyB9KSk7XG59XG5leHBvcnRzLmF0dGFjaCA9IGF0dGFjaDtcbmZ1bmN0aW9uIGFkZFNvY2tldExpc3RlbmVyKHNvY2tldCwgdHlwZSwgaGFuZGxlcikge1xuICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghaGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICAgICAgICAgICAgaGFuZGxlciA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gZGV0YWNoKHRlcm0sIHNvY2tldCkge1xuICAgIHZhciBhZGRvblRlcm1pbmFsID0gdGVybTtcbiAgICBhZGRvblRlcm1pbmFsLm9mZignZGF0YScsIGFkZG9uVGVybWluYWwuX19zZW5kRGF0YSk7XG4gICAgc29ja2V0ID0gKHR5cGVvZiBzb2NrZXQgPT09ICd1bmRlZmluZWQnKSA/IGFkZG9uVGVybWluYWwuX19zb2NrZXQgOiBzb2NrZXQ7XG4gICAgaWYgKHNvY2tldCkge1xuICAgICAgICBzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGFkZG9uVGVybWluYWwuX19nZXRNZXNzYWdlKTtcbiAgICB9XG4gICAgZGVsZXRlIGFkZG9uVGVybWluYWwuX19zb2NrZXQ7XG59XG5leHBvcnRzLmRldGFjaCA9IGRldGFjaDtcbmZ1bmN0aW9uIGFwcGx5KHRlcm1pbmFsQ29uc3RydWN0b3IpIHtcbiAgICB0ZXJtaW5hbENvbnN0cnVjdG9yLnByb3RvdHlwZS5hdHRhY2ggPSBmdW5jdGlvbiAoc29ja2V0LCBiaWRpcmVjdGlvbmFsLCBidWZmZXJlZCkge1xuICAgICAgICBhdHRhY2godGhpcywgc29ja2V0LCBiaWRpcmVjdGlvbmFsLCBidWZmZXJlZCk7XG4gICAgfTtcbiAgICB0ZXJtaW5hbENvbnN0cnVjdG9yLnByb3RvdHlwZS5kZXRhY2ggPSBmdW5jdGlvbiAoc29ja2V0KSB7XG4gICAgICAgIGRldGFjaCh0aGlzLCBzb2NrZXQpO1xuICAgIH07XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdHRhY2guanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5mdW5jdGlvbiBwcm9wb3NlR2VvbWV0cnkodGVybSkge1xuICAgIGlmICghdGVybS5lbGVtZW50LnBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHZhciBwYXJlbnRFbGVtZW50U3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0ZXJtLmVsZW1lbnQucGFyZW50RWxlbWVudCk7XG4gICAgdmFyIHBhcmVudEVsZW1lbnRIZWlnaHQgPSBwYXJzZUludChwYXJlbnRFbGVtZW50U3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnaGVpZ2h0JykpO1xuICAgIHZhciBwYXJlbnRFbGVtZW50V2lkdGggPSBNYXRoLm1heCgwLCBwYXJzZUludChwYXJlbnRFbGVtZW50U3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnd2lkdGgnKSkpO1xuICAgIHZhciBlbGVtZW50U3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0ZXJtLmVsZW1lbnQpO1xuICAgIHZhciBlbGVtZW50UGFkZGluZyA9IHtcbiAgICAgICAgdG9wOiBwYXJzZUludChlbGVtZW50U3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgncGFkZGluZy10b3AnKSksXG4gICAgICAgIGJvdHRvbTogcGFyc2VJbnQoZWxlbWVudFN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ3BhZGRpbmctYm90dG9tJykpLFxuICAgICAgICByaWdodDogcGFyc2VJbnQoZWxlbWVudFN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ3BhZGRpbmctcmlnaHQnKSksXG4gICAgICAgIGxlZnQ6IHBhcnNlSW50KGVsZW1lbnRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdwYWRkaW5nLWxlZnQnKSlcbiAgICB9O1xuICAgIHZhciBlbGVtZW50UGFkZGluZ1ZlciA9IGVsZW1lbnRQYWRkaW5nLnRvcCArIGVsZW1lbnRQYWRkaW5nLmJvdHRvbTtcbiAgICB2YXIgZWxlbWVudFBhZGRpbmdIb3IgPSBlbGVtZW50UGFkZGluZy5yaWdodCArIGVsZW1lbnRQYWRkaW5nLmxlZnQ7XG4gICAgdmFyIGF2YWlsYWJsZUhlaWdodCA9IHBhcmVudEVsZW1lbnRIZWlnaHQgLSBlbGVtZW50UGFkZGluZ1ZlcjtcbiAgICB2YXIgYXZhaWxhYmxlV2lkdGggPSBwYXJlbnRFbGVtZW50V2lkdGggLSBlbGVtZW50UGFkZGluZ0hvciAtIHRlcm0uX2NvcmUudmlld3BvcnQuc2Nyb2xsQmFyV2lkdGg7XG4gICAgdmFyIGdlb21ldHJ5ID0ge1xuICAgICAgICBjb2xzOiBNYXRoLmZsb29yKGF2YWlsYWJsZVdpZHRoIC8gdGVybS5fY29yZS5yZW5kZXJlci5kaW1lbnNpb25zLmFjdHVhbENlbGxXaWR0aCksXG4gICAgICAgIHJvd3M6IE1hdGguZmxvb3IoYXZhaWxhYmxlSGVpZ2h0IC8gdGVybS5fY29yZS5yZW5kZXJlci5kaW1lbnNpb25zLmFjdHVhbENlbGxIZWlnaHQpXG4gICAgfTtcbiAgICByZXR1cm4gZ2VvbWV0cnk7XG59XG5leHBvcnRzLnByb3Bvc2VHZW9tZXRyeSA9IHByb3Bvc2VHZW9tZXRyeTtcbmZ1bmN0aW9uIGZpdCh0ZXJtKSB7XG4gICAgdmFyIGdlb21ldHJ5ID0gcHJvcG9zZUdlb21ldHJ5KHRlcm0pO1xuICAgIGlmIChnZW9tZXRyeSkge1xuICAgICAgICBpZiAodGVybS5yb3dzICE9PSBnZW9tZXRyeS5yb3dzIHx8IHRlcm0uY29scyAhPT0gZ2VvbWV0cnkuY29scykge1xuICAgICAgICAgICAgdGVybS5fY29yZS5yZW5kZXJlci5jbGVhcigpO1xuICAgICAgICAgICAgdGVybS5yZXNpemUoZ2VvbWV0cnkuY29scywgZ2VvbWV0cnkucm93cyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLmZpdCA9IGZpdDtcbmZ1bmN0aW9uIGFwcGx5KHRlcm1pbmFsQ29uc3RydWN0b3IpIHtcbiAgICB0ZXJtaW5hbENvbnN0cnVjdG9yLnByb3RvdHlwZS5wcm9wb3NlR2VvbWV0cnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9wb3NlR2VvbWV0cnkodGhpcyk7XG4gICAgfTtcbiAgICB0ZXJtaW5hbENvbnN0cnVjdG9yLnByb3RvdHlwZS5maXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZpdCh0aGlzKTtcbiAgICB9O1xufVxuZXhwb3J0cy5hcHBseSA9IGFwcGx5O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Zml0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZnVuY3Rpb24gdG9nZ2xlRnVsbFNjcmVlbih0ZXJtLCBmdWxsc2NyZWVuKSB7XG4gICAgdmFyIGZuO1xuICAgIGlmICh0eXBlb2YgZnVsbHNjcmVlbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgZm4gPSAodGVybS5lbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnZnVsbHNjcmVlbicpKSA/XG4gICAgICAgICAgICB0ZXJtLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSA6IHRlcm0uZWxlbWVudC5jbGFzc0xpc3QuYWRkO1xuICAgIH1cbiAgICBlbHNlIGlmICghZnVsbHNjcmVlbikge1xuICAgICAgICBmbiA9IHRlcm0uZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZm4gPSB0ZXJtLmVsZW1lbnQuY2xhc3NMaXN0LmFkZDtcbiAgICB9XG4gICAgZm4oJ2Z1bGxzY3JlZW4nKTtcbn1cbmV4cG9ydHMudG9nZ2xlRnVsbFNjcmVlbiA9IHRvZ2dsZUZ1bGxTY3JlZW47XG5mdW5jdGlvbiBhcHBseSh0ZXJtaW5hbENvbnN0cnVjdG9yKSB7XG4gICAgdGVybWluYWxDb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9nZ2xlRnVsbFNjcmVlbiA9IGZ1bmN0aW9uIChmdWxsc2NyZWVuKSB7XG4gICAgICAgIHRvZ2dsZUZ1bGxTY3JlZW4odGhpcywgZnVsbHNjcmVlbik7XG4gICAgfTtcbn1cbmV4cG9ydHMuYXBwbHkgPSBhcHBseTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZ1bGxzY3JlZW4uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgbm9uV29yZENoYXJhY3RlcnMgPSAnIH4hQCMkJV4mKigpK2AtPVtde318XFw7OlwiXFwnLC4vPD4/JztcbnZhciBTZWFyY2hIZWxwZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNlYXJjaEhlbHBlcihfdGVybWluYWwpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgfVxuICAgIFNlYXJjaEhlbHBlci5wcm90b3R5cGUuZmluZE5leHQgPSBmdW5jdGlvbiAodGVybSwgc2VhcmNoT3B0aW9ucykge1xuICAgICAgICBpZiAoIXRlcm0gfHwgdGVybS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICB2YXIgc3RhcnRSb3cgPSB0aGlzLl90ZXJtaW5hbC5fY29yZS5idWZmZXIueWRpc3A7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5fY29yZS5zZWxlY3Rpb25NYW5hZ2VyLnNlbGVjdGlvbkVuZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmdldFNlbGVjdGlvbigpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHN0YXJ0Um93ID0gdGhpcy5fdGVybWluYWwuX2NvcmUuc2VsZWN0aW9uTWFuYWdlci5zZWxlY3Rpb25FbmRbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgeSA9IHN0YXJ0Um93ICsgMTsgeSA8IHRoaXMuX3Rlcm1pbmFsLl9jb3JlLmJ1ZmZlci55YmFzZSArIHRoaXMuX3Rlcm1pbmFsLnJvd3M7IHkrKykge1xuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5fZmluZEluTGluZSh0ZXJtLCB5LCBzZWFyY2hPcHRpb25zKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdGFydFJvdzsgeSsrKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5fZmluZEluTGluZSh0ZXJtLCB5LCBzZWFyY2hPcHRpb25zKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0UmVzdWx0KHJlc3VsdCk7XG4gICAgfTtcbiAgICBTZWFyY2hIZWxwZXIucHJvdG90eXBlLmZpbmRQcmV2aW91cyA9IGZ1bmN0aW9uICh0ZXJtLCBzZWFyY2hPcHRpb25zKSB7XG4gICAgICAgIGlmICghdGVybSB8fCB0ZXJtLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgIHZhciBzdGFydFJvdyA9IHRoaXMuX3Rlcm1pbmFsLl9jb3JlLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLl9jb3JlLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uU3RhcnQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5nZXRTZWxlY3Rpb24oKS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICBzdGFydFJvdyA9IHRoaXMuX3Rlcm1pbmFsLl9jb3JlLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uU3RhcnRbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgeSA9IHN0YXJ0Um93IC0gMTsgeSA+PSAwOyB5LS0pIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2ZpbmRJbkxpbmUodGVybSwgeSwgc2VhcmNoT3B0aW9ucyk7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgIGZvciAodmFyIHkgPSB0aGlzLl90ZXJtaW5hbC5fY29yZS5idWZmZXIueWJhc2UgKyB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTsgeSA+IHN0YXJ0Um93OyB5LS0pIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLl9maW5kSW5MaW5lKHRlcm0sIHksIHNlYXJjaE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3RSZXN1bHQocmVzdWx0KTtcbiAgICB9O1xuICAgIFNlYXJjaEhlbHBlci5wcm90b3R5cGUuX2lzV2hvbGVXb3JkID0gZnVuY3Rpb24gKHNlYXJjaEluZGV4LCBsaW5lLCB0ZXJtKSB7XG4gICAgICAgIHJldHVybiAoKChzZWFyY2hJbmRleCA9PT0gMCkgfHwgKG5vbldvcmRDaGFyYWN0ZXJzLmluZGV4T2YobGluZVtzZWFyY2hJbmRleCAtIDFdKSAhPT0gLTEpKSAmJlxuICAgICAgICAgICAgKCgoc2VhcmNoSW5kZXggKyB0ZXJtLmxlbmd0aCkgPT09IGxpbmUubGVuZ3RoKSB8fCAobm9uV29yZENoYXJhY3RlcnMuaW5kZXhPZihsaW5lW3NlYXJjaEluZGV4ICsgdGVybS5sZW5ndGhdKSAhPT0gLTEpKSk7XG4gICAgfTtcbiAgICBTZWFyY2hIZWxwZXIucHJvdG90eXBlLl9maW5kSW5MaW5lID0gZnVuY3Rpb24gKHRlcm0sIHksIHNlYXJjaE9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHNlYXJjaE9wdGlvbnMgPT09IHZvaWQgMCkgeyBzZWFyY2hPcHRpb25zID0ge307IH1cbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLl9jb3JlLmJ1ZmZlci5saW5lcy5nZXQoeSkuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0cmluZ0xpbmUgPSB0aGlzLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZ1dpdGhXcmFwKHksIHRydWUpO1xuICAgICAgICB2YXIgc2VhcmNoU3RyaW5nTGluZSA9IHNlYXJjaE9wdGlvbnMuY2FzZVNlbnNpdGl2ZSA/IHN0cmluZ0xpbmUgOiBzdHJpbmdMaW5lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciBzZWFyY2hUZXJtID0gc2VhcmNoT3B0aW9ucy5jYXNlU2Vuc2l0aXZlID8gdGVybSA6IHRlcm0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdmFyIHNlYXJjaEluZGV4ID0gLTE7XG4gICAgICAgIGlmIChzZWFyY2hPcHRpb25zLnJlZ2V4KSB7XG4gICAgICAgICAgICB2YXIgc2VhcmNoUmVnZXggPSBSZWdFeHAoc2VhcmNoVGVybSwgJ2cnKTtcbiAgICAgICAgICAgIHZhciBmb3VuZFRlcm0gPSBzZWFyY2hSZWdleC5leGVjKHNlYXJjaFN0cmluZ0xpbmUpO1xuICAgICAgICAgICAgaWYgKGZvdW5kVGVybSAmJiBmb3VuZFRlcm1bMF0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNlYXJjaEluZGV4ID0gc2VhcmNoUmVnZXgubGFzdEluZGV4IC0gZm91bmRUZXJtWzBdLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB0ZXJtID0gZm91bmRUZXJtWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2VhcmNoSW5kZXggPSBzZWFyY2hTdHJpbmdMaW5lLmluZGV4T2Yoc2VhcmNoVGVybSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlYXJjaEluZGV4ID49IDApIHtcbiAgICAgICAgICAgIGlmIChzZWFyY2hJbmRleCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICAgICAgeSArPSBNYXRoLmZsb29yKHNlYXJjaEluZGV4IC8gdGhpcy5fdGVybWluYWwuY29scyk7XG4gICAgICAgICAgICAgICAgc2VhcmNoSW5kZXggPSBzZWFyY2hJbmRleCAlIHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VhcmNoT3B0aW9ucy53aG9sZVdvcmQgJiYgIXRoaXMuX2lzV2hvbGVXb3JkKHNlYXJjaEluZGV4LCBzZWFyY2hTdHJpbmdMaW5lLCB0ZXJtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBsaW5lID0gdGhpcy5fdGVybWluYWwuX2NvcmUuYnVmZmVyLmxpbmVzLmdldCh5KTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VhcmNoSW5kZXg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjaGFyRGF0YSA9IGxpbmUuZ2V0KGkpO1xuICAgICAgICAgICAgICAgIHZhciBjaGFyID0gY2hhckRhdGFbMV07XG4gICAgICAgICAgICAgICAgaWYgKGNoYXIubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2hJbmRleCAtPSBjaGFyLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBjaGFyV2lkdGggPSBjaGFyRGF0YVsyXTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcldpZHRoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaEluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0ZXJtOiB0ZXJtLFxuICAgICAgICAgICAgICAgIGNvbDogc2VhcmNoSW5kZXgsXG4gICAgICAgICAgICAgICAgcm93OiB5XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWFyY2hIZWxwZXIucHJvdG90eXBlLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZ1dpdGhXcmFwID0gZnVuY3Rpb24gKGxpbmVJbmRleCwgdHJpbVJpZ2h0KSB7XG4gICAgICAgIHZhciBsaW5lU3RyaW5nID0gJyc7XG4gICAgICAgIHZhciBsaW5lV3JhcHNUb05leHQ7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHZhciBuZXh0TGluZSA9IHRoaXMuX3Rlcm1pbmFsLl9jb3JlLmJ1ZmZlci5saW5lcy5nZXQobGluZUluZGV4ICsgMSk7XG4gICAgICAgICAgICBsaW5lV3JhcHNUb05leHQgPSBuZXh0TGluZSA/IG5leHRMaW5lLmlzV3JhcHBlZCA6IGZhbHNlO1xuICAgICAgICAgICAgbGluZVN0cmluZyArPSB0aGlzLl90ZXJtaW5hbC5fY29yZS5idWZmZXIudHJhbnNsYXRlQnVmZmVyTGluZVRvU3RyaW5nKGxpbmVJbmRleCwgIWxpbmVXcmFwc1RvTmV4dCAmJiB0cmltUmlnaHQpLnN1YnN0cmluZygwLCB0aGlzLl90ZXJtaW5hbC5jb2xzKTtcbiAgICAgICAgICAgIGxpbmVJbmRleCsrO1xuICAgICAgICB9IHdoaWxlIChsaW5lV3JhcHNUb05leHQpO1xuICAgICAgICByZXR1cm4gbGluZVN0cmluZztcbiAgICB9O1xuICAgIFNlYXJjaEhlbHBlci5wcm90b3R5cGUuX3NlbGVjdFJlc3VsdCA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuX2NvcmUuc2VsZWN0aW9uTWFuYWdlci5zZXRTZWxlY3Rpb24ocmVzdWx0LmNvbCwgcmVzdWx0LnJvdywgcmVzdWx0LnRlcm0ubGVuZ3RoKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2Nyb2xsTGluZXMocmVzdWx0LnJvdyAtIHRoaXMuX3Rlcm1pbmFsLl9jb3JlLmJ1ZmZlci55ZGlzcCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgcmV0dXJuIFNlYXJjaEhlbHBlcjtcbn0oKSk7XG5leHBvcnRzLlNlYXJjaEhlbHBlciA9IFNlYXJjaEhlbHBlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNlYXJjaEhlbHBlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBTZWFyY2hIZWxwZXJfMSA9IHJlcXVpcmUoXCIuL1NlYXJjaEhlbHBlclwiKTtcbmZ1bmN0aW9uIGZpbmROZXh0KHRlcm1pbmFsLCB0ZXJtLCBzZWFyY2hPcHRpb25zKSB7XG4gICAgaWYgKHNlYXJjaE9wdGlvbnMgPT09IHZvaWQgMCkgeyBzZWFyY2hPcHRpb25zID0ge307IH1cbiAgICB2YXIgYWRkb25UZXJtaW5hbCA9IHRlcm1pbmFsO1xuICAgIGlmICghYWRkb25UZXJtaW5hbC5fX3NlYXJjaEhlbHBlcikge1xuICAgICAgICBhZGRvblRlcm1pbmFsLl9fc2VhcmNoSGVscGVyID0gbmV3IFNlYXJjaEhlbHBlcl8xLlNlYXJjaEhlbHBlcihhZGRvblRlcm1pbmFsKTtcbiAgICB9XG4gICAgcmV0dXJuIGFkZG9uVGVybWluYWwuX19zZWFyY2hIZWxwZXIuZmluZE5leHQodGVybSwgc2VhcmNoT3B0aW9ucyk7XG59XG5leHBvcnRzLmZpbmROZXh0ID0gZmluZE5leHQ7XG5mdW5jdGlvbiBmaW5kUHJldmlvdXModGVybWluYWwsIHRlcm0sIHNlYXJjaE9wdGlvbnMpIHtcbiAgICB2YXIgYWRkb25UZXJtaW5hbCA9IHRlcm1pbmFsO1xuICAgIGlmICghYWRkb25UZXJtaW5hbC5fX3NlYXJjaEhlbHBlcikge1xuICAgICAgICBhZGRvblRlcm1pbmFsLl9fc2VhcmNoSGVscGVyID0gbmV3IFNlYXJjaEhlbHBlcl8xLlNlYXJjaEhlbHBlcihhZGRvblRlcm1pbmFsKTtcbiAgICB9XG4gICAgcmV0dXJuIGFkZG9uVGVybWluYWwuX19zZWFyY2hIZWxwZXIuZmluZFByZXZpb3VzKHRlcm0sIHNlYXJjaE9wdGlvbnMpO1xufVxuZXhwb3J0cy5maW5kUHJldmlvdXMgPSBmaW5kUHJldmlvdXM7XG5mdW5jdGlvbiBhcHBseSh0ZXJtaW5hbENvbnN0cnVjdG9yKSB7XG4gICAgdGVybWluYWxDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZmluZE5leHQgPSBmdW5jdGlvbiAodGVybSwgc2VhcmNoT3B0aW9ucykge1xuICAgICAgICByZXR1cm4gZmluZE5leHQodGhpcywgdGVybSwgc2VhcmNoT3B0aW9ucyk7XG4gICAgfTtcbiAgICB0ZXJtaW5hbENvbnN0cnVjdG9yLnByb3RvdHlwZS5maW5kUHJldmlvdXMgPSBmdW5jdGlvbiAodGVybSwgc2VhcmNoT3B0aW9ucykge1xuICAgICAgICByZXR1cm4gZmluZFByZXZpb3VzKHRoaXMsIHRlcm0sIHNlYXJjaE9wdGlvbnMpO1xuICAgIH07XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZWFyY2guanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgcHJvdG9jb2xDbGF1c2UgPSAnKGh0dHBzPzpcXFxcL1xcXFwvKSc7XG52YXIgZG9tYWluQ2hhcmFjdGVyU2V0ID0gJ1tcXFxcZGEtelxcXFwuLV0rJztcbnZhciBuZWdhdGVkRG9tYWluQ2hhcmFjdGVyU2V0ID0gJ1teXFxcXGRhLXpcXFxcLi1dKyc7XG52YXIgZG9tYWluQm9keUNsYXVzZSA9ICcoJyArIGRvbWFpbkNoYXJhY3RlclNldCArICcpJztcbnZhciB0bGRDbGF1c2UgPSAnKFthLXpcXFxcLl17Miw2fSknO1xudmFyIGlwQ2xhdXNlID0gJygoXFxcXGR7MSwzfVxcXFwuKXszfVxcXFxkezEsM30pJztcbnZhciBsb2NhbEhvc3RDbGF1c2UgPSAnKGxvY2FsaG9zdCknO1xudmFyIHBvcnRDbGF1c2UgPSAnKDpcXFxcZHsxLDV9KSc7XG52YXIgaG9zdENsYXVzZSA9ICcoKCcgKyBkb21haW5Cb2R5Q2xhdXNlICsgJ1xcXFwuJyArIHRsZENsYXVzZSArICcpfCcgKyBpcENsYXVzZSArICd8JyArIGxvY2FsSG9zdENsYXVzZSArICcpJyArIHBvcnRDbGF1c2UgKyAnPyc7XG52YXIgcGF0aENsYXVzZSA9ICcoXFxcXC9bXFxcXC9cXFxcd1xcXFwuXFxcXC0lfjpdKikqKFteOlxcXFxzXSknO1xudmFyIHF1ZXJ5U3RyaW5nSGFzaEZyYWdtZW50Q2hhcmFjdGVyU2V0ID0gJ1swLTlcXFxcd1xcXFxbXFxcXF1cXFxcKFxcXFwpXFxcXC9cXFxcP1xcXFwhI0AkJSZcXCcqKyw6O35cXFxcPVxcXFwuXFxcXC1dKic7XG52YXIgcXVlcnlTdHJpbmdDbGF1c2UgPSAnKFxcXFw/JyArIHF1ZXJ5U3RyaW5nSGFzaEZyYWdtZW50Q2hhcmFjdGVyU2V0ICsgJyk/JztcbnZhciBoYXNoRnJhZ21lbnRDbGF1c2UgPSAnKCMnICsgcXVlcnlTdHJpbmdIYXNoRnJhZ21lbnRDaGFyYWN0ZXJTZXQgKyAnKT8nO1xudmFyIG5lZ2F0ZWRQYXRoQ2hhcmFjdGVyU2V0ID0gJ1teXFxcXC9cXFxcd1xcXFwuXFxcXC0lXSsnO1xudmFyIGJvZHlDbGF1c2UgPSBob3N0Q2xhdXNlICsgcGF0aENsYXVzZSArIHF1ZXJ5U3RyaW5nQ2xhdXNlICsgaGFzaEZyYWdtZW50Q2xhdXNlO1xudmFyIHN0YXJ0ID0gJyg/Ol58JyArIG5lZ2F0ZWREb21haW5DaGFyYWN0ZXJTZXQgKyAnKSgnO1xudmFyIGVuZCA9ICcpKCR8JyArIG5lZ2F0ZWRQYXRoQ2hhcmFjdGVyU2V0ICsgJyknO1xudmFyIHN0cmljdFVybFJlZ2V4ID0gbmV3IFJlZ0V4cChzdGFydCArIHByb3RvY29sQ2xhdXNlICsgYm9keUNsYXVzZSArIGVuZCk7XG5mdW5jdGlvbiBoYW5kbGVMaW5rKGV2ZW50LCB1cmkpIHtcbiAgICB3aW5kb3cub3Blbih1cmksICdfYmxhbmsnKTtcbn1cbmZ1bmN0aW9uIHdlYkxpbmtzSW5pdCh0ZXJtLCBoYW5kbGVyLCBvcHRpb25zKSB7XG4gICAgaWYgKGhhbmRsZXIgPT09IHZvaWQgMCkgeyBoYW5kbGVyID0gaGFuZGxlTGluazsgfVxuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgb3B0aW9ucy5tYXRjaEluZGV4ID0gMTtcbiAgICB0ZXJtLnJlZ2lzdGVyTGlua01hdGNoZXIoc3RyaWN0VXJsUmVnZXgsIGhhbmRsZXIsIG9wdGlvbnMpO1xufVxuZXhwb3J0cy53ZWJMaW5rc0luaXQgPSB3ZWJMaW5rc0luaXQ7XG5mdW5jdGlvbiBhcHBseSh0ZXJtaW5hbENvbnN0cnVjdG9yKSB7XG4gICAgdGVybWluYWxDb25zdHJ1Y3Rvci5wcm90b3R5cGUud2ViTGlua3NJbml0ID0gZnVuY3Rpb24gKGhhbmRsZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgd2ViTGlua3NJbml0KHRoaXMsIGhhbmRsZXIsIG9wdGlvbnMpO1xuICAgIH07XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD13ZWJMaW5rcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBDSEFSX0RBVEFfQ09ERV9JTkRFWCA9IDM7XG52YXIgTlVMTF9DRUxMX0NPREUgPSAzMjtcbmZ1bmN0aW9uIHdpbnB0eUNvbXBhdEluaXQodGVybWluYWwpIHtcbiAgICB2YXIgYWRkb25UZXJtaW5hbCA9IHRlcm1pbmFsO1xuICAgIHZhciBpc1dpbmRvd3MgPSBbJ1dpbmRvd3MnLCAnV2luMTYnLCAnV2luMzInLCAnV2luQ0UnXS5pbmRleE9mKG5hdmlnYXRvci5wbGF0Zm9ybSkgPj0gMDtcbiAgICBpZiAoIWlzV2luZG93cykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGFkZG9uVGVybWluYWwub24oJ2xpbmVmZWVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGluZSA9IGFkZG9uVGVybWluYWwuX2NvcmUuYnVmZmVyLmxpbmVzLmdldChhZGRvblRlcm1pbmFsLl9jb3JlLmJ1ZmZlci55YmFzZSArIGFkZG9uVGVybWluYWwuX2NvcmUuYnVmZmVyLnkgLSAxKTtcbiAgICAgICAgdmFyIGxhc3RDaGFyID0gbGluZS5nZXQoYWRkb25UZXJtaW5hbC5jb2xzIC0gMSk7XG4gICAgICAgIGlmIChsYXN0Q2hhcltDSEFSX0RBVEFfQ09ERV9JTkRFWF0gIT09IE5VTExfQ0VMTF9DT0RFKSB7XG4gICAgICAgICAgICB2YXIgbmV4dExpbmUgPSBhZGRvblRlcm1pbmFsLl9jb3JlLmJ1ZmZlci5saW5lcy5nZXQoYWRkb25UZXJtaW5hbC5fY29yZS5idWZmZXIueWJhc2UgKyBhZGRvblRlcm1pbmFsLl9jb3JlLmJ1ZmZlci55KTtcbiAgICAgICAgICAgIG5leHRMaW5lLmlzV3JhcHBlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMud2lucHR5Q29tcGF0SW5pdCA9IHdpbnB0eUNvbXBhdEluaXQ7XG5mdW5jdGlvbiBhcHBseSh0ZXJtaW5hbENvbnN0cnVjdG9yKSB7XG4gICAgdGVybWluYWxDb25zdHJ1Y3Rvci5wcm90b3R5cGUud2lucHR5Q29tcGF0SW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2lucHR5Q29tcGF0SW5pdCh0aGlzKTtcbiAgICB9O1xufVxuZXhwb3J0cy5hcHBseSA9IGFwcGx5O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2lucHR5Q29tcGF0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuL0V2ZW50RW1pdHRlclwiKTtcbnZhciBDaXJjdWxhckxpc3QgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhDaXJjdWxhckxpc3QsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2lyY3VsYXJMaXN0KF9tYXhMZW5ndGgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX21heExlbmd0aCA9IF9tYXhMZW5ndGg7XG4gICAgICAgIF90aGlzLl9hcnJheSA9IG5ldyBBcnJheShfdGhpcy5fbWF4TGVuZ3RoKTtcbiAgICAgICAgX3RoaXMuX3N0YXJ0SW5kZXggPSAwO1xuICAgICAgICBfdGhpcy5fbGVuZ3RoID0gMDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2lyY3VsYXJMaXN0LnByb3RvdHlwZSwgXCJtYXhMZW5ndGhcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKG5ld01heExlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX21heExlbmd0aCA9PT0gbmV3TWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IEFycmF5KG5ld01heExlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE1hdGgubWluKG5ld01heExlbmd0aCwgdGhpcy5sZW5ndGgpOyBpKyspIHtcbiAgICAgICAgICAgICAgICBuZXdBcnJheVtpXSA9IHRoaXMuX2FycmF5W3RoaXMuX2dldEN5Y2xpY0luZGV4KGkpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2FycmF5ID0gbmV3QXJyYXk7XG4gICAgICAgICAgICB0aGlzLl9tYXhMZW5ndGggPSBuZXdNYXhMZW5ndGg7XG4gICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gMDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENpcmN1bGFyTGlzdC5wcm90b3R5cGUsIFwibGVuZ3RoXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdMZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChuZXdMZW5ndGggPiB0aGlzLl9sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fbGVuZ3RoOyBpIDwgbmV3TGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJyYXlbaV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fbGVuZ3RoID0gbmV3TGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgoaW5kZXgpXTtcbiAgICB9O1xuICAgIENpcmN1bGFyTGlzdC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpbmRleCldID0gdmFsdWU7XG4gICAgfTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgodGhpcy5fbGVuZ3RoKV0gPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2xlbmd0aCA9PT0gdGhpcy5fbWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gKyt0aGlzLl9zdGFydEluZGV4ICUgdGhpcy5fbWF4TGVuZ3RoO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCd0cmltJywgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9sZW5ndGgrKztcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2lyY3VsYXJMaXN0LnByb3RvdHlwZS5yZWN5Y2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbGVuZ3RoICE9PSB0aGlzLl9tYXhMZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuIG9ubHkgcmVjeWNsZSB3aGVuIHRoZSBidWZmZXIgaXMgZnVsbCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSArK3RoaXMuX3N0YXJ0SW5kZXggJSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgIHRoaXMuZW1pdCgndHJpbScsIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgodGhpcy5fbGVuZ3RoIC0gMSldO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENpcmN1bGFyTGlzdC5wcm90b3R5cGUsIFwiaXNGdWxsXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVuZ3RoID09PSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIENpcmN1bGFyTGlzdC5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgodGhpcy5fbGVuZ3RoLS0gLSAxKV07XG4gICAgfTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLnNwbGljZSA9IGZ1bmN0aW9uIChzdGFydCwgZGVsZXRlQ291bnQpIHtcbiAgICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMjsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICBpdGVtc1tfaSAtIDJdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVsZXRlQ291bnQpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHRoaXMuX2xlbmd0aCAtIGRlbGV0ZUNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpKV0gPSB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpICsgZGVsZXRlQ291bnQpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2xlbmd0aCAtPSBkZWxldGVDb3VudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fbGVuZ3RoIC0gMTsgaSA+PSBzdGFydDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgoaSArIGl0ZW1zLmxlbmd0aCldID0gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgoaSldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2FycmF5W3RoaXMuX2dldEN5Y2xpY0luZGV4KHN0YXJ0ICsgaSldID0gaXRlbXNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fbGVuZ3RoICsgaXRlbXMubGVuZ3RoID4gdGhpcy5fbWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvdW50VG9UcmltID0gKHRoaXMuX2xlbmd0aCArIGl0ZW1zLmxlbmd0aCkgLSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhcnRJbmRleCArPSBjb3VudFRvVHJpbTtcbiAgICAgICAgICAgICAgICB0aGlzLl9sZW5ndGggPSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd0cmltJywgY291bnRUb1RyaW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGVuZ3RoICs9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2lyY3VsYXJMaXN0LnByb3RvdHlwZS50cmltU3RhcnQgPSBmdW5jdGlvbiAoY291bnQpIHtcbiAgICAgICAgaWYgKGNvdW50ID4gdGhpcy5fbGVuZ3RoKSB7XG4gICAgICAgICAgICBjb3VudCA9IHRoaXMuX2xlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdGFydEluZGV4ICs9IGNvdW50O1xuICAgICAgICB0aGlzLl9sZW5ndGggLT0gY291bnQ7XG4gICAgICAgIHRoaXMuZW1pdCgndHJpbScsIGNvdW50KTtcbiAgICB9O1xuICAgIENpcmN1bGFyTGlzdC5wcm90b3R5cGUuc2hpZnRFbGVtZW50cyA9IGZ1bmN0aW9uIChzdGFydCwgY291bnQsIG9mZnNldCkge1xuICAgICAgICBpZiAoY291bnQgPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgPj0gdGhpcy5fbGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0YXJ0IGFyZ3VtZW50IG91dCBvZiByYW5nZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGFydCArIG9mZnNldCA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNoaWZ0IGVsZW1lbnRzIGluIGxpc3QgYmV5b25kIGluZGV4IDAnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGNvdW50IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldChzdGFydCArIGkgKyBvZmZzZXQsIHRoaXMuZ2V0KHN0YXJ0ICsgaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGV4cGFuZExpc3RCeSA9IChzdGFydCArIGNvdW50ICsgb2Zmc2V0KSAtIHRoaXMuX2xlbmd0aDtcbiAgICAgICAgICAgIGlmIChleHBhbmRMaXN0QnkgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGVuZ3RoICs9IGV4cGFuZExpc3RCeTtcbiAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5fbGVuZ3RoID4gdGhpcy5fbWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xlbmd0aC0tO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgndHJpbScsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0KHN0YXJ0ICsgaSArIG9mZnNldCwgdGhpcy5nZXQoc3RhcnQgKyBpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENpcmN1bGFyTGlzdC5wcm90b3R5cGUuX2dldEN5Y2xpY0luZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHJldHVybiAodGhpcy5fc3RhcnRJbmRleCArIGluZGV4KSAlIHRoaXMuX21heExlbmd0aDtcbiAgICB9O1xuICAgIHJldHVybiBDaXJjdWxhckxpc3Q7XG59KEV2ZW50RW1pdHRlcl8xLkV2ZW50RW1pdHRlcikpO1xuZXhwb3J0cy5DaXJjdWxhckxpc3QgPSBDaXJjdWxhckxpc3Q7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1DaXJjdWxhckxpc3QuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIExpZmVjeWNsZV8xID0gcmVxdWlyZShcIi4vTGlmZWN5Y2xlXCIpO1xudmFyIEV2ZW50RW1pdHRlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEV2ZW50RW1pdHRlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9ldmVudHMgPSBfdGhpcy5fZXZlbnRzIHx8IHt9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdID0gdGhpcy5fZXZlbnRzW3R5cGVdIHx8IFtdO1xuICAgICAgICB0aGlzLl9ldmVudHNbdHlwZV0ucHVzaChsaXN0ZW5lcik7XG4gICAgfTtcbiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZERpc3Bvc2FibGVMaXN0ZW5lciA9IGZ1bmN0aW9uICh0eXBlLCBoYW5kbGVyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMub24odHlwZSwgaGFuZGxlcik7XG4gICAgICAgIHZhciBkaXNwb3NlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChkaXNwb3NlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLm9mZih0eXBlLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBkaXNwb3NlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uICh0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgICBpZiAoIXRoaXMuX2V2ZW50c1t0eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvYmogPSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgICAgIHZhciBpID0gb2JqLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgaWYgKG9ialtpXSA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICBvYmouc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICBpZiAodGhpcy5fZXZlbnRzW3R5cGVdKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2V2ZW50c1t0eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvYmogPSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvYmpbaV0uYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50c1t0eXBlXSB8fCBbXTtcbiAgICB9O1xuICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuICAgIH07XG4gICAgcmV0dXJuIEV2ZW50RW1pdHRlcjtcbn0oTGlmZWN5Y2xlXzEuRGlzcG9zYWJsZSkpO1xuZXhwb3J0cy5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1FdmVudEVtaXR0ZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRGlzcG9zYWJsZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRGlzcG9zYWJsZSgpIHtcbiAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBbXTtcbiAgICAgICAgdGhpcy5faXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuZm9yRWFjaChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5kaXNwb3NlKCk7IH0pO1xuICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcy5sZW5ndGggPSAwO1xuICAgIH07XG4gICAgRGlzcG9zYWJsZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcy5wdXNoKGQpO1xuICAgIH07XG4gICAgRGlzcG9zYWJsZS5wcm90b3R5cGUudW5yZWdpc3RlciA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMuX2Rpc3Bvc2FibGVzLmluZGV4T2YoZCk7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBEaXNwb3NhYmxlO1xufSgpKTtcbmV4cG9ydHMuRGlzcG9zYWJsZSA9IERpc3Bvc2FibGU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1MaWZlY3ljbGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5mdW5jdGlvbiBmaWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQsIGVuZCkge1xuICAgIGlmIChhcnJheS5maWxsKSB7XG4gICAgICAgIHJldHVybiBhcnJheS5maWxsKHZhbHVlLCBzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbGxGYWxsYmFjayhhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpO1xufVxuZXhwb3J0cy5maWxsID0gZmlsbDtcbmZ1bmN0aW9uIGZpbGxGYWxsYmFjayhhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpIHtcbiAgICBpZiAoc3RhcnQgPT09IHZvaWQgMCkgeyBzdGFydCA9IDA7IH1cbiAgICBpZiAoZW5kID09PSB2b2lkIDApIHsgZW5kID0gYXJyYXkubGVuZ3RoOyB9XG4gICAgaWYgKHN0YXJ0ID49IGFycmF5Lmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuICAgIHN0YXJ0ID0gKGFycmF5Lmxlbmd0aCArIHN0YXJ0KSAlIGFycmF5Lmxlbmd0aDtcbiAgICBpZiAoZW5kID49IGFycmF5Lmxlbmd0aCkge1xuICAgICAgICBlbmQgPSBhcnJheS5sZW5ndGg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlbmQgPSAoYXJyYXkubGVuZ3RoICsgZW5kKSAlIGFycmF5Lmxlbmd0aDtcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHtcbiAgICAgICAgYXJyYXlbaV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xufVxuZXhwb3J0cy5maWxsRmFsbGJhY2sgPSBmaWxsRmFsbGJhY2s7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1UeXBlZEFycmF5VXRpbHMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQzA7XG4oZnVuY3Rpb24gKEMwKSB7XG4gICAgQzAuTlVMID0gJ1xceDAwJztcbiAgICBDMC5TT0ggPSAnXFx4MDEnO1xuICAgIEMwLlNUWCA9ICdcXHgwMic7XG4gICAgQzAuRVRYID0gJ1xceDAzJztcbiAgICBDMC5FT1QgPSAnXFx4MDQnO1xuICAgIEMwLkVOUSA9ICdcXHgwNSc7XG4gICAgQzAuQUNLID0gJ1xceDA2JztcbiAgICBDMC5CRUwgPSAnXFx4MDcnO1xuICAgIEMwLkJTID0gJ1xceDA4JztcbiAgICBDMC5IVCA9ICdcXHgwOSc7XG4gICAgQzAuTEYgPSAnXFx4MGEnO1xuICAgIEMwLlZUID0gJ1xceDBiJztcbiAgICBDMC5GRiA9ICdcXHgwYyc7XG4gICAgQzAuQ1IgPSAnXFx4MGQnO1xuICAgIEMwLlNPID0gJ1xceDBlJztcbiAgICBDMC5TSSA9ICdcXHgwZic7XG4gICAgQzAuRExFID0gJ1xceDEwJztcbiAgICBDMC5EQzEgPSAnXFx4MTEnO1xuICAgIEMwLkRDMiA9ICdcXHgxMic7XG4gICAgQzAuREMzID0gJ1xceDEzJztcbiAgICBDMC5EQzQgPSAnXFx4MTQnO1xuICAgIEMwLk5BSyA9ICdcXHgxNSc7XG4gICAgQzAuU1lOID0gJ1xceDE2JztcbiAgICBDMC5FVEIgPSAnXFx4MTcnO1xuICAgIEMwLkNBTiA9ICdcXHgxOCc7XG4gICAgQzAuRU0gPSAnXFx4MTknO1xuICAgIEMwLlNVQiA9ICdcXHgxYSc7XG4gICAgQzAuRVNDID0gJ1xceDFiJztcbiAgICBDMC5GUyA9ICdcXHgxYyc7XG4gICAgQzAuR1MgPSAnXFx4MWQnO1xuICAgIEMwLlJTID0gJ1xceDFlJztcbiAgICBDMC5VUyA9ICdcXHgxZic7XG4gICAgQzAuU1AgPSAnXFx4MjAnO1xuICAgIEMwLkRFTCA9ICdcXHg3Zic7XG59KShDMCA9IGV4cG9ydHMuQzAgfHwgKGV4cG9ydHMuQzAgPSB7fSkpO1xudmFyIEMxO1xuKGZ1bmN0aW9uIChDMSkge1xuICAgIEMxLlBBRCA9ICdcXHg4MCc7XG4gICAgQzEuSE9QID0gJ1xceDgxJztcbiAgICBDMS5CUEggPSAnXFx4ODInO1xuICAgIEMxLk5CSCA9ICdcXHg4Myc7XG4gICAgQzEuSU5EID0gJ1xceDg0JztcbiAgICBDMS5ORUwgPSAnXFx4ODUnO1xuICAgIEMxLlNTQSA9ICdcXHg4Nic7XG4gICAgQzEuRVNBID0gJ1xceDg3JztcbiAgICBDMS5IVFMgPSAnXFx4ODgnO1xuICAgIEMxLkhUSiA9ICdcXHg4OSc7XG4gICAgQzEuVlRTID0gJ1xceDhhJztcbiAgICBDMS5QTEQgPSAnXFx4OGInO1xuICAgIEMxLlBMVSA9ICdcXHg4Yyc7XG4gICAgQzEuUkkgPSAnXFx4OGQnO1xuICAgIEMxLlNTMiA9ICdcXHg4ZSc7XG4gICAgQzEuU1MzID0gJ1xceDhmJztcbiAgICBDMS5EQ1MgPSAnXFx4OTAnO1xuICAgIEMxLlBVMSA9ICdcXHg5MSc7XG4gICAgQzEuUFUyID0gJ1xceDkyJztcbiAgICBDMS5TVFMgPSAnXFx4OTMnO1xuICAgIEMxLkNDSCA9ICdcXHg5NCc7XG4gICAgQzEuTVcgPSAnXFx4OTUnO1xuICAgIEMxLlNQQSA9ICdcXHg5Nic7XG4gICAgQzEuRVBBID0gJ1xceDk3JztcbiAgICBDMS5TT1MgPSAnXFx4OTgnO1xuICAgIEMxLlNHQ0kgPSAnXFx4OTknO1xuICAgIEMxLlNDSSA9ICdcXHg5YSc7XG4gICAgQzEuQ1NJID0gJ1xceDliJztcbiAgICBDMS5TVCA9ICdcXHg5Yyc7XG4gICAgQzEuT1NDID0gJ1xceDlkJztcbiAgICBDMS5QTSA9ICdcXHg5ZSc7XG4gICAgQzEuQVBDID0gJ1xceDlmJztcbn0pKEMxID0gZXhwb3J0cy5DMSB8fCAoZXhwb3J0cy5DMSA9IHt9KSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Fc2NhcGVTZXF1ZW5jZXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgaXNOb2RlID0gKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnKSA/IHRydWUgOiBmYWxzZTtcbnZhciB1c2VyQWdlbnQgPSAoaXNOb2RlKSA/ICdub2RlJyA6IG5hdmlnYXRvci51c2VyQWdlbnQ7XG52YXIgcGxhdGZvcm0gPSAoaXNOb2RlKSA/ICdub2RlJyA6IG5hdmlnYXRvci5wbGF0Zm9ybTtcbmV4cG9ydHMuaXNGaXJlZm94ID0gISF+dXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gnKTtcbmV4cG9ydHMuaXNTYWZhcmkgPSAvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvaS50ZXN0KHVzZXJBZ2VudCk7XG5leHBvcnRzLmlzTVNJRSA9ICEhfnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFJykgfHwgISF+dXNlckFnZW50LmluZGV4T2YoJ1RyaWRlbnQnKTtcbmV4cG9ydHMuaXNNYWMgPSBjb250YWlucyhbJ01hY2ludG9zaCcsICdNYWNJbnRlbCcsICdNYWNQUEMnLCAnTWFjNjhLJ10sIHBsYXRmb3JtKTtcbmV4cG9ydHMuaXNJcGFkID0gcGxhdGZvcm0gPT09ICdpUGFkJztcbmV4cG9ydHMuaXNJcGhvbmUgPSBwbGF0Zm9ybSA9PT0gJ2lQaG9uZSc7XG5leHBvcnRzLmlzTVNXaW5kb3dzID0gY29udGFpbnMoWydXaW5kb3dzJywgJ1dpbjE2JywgJ1dpbjMyJywgJ1dpbkNFJ10sIHBsYXRmb3JtKTtcbmV4cG9ydHMuaXNMaW51eCA9IHBsYXRmb3JtLmluZGV4T2YoJ0xpbnV4JykgPj0gMDtcbmZ1bmN0aW9uIGNvbnRhaW5zKGFyciwgZWwpIHtcbiAgICByZXR1cm4gYXJyLmluZGV4T2YoZWwpID49IDA7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1QbGF0Zm9ybS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ0hBUlNFVFMgPSB7fTtcbmV4cG9ydHMuREVGQVVMVF9DSEFSU0VUID0gZXhwb3J0cy5DSEFSU0VUU1snQiddO1xuZXhwb3J0cy5DSEFSU0VUU1snMCddID0ge1xuICAgICdgJzogJ1xcdTI1YzYnLFxuICAgICdhJzogJ1xcdTI1OTInLFxuICAgICdiJzogJ1xcdTAwMDknLFxuICAgICdjJzogJ1xcdTAwMGMnLFxuICAgICdkJzogJ1xcdTAwMGQnLFxuICAgICdlJzogJ1xcdTAwMGEnLFxuICAgICdmJzogJ1xcdTAwYjAnLFxuICAgICdnJzogJ1xcdTAwYjEnLFxuICAgICdoJzogJ1xcdTI0MjQnLFxuICAgICdpJzogJ1xcdTAwMGInLFxuICAgICdqJzogJ1xcdTI1MTgnLFxuICAgICdrJzogJ1xcdTI1MTAnLFxuICAgICdsJzogJ1xcdTI1MGMnLFxuICAgICdtJzogJ1xcdTI1MTQnLFxuICAgICduJzogJ1xcdTI1M2MnLFxuICAgICdvJzogJ1xcdTIzYmEnLFxuICAgICdwJzogJ1xcdTIzYmInLFxuICAgICdxJzogJ1xcdTI1MDAnLFxuICAgICdyJzogJ1xcdTIzYmMnLFxuICAgICdzJzogJ1xcdTIzYmQnLFxuICAgICd0JzogJ1xcdTI1MWMnLFxuICAgICd1JzogJ1xcdTI1MjQnLFxuICAgICd2JzogJ1xcdTI1MzQnLFxuICAgICd3JzogJ1xcdTI1MmMnLFxuICAgICd4JzogJ1xcdTI1MDInLFxuICAgICd5JzogJ1xcdTIyNjQnLFxuICAgICd6JzogJ1xcdTIyNjUnLFxuICAgICd7JzogJ1xcdTAzYzAnLFxuICAgICd8JzogJ1xcdTIyNjAnLFxuICAgICd9JzogJ1xcdTAwYTMnLFxuICAgICd+JzogJ1xcdTAwYjcnXG59O1xuZXhwb3J0cy5DSEFSU0VUU1snQSddID0ge1xuICAgICcjJzogJ8KjJ1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ0InXSA9IG51bGw7XG5leHBvcnRzLkNIQVJTRVRTWyc0J10gPSB7XG4gICAgJyMnOiAnwqMnLFxuICAgICdAJzogJ8K+JyxcbiAgICAnWyc6ICdpaicsXG4gICAgJ1xcXFwnOiAnwr0nLFxuICAgICddJzogJ3wnLFxuICAgICd7JzogJ8KoJyxcbiAgICAnfCc6ICdmJyxcbiAgICAnfSc6ICfCvCcsXG4gICAgJ34nOiAnwrQnXG59O1xuZXhwb3J0cy5DSEFSU0VUU1snQyddID1cbiAgICBleHBvcnRzLkNIQVJTRVRTWyc1J10gPSB7XG4gICAgICAgICdbJzogJ8OEJyxcbiAgICAgICAgJ1xcXFwnOiAnw5YnLFxuICAgICAgICAnXSc6ICfDhScsXG4gICAgICAgICdeJzogJ8OcJyxcbiAgICAgICAgJ2AnOiAnw6knLFxuICAgICAgICAneyc6ICfDpCcsXG4gICAgICAgICd8JzogJ8O2JyxcbiAgICAgICAgJ30nOiAnw6UnLFxuICAgICAgICAnfic6ICfDvCdcbiAgICB9O1xuZXhwb3J0cy5DSEFSU0VUU1snUiddID0ge1xuICAgICcjJzogJ8KjJyxcbiAgICAnQCc6ICfDoCcsXG4gICAgJ1snOiAnwrAnLFxuICAgICdcXFxcJzogJ8OnJyxcbiAgICAnXSc6ICfCpycsXG4gICAgJ3snOiAnw6knLFxuICAgICd8JzogJ8O5JyxcbiAgICAnfSc6ICfDqCcsXG4gICAgJ34nOiAnwqgnXG59O1xuZXhwb3J0cy5DSEFSU0VUU1snUSddID0ge1xuICAgICdAJzogJ8OgJyxcbiAgICAnWyc6ICfDoicsXG4gICAgJ1xcXFwnOiAnw6cnLFxuICAgICddJzogJ8OqJyxcbiAgICAnXic6ICfDricsXG4gICAgJ2AnOiAnw7QnLFxuICAgICd7JzogJ8OpJyxcbiAgICAnfCc6ICfDuScsXG4gICAgJ30nOiAnw6gnLFxuICAgICd+JzogJ8O7J1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ0snXSA9IHtcbiAgICAnQCc6ICfCpycsXG4gICAgJ1snOiAnw4QnLFxuICAgICdcXFxcJzogJ8OWJyxcbiAgICAnXSc6ICfDnCcsXG4gICAgJ3snOiAnw6QnLFxuICAgICd8JzogJ8O2JyxcbiAgICAnfSc6ICfDvCcsXG4gICAgJ34nOiAnw58nXG59O1xuZXhwb3J0cy5DSEFSU0VUU1snWSddID0ge1xuICAgICcjJzogJ8KjJyxcbiAgICAnQCc6ICfCpycsXG4gICAgJ1snOiAnwrAnLFxuICAgICdcXFxcJzogJ8OnJyxcbiAgICAnXSc6ICfDqScsXG4gICAgJ2AnOiAnw7knLFxuICAgICd7JzogJ8OgJyxcbiAgICAnfCc6ICfDsicsXG4gICAgJ30nOiAnw6gnLFxuICAgICd+JzogJ8OsJ1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ0UnXSA9XG4gICAgZXhwb3J0cy5DSEFSU0VUU1snNiddID0ge1xuICAgICAgICAnQCc6ICfDhCcsXG4gICAgICAgICdbJzogJ8OGJyxcbiAgICAgICAgJ1xcXFwnOiAnw5gnLFxuICAgICAgICAnXSc6ICfDhScsXG4gICAgICAgICdeJzogJ8OcJyxcbiAgICAgICAgJ2AnOiAnw6QnLFxuICAgICAgICAneyc6ICfDpicsXG4gICAgICAgICd8JzogJ8O4JyxcbiAgICAgICAgJ30nOiAnw6UnLFxuICAgICAgICAnfic6ICfDvCdcbiAgICB9O1xuZXhwb3J0cy5DSEFSU0VUU1snWiddID0ge1xuICAgICcjJzogJ8KjJyxcbiAgICAnQCc6ICfCpycsXG4gICAgJ1snOiAnwqEnLFxuICAgICdcXFxcJzogJ8ORJyxcbiAgICAnXSc6ICfCvycsXG4gICAgJ3snOiAnwrAnLFxuICAgICd8JzogJ8OxJyxcbiAgICAnfSc6ICfDpydcbn07XG5leHBvcnRzLkNIQVJTRVRTWydIJ10gPVxuICAgIGV4cG9ydHMuQ0hBUlNFVFNbJzcnXSA9IHtcbiAgICAgICAgJ0AnOiAnw4knLFxuICAgICAgICAnWyc6ICfDhCcsXG4gICAgICAgICdcXFxcJzogJ8OWJyxcbiAgICAgICAgJ10nOiAnw4UnLFxuICAgICAgICAnXic6ICfDnCcsXG4gICAgICAgICdgJzogJ8OpJyxcbiAgICAgICAgJ3snOiAnw6QnLFxuICAgICAgICAnfCc6ICfDticsXG4gICAgICAgICd9JzogJ8OlJyxcbiAgICAgICAgJ34nOiAnw7wnXG4gICAgfTtcbmV4cG9ydHMuQ0hBUlNFVFNbJz0nXSA9IHtcbiAgICAnIyc6ICfDuScsXG4gICAgJ0AnOiAnw6AnLFxuICAgICdbJzogJ8OpJyxcbiAgICAnXFxcXCc6ICfDpycsXG4gICAgJ10nOiAnw6onLFxuICAgICdeJzogJ8OuJyxcbiAgICAnXyc6ICfDqCcsXG4gICAgJ2AnOiAnw7QnLFxuICAgICd7JzogJ8OkJyxcbiAgICAnfCc6ICfDticsXG4gICAgJ30nOiAnw7wnLFxuICAgICd+JzogJ8O7J1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNoYXJzZXRzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEVzY2FwZVNlcXVlbmNlc18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9kYXRhL0VzY2FwZVNlcXVlbmNlc1wiKTtcbnZhciBLRVlDT0RFX0tFWV9NQVBQSU5HUyA9IHtcbiAgICA0ODogWycwJywgJyknXSxcbiAgICA0OTogWycxJywgJyEnXSxcbiAgICA1MDogWycyJywgJ0AnXSxcbiAgICA1MTogWyczJywgJyMnXSxcbiAgICA1MjogWyc0JywgJyQnXSxcbiAgICA1MzogWyc1JywgJyUnXSxcbiAgICA1NDogWyc2JywgJ14nXSxcbiAgICA1NTogWyc3JywgJyYnXSxcbiAgICA1NjogWyc4JywgJyonXSxcbiAgICA1NzogWyc5JywgJygnXSxcbiAgICAxODY6IFsnOycsICc6J10sXG4gICAgMTg3OiBbJz0nLCAnKyddLFxuICAgIDE4ODogWycsJywgJzwnXSxcbiAgICAxODk6IFsnLScsICdfJ10sXG4gICAgMTkwOiBbJy4nLCAnPiddLFxuICAgIDE5MTogWycvJywgJz8nXSxcbiAgICAxOTI6IFsnYCcsICd+J10sXG4gICAgMjE5OiBbJ1snLCAneyddLFxuICAgIDIyMDogWydcXFxcJywgJ3wnXSxcbiAgICAyMjE6IFsnXScsICd9J10sXG4gICAgMjIyOiBbJ1xcJycsICdcIiddXG59O1xuZnVuY3Rpb24gZXZhbHVhdGVLZXlib2FyZEV2ZW50KGV2LCBhcHBsaWNhdGlvbkN1cnNvck1vZGUsIGlzTWFjLCBtYWNPcHRpb25Jc01ldGEpIHtcbiAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICB0eXBlOiAwLFxuICAgICAgICBjYW5jZWw6IGZhbHNlLFxuICAgICAgICBrZXk6IHVuZGVmaW5lZFxuICAgIH07XG4gICAgdmFyIG1vZGlmaWVycyA9IChldi5zaGlmdEtleSA/IDEgOiAwKSB8IChldi5hbHRLZXkgPyAyIDogMCkgfCAoZXYuY3RybEtleSA/IDQgOiAwKSB8IChldi5tZXRhS2V5ID8gOCA6IDApO1xuICAgIHN3aXRjaCAoZXYua2V5Q29kZSkge1xuICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICBpZiAoZXYua2V5ID09PSAnVUlLZXlJbnB1dFVwQXJyb3cnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFwcGxpY2F0aW9uQ3Vyc29yTW9kZSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09BJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0EnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LmtleSA9PT0gJ1VJS2V5SW5wdXRMZWZ0QXJyb3cnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFwcGxpY2F0aW9uQ3Vyc29yTW9kZSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09EJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0QnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LmtleSA9PT0gJ1VJS2V5SW5wdXRSaWdodEFycm93Jykge1xuICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPQyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tDJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChldi5rZXkgPT09ICdVSUtleUlucHV0RG93bkFycm93Jykge1xuICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPQic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tCJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgaWYgKGV2LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkJTO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXYuYWx0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIEVzY2FwZVNlcXVlbmNlc18xLkMwLkRFTDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5ERUw7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgaWYgKGV2LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbWic7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuSFQ7XG4gICAgICAgICAgICByZXN1bHQuY2FuY2VsID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEzOlxuICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkNSO1xuICAgICAgICAgICAgcmVzdWx0LmNhbmNlbCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyNzpcbiAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0M7XG4gICAgICAgICAgICByZXN1bHQuY2FuY2VsID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM3OlxuICAgICAgICAgICAgaWYgKG1vZGlmaWVycykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7JyArIChtb2RpZmllcnMgKyAxKSArICdEJztcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmtleSA9PT0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOzNEJykge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gaXNNYWMgPyBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnYicgOiBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7NUQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFwcGxpY2F0aW9uQ3Vyc29yTW9kZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnT0QnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbRCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzOTpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnQyc7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5rZXkgPT09IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTszQycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IGlzTWFjID8gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ2YnIDogRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOzVDJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09DJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0MnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzg6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ0EnO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQua2V5ID09PSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7M0EnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7NUEnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFwcGxpY2F0aW9uQ3Vyc29yTW9kZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnT0EnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbQSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA0MDpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnQic7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5rZXkgPT09IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTszQicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTs1Qic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYXBwbGljYXRpb25DdXJzb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPQic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tCJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDQ1OlxuICAgICAgICAgICAgaWYgKCFldi5zaGlmdEtleSAmJiAhZXYuY3RybEtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzJ+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDQ2OlxuICAgICAgICAgICAgaWYgKG1vZGlmaWVycykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzM7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzN+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM2OlxuICAgICAgICAgICAgaWYgKG1vZGlmaWVycykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7JyArIChtb2RpZmllcnMgKyAxKSArICdIJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFwcGxpY2F0aW9uQ3Vyc29yTW9kZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnT0gnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbSCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzNTpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnRic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09GJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0YnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzM6XG4gICAgICAgICAgICBpZiAoZXYuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQudHlwZSA9IDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1s1fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzNDpcbiAgICAgICAgICAgIGlmIChldi5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC50eXBlID0gMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzZ+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExMjpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnUCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09QJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExMzpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnUSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09RJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExNDpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnUic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09SJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExNTpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnUyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09TJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExNjpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxNTsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTV+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExNzpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxNzsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExODpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxODsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTh+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDExOTpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOTsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTl+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEyMDpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1syMDsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjB+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEyMTpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1syMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjF+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEyMjpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1syMzsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjN+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDEyMzpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1syNDsnICsgKG1vZGlmaWVycyArIDEpICsgJ34nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjR+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgaWYgKGV2LmN0cmxLZXkgJiYgIWV2LnNoaWZ0S2V5ICYmICFldi5hbHRLZXkgJiYgIWV2Lm1ldGFLZXkpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXYua2V5Q29kZSA+PSA2NSAmJiBldi5rZXlDb2RlIDw9IDkwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGV2LmtleUNvZGUgLSA2NCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGV2LmtleUNvZGUgPT09IDMyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldi5rZXlDb2RlID49IDUxICYmIGV2LmtleUNvZGUgPD0gNTUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZXYua2V5Q29kZSAtIDUxICsgMjcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldi5rZXlDb2RlID09PSA1Nikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxMjcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldi5rZXlDb2RlID09PSAyMTkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMjcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldi5rZXlDb2RlID09PSAyMjApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMjgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldi5rZXlDb2RlID09PSAyMjEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMjkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCghaXNNYWMgfHwgbWFjT3B0aW9uSXNNZXRhKSAmJiBldi5hbHRLZXkgJiYgIWV2Lm1ldGFLZXkpIHtcbiAgICAgICAgICAgICAgICB2YXIga2V5TWFwcGluZyA9IEtFWUNPREVfS0VZX01BUFBJTkdTW2V2LmtleUNvZGVdO1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBrZXlNYXBwaW5nICYmIGtleU1hcHBpbmdbIWV2LnNoaWZ0S2V5ID8gMCA6IDFdO1xuICAgICAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIGtleTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA+PSA2NSAmJiBldi5rZXlDb2RlIDw9IDkwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXlDb2RlID0gZXYuY3RybEtleSA/IGV2LmtleUNvZGUgLSA2NCA6IGV2LmtleUNvZGUgKyAzMjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5Q29kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXNNYWMgJiYgIWV2LmFsdEtleSAmJiAhZXYuY3RybEtleSAmJiBldi5tZXRhS2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2LmtleUNvZGUgPT09IDY1KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC50eXBlID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydHMuZXZhbHVhdGVLZXlib2FyZEV2ZW50ID0gZXZhbHVhdGVLZXlib2FyZEV2ZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9S2V5Ym9hcmQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXNjYXBlU2VxdWVuY2VzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL2RhdGEvRXNjYXBlU2VxdWVuY2VzXCIpO1xudmFyIEFsdENsaWNrSGFuZGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWx0Q2xpY2tIYW5kbGVyKF9tb3VzZUV2ZW50LCBfdGVybWluYWwpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLl9tb3VzZUV2ZW50ID0gX21vdXNlRXZlbnQ7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9saW5lcyA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcztcbiAgICAgICAgdGhpcy5fc3RhcnRDb2wgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueDtcbiAgICAgICAgdGhpcy5fc3RhcnRSb3cgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueTtcbiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gdGhpcy5fdGVybWluYWwubW91c2VIZWxwZXIuZ2V0Q29vcmRzKHRoaXMuX21vdXNlRXZlbnQsIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQsIHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLCB0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLl90ZXJtaW5hbC5yb3dzLCBmYWxzZSk7XG4gICAgICAgIGlmIChjb29yZGluYXRlcykge1xuICAgICAgICAgICAgX2EgPSBjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24gKGNvb3JkaW5hdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29vcmRpbmF0ZSAtIDE7XG4gICAgICAgICAgICB9KSwgdGhpcy5fZW5kQ29sID0gX2FbMF0sIHRoaXMuX2VuZFJvdyA9IF9hWzFdO1xuICAgICAgICB9XG4gICAgfVxuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlRXZlbnQuYWx0S2V5ICYmIHRoaXMuX2VuZENvbCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuX2VuZFJvdyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKHRoaXMuX2Fycm93U2VxdWVuY2VzKCkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl9hcnJvd1NlcXVlbmNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90ZXJtaW5hbC5idWZmZXIuaGFzU2Nyb2xsYmFjaykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc2V0U3RhcnRpbmdSb3coKSArIHRoaXMuX21vdmVUb1JlcXVlc3RlZFJvdygpICsgdGhpcy5fbW92ZVRvUmVxdWVzdGVkQ29sKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX21vdmVIb3Jpem9udGFsbHlPbmx5KCk7XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl9yZXNldFN0YXJ0aW5nUm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbW92ZVRvUmVxdWVzdGVkUm93KCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcGVhdCh0aGlzLl9idWZmZXJMaW5lKHRoaXMuX3N0YXJ0Q29sLCB0aGlzLl9zdGFydFJvdywgdGhpcy5fc3RhcnRDb2wsIHRoaXMuX3N0YXJ0Um93IC0gdGhpcy5fd3JhcHBlZFJvd3NGb3JSb3codGhpcy5fc3RhcnRSb3cpLCBmYWxzZSkubGVuZ3RoLCB0aGlzLl9zZXF1ZW5jZShcIkRcIikpO1xuICAgIH07XG4gICAgQWx0Q2xpY2tIYW5kbGVyLnByb3RvdHlwZS5fbW92ZVRvUmVxdWVzdGVkUm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3RhcnRSb3cgPSB0aGlzLl9zdGFydFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX3N0YXJ0Um93KTtcbiAgICAgICAgdmFyIGVuZFJvdyA9IHRoaXMuX2VuZFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX2VuZFJvdyk7XG4gICAgICAgIHZhciByb3dzVG9Nb3ZlID0gTWF0aC5hYnMoc3RhcnRSb3cgLSBlbmRSb3cpIC0gdGhpcy5fd3JhcHBlZFJvd3NDb3VudCgpO1xuICAgICAgICByZXR1cm4gcmVwZWF0KHJvd3NUb01vdmUsIHRoaXMuX3NlcXVlbmNlKHRoaXMuX3ZlcnRpY2FsRGlyZWN0aW9uKCkpKTtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX21vdmVUb1JlcXVlc3RlZENvbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHN0YXJ0Um93O1xuICAgICAgICBpZiAodGhpcy5fbW92ZVRvUmVxdWVzdGVkUm93KCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc3RhcnRSb3cgPSB0aGlzLl9lbmRSb3cgLSB0aGlzLl93cmFwcGVkUm93c0ZvclJvdyh0aGlzLl9lbmRSb3cpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhcnRSb3cgPSB0aGlzLl9zdGFydFJvdztcbiAgICAgICAgfVxuICAgICAgICB2YXIgZW5kUm93ID0gdGhpcy5fZW5kUm93O1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gdGhpcy5faG9yaXpvbnRhbERpcmVjdGlvbigpO1xuICAgICAgICByZXR1cm4gcmVwZWF0KHRoaXMuX2J1ZmZlckxpbmUodGhpcy5fc3RhcnRDb2wsIHN0YXJ0Um93LCB0aGlzLl9lbmRDb2wsIGVuZFJvdywgZGlyZWN0aW9uID09PSBcIkNcIikubGVuZ3RoLCB0aGlzLl9zZXF1ZW5jZShkaXJlY3Rpb24pKTtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX21vdmVIb3Jpem9udGFsbHlPbmx5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gdGhpcy5faG9yaXpvbnRhbERpcmVjdGlvbigpO1xuICAgICAgICByZXR1cm4gcmVwZWF0KE1hdGguYWJzKHRoaXMuX3N0YXJ0Q29sIC0gdGhpcy5fZW5kQ29sKSwgdGhpcy5fc2VxdWVuY2UoZGlyZWN0aW9uKSk7XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl93cmFwcGVkUm93c0NvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgd3JhcHBlZFJvd3MgPSAwO1xuICAgICAgICB2YXIgc3RhcnRSb3cgPSB0aGlzLl9zdGFydFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX3N0YXJ0Um93KTtcbiAgICAgICAgdmFyIGVuZFJvdyA9IHRoaXMuX2VuZFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX2VuZFJvdyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTWF0aC5hYnMoc3RhcnRSb3cgLSBlbmRSb3cpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSB0aGlzLl92ZXJ0aWNhbERpcmVjdGlvbigpID09PSBcIkFcIiA/IC0xIDogMTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9saW5lcy5nZXQoc3RhcnRSb3cgKyAoZGlyZWN0aW9uICogaSkpLmlzV3JhcHBlZCkge1xuICAgICAgICAgICAgICAgIHdyYXBwZWRSb3dzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdyYXBwZWRSb3dzO1xuICAgIH07XG4gICAgQWx0Q2xpY2tIYW5kbGVyLnByb3RvdHlwZS5fd3JhcHBlZFJvd3NGb3JSb3cgPSBmdW5jdGlvbiAoY3VycmVudFJvdykge1xuICAgICAgICB2YXIgcm93Q291bnQgPSAwO1xuICAgICAgICB2YXIgbGluZVdyYXBzID0gdGhpcy5fbGluZXMuZ2V0KGN1cnJlbnRSb3cpLmlzV3JhcHBlZDtcbiAgICAgICAgd2hpbGUgKGxpbmVXcmFwcyAmJiBjdXJyZW50Um93ID49IDAgJiYgY3VycmVudFJvdyA8IHRoaXMuX3Rlcm1pbmFsLnJvd3MpIHtcbiAgICAgICAgICAgIHJvd0NvdW50Kys7XG4gICAgICAgICAgICBjdXJyZW50Um93LS07XG4gICAgICAgICAgICBsaW5lV3JhcHMgPSB0aGlzLl9saW5lcy5nZXQoY3VycmVudFJvdykuaXNXcmFwcGVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByb3dDb3VudDtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX2hvcml6b250YWxEaXJlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzdGFydFJvdztcbiAgICAgICAgaWYgKHRoaXMuX21vdmVUb1JlcXVlc3RlZFJvdygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHN0YXJ0Um93ID0gdGhpcy5fZW5kUm93IC0gdGhpcy5fd3JhcHBlZFJvd3NGb3JSb3codGhpcy5fZW5kUm93KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0Um93ID0gdGhpcy5fc3RhcnRSb3c7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh0aGlzLl9zdGFydENvbCA8IHRoaXMuX2VuZENvbCAmJlxuICAgICAgICAgICAgc3RhcnRSb3cgPD0gdGhpcy5fZW5kUm93KSB8fFxuICAgICAgICAgICAgKHRoaXMuX3N0YXJ0Q29sID49IHRoaXMuX2VuZENvbCAmJlxuICAgICAgICAgICAgICAgIHN0YXJ0Um93IDwgdGhpcy5fZW5kUm93KSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiQ1wiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcIkRcIjtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX3ZlcnRpY2FsRGlyZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhcnRSb3cgPiB0aGlzLl9lbmRSb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBcIkFcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gXCJCXCI7XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl9idWZmZXJMaW5lID0gZnVuY3Rpb24gKHN0YXJ0Q29sLCBzdGFydFJvdywgZW5kQ29sLCBlbmRSb3csIGZvcndhcmQpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRDb2wgPSBzdGFydENvbDtcbiAgICAgICAgdmFyIGN1cnJlbnRSb3cgPSBzdGFydFJvdztcbiAgICAgICAgdmFyIGJ1ZmZlclN0ciA9ICcnO1xuICAgICAgICB3aGlsZSAoY3VycmVudENvbCAhPT0gZW5kQ29sIHx8IGN1cnJlbnRSb3cgIT09IGVuZFJvdykge1xuICAgICAgICAgICAgY3VycmVudENvbCArPSBmb3J3YXJkID8gMSA6IC0xO1xuICAgICAgICAgICAgaWYgKGZvcndhcmQgJiYgY3VycmVudENvbCA+IHRoaXMuX3Rlcm1pbmFsLmNvbHMgLSAxKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyU3RyICs9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoY3VycmVudFJvdywgZmFsc2UsIHN0YXJ0Q29sLCBjdXJyZW50Q29sKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29sID0gMDtcbiAgICAgICAgICAgICAgICBzdGFydENvbCA9IDA7XG4gICAgICAgICAgICAgICAgY3VycmVudFJvdysrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIWZvcndhcmQgJiYgY3VycmVudENvbCA8IDApIHtcbiAgICAgICAgICAgICAgICBidWZmZXJTdHIgKz0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhjdXJyZW50Um93LCBmYWxzZSwgMCwgc3RhcnRDb2wgKyAxKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29sID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgICAgICAgICAgc3RhcnRDb2wgPSBjdXJyZW50Q29sO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRSb3ctLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnVmZmVyU3RyICsgdGhpcy5fdGVybWluYWwuYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhjdXJyZW50Um93LCBmYWxzZSwgc3RhcnRDb2wsIGN1cnJlbnRDb2wpO1xuICAgIH07XG4gICAgQWx0Q2xpY2tIYW5kbGVyLnByb3RvdHlwZS5fc2VxdWVuY2UgPSBmdW5jdGlvbiAoZGlyZWN0aW9uKSB7XG4gICAgICAgIHZhciBtb2QgPSB0aGlzLl90ZXJtaW5hbC5hcHBsaWNhdGlvbkN1cnNvciA/ICdPJyA6ICdbJztcbiAgICAgICAgcmV0dXJuIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIG1vZCArIGRpcmVjdGlvbjtcbiAgICB9O1xuICAgIHJldHVybiBBbHRDbGlja0hhbmRsZXI7XG59KCkpO1xuZXhwb3J0cy5BbHRDbGlja0hhbmRsZXIgPSBBbHRDbGlja0hhbmRsZXI7XG5mdW5jdGlvbiByZXBlYXQoY291bnQsIHN0cikge1xuICAgIGNvdW50ID0gTWF0aC5mbG9vcihjb3VudCk7XG4gICAgdmFyIHJwdCA9ICcnO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICBycHQgKz0gc3RyO1xuICAgIH1cbiAgICByZXR1cm4gcnB0O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QWx0Q2xpY2tIYW5kbGVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFRlcm1pbmFsXzEgPSByZXF1aXJlKFwiLi4vVGVybWluYWxcIik7XG52YXIgU3RyaW5ncyA9IHJlcXVpcmUoXCIuLi9TdHJpbmdzXCIpO1xudmFyIFRlcm1pbmFsID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUZXJtaW5hbChvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX2NvcmUgPSBuZXcgVGVybWluYWxfMS5UZXJtaW5hbChvcHRpb25zKTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJlbGVtZW50XCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLmVsZW1lbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwidGV4dGFyZWFcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUudGV4dGFyZWE7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwicm93c1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY29yZS5yb3dzOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcImNvbHNcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUuY29sczsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJtYXJrZXJzXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLm1hcmtlcnM7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5ibHVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb3JlLmJsdXIoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5mb2N1cygpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuX2NvcmUub24odHlwZSwgbGlzdGVuZXIpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uICh0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLl9jb3JlLm9mZih0eXBlLCBsaXN0ZW5lcik7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuZW1pdCh0eXBlLCBkYXRhKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5hZGREaXNwb3NhYmxlTGlzdGVuZXIgPSBmdW5jdGlvbiAodHlwZSwgaGFuZGxlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29yZS5hZGREaXNwb3NhYmxlTGlzdGVuZXIodHlwZSwgaGFuZGxlcik7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKGNvbHVtbnMsIHJvd3MpIHtcbiAgICAgICAgdGhpcy5fY29yZS5yZXNpemUoY29sdW1ucywgcm93cyk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUud3JpdGVsbiA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuX2NvcmUud3JpdGVsbihkYXRhKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKHBhcmVudCkge1xuICAgICAgICB0aGlzLl9jb3JlLm9wZW4ocGFyZW50KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5hdHRhY2hDdXN0b21LZXlFdmVudEhhbmRsZXIgPSBmdW5jdGlvbiAoY3VzdG9tS2V5RXZlbnRIYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuYXR0YWNoQ3VzdG9tS2V5RXZlbnRIYW5kbGVyKGN1c3RvbUtleUV2ZW50SGFuZGxlcik7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVnaXN0ZXJMaW5rTWF0Y2hlciA9IGZ1bmN0aW9uIChyZWdleCwgaGFuZGxlciwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29yZS5yZWdpc3RlckxpbmtNYXRjaGVyKHJlZ2V4LCBoYW5kbGVyLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5kZXJlZ2lzdGVyTGlua01hdGNoZXIgPSBmdW5jdGlvbiAobWF0Y2hlcklkKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuZGVyZWdpc3RlckxpbmtNYXRjaGVyKG1hdGNoZXJJZCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29yZS5yZWdpc3RlckNoYXJhY3RlckpvaW5lcihoYW5kbGVyKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGpvaW5lcklkKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuZGVyZWdpc3RlckNoYXJhY3RlckpvaW5lcihqb2luZXJJZCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYWRkTWFya2VyID0gZnVuY3Rpb24gKGN1cnNvcllPZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUuYWRkTWFya2VyKGN1cnNvcllPZmZzZXQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmhhc1NlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUuaGFzU2VsZWN0aW9uKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZ2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29yZS5nZXRTZWxlY3Rpb24oKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5jbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5jbGVhclNlbGVjdGlvbigpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNlbGVjdEFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5zZWxlY3RBbGwoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zZWxlY3RMaW5lcyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2VsZWN0TGluZXMoc3RhcnQsIGVuZCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5kaXNwb3NlKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5kZXN0cm95KCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsTGluZXMgPSBmdW5jdGlvbiAoYW1vdW50KSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2Nyb2xsTGluZXMoYW1vdW50KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zY3JvbGxQYWdlcyA9IGZ1bmN0aW9uIChwYWdlQ291bnQpIHtcbiAgICAgICAgdGhpcy5fY29yZS5zY3JvbGxQYWdlcyhwYWdlQ291bnQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbFRvVG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb3JlLnNjcm9sbFRvVG9wKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsVG9Cb3R0b20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zY3JvbGxUb0xpbmUgPSBmdW5jdGlvbiAobGluZSkge1xuICAgICAgICB0aGlzLl9jb3JlLnNjcm9sbFRvTGluZShsaW5lKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5jbGVhcigpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdGhpcy5fY29yZS53cml0ZShkYXRhKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5nZXRPcHRpb24gPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb3JlLmdldE9wdGlvbihrZXkpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNldE9wdGlvbiA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2V0T3B0aW9uKGtleSwgdmFsdWUpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB0aGlzLl9jb3JlLnJlZnJlc2goc3RhcnQsIGVuZCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUucmVzZXQoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLmFwcGx5QWRkb24gPSBmdW5jdGlvbiAoYWRkb24pIHtcbiAgICAgICAgYWRkb24uYXBwbHkoVGVybWluYWwpO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLCBcInN0cmluZ3NcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmdzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gVGVybWluYWw7XG59KCkpO1xuZXhwb3J0cy5UZXJtaW5hbCA9IFRlcm1pbmFsO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VGVybWluYWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgVHlwZXNfMSA9IHJlcXVpcmUoXCIuL2F0bGFzL1R5cGVzXCIpO1xudmFyIENoYXJBdGxhc0NhY2hlXzEgPSByZXF1aXJlKFwiLi9hdGxhcy9DaGFyQXRsYXNDYWNoZVwiKTtcbnZhciBCdWZmZXJfMSA9IHJlcXVpcmUoXCIuLi9CdWZmZXJcIik7XG52YXIgQ2hhckF0bGFzVXRpbHNfMSA9IHJlcXVpcmUoXCIuL2F0bGFzL0NoYXJBdGxhc1V0aWxzXCIpO1xudmFyIEJhc2VSZW5kZXJMYXllciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQmFzZVJlbmRlckxheWVyKF9jb250YWluZXIsIGlkLCB6SW5kZXgsIF9hbHBoYSwgX2NvbG9ycykge1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBfY29udGFpbmVyO1xuICAgICAgICB0aGlzLl9hbHBoYSA9IF9hbHBoYTtcbiAgICAgICAgdGhpcy5fY29sb3JzID0gX2NvbG9ycztcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhcldpZHRoID0gMDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhckhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLl9zY2FsZWRDaGFyTGVmdCA9IDA7XG4gICAgICAgIHRoaXMuX3NjYWxlZENoYXJUb3AgPSAwO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2x5cGhJZGVudGlmaWVyID0ge1xuICAgICAgICAgICAgY2hhcnM6ICcnLFxuICAgICAgICAgICAgY29kZTogMCxcbiAgICAgICAgICAgIGJnOiAwLFxuICAgICAgICAgICAgZmc6IDAsXG4gICAgICAgICAgICBib2xkOiBmYWxzZSxcbiAgICAgICAgICAgIGRpbTogZmFsc2UsXG4gICAgICAgICAgICBpdGFsaWM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICB0aGlzLl9jYW52YXMuY2xhc3NMaXN0LmFkZChcInh0ZXJtLVwiICsgaWQgKyBcIi1sYXllclwiKTtcbiAgICAgICAgdGhpcy5fY2FudmFzLnN0eWxlLnpJbmRleCA9IHpJbmRleC50b1N0cmluZygpO1xuICAgICAgICB0aGlzLl9pbml0Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9jYW52YXMpO1xuICAgIH1cbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLl9jYW52YXMpO1xuICAgICAgICBpZiAodGhpcy5fY2hhckF0bGFzKSB7XG4gICAgICAgICAgICB0aGlzLl9jaGFyQXRsYXMuZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9pbml0Q2FudmFzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jdHggPSB0aGlzLl9jYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IGFscGhhOiB0aGlzLl9hbHBoYSB9KTtcbiAgICAgICAgaWYgKCF0aGlzLl9hbHBoYSkge1xuICAgICAgICAgICAgdGhpcy5jbGVhckFsbCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwpIHsgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uQmx1ciA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkgeyB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUub25Gb2N1cyA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkgeyB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUub25DdXJzb3JNb3ZlID0gZnVuY3Rpb24gKHRlcm1pbmFsKSB7IH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5vbkdyaWRDaGFuZ2VkID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBzdGFydFJvdywgZW5kUm93KSB7IH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5vblNlbGVjdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwsIHN0YXJ0LCBlbmQsIGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgaWYgKGNvbHVtblNlbGVjdE1vZGUgPT09IHZvaWQgMCkgeyBjb2x1bW5TZWxlY3RNb2RlID0gZmFsc2U7IH1cbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUub25UaGVtZUNoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwsIGNvbG9yU2V0KSB7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hDaGFyQXRsYXModGVybWluYWwsIGNvbG9yU2V0KTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuc2V0VHJhbnNwYXJlbmN5ID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBhbHBoYSkge1xuICAgICAgICBpZiAoYWxwaGEgPT09IHRoaXMuX2FscGhhKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG9sZENhbnZhcyA9IHRoaXMuX2NhbnZhcztcbiAgICAgICAgdGhpcy5fYWxwaGEgPSBhbHBoYTtcbiAgICAgICAgdGhpcy5fY2FudmFzID0gdGhpcy5fY2FudmFzLmNsb25lTm9kZSgpO1xuICAgICAgICB0aGlzLl9pbml0Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZXBsYWNlQ2hpbGQodGhpcy5fY2FudmFzLCBvbGRDYW52YXMpO1xuICAgICAgICB0aGlzLl9yZWZyZXNoQ2hhckF0bGFzKHRlcm1pbmFsLCB0aGlzLl9jb2xvcnMpO1xuICAgICAgICB0aGlzLm9uR3JpZENoYW5nZWQodGVybWluYWwsIDAsIHRlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuX3JlZnJlc2hDaGFyQXRsYXMgPSBmdW5jdGlvbiAodGVybWluYWwsIGNvbG9yU2V0KSB7XG4gICAgICAgIGlmICh0aGlzLl9zY2FsZWRDaGFyV2lkdGggPD0gMCAmJiB0aGlzLl9zY2FsZWRDaGFySGVpZ2h0IDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jaGFyQXRsYXMgPSBDaGFyQXRsYXNDYWNoZV8xLmFjcXVpcmVDaGFyQXRsYXModGVybWluYWwsIGNvbG9yU2V0LCB0aGlzLl9zY2FsZWRDaGFyV2lkdGgsIHRoaXMuX3NjYWxlZENoYXJIZWlnaHQpO1xuICAgICAgICB0aGlzLl9jaGFyQXRsYXMud2FybVVwKCk7XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgZGltKSB7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxXaWR0aCA9IGRpbS5zY2FsZWRDZWxsV2lkdGg7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgPSBkaW0uc2NhbGVkQ2VsbEhlaWdodDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhcldpZHRoID0gZGltLnNjYWxlZENoYXJXaWR0aDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhckhlaWdodCA9IGRpbS5zY2FsZWRDaGFySGVpZ2h0O1xuICAgICAgICB0aGlzLl9zY2FsZWRDaGFyTGVmdCA9IGRpbS5zY2FsZWRDaGFyTGVmdDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhclRvcCA9IGRpbS5zY2FsZWRDaGFyVG9wO1xuICAgICAgICB0aGlzLl9jYW52YXMud2lkdGggPSBkaW0uc2NhbGVkQ2FudmFzV2lkdGg7XG4gICAgICAgIHRoaXMuX2NhbnZhcy5oZWlnaHQgPSBkaW0uc2NhbGVkQ2FudmFzSGVpZ2h0O1xuICAgICAgICB0aGlzLl9jYW52YXMuc3R5bGUud2lkdGggPSBkaW0uY2FudmFzV2lkdGggKyBcInB4XCI7XG4gICAgICAgIHRoaXMuX2NhbnZhcy5zdHlsZS5oZWlnaHQgPSBkaW0uY2FudmFzSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICBpZiAoIXRoaXMuX2FscGhhKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVmcmVzaENoYXJBdGxhcyh0ZXJtaW5hbCwgdGhpcy5fY29sb3JzKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuZmlsbENlbGxzID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsIHkgKiB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0LCB3aWR0aCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCwgaGVpZ2h0ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCk7XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmZpbGxCb3R0b21MaW5lQXRDZWxscyA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCkge1xuICAgICAgICBpZiAod2lkdGggPT09IHZvaWQgMCkgeyB3aWR0aCA9IDE7IH1cbiAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsICh5ICsgMSkgKiB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0IC0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gLSAxLCB3aWR0aCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCwgd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5maWxsTGVmdExpbmVBdENlbGwgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICB0aGlzLl9jdHguZmlsbFJlY3QoeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQsIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvLCB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0KTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuc3Ryb2tlUmVjdEF0Q2VsbCA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuX2N0eC5saW5lV2lkdGggPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgdGhpcy5fY3R4LnN0cm9rZVJlY3QoeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCArIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIC8gMiwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgKyAod2luZG93LmRldmljZVBpeGVsUmF0aW8gLyAyKSwgd2lkdGggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGggLSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbywgKGhlaWdodCAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQpIC0gd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5jbGVhckFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2FscGhhKSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuX2NhbnZhcy53aWR0aCwgdGhpcy5fY2FudmFzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmJhY2tncm91bmQuY3NzO1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KDAsIDAsIHRoaXMuX2NhbnZhcy53aWR0aCwgdGhpcy5fY2FudmFzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuY2xlYXJDZWxscyA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl9hbHBoYSkge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmNsZWFyUmVjdCh4ICogdGhpcy5fc2NhbGVkQ2VsbFdpZHRoLCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCwgd2lkdGggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsIGhlaWdodCAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICAgICAgICAgIHRoaXMuX2N0eC5maWxsUmVjdCh4ICogdGhpcy5fc2NhbGVkQ2VsbFdpZHRoLCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCwgd2lkdGggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsIGhlaWdodCAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmZpbGxDaGFyVHJ1ZUNvbG9yID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBjaGFyRGF0YSwgeCwgeSkge1xuICAgICAgICB0aGlzLl9jdHguZm9udCA9IHRoaXMuX2dldEZvbnQodGVybWluYWwsIGZhbHNlLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuX2N0eC50ZXh0QmFzZWxpbmUgPSAndG9wJztcbiAgICAgICAgdGhpcy5fY2xpcFJvdyh0ZXJtaW5hbCwgeSk7XG4gICAgICAgIHRoaXMuX2N0eC5maWxsVGV4dChjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0sIHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGggKyB0aGlzLl9zY2FsZWRDaGFyTGVmdCwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgKyB0aGlzLl9zY2FsZWRDaGFyVG9wKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuZHJhd0NoYXJzID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBjaGFycywgY29kZSwgd2lkdGgsIHgsIHksIGZnLCBiZywgYm9sZCwgZGltLCBpdGFsaWMpIHtcbiAgICAgICAgdmFyIGRyYXdJbkJyaWdodENvbG9yID0gdGVybWluYWwub3B0aW9ucy5kcmF3Qm9sZFRleHRJbkJyaWdodENvbG9ycyAmJiBib2xkICYmIGZnIDwgOCAmJiBmZyAhPT0gVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SO1xuICAgICAgICBmZyArPSBkcmF3SW5CcmlnaHRDb2xvciA/IDggOiAwO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2x5cGhJZGVudGlmaWVyLmNoYXJzID0gY2hhcnM7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRHbHlwaElkZW50aWZpZXIuY29kZSA9IGNvZGU7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRHbHlwaElkZW50aWZpZXIuYmcgPSBiZztcbiAgICAgICAgdGhpcy5fY3VycmVudEdseXBoSWRlbnRpZmllci5mZyA9IGZnO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2x5cGhJZGVudGlmaWVyLmJvbGQgPSBib2xkICYmIHRlcm1pbmFsLm9wdGlvbnMuZW5hYmxlQm9sZDtcbiAgICAgICAgdGhpcy5fY3VycmVudEdseXBoSWRlbnRpZmllci5kaW0gPSBkaW07XG4gICAgICAgIHRoaXMuX2N1cnJlbnRHbHlwaElkZW50aWZpZXIuaXRhbGljID0gaXRhbGljO1xuICAgICAgICB2YXIgYXRsYXNEaWREcmF3ID0gdGhpcy5fY2hhckF0bGFzICYmIHRoaXMuX2NoYXJBdGxhcy5kcmF3KHRoaXMuX2N0eCwgdGhpcy5fY3VycmVudEdseXBoSWRlbnRpZmllciwgeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCArIHRoaXMuX3NjYWxlZENoYXJMZWZ0LCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCArIHRoaXMuX3NjYWxlZENoYXJUb3ApO1xuICAgICAgICBpZiAoIWF0bGFzRGlkRHJhdykge1xuICAgICAgICAgICAgdGhpcy5fZHJhd1VuY2FjaGVkQ2hhcnModGVybWluYWwsIGNoYXJzLCB3aWR0aCwgZmcsIHgsIHksIGJvbGQgJiYgdGVybWluYWwub3B0aW9ucy5lbmFibGVCb2xkLCBkaW0sIGl0YWxpYyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuX2RyYXdVbmNhY2hlZENoYXJzID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBjaGFycywgd2lkdGgsIGZnLCB4LCB5LCBib2xkLCBkaW0sIGl0YWxpYykge1xuICAgICAgICB0aGlzLl9jdHguc2F2ZSgpO1xuICAgICAgICB0aGlzLl9jdHguZm9udCA9IHRoaXMuX2dldEZvbnQodGVybWluYWwsIGJvbGQsIGl0YWxpYyk7XG4gICAgICAgIHRoaXMuX2N0eC50ZXh0QmFzZWxpbmUgPSAndG9wJztcbiAgICAgICAgaWYgKGZnID09PSBUeXBlc18xLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IpIHtcbiAgICAgICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuYmFja2dyb3VuZC5jc3M7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoQ2hhckF0bGFzVXRpbHNfMS5pczI1NkNvbG9yKGZnKSkge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5hbnNpW2ZnXS5jc3M7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NsaXBSb3codGVybWluYWwsIHkpO1xuICAgICAgICBpZiAoZGltKSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZ2xvYmFsQWxwaGEgPSBUeXBlc18xLkRJTV9PUEFDSVRZO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N0eC5maWxsVGV4dChjaGFycywgeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCArIHRoaXMuX3NjYWxlZENoYXJMZWZ0LCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCArIHRoaXMuX3NjYWxlZENoYXJUb3ApO1xuICAgICAgICB0aGlzLl9jdHgucmVzdG9yZSgpO1xuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5fY2xpcFJvdyA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgeSkge1xuICAgICAgICB0aGlzLl9jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuX2N0eC5yZWN0KDAsIHkgKiB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0LCB0ZXJtaW5hbC5jb2xzICogdGhpcy5fc2NhbGVkQ2VsbFdpZHRoLCB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0KTtcbiAgICAgICAgdGhpcy5fY3R4LmNsaXAoKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuX2dldEZvbnQgPSBmdW5jdGlvbiAodGVybWluYWwsIGlzQm9sZCwgaXNJdGFsaWMpIHtcbiAgICAgICAgdmFyIGZvbnRXZWlnaHQgPSBpc0JvbGQgPyB0ZXJtaW5hbC5vcHRpb25zLmZvbnRXZWlnaHRCb2xkIDogdGVybWluYWwub3B0aW9ucy5mb250V2VpZ2h0O1xuICAgICAgICB2YXIgZm9udFN0eWxlID0gaXNJdGFsaWMgPyAnaXRhbGljJyA6ICcnO1xuICAgICAgICByZXR1cm4gZm9udFN0eWxlICsgXCIgXCIgKyBmb250V2VpZ2h0ICsgXCIgXCIgKyB0ZXJtaW5hbC5vcHRpb25zLmZvbnRTaXplICogd2luZG93LmRldmljZVBpeGVsUmF0aW8gKyBcInB4IFwiICsgdGVybWluYWwub3B0aW9ucy5mb250RmFtaWx5O1xuICAgIH07XG4gICAgcmV0dXJuIEJhc2VSZW5kZXJMYXllcjtcbn0oKSk7XG5leHBvcnRzLkJhc2VSZW5kZXJMYXllciA9IEJhc2VSZW5kZXJMYXllcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUJhc2VSZW5kZXJMYXllci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBCdWZmZXJfMSA9IHJlcXVpcmUoXCIuLi9CdWZmZXJcIik7XG52YXIgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5KF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVySm9pbmVycyA9IFtdO1xuICAgICAgICB0aGlzLl9uZXh0Q2hhcmFjdGVySm9pbmVySWQgPSAwO1xuICAgIH1cbiAgICBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5wcm90b3R5cGUucmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICB2YXIgam9pbmVyID0ge1xuICAgICAgICAgICAgaWQ6IHRoaXMuX25leHRDaGFyYWN0ZXJKb2luZXJJZCsrLFxuICAgICAgICAgICAgaGFuZGxlcjogaGFuZGxlclxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9jaGFyYWN0ZXJKb2luZXJzLnB1c2goam9pbmVyKTtcbiAgICAgICAgcmV0dXJuIGpvaW5lci5pZDtcbiAgICB9O1xuICAgIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LnByb3RvdHlwZS5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGpvaW5lcklkKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fY2hhcmFjdGVySm9pbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NoYXJhY3RlckpvaW5lcnNbaV0uaWQgPT09IGpvaW5lcklkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVySm9pbmVycy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkucHJvdG90eXBlLmdldEpvaW5lZENoYXJhY3RlcnMgPSBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIGlmICh0aGlzLl9jaGFyYWN0ZXJKb2luZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmdldChyb3cpO1xuICAgICAgICBpZiAobGluZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmFuZ2VzID0gW107XG4gICAgICAgIHZhciBsaW5lU3RyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhyb3csIHRydWUpO1xuICAgICAgICB2YXIgcmFuZ2VTdGFydENvbHVtbiA9IDA7XG4gICAgICAgIHZhciBjdXJyZW50U3RyaW5nSW5kZXggPSAwO1xuICAgICAgICB2YXIgcmFuZ2VTdGFydFN0cmluZ0luZGV4ID0gMDtcbiAgICAgICAgdmFyIHJhbmdlQXR0ciA9IGxpbmUuZ2V0KDApW0J1ZmZlcl8xLkNIQVJfREFUQV9BVFRSX0lOREVYXSA+PiA5O1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHRoaXMuX3Rlcm1pbmFsLmNvbHM7IHgrKykge1xuICAgICAgICAgICAgdmFyIGNoYXJEYXRhID0gbGluZS5nZXQoeCk7XG4gICAgICAgICAgICB2YXIgY2hhcnMgPSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF07XG4gICAgICAgICAgICB2YXIgd2lkdGggPSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdO1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfQVRUUl9JTkRFWF0gPj4gOTtcbiAgICAgICAgICAgIGlmICh3aWR0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGF0dHIgIT09IHJhbmdlQXR0cikge1xuICAgICAgICAgICAgICAgIGlmICh4IC0gcmFuZ2VTdGFydENvbHVtbiA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpvaW5lZFJhbmdlcyA9IHRoaXMuX2dldEpvaW5lZFJhbmdlcyhsaW5lU3RyLCByYW5nZVN0YXJ0U3RyaW5nSW5kZXgsIGN1cnJlbnRTdHJpbmdJbmRleCwgbGluZSwgcmFuZ2VTdGFydENvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkUmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZXMucHVzaChqb2luZWRSYW5nZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJhbmdlU3RhcnRDb2x1bW4gPSB4O1xuICAgICAgICAgICAgICAgIHJhbmdlU3RhcnRTdHJpbmdJbmRleCA9IGN1cnJlbnRTdHJpbmdJbmRleDtcbiAgICAgICAgICAgICAgICByYW5nZUF0dHIgPSBhdHRyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudFN0cmluZ0luZGV4ICs9IGNoYXJzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuY29scyAtIHJhbmdlU3RhcnRDb2x1bW4gPiAxKSB7XG4gICAgICAgICAgICB2YXIgam9pbmVkUmFuZ2VzID0gdGhpcy5fZ2V0Sm9pbmVkUmFuZ2VzKGxpbmVTdHIsIHJhbmdlU3RhcnRTdHJpbmdJbmRleCwgY3VycmVudFN0cmluZ0luZGV4LCBsaW5lLCByYW5nZVN0YXJ0Q29sdW1uKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkUmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2goam9pbmVkUmFuZ2VzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgIH07XG4gICAgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkucHJvdG90eXBlLl9nZXRKb2luZWRSYW5nZXMgPSBmdW5jdGlvbiAobGluZSwgc3RhcnRJbmRleCwgZW5kSW5kZXgsIGxpbmVEYXRhLCBzdGFydENvbCkge1xuICAgICAgICB2YXIgdGV4dCA9IGxpbmUuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcbiAgICAgICAgdmFyIGpvaW5lZFJhbmdlcyA9IHRoaXMuX2NoYXJhY3RlckpvaW5lcnNbMF0uaGFuZGxlcih0ZXh0KTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLl9jaGFyYWN0ZXJKb2luZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgam9pbmVyUmFuZ2VzID0gdGhpcy5fY2hhcmFjdGVySm9pbmVyc1tpXS5oYW5kbGVyKHRleHQpO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBqb2luZXJSYW5nZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5fbWVyZ2VSYW5nZXMoam9pbmVkUmFuZ2VzLCBqb2luZXJSYW5nZXNbal0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0cmluZ1Jhbmdlc1RvQ2VsbFJhbmdlcyhqb2luZWRSYW5nZXMsIGxpbmVEYXRhLCBzdGFydENvbCk7XG4gICAgICAgIHJldHVybiBqb2luZWRSYW5nZXM7XG4gICAgfTtcbiAgICBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5wcm90b3R5cGUuX3N0cmluZ1Jhbmdlc1RvQ2VsbFJhbmdlcyA9IGZ1bmN0aW9uIChyYW5nZXMsIGxpbmUsIHN0YXJ0Q29sKSB7XG4gICAgICAgIHZhciBjdXJyZW50UmFuZ2VJbmRleCA9IDA7XG4gICAgICAgIHZhciBjdXJyZW50UmFuZ2VTdGFydGVkID0gZmFsc2U7XG4gICAgICAgIHZhciBjdXJyZW50U3RyaW5nSW5kZXggPSAwO1xuICAgICAgICB2YXIgY3VycmVudFJhbmdlID0gcmFuZ2VzW2N1cnJlbnRSYW5nZUluZGV4XTtcbiAgICAgICAgaWYgKCFjdXJyZW50UmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciB4ID0gc3RhcnRDb2w7IHggPCB0aGlzLl90ZXJtaW5hbC5jb2xzOyB4KyspIHtcbiAgICAgICAgICAgIHZhciBjaGFyRGF0YSA9IGxpbmUuZ2V0KHgpO1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXTtcbiAgICAgICAgICAgIHZhciBsZW5ndGhfMSA9IGNoYXJEYXRhW0J1ZmZlcl8xLkNIQVJfREFUQV9DSEFSX0lOREVYXS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAod2lkdGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY3VycmVudFJhbmdlU3RhcnRlZCAmJiBjdXJyZW50UmFuZ2VbMF0gPD0gY3VycmVudFN0cmluZ0luZGV4KSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFJhbmdlWzBdID0geDtcbiAgICAgICAgICAgICAgICBjdXJyZW50UmFuZ2VTdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50UmFuZ2VbMV0gPD0gY3VycmVudFN0cmluZ0luZGV4KSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFJhbmdlWzFdID0geDtcbiAgICAgICAgICAgICAgICBjdXJyZW50UmFuZ2UgPSByYW5nZXNbKytjdXJyZW50UmFuZ2VJbmRleF07XG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50UmFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UmFuZ2VbMF0gPD0gY3VycmVudFN0cmluZ0luZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSYW5nZVswXSA9IHg7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSYW5nZVN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFJhbmdlU3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRTdHJpbmdJbmRleCArPSBsZW5ndGhfMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudFJhbmdlKSB7XG4gICAgICAgICAgICBjdXJyZW50UmFuZ2VbMV0gPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5fbWVyZ2VSYW5nZXMgPSBmdW5jdGlvbiAocmFuZ2VzLCBuZXdSYW5nZSkge1xuICAgICAgICB2YXIgaW5SYW5nZSA9IGZhbHNlO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHJhbmdlID0gcmFuZ2VzW2ldO1xuICAgICAgICAgICAgaWYgKCFpblJhbmdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1JhbmdlWzFdIDw9IHJhbmdlWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlcy5zcGxpY2UoaSwgMCwgbmV3UmFuZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmV3UmFuZ2VbMV0gPD0gcmFuZ2VbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VbMF0gPSBNYXRoLm1pbihuZXdSYW5nZVswXSwgcmFuZ2VbMF0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmV3UmFuZ2VbMF0gPCByYW5nZVsxXSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZVswXSA9IE1hdGgubWluKG5ld1JhbmdlWzBdLCByYW5nZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIGluUmFuZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChuZXdSYW5nZVsxXSA8PSByYW5nZVswXSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZXNbaSAtIDFdWzFdID0gbmV3UmFuZ2VbMV07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuZXdSYW5nZVsxXSA8PSByYW5nZVsxXSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZXNbaSAtIDFdWzFdID0gTWF0aC5tYXgobmV3UmFuZ2VbMV0sIHJhbmdlWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaW5SYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByYW5nZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5SYW5nZSkge1xuICAgICAgICAgICAgcmFuZ2VzW3Jhbmdlcy5sZW5ndGggLSAxXVsxXSA9IG5ld1JhbmdlWzFdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmFuZ2VzLnB1c2gobmV3UmFuZ2UpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfTtcbiAgICByZXR1cm4gQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnk7XG59KCkpO1xuZXhwb3J0cy5DaGFyYWN0ZXJKb2luZXJSZWdpc3RyeSA9IENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhcmFjdGVySm9pbmVyUmVnaXN0cnkuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgREVGQVVMVF9GT1JFR1JPVU5EID0gZnJvbUhleCgnI2ZmZmZmZicpO1xudmFyIERFRkFVTFRfQkFDS0dST1VORCA9IGZyb21IZXgoJyMwMDAwMDAnKTtcbnZhciBERUZBVUxUX0NVUlNPUiA9IGZyb21IZXgoJyNmZmZmZmYnKTtcbnZhciBERUZBVUxUX0NVUlNPUl9BQ0NFTlQgPSBmcm9tSGV4KCcjMDAwMDAwJyk7XG52YXIgREVGQVVMVF9TRUxFQ1RJT04gPSB7XG4gICAgY3NzOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpJyxcbiAgICByZ2JhOiAweEZGRkZGRjc3XG59O1xuZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY29sb3JzID0gW1xuICAgICAgICBmcm9tSGV4KCcjMmUzNDM2JyksXG4gICAgICAgIGZyb21IZXgoJyNjYzAwMDAnKSxcbiAgICAgICAgZnJvbUhleCgnIzRlOWEwNicpLFxuICAgICAgICBmcm9tSGV4KCcjYzRhMDAwJyksXG4gICAgICAgIGZyb21IZXgoJyMzNDY1YTQnKSxcbiAgICAgICAgZnJvbUhleCgnIzc1NTA3YicpLFxuICAgICAgICBmcm9tSGV4KCcjMDY5ODlhJyksXG4gICAgICAgIGZyb21IZXgoJyNkM2Q3Y2YnKSxcbiAgICAgICAgZnJvbUhleCgnIzU1NTc1MycpLFxuICAgICAgICBmcm9tSGV4KCcjZWYyOTI5JyksXG4gICAgICAgIGZyb21IZXgoJyM4YWUyMzQnKSxcbiAgICAgICAgZnJvbUhleCgnI2ZjZTk0ZicpLFxuICAgICAgICBmcm9tSGV4KCcjNzI5ZmNmJyksXG4gICAgICAgIGZyb21IZXgoJyNhZDdmYTgnKSxcbiAgICAgICAgZnJvbUhleCgnIzM0ZTJlMicpLFxuICAgICAgICBmcm9tSGV4KCcjZWVlZWVjJylcbiAgICBdO1xuICAgIHZhciB2ID0gWzB4MDAsIDB4NWYsIDB4ODcsIDB4YWYsIDB4ZDcsIDB4ZmZdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjE2OyBpKyspIHtcbiAgICAgICAgdmFyIHIgPSB2WyhpIC8gMzYpICUgNiB8IDBdO1xuICAgICAgICB2YXIgZyA9IHZbKGkgLyA2KSAlIDYgfCAwXTtcbiAgICAgICAgdmFyIGIgPSB2W2kgJSA2XTtcbiAgICAgICAgY29sb3JzLnB1c2goe1xuICAgICAgICAgICAgY3NzOiBcIiNcIiArIHRvUGFkZGVkSGV4KHIpICsgdG9QYWRkZWRIZXgoZykgKyB0b1BhZGRlZEhleChiKSxcbiAgICAgICAgICAgIHJnYmE6ICgociA8PCAyNCkgfCAoZyA8PCAxNikgfCAoYiA8PCA4KSB8IDB4RkYpID4+PiAwXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI0OyBpKyspIHtcbiAgICAgICAgdmFyIGMgPSA4ICsgaSAqIDEwO1xuICAgICAgICB2YXIgY2ggPSB0b1BhZGRlZEhleChjKTtcbiAgICAgICAgY29sb3JzLnB1c2goe1xuICAgICAgICAgICAgY3NzOiBcIiNcIiArIGNoICsgY2ggKyBjaCxcbiAgICAgICAgICAgIHJnYmE6ICgoYyA8PCAyNCkgfCAoYyA8PCAxNikgfCAoYyA8PCA4KSB8IDB4RkYpID4+PiAwXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gY29sb3JzO1xufSkoKTtcbmZ1bmN0aW9uIGZyb21IZXgoY3NzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY3NzOiBjc3MsXG4gICAgICAgIHJnYmE6IHBhcnNlSW50KGNzcy5zbGljZSgxKSwgMTYpIDw8IDggfCAweEZGXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHRvUGFkZGVkSGV4KGMpIHtcbiAgICB2YXIgcyA9IGMudG9TdHJpbmcoMTYpO1xuICAgIHJldHVybiBzLmxlbmd0aCA8IDIgPyAnMCcgKyBzIDogcztcbn1cbnZhciBDb2xvck1hbmFnZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbG9yTWFuYWdlcihkb2N1bWVudCwgYWxsb3dUcmFuc3BhcmVuY3kpIHtcbiAgICAgICAgdGhpcy5hbGxvd1RyYW5zcGFyZW5jeSA9IGFsbG93VHJhbnNwYXJlbmN5O1xuICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IDE7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSAxO1xuICAgICAgICB0aGlzLl9jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdGhpcy5fY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdjb3B5JztcbiAgICAgICAgdGhpcy5fbGl0bXVzQ29sb3IgPSB0aGlzLl9jdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMSwgMSk7XG4gICAgICAgIHRoaXMuY29sb3JzID0ge1xuICAgICAgICAgICAgZm9yZWdyb3VuZDogREVGQVVMVF9GT1JFR1JPVU5ELFxuICAgICAgICAgICAgYmFja2dyb3VuZDogREVGQVVMVF9CQUNLR1JPVU5ELFxuICAgICAgICAgICAgY3Vyc29yOiBERUZBVUxUX0NVUlNPUixcbiAgICAgICAgICAgIGN1cnNvckFjY2VudDogREVGQVVMVF9DVVJTT1JfQUNDRU5ULFxuICAgICAgICAgICAgc2VsZWN0aW9uOiBERUZBVUxUX1NFTEVDVElPTixcbiAgICAgICAgICAgIGFuc2k6IGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SUy5zbGljZSgpXG4gICAgICAgIH07XG4gICAgfVxuICAgIENvbG9yTWFuYWdlci5wcm90b3R5cGUuc2V0VGhlbWUgPSBmdW5jdGlvbiAodGhlbWUpIHtcbiAgICAgICAgdGhpcy5jb2xvcnMuZm9yZWdyb3VuZCA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuZm9yZWdyb3VuZCwgREVGQVVMVF9GT1JFR1JPVU5EKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYmFja2dyb3VuZCA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYmFja2dyb3VuZCwgREVGQVVMVF9CQUNLR1JPVU5EKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuY3Vyc29yID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5jdXJzb3IsIERFRkFVTFRfQ1VSU09SLCB0cnVlKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuY3Vyc29yQWNjZW50ID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5jdXJzb3JBY2NlbnQsIERFRkFVTFRfQ1VSU09SX0FDQ0VOVCwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuY29sb3JzLnNlbGVjdGlvbiA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuc2VsZWN0aW9uLCBERUZBVUxUX1NFTEVDVElPTiwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbMF0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJsYWNrLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMF0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzFdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5yZWQsIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1sxXSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbMl0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmdyZWVuLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMl0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzNdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS55ZWxsb3csIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1szXSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbNF0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJsdWUsIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1s0XSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbNV0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLm1hZ2VudGEsIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1s1XSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbNl0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmN5YW4sIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1s2XSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbN10gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLndoaXRlLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbN10pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzhdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5icmlnaHRCbGFjaywgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzhdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVs5XSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYnJpZ2h0UmVkLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbOV0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzEwXSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYnJpZ2h0R3JlZW4sIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1sxMF0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzExXSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYnJpZ2h0WWVsbG93LCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMTFdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVsxMl0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJyaWdodEJsdWUsIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1sxMl0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzEzXSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYnJpZ2h0TWFnZW50YSwgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzEzXSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbMTRdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5icmlnaHRDeWFuLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMTRdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVsxNV0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJyaWdodFdoaXRlLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMTVdKTtcbiAgICB9O1xuICAgIENvbG9yTWFuYWdlci5wcm90b3R5cGUuX3BhcnNlQ29sb3IgPSBmdW5jdGlvbiAoY3NzLCBmYWxsYmFjaywgYWxsb3dUcmFuc3BhcmVuY3kpIHtcbiAgICAgICAgaWYgKGFsbG93VHJhbnNwYXJlbmN5ID09PSB2b2lkIDApIHsgYWxsb3dUcmFuc3BhcmVuY3kgPSB0aGlzLmFsbG93VHJhbnNwYXJlbmN5OyB9XG4gICAgICAgIGlmICghY3NzKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2xpdG11c0NvbG9yO1xuICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gY3NzO1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuX2N0eC5maWxsU3R5bGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJDb2xvcjogXCIgKyBjc3MgKyBcIiBpcyBpbnZhbGlkIHVzaW5nIGZhbGxiYWNrIFwiICsgZmFsbGJhY2suY3NzKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxsYmFjaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdHguZmlsbFJlY3QoMCwgMCwgMSwgMSk7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5fY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhO1xuICAgICAgICBpZiAoIWFsbG93VHJhbnNwYXJlbmN5ICYmIGRhdGFbM10gIT09IDB4RkYpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkNvbG9yOiBcIiArIGNzcyArIFwiIGlzIHVzaW5nIHRyYW5zcGFyZW5jeSwgYnV0IGFsbG93VHJhbnNwYXJlbmN5IGlzIGZhbHNlLiBcIiArXG4gICAgICAgICAgICAgICAgKFwiVXNpbmcgZmFsbGJhY2sgXCIgKyBmYWxsYmFjay5jc3MgKyBcIi5cIikpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbGxiYWNrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjc3M6IGNzcyxcbiAgICAgICAgICAgIHJnYmE6IChkYXRhWzBdIDw8IDI0IHwgZGF0YVsxXSA8PCAxNiB8IGRhdGFbMl0gPDwgOCB8IGRhdGFbM10pID4+PiAwXG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gQ29sb3JNYW5hZ2VyO1xufSgpKTtcbmV4cG9ydHMuQ29sb3JNYW5hZ2VyID0gQ29sb3JNYW5hZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q29sb3JNYW5hZ2VyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBCdWZmZXJfMSA9IHJlcXVpcmUoXCIuLi9CdWZmZXJcIik7XG52YXIgQmFzZVJlbmRlckxheWVyXzEgPSByZXF1aXJlKFwiLi9CYXNlUmVuZGVyTGF5ZXJcIik7XG52YXIgQkxJTktfSU5URVJWQUwgPSA2MDA7XG52YXIgQ3Vyc29yUmVuZGVyTGF5ZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhDdXJzb3JSZW5kZXJMYXllciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBDdXJzb3JSZW5kZXJMYXllcihjb250YWluZXIsIHpJbmRleCwgY29sb3JzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJ2N1cnNvcicsIHpJbmRleCwgdHJ1ZSwgY29sb3JzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fc3RhdGUgPSB7XG4gICAgICAgICAgICB4OiBudWxsLFxuICAgICAgICAgICAgeTogbnVsbCxcbiAgICAgICAgICAgIGlzRm9jdXNlZDogbnVsbCxcbiAgICAgICAgICAgIHN0eWxlOiBudWxsLFxuICAgICAgICAgICAgd2lkdGg6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMuX2N1cnNvclJlbmRlcmVycyA9IHtcbiAgICAgICAgICAgICdiYXInOiBfdGhpcy5fcmVuZGVyQmFyQ3Vyc29yLmJpbmQoX3RoaXMpLFxuICAgICAgICAgICAgJ2Jsb2NrJzogX3RoaXMuX3JlbmRlckJsb2NrQ3Vyc29yLmJpbmQoX3RoaXMpLFxuICAgICAgICAgICAgJ3VuZGVybGluZSc6IF90aGlzLl9yZW5kZXJVbmRlcmxpbmVDdXJzb3IuYmluZChfdGhpcylcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBDdXJzb3JSZW5kZXJMYXllci5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBkaW0pIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5yZXNpemUuY2FsbCh0aGlzLCB0ZXJtaW5hbCwgZGltKTtcbiAgICAgICAgdGhpcy5fc3RhdGUgPSB7XG4gICAgICAgICAgICB4OiBudWxsLFxuICAgICAgICAgICAgeTogbnVsbCxcbiAgICAgICAgICAgIGlzRm9jdXNlZDogbnVsbCxcbiAgICAgICAgICAgIHN0eWxlOiBudWxsLFxuICAgICAgICAgICAgd2lkdGg6IG51bGxcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl9jbGVhckN1cnNvcigpO1xuICAgICAgICBpZiAodGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMub25PcHRpb25zQ2hhbmdlZCh0ZXJtaW5hbCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5vbkJsdXIgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgaWYgKHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wYXVzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRlcm1pbmFsLnJlZnJlc2godGVybWluYWwuYnVmZmVyLnksIHRlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5vbkZvY3VzID0gZnVuY3Rpb24gKHRlcm1pbmFsKSB7XG4gICAgICAgIGlmICh0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlcikge1xuICAgICAgICAgICAgdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIucmVzdW1lKHRlcm1pbmFsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRlcm1pbmFsLnJlZnJlc2godGVybWluYWwuYnVmZmVyLnksIHRlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHRlcm1pbmFsLm9wdGlvbnMuY3Vyc29yQmxpbmspIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlciA9IG5ldyBDdXJzb3JCbGlua1N0YXRlTWFuYWdlcih0ZXJtaW5hbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fcmVuZGVyKHRlcm1pbmFsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXJtaW5hbC5yZWZyZXNoKHRlcm1pbmFsLmJ1ZmZlci55LCB0ZXJtaW5hbC5idWZmZXIueSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5vbkN1cnNvck1vdmUgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgaWYgKHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlci5yZXN0YXJ0QmxpbmtBbmltYXRpb24odGVybWluYWwpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDdXJzb3JSZW5kZXJMYXllci5wcm90b3R5cGUub25HcmlkQ2hhbmdlZCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgc3RhcnRSb3csIGVuZFJvdykge1xuICAgICAgICBpZiAoIXRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyIHx8IHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLmlzUGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIodGVybWluYWwsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnJlc3RhcnRCbGlua0FuaW1hdGlvbih0ZXJtaW5hbCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24gKHRlcm1pbmFsLCB0cmlnZ2VyZWRCeUFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICAgIGlmICghdGVybWluYWwuY3Vyc29yU3RhdGUgfHwgdGVybWluYWwuY3Vyc29ySGlkZGVuKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhckN1cnNvcigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjdXJzb3JZID0gdGVybWluYWwuYnVmZmVyLnliYXNlICsgdGVybWluYWwuYnVmZmVyLnk7XG4gICAgICAgIHZhciB2aWV3cG9ydFJlbGF0aXZlQ3Vyc29yWSA9IGN1cnNvclkgLSB0ZXJtaW5hbC5idWZmZXIueWRpc3A7XG4gICAgICAgIGlmICh2aWV3cG9ydFJlbGF0aXZlQ3Vyc29yWSA8IDAgfHwgdmlld3BvcnRSZWxhdGl2ZUN1cnNvclkgPj0gdGVybWluYWwucm93cykge1xuICAgICAgICAgICAgdGhpcy5fY2xlYXJDdXJzb3IoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2hhckRhdGEgPSB0ZXJtaW5hbC5idWZmZXIubGluZXMuZ2V0KGN1cnNvclkpLmdldCh0ZXJtaW5hbC5idWZmZXIueCk7XG4gICAgICAgIGlmICghY2hhckRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRlcm1pbmFsLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYXJDdXJzb3IoKTtcbiAgICAgICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmN1cnNvci5jc3M7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJCbHVyQ3Vyc29yKHRlcm1pbmFsLCB0ZXJtaW5hbC5idWZmZXIueCwgdmlld3BvcnRSZWxhdGl2ZUN1cnNvclksIGNoYXJEYXRhKTtcbiAgICAgICAgICAgIHRoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS54ID0gdGVybWluYWwuYnVmZmVyLng7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS55ID0gdmlld3BvcnRSZWxhdGl2ZUN1cnNvclk7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnN0eWxlID0gdGVybWluYWwub3B0aW9ucy5jdXJzb3JTdHlsZTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLndpZHRoID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIgJiYgIXRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLmlzQ3Vyc29yVmlzaWJsZSkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYXJDdXJzb3IoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fc3RhdGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS54ID09PSB0ZXJtaW5hbC5idWZmZXIueCAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLnkgPT09IHZpZXdwb3J0UmVsYXRpdmVDdXJzb3JZICYmXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuaXNGb2N1c2VkID09PSB0ZXJtaW5hbC5pc0ZvY3VzZWQgJiZcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5zdHlsZSA9PT0gdGVybWluYWwub3B0aW9ucy5jdXJzb3JTdHlsZSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLndpZHRoID09PSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY2xlYXJDdXJzb3IoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdHguc2F2ZSgpO1xuICAgICAgICB0aGlzLl9jdXJzb3JSZW5kZXJlcnNbdGVybWluYWwub3B0aW9ucy5jdXJzb3JTdHlsZSB8fCAnYmxvY2snXSh0ZXJtaW5hbCwgdGVybWluYWwuYnVmZmVyLngsIHZpZXdwb3J0UmVsYXRpdmVDdXJzb3JZLCBjaGFyRGF0YSk7XG4gICAgICAgIHRoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgICAgIHRoaXMuX3N0YXRlLnggPSB0ZXJtaW5hbC5idWZmZXIueDtcbiAgICAgICAgdGhpcy5fc3RhdGUueSA9IHZpZXdwb3J0UmVsYXRpdmVDdXJzb3JZO1xuICAgICAgICB0aGlzLl9zdGF0ZS5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fc3RhdGUuc3R5bGUgPSB0ZXJtaW5hbC5vcHRpb25zLmN1cnNvclN0eWxlO1xuICAgICAgICB0aGlzLl9zdGF0ZS53aWR0aCA9IGNoYXJEYXRhW0J1ZmZlcl8xLkNIQVJfREFUQV9XSURUSF9JTkRFWF07XG4gICAgfTtcbiAgICBDdXJzb3JSZW5kZXJMYXllci5wcm90b3R5cGUuX2NsZWFyQ3Vyc29yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJDZWxscyh0aGlzLl9zdGF0ZS54LCB0aGlzLl9zdGF0ZS55LCB0aGlzLl9zdGF0ZS53aWR0aCwgMSk7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IHtcbiAgICAgICAgICAgICAgICB4OiBudWxsLFxuICAgICAgICAgICAgICAgIHk6IG51bGwsXG4gICAgICAgICAgICAgICAgaXNGb2N1c2VkOiBudWxsLFxuICAgICAgICAgICAgICAgIHN0eWxlOiBudWxsLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDdXJzb3JSZW5kZXJMYXllci5wcm90b3R5cGUuX3JlbmRlckJhckN1cnNvciA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgeCwgeSwgY2hhckRhdGEpIHtcbiAgICAgICAgdGhpcy5fY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5jdXJzb3IuY3NzO1xuICAgICAgICB0aGlzLmZpbGxMZWZ0TGluZUF0Q2VsbCh4LCB5KTtcbiAgICAgICAgdGhpcy5fY3R4LnJlc3RvcmUoKTtcbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5fcmVuZGVyQmxvY2tDdXJzb3IgPSBmdW5jdGlvbiAodGVybWluYWwsIHgsIHksIGNoYXJEYXRhKSB7XG4gICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuY3Vyc29yLmNzcztcbiAgICAgICAgdGhpcy5maWxsQ2VsbHMoeCwgeSwgY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSwgMSk7XG4gICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuY3Vyc29yQWNjZW50LmNzcztcbiAgICAgICAgdGhpcy5maWxsQ2hhclRydWVDb2xvcih0ZXJtaW5hbCwgY2hhckRhdGEsIHgsIHkpO1xuICAgICAgICB0aGlzLl9jdHgucmVzdG9yZSgpO1xuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9yZW5kZXJVbmRlcmxpbmVDdXJzb3IgPSBmdW5jdGlvbiAodGVybWluYWwsIHgsIHksIGNoYXJEYXRhKSB7XG4gICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuY3Vyc29yLmNzcztcbiAgICAgICAgdGhpcy5maWxsQm90dG9tTGluZUF0Q2VsbHMoeCwgeSk7XG4gICAgICAgIHRoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgfTtcbiAgICBDdXJzb3JSZW5kZXJMYXllci5wcm90b3R5cGUuX3JlbmRlckJsdXJDdXJzb3IgPSBmdW5jdGlvbiAodGVybWluYWwsIHgsIHksIGNoYXJEYXRhKSB7XG4gICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgIHRoaXMuX2N0eC5zdHJva2VTdHlsZSA9IHRoaXMuX2NvbG9ycy5jdXJzb3IuY3NzO1xuICAgICAgICB0aGlzLnN0cm9rZVJlY3RBdENlbGwoeCwgeSwgY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSwgMSk7XG4gICAgICAgIHRoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgfTtcbiAgICByZXR1cm4gQ3Vyc29yUmVuZGVyTGF5ZXI7XG59KEJhc2VSZW5kZXJMYXllcl8xLkJhc2VSZW5kZXJMYXllcikpO1xuZXhwb3J0cy5DdXJzb3JSZW5kZXJMYXllciA9IEN1cnNvclJlbmRlckxheWVyO1xudmFyIEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDdXJzb3JCbGlua1N0YXRlTWFuYWdlcih0ZXJtaW5hbCwgX3JlbmRlckNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlckNhbGxiYWNrID0gX3JlbmRlckNhbGxiYWNrO1xuICAgICAgICB0aGlzLmlzQ3Vyc29yVmlzaWJsZSA9IHRydWU7XG4gICAgICAgIGlmICh0ZXJtaW5hbC5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc3RhcnRJbnRlcnZhbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wcm90b3R5cGUsIFwiaXNQYXVzZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEodGhpcy5fYmxpbmtTdGFydFRpbWVvdXQgfHwgdGhpcy5fYmxpbmtJbnRlcnZhbCk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fYmxpbmtJbnRlcnZhbCkge1xuICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5fYmxpbmtJbnRlcnZhbCk7XG4gICAgICAgICAgICB0aGlzLl9ibGlua0ludGVydmFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fYmxpbmtTdGFydFRpbWVvdXQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fYmxpbmtTdGFydFRpbWVvdXQpO1xuICAgICAgICAgICAgdGhpcy5fYmxpbmtTdGFydFRpbWVvdXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2FuaW1hdGlvbkZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIucHJvdG90eXBlLnJlc3RhcnRCbGlua0FuaW1hdGlvbiA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5pc1BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvblRpbWVSZXN0YXJ0ZWQgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmlzQ3Vyc29yVmlzaWJsZSA9IHRydWU7XG4gICAgICAgIGlmICghdGhpcy5fYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbmRlckNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wcm90b3R5cGUuX3Jlc3RhcnRJbnRlcnZhbCA9IGZ1bmN0aW9uICh0aW1lVG9TdGFydCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGltZVRvU3RhcnQgPT09IHZvaWQgMCkgeyB0aW1lVG9TdGFydCA9IEJMSU5LX0lOVEVSVkFMOyB9XG4gICAgICAgIGlmICh0aGlzLl9ibGlua0ludGVydmFsKSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLl9ibGlua0ludGVydmFsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9ibGlua1N0YXJ0VGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBCTElOS19JTlRFUlZBTCAtIChEYXRlLm5vdygpIC0gX3RoaXMuX2FuaW1hdGlvblRpbWVSZXN0YXJ0ZWQpO1xuICAgICAgICAgICAgICAgIF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAodGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3Jlc3RhcnRJbnRlcnZhbCh0aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmlzQ3Vyc29yVmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbmRlckNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgX3RoaXMuX2JsaW5rSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lID0gQkxJTktfSU5URVJWQUwgLSAoRGF0ZS5ub3coKSAtIF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvblRpbWVSZXN0YXJ0ZWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fcmVzdGFydEludGVydmFsKHRpbWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLmlzQ3Vyc29yVmlzaWJsZSA9ICFfdGhpcy5pc0N1cnNvclZpc2libGU7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9yZW5kZXJDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgQkxJTktfSU5URVJWQUwpO1xuICAgICAgICB9LCB0aW1lVG9TdGFydCk7XG4gICAgfTtcbiAgICBDdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaXNDdXJzb3JWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2JsaW5rSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX2JsaW5rSW50ZXJ2YWwpO1xuICAgICAgICAgICAgdGhpcy5fYmxpbmtJbnRlcnZhbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2JsaW5rU3RhcnRUaW1lb3V0KSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuX2JsaW5rU3RhcnRUaW1lb3V0KTtcbiAgICAgICAgICAgIHRoaXMuX2JsaW5rU3RhcnRUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRpb25GcmFtZSk7XG4gICAgICAgICAgICB0aGlzLl9hbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uVGltZVJlc3RhcnRlZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX3Jlc3RhcnRJbnRlcnZhbCgpO1xuICAgICAgICB0aGlzLnJlc3RhcnRCbGlua0FuaW1hdGlvbih0ZXJtaW5hbCk7XG4gICAgfTtcbiAgICByZXR1cm4gQ3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXI7XG59KCkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q3Vyc29yUmVuZGVyTGF5ZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgR3JpZENhY2hlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBHcmlkQ2FjaGUoKSB7XG4gICAgICAgIHRoaXMuY2FjaGUgPSBbXTtcbiAgICB9XG4gICAgR3JpZENhY2hlLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNhY2hlLmxlbmd0aCA8PSB4KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5wdXNoKFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIHkgPSB0aGlzLmNhY2hlW3hdLmxlbmd0aDsgeSA8IGhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZVt4XS5wdXNoKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jYWNoZVt4XS5sZW5ndGggPSBoZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWNoZS5sZW5ndGggPSB3aWR0aDtcbiAgICB9O1xuICAgIEdyaWRDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5jYWNoZS5sZW5ndGg7IHgrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmNhY2hlW3hdLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZVt4XVt5XSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBHcmlkQ2FjaGU7XG59KCkpO1xuZXhwb3J0cy5HcmlkQ2FjaGUgPSBHcmlkQ2FjaGU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1HcmlkQ2FjaGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJhc2VSZW5kZXJMYXllcl8xID0gcmVxdWlyZShcIi4vQmFzZVJlbmRlckxheWVyXCIpO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi9hdGxhcy9UeXBlc1wiKTtcbnZhciBDaGFyQXRsYXNVdGlsc18xID0gcmVxdWlyZShcIi4vYXRsYXMvQ2hhckF0bGFzVXRpbHNcIik7XG52YXIgTGlua1JlbmRlckxheWVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGlua1JlbmRlckxheWVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExpbmtSZW5kZXJMYXllcihjb250YWluZXIsIHpJbmRleCwgY29sb3JzLCB0ZXJtaW5hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBjb250YWluZXIsICdsaW5rJywgekluZGV4LCB0cnVlLCBjb2xvcnMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9zdGF0ZSA9IG51bGw7XG4gICAgICAgIHRlcm1pbmFsLmxpbmtpZmllci5vbihcImxpbmtob3ZlclwiLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX29uTGlua0hvdmVyKGUpOyB9KTtcbiAgICAgICAgdGVybWluYWwubGlua2lmaWVyLm9uKFwibGlua2xlYXZlXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25MaW5rTGVhdmUoZSk7IH0pO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIExpbmtSZW5kZXJMYXllci5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBkaW0pIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5yZXNpemUuY2FsbCh0aGlzLCB0ZXJtaW5hbCwgZGltKTtcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBudWxsO1xuICAgIH07XG4gICAgTGlua1JlbmRlckxheWVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl9jbGVhckN1cnJlbnRMaW5rKCk7XG4gICAgfTtcbiAgICBMaW5rUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9jbGVhckN1cnJlbnRMaW5rID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJDZWxscyh0aGlzLl9zdGF0ZS54MSwgdGhpcy5fc3RhdGUueTEsIHRoaXMuX3N0YXRlLmNvbHMgLSB0aGlzLl9zdGF0ZS54MSwgMSk7XG4gICAgICAgICAgICB2YXIgbWlkZGxlUm93Q291bnQgPSB0aGlzLl9zdGF0ZS55MiAtIHRoaXMuX3N0YXRlLnkxIC0gMTtcbiAgICAgICAgICAgIGlmIChtaWRkbGVSb3dDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbHMoMCwgdGhpcy5fc3RhdGUueTEgKyAxLCB0aGlzLl9zdGF0ZS5jb2xzLCBtaWRkbGVSb3dDb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbHMoMCwgdGhpcy5fc3RhdGUueTIsIHRoaXMuX3N0YXRlLngyLCAxKTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTGlua1JlbmRlckxheWVyLnByb3RvdHlwZS5fb25MaW5rSG92ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoZS5mZyA9PT0gVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmJhY2tncm91bmQuY3NzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKENoYXJBdGxhc1V0aWxzXzEuaXMyNTZDb2xvcihlLmZnKSkge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5hbnNpW2UuZmddLmNzcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuZm9yZWdyb3VuZC5jc3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUueTEgPT09IGUueTIpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsbEJvdHRvbUxpbmVBdENlbGxzKGUueDEsIGUueTEsIGUueDIgLSBlLngxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmlsbEJvdHRvbUxpbmVBdENlbGxzKGUueDEsIGUueTEsIGUuY29scyAtIGUueDEpO1xuICAgICAgICAgICAgZm9yICh2YXIgeSA9IGUueTEgKyAxOyB5IDwgZS55MjsgeSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxsQm90dG9tTGluZUF0Q2VsbHMoMCwgeSwgZS5jb2xzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZmlsbEJvdHRvbUxpbmVBdENlbGxzKDAsIGUueTIsIGUueDIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXRlID0gZTtcbiAgICB9O1xuICAgIExpbmtSZW5kZXJMYXllci5wcm90b3R5cGUuX29uTGlua0xlYXZlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy5fY2xlYXJDdXJyZW50TGluaygpO1xuICAgIH07XG4gICAgcmV0dXJuIExpbmtSZW5kZXJMYXllcjtcbn0oQmFzZVJlbmRlckxheWVyXzEuQmFzZVJlbmRlckxheWVyKSk7XG5leHBvcnRzLkxpbmtSZW5kZXJMYXllciA9IExpbmtSZW5kZXJMYXllcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxpbmtSZW5kZXJMYXllci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgVGV4dFJlbmRlckxheWVyXzEgPSByZXF1aXJlKFwiLi9UZXh0UmVuZGVyTGF5ZXJcIik7XG52YXIgU2VsZWN0aW9uUmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL1NlbGVjdGlvblJlbmRlckxheWVyXCIpO1xudmFyIEN1cnNvclJlbmRlckxheWVyXzEgPSByZXF1aXJlKFwiLi9DdXJzb3JSZW5kZXJMYXllclwiKTtcbnZhciBDb2xvck1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuL0NvbG9yTWFuYWdlclwiKTtcbnZhciBMaW5rUmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0xpbmtSZW5kZXJMYXllclwiKTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vRXZlbnRFbWl0dGVyXCIpO1xudmFyIFJlbmRlckRlYm91bmNlcl8xID0gcmVxdWlyZShcIi4uL3VpL1JlbmRlckRlYm91bmNlclwiKTtcbnZhciBTY3JlZW5EcHJNb25pdG9yXzEgPSByZXF1aXJlKFwiLi4vdWkvU2NyZWVuRHByTW9uaXRvclwiKTtcbnZhciBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4uL3JlbmRlcmVyL0NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5XCIpO1xudmFyIFJlbmRlcmVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUmVuZGVyZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUmVuZGVyZXIoX3Rlcm1pbmFsLCB0aGVtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIF90aGlzLl9pc1BhdXNlZCA9IGZhbHNlO1xuICAgICAgICBfdGhpcy5fbmVlZHNGdWxsUmVmcmVzaCA9IGZhbHNlO1xuICAgICAgICB2YXIgYWxsb3dUcmFuc3BhcmVuY3kgPSBfdGhpcy5fdGVybWluYWwub3B0aW9ucy5hbGxvd1RyYW5zcGFyZW5jeTtcbiAgICAgICAgX3RoaXMuY29sb3JNYW5hZ2VyID0gbmV3IENvbG9yTWFuYWdlcl8xLkNvbG9yTWFuYWdlcihkb2N1bWVudCwgYWxsb3dUcmFuc3BhcmVuY3kpO1xuICAgICAgICBfdGhpcy5fY2hhcmFjdGVySm9pbmVyUmVnaXN0cnkgPSBuZXcgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnlfMS5DaGFyYWN0ZXJKb2luZXJSZWdpc3RyeShfdGVybWluYWwpO1xuICAgICAgICBpZiAodGhlbWUpIHtcbiAgICAgICAgICAgIF90aGlzLmNvbG9yTWFuYWdlci5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgIH1cbiAgICAgICAgX3RoaXMuX3JlbmRlckxheWVycyA9IFtcbiAgICAgICAgICAgIG5ldyBUZXh0UmVuZGVyTGF5ZXJfMS5UZXh0UmVuZGVyTGF5ZXIoX3RoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQsIDAsIF90aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMsIF90aGlzLl9jaGFyYWN0ZXJKb2luZXJSZWdpc3RyeSwgYWxsb3dUcmFuc3BhcmVuY3kpLFxuICAgICAgICAgICAgbmV3IFNlbGVjdGlvblJlbmRlckxheWVyXzEuU2VsZWN0aW9uUmVuZGVyTGF5ZXIoX3RoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQsIDEsIF90aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMpLFxuICAgICAgICAgICAgbmV3IExpbmtSZW5kZXJMYXllcl8xLkxpbmtSZW5kZXJMYXllcihfdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudCwgMiwgX3RoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycywgX3RoaXMuX3Rlcm1pbmFsKSxcbiAgICAgICAgICAgIG5ldyBDdXJzb3JSZW5kZXJMYXllcl8xLkN1cnNvclJlbmRlckxheWVyKF90aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LCAzLCBfdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzKVxuICAgICAgICBdO1xuICAgICAgICBfdGhpcy5kaW1lbnNpb25zID0ge1xuICAgICAgICAgICAgc2NhbGVkQ2hhcldpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2hhckhlaWdodDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENlbGxXaWR0aDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENlbGxIZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICBzY2FsZWRDaGFyTGVmdDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENoYXJUb3A6IG51bGwsXG4gICAgICAgICAgICBzY2FsZWRDYW52YXNXaWR0aDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENhbnZhc0hlaWdodDogbnVsbCxcbiAgICAgICAgICAgIGNhbnZhc1dpZHRoOiBudWxsLFxuICAgICAgICAgICAgY2FudmFzSGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgYWN0dWFsQ2VsbFdpZHRoOiBudWxsLFxuICAgICAgICAgICAgYWN0dWFsQ2VsbEhlaWdodDogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICBfdGhpcy5fdXBkYXRlRGltZW5zaW9ucygpO1xuICAgICAgICBfdGhpcy5vbk9wdGlvbnNDaGFuZ2VkKCk7XG4gICAgICAgIF90aGlzLl9yZW5kZXJEZWJvdW5jZXIgPSBuZXcgUmVuZGVyRGVib3VuY2VyXzEuUmVuZGVyRGVib3VuY2VyKF90aGlzLl90ZXJtaW5hbCwgX3RoaXMuX3JlbmRlclJvd3MuYmluZChfdGhpcykpO1xuICAgICAgICBfdGhpcy5fc2NyZWVuRHByTW9uaXRvciA9IG5ldyBTY3JlZW5EcHJNb25pdG9yXzEuU2NyZWVuRHByTW9uaXRvcigpO1xuICAgICAgICBfdGhpcy5fc2NyZWVuRHByTW9uaXRvci5zZXRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5vbldpbmRvd1Jlc2l6ZSh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7IH0pO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fc2NyZWVuRHByTW9uaXRvcik7XG4gICAgICAgIGlmICgnSW50ZXJzZWN0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xuICAgICAgICAgICAgdmFyIG9ic2VydmVyXzEgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLm9uSW50ZXJzZWN0aW9uQ2hhbmdlKGVbMF0pOyB9LCB7IHRocmVzaG9sZDogMCB9KTtcbiAgICAgICAgICAgIG9ic2VydmVyXzEub2JzZXJ2ZShfdGhpcy5fdGVybWluYWwuZWxlbWVudCk7XG4gICAgICAgICAgICBfdGhpcy5yZWdpc3Rlcih7IGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9ic2VydmVyXzEuZGlzY29ubmVjdCgpOyB9IH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLl9yZW5kZXJMYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5kaXNwb3NlKCk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uSW50ZXJzZWN0aW9uQ2hhbmdlID0gZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgIHRoaXMuX2lzUGF1c2VkID0gZW50cnkuaW50ZXJzZWN0aW9uUmF0aW8gPT09IDA7XG4gICAgICAgIGlmICghdGhpcy5faXNQYXVzZWQgJiYgdGhpcy5fbmVlZHNGdWxsUmVmcmVzaCkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwucmVmcmVzaCgwLCB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5vbldpbmRvd1Jlc2l6ZSA9IGZ1bmN0aW9uIChkZXZpY2VQaXhlbFJhdGlvKSB7XG4gICAgICAgIGlmICh0aGlzLl9kZXZpY2VQaXhlbFJhdGlvICE9PSBkZXZpY2VQaXhlbFJhdGlvKSB7XG4gICAgICAgICAgICB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvID0gZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgICAgIHRoaXMub25SZXNpemUodGhpcy5fdGVybWluYWwuY29scywgdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5zZXRUaGVtZSA9IGZ1bmN0aW9uICh0aGVtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmNvbG9yTWFuYWdlci5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgIHRoaXMuX3JlbmRlckxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgICAgICBsLm9uVGhlbWVDaGFuZ2VkKF90aGlzLl90ZXJtaW5hbCwgX3RoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycyk7XG4gICAgICAgICAgICBsLnJlc2V0KF90aGlzLl90ZXJtaW5hbCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5faXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX25lZWRzRnVsbFJlZnJlc2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwucmVmcmVzaCgwLCB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycztcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uIChjb2xzLCByb3dzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURpbWVuc2lvbnMoKTtcbiAgICAgICAgdGhpcy5fcmVuZGVyTGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwucmVzaXplKF90aGlzLl90ZXJtaW5hbCwgX3RoaXMuZGltZW5zaW9ucyk7IH0pO1xuICAgICAgICBpZiAodGhpcy5faXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX25lZWRzRnVsbFJlZnJlc2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwucmVmcmVzaCgwLCB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMuZGltZW5zaW9ucy5jYW52YXNXaWR0aCArIFwicHhcIjtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLmRpbWVuc2lvbnMuY2FudmFzSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICB0aGlzLmVtaXQoJ3Jlc2l6ZScsIHtcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmRpbWVuc2lvbnMuY2FudmFzV2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHRcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUub25DaGFyU2l6ZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub25SZXNpemUodGhpcy5fdGVybWluYWwuY29scywgdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUub25CbHVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9ydW5PcGVyYXRpb24oZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwub25CbHVyKF90aGlzLl90ZXJtaW5hbCk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3J1bk9wZXJhdGlvbihmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5vbkZvY3VzKF90aGlzLl90ZXJtaW5hbCk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uU2VsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBjb2x1bW5TZWxlY3RNb2RlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChjb2x1bW5TZWxlY3RNb2RlID09PSB2b2lkIDApIHsgY29sdW1uU2VsZWN0TW9kZSA9IGZhbHNlOyB9XG4gICAgICAgIHRoaXMuX3J1bk9wZXJhdGlvbihmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5vblNlbGVjdGlvbkNoYW5nZWQoX3RoaXMuX3Rlcm1pbmFsLCBzdGFydCwgZW5kLCBjb2x1bW5TZWxlY3RNb2RlKTsgfSk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUub25DdXJzb3JNb3ZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9ydW5PcGVyYXRpb24oZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwub25DdXJzb3JNb3ZlKF90aGlzLl90ZXJtaW5hbCk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuY29sb3JNYW5hZ2VyLmFsbG93VHJhbnNwYXJlbmN5ID0gdGhpcy5fdGVybWluYWwub3B0aW9ucy5hbGxvd1RyYW5zcGFyZW5jeTtcbiAgICAgICAgdGhpcy5fcnVuT3BlcmF0aW9uKGZ1bmN0aW9uIChsKSB7IHJldHVybiBsLm9uT3B0aW9uc0NoYW5nZWQoX3RoaXMuX3Rlcm1pbmFsKTsgfSk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3J1bk9wZXJhdGlvbihmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5yZXNldChfdGhpcy5fdGVybWluYWwpOyB9KTtcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5fcnVuT3BlcmF0aW9uID0gZnVuY3Rpb24gKG9wZXJhdGlvbikge1xuICAgICAgICBpZiAodGhpcy5faXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX25lZWRzRnVsbFJlZnJlc2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyTGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGwpIHsgcmV0dXJuIG9wZXJhdGlvbihsKTsgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5yZWZyZXNoUm93cyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc1BhdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5fbmVlZHNGdWxsUmVmcmVzaCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVuZGVyRGVib3VuY2VyLnJlZnJlc2goc3RhcnQsIGVuZCk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUuX3JlbmRlclJvd3MgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9yZW5kZXJMYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5vbkdyaWRDaGFuZ2VkKF90aGlzLl90ZXJtaW5hbCwgc3RhcnQsIGVuZCk7IH0pO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbWl0KCdyZWZyZXNoJywgeyBzdGFydDogc3RhcnQsIGVuZDogZW5kIH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLl91cGRhdGVEaW1lbnNpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLndpZHRoIHx8ICF0aGlzLl90ZXJtaW5hbC5jaGFyTWVhc3VyZS5oZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhcldpZHRoID0gTWF0aC5mbG9vcih0aGlzLl90ZXJtaW5hbC5jaGFyTWVhc3VyZS53aWR0aCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJIZWlnaHQgPSBNYXRoLmNlaWwodGhpcy5fdGVybWluYWwuY2hhck1lYXN1cmUuaGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbEhlaWdodCA9IE1hdGguZmxvb3IodGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJIZWlnaHQgKiB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmxpbmVIZWlnaHQpO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhclRvcCA9IHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMubGluZUhlaWdodCA9PT0gMSA/IDAgOiBNYXRoLnJvdW5kKCh0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbEhlaWdodCAtIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDaGFySGVpZ2h0KSAvIDIpO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbFdpZHRoID0gdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJXaWR0aCArIE1hdGgucm91bmQodGhpcy5fdGVybWluYWwub3B0aW9ucy5sZXR0ZXJTcGFjaW5nKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJMZWZ0ID0gTWF0aC5mbG9vcih0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmxldHRlclNwYWNpbmcgLyAyKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENhbnZhc0hlaWdodCA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgKiB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbEhlaWdodDtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENhbnZhc1dpZHRoID0gdGhpcy5fdGVybWluYWwuY29scyAqIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsV2lkdGg7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHQgPSBNYXRoLnJvdW5kKHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDYW52YXNIZWlnaHQgLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5jYW52YXNXaWR0aCA9IE1hdGgucm91bmQodGhpcy5kaW1lbnNpb25zLnNjYWxlZENhbnZhc1dpZHRoIC8gd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbEhlaWdodCA9IHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHQgLyB0aGlzLl90ZXJtaW5hbC5yb3dzO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoID0gdGhpcy5kaW1lbnNpb25zLmNhbnZhc1dpZHRoIC8gdGhpcy5fdGVybWluYWwuY29scztcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5yZWdpc3RlckNoYXJhY3RlckpvaW5lciA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5yZWdpc3RlckNoYXJhY3RlckpvaW5lcihoYW5kbGVyKTtcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGpvaW5lcklkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyKGpvaW5lcklkKTtcbiAgICB9O1xuICAgIHJldHVybiBSZW5kZXJlcjtcbn0oRXZlbnRFbWl0dGVyXzEuRXZlbnRFbWl0dGVyKSk7XG5leHBvcnRzLlJlbmRlcmVyID0gUmVuZGVyZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1SZW5kZXJlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQmFzZVJlbmRlckxheWVyXzEgPSByZXF1aXJlKFwiLi9CYXNlUmVuZGVyTGF5ZXJcIik7XG52YXIgU2VsZWN0aW9uUmVuZGVyTGF5ZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTZWxlY3Rpb25SZW5kZXJMYXllciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBTZWxlY3Rpb25SZW5kZXJMYXllcihjb250YWluZXIsIHpJbmRleCwgY29sb3JzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJ3NlbGVjdGlvbicsIHpJbmRleCwgdHJ1ZSwgY29sb3JzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fY2xlYXJTdGF0ZSgpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFNlbGVjdGlvblJlbmRlckxheWVyLnByb3RvdHlwZS5fY2xlYXJTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUgPSB7XG4gICAgICAgICAgICBzdGFydDogbnVsbCxcbiAgICAgICAgICAgIGVuZDogbnVsbCxcbiAgICAgICAgICAgIGNvbHVtblNlbGVjdE1vZGU6IG51bGwsXG4gICAgICAgICAgICB5ZGlzcDogbnVsbFxuICAgICAgICB9O1xuICAgIH07XG4gICAgU2VsZWN0aW9uUmVuZGVyTGF5ZXIucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgZGltKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucmVzaXplLmNhbGwodGhpcywgdGVybWluYWwsIGRpbSk7XG4gICAgICAgIHRoaXMuX2NsZWFyU3RhdGUoKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvblJlbmRlckxheWVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc3RhcnQgJiYgdGhpcy5fc3RhdGUuZW5kKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhclN0YXRlKCk7XG4gICAgICAgICAgICB0aGlzLmNsZWFyQWxsKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvblJlbmRlckxheWVyLnByb3RvdHlwZS5vblNlbGVjdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwsIHN0YXJ0LCBlbmQsIGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9kaWRTdGF0ZUNoYW5nZShzdGFydCwgZW5kLCBjb2x1bW5TZWxlY3RNb2RlLCB0ZXJtaW5hbC5idWZmZXIueWRpc3ApKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGVhckFsbCgpO1xuICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdmlld3BvcnRTdGFydFJvdyA9IHN0YXJ0WzFdIC0gdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgICAgICB2YXIgdmlld3BvcnRFbmRSb3cgPSBlbmRbMV0gLSB0ZXJtaW5hbC5idWZmZXIueWRpc3A7XG4gICAgICAgIHZhciB2aWV3cG9ydENhcHBlZFN0YXJ0Um93ID0gTWF0aC5tYXgodmlld3BvcnRTdGFydFJvdywgMCk7XG4gICAgICAgIHZhciB2aWV3cG9ydENhcHBlZEVuZFJvdyA9IE1hdGgubWluKHZpZXdwb3J0RW5kUm93LCB0ZXJtaW5hbC5yb3dzIC0gMSk7XG4gICAgICAgIGlmICh2aWV3cG9ydENhcHBlZFN0YXJ0Um93ID49IHRlcm1pbmFsLnJvd3MgfHwgdmlld3BvcnRDYXBwZWRFbmRSb3cgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5zZWxlY3Rpb24uY3NzO1xuICAgICAgICBpZiAoY29sdW1uU2VsZWN0TW9kZSkge1xuICAgICAgICAgICAgdmFyIHN0YXJ0Q29sID0gc3RhcnRbMF07XG4gICAgICAgICAgICB2YXIgd2lkdGggPSBlbmRbMF0gLSBzdGFydENvbDtcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB2aWV3cG9ydENhcHBlZEVuZFJvdyAtIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgKyAxO1xuICAgICAgICAgICAgdGhpcy5maWxsQ2VsbHMoc3RhcnRDb2wsIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3csIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHN0YXJ0Q29sID0gdmlld3BvcnRTdGFydFJvdyA9PT0gdmlld3BvcnRDYXBwZWRTdGFydFJvdyA/IHN0YXJ0WzBdIDogMDtcbiAgICAgICAgICAgIHZhciBzdGFydFJvd0VuZENvbCA9IHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPT09IHZpZXdwb3J0Q2FwcGVkRW5kUm93ID8gZW5kWzBdIDogdGVybWluYWwuY29scztcbiAgICAgICAgICAgIHRoaXMuZmlsbENlbGxzKHN0YXJ0Q29sLCB2aWV3cG9ydENhcHBlZFN0YXJ0Um93LCBzdGFydFJvd0VuZENvbCAtIHN0YXJ0Q29sLCAxKTtcbiAgICAgICAgICAgIHZhciBtaWRkbGVSb3dzQ291bnQgPSBNYXRoLm1heCh2aWV3cG9ydENhcHBlZEVuZFJvdyAtIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgLSAxLCAwKTtcbiAgICAgICAgICAgIHRoaXMuZmlsbENlbGxzKDAsIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgKyAxLCB0ZXJtaW5hbC5jb2xzLCBtaWRkbGVSb3dzQ291bnQpO1xuICAgICAgICAgICAgaWYgKHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgIT09IHZpZXdwb3J0Q2FwcGVkRW5kUm93KSB7XG4gICAgICAgICAgICAgICAgdmFyIGVuZENvbCA9IHZpZXdwb3J0RW5kUm93ID09PSB2aWV3cG9ydENhcHBlZEVuZFJvdyA/IGVuZFswXSA6IHRlcm1pbmFsLmNvbHM7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxsQ2VsbHMoMCwgdmlld3BvcnRDYXBwZWRFbmRSb3csIGVuZENvbCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc3RhdGUuc3RhcnQgPSBbc3RhcnRbMF0sIHN0YXJ0WzFdXTtcbiAgICAgICAgdGhpcy5fc3RhdGUuZW5kID0gW2VuZFswXSwgZW5kWzFdXTtcbiAgICAgICAgdGhpcy5fc3RhdGUuY29sdW1uU2VsZWN0TW9kZSA9IGNvbHVtblNlbGVjdE1vZGU7XG4gICAgICAgIHRoaXMuX3N0YXRlLnlkaXNwID0gdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgIH07XG4gICAgU2VsZWN0aW9uUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9kaWRTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBjb2x1bW5TZWxlY3RNb2RlLCB5ZGlzcCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuX2FyZUNvb3JkaW5hdGVzRXF1YWwoc3RhcnQsIHRoaXMuX3N0YXRlLnN0YXJ0KSB8fFxuICAgICAgICAgICAgIXRoaXMuX2FyZUNvb3JkaW5hdGVzRXF1YWwoZW5kLCB0aGlzLl9zdGF0ZS5lbmQpIHx8XG4gICAgICAgICAgICBjb2x1bW5TZWxlY3RNb2RlICE9PSB0aGlzLl9zdGF0ZS5jb2x1bW5TZWxlY3RNb2RlIHx8XG4gICAgICAgICAgICB5ZGlzcCAhPT0gdGhpcy5fc3RhdGUueWRpc3A7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25SZW5kZXJMYXllci5wcm90b3R5cGUuX2FyZUNvb3JkaW5hdGVzRXF1YWwgPSBmdW5jdGlvbiAoY29vcmQxLCBjb29yZDIpIHtcbiAgICAgICAgaWYgKCFjb29yZDEgfHwgIWNvb3JkMikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb29yZDFbMF0gPT09IGNvb3JkMlswXSAmJiBjb29yZDFbMV0gPT09IGNvb3JkMlsxXTtcbiAgICB9O1xuICAgIHJldHVybiBTZWxlY3Rpb25SZW5kZXJMYXllcjtcbn0oQmFzZVJlbmRlckxheWVyXzEuQmFzZVJlbmRlckxheWVyKSk7XG5leHBvcnRzLlNlbGVjdGlvblJlbmRlckxheWVyID0gU2VsZWN0aW9uUmVuZGVyTGF5ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1TZWxlY3Rpb25SZW5kZXJMYXllci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQnVmZmVyXzEgPSByZXF1aXJlKFwiLi4vQnVmZmVyXCIpO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi9hdGxhcy9UeXBlc1wiKTtcbnZhciBHcmlkQ2FjaGVfMSA9IHJlcXVpcmUoXCIuL0dyaWRDYWNoZVwiKTtcbnZhciBCYXNlUmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0Jhc2VSZW5kZXJMYXllclwiKTtcbnZhciBDaGFyQXRsYXNVdGlsc18xID0gcmVxdWlyZShcIi4vYXRsYXMvQ2hhckF0bGFzVXRpbHNcIik7XG52YXIgVGV4dFJlbmRlckxheWVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGV4dFJlbmRlckxheWVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRleHRSZW5kZXJMYXllcihjb250YWluZXIsIHpJbmRleCwgY29sb3JzLCBjaGFyYWN0ZXJKb2luZXJSZWdpc3RyeSwgYWxwaGEpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgY29udGFpbmVyLCAndGV4dCcsIHpJbmRleCwgYWxwaGEsIGNvbG9ycykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2NoYXJhY3Rlck92ZXJsYXBDYWNoZSA9IHt9O1xuICAgICAgICBfdGhpcy5fc3RhdGUgPSBuZXcgR3JpZENhY2hlXzEuR3JpZENhY2hlKCk7XG4gICAgICAgIF90aGlzLl9jaGFyYWN0ZXJKb2luZXJSZWdpc3RyeSA9IGNoYXJhY3RlckpvaW5lclJlZ2lzdHJ5O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFRleHRSZW5kZXJMYXllci5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBkaW0pIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5yZXNpemUuY2FsbCh0aGlzLCB0ZXJtaW5hbCwgZGltKTtcbiAgICAgICAgdmFyIHRlcm1pbmFsRm9udCA9IHRoaXMuX2dldEZvbnQodGVybWluYWwsIGZhbHNlLCBmYWxzZSk7XG4gICAgICAgIGlmICh0aGlzLl9jaGFyYWN0ZXJXaWR0aCAhPT0gZGltLnNjYWxlZENoYXJXaWR0aCB8fCB0aGlzLl9jaGFyYWN0ZXJGb250ICE9PSB0ZXJtaW5hbEZvbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlcldpZHRoID0gZGltLnNjYWxlZENoYXJXaWR0aDtcbiAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlckZvbnQgPSB0ZXJtaW5hbEZvbnQ7XG4gICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJPdmVybGFwQ2FjaGUgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdGF0ZS5jbGVhcigpO1xuICAgICAgICB0aGlzLl9zdGF0ZS5yZXNpemUodGVybWluYWwuY29scywgdGVybWluYWwucm93cyk7XG4gICAgfTtcbiAgICBUZXh0UmVuZGVyTGF5ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKHRlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX3N0YXRlLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuY2xlYXJBbGwoKTtcbiAgICB9O1xuICAgIFRleHRSZW5kZXJMYXllci5wcm90b3R5cGUuX2ZvckVhY2hDZWxsID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBmaXJzdFJvdywgbGFzdFJvdywgam9pbmVyUmVnaXN0cnksIGNhbGxiYWNrKSB7XG4gICAgICAgIGZvciAodmFyIHkgPSBmaXJzdFJvdzsgeSA8PSBsYXN0Um93OyB5KyspIHtcbiAgICAgICAgICAgIHZhciByb3cgPSB5ICsgdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgICAgICAgICAgdmFyIGxpbmUgPSB0ZXJtaW5hbC5idWZmZXIubGluZXMuZ2V0KHJvdyk7XG4gICAgICAgICAgICB2YXIgam9pbmVkUmFuZ2VzID0gam9pbmVyUmVnaXN0cnkgPyBqb2luZXJSZWdpc3RyeS5nZXRKb2luZWRDaGFyYWN0ZXJzKHJvdykgOiBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGVybWluYWwuY29sczsgeCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoYXJEYXRhID0gbGluZS5nZXQoeCk7XG4gICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfQ09ERV9JTkRFWF07XG4gICAgICAgICAgICAgICAgdmFyIGNoYXJzID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdO1xuICAgICAgICAgICAgICAgIHZhciBhdHRyID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX0FUVFJfSU5ERVhdO1xuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGNoYXJEYXRhW0J1ZmZlcl8xLkNIQVJfREFUQV9XSURUSF9JTkRFWF07XG4gICAgICAgICAgICAgICAgdmFyIGlzSm9pbmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIGxhc3RDaGFyWCA9IHg7XG4gICAgICAgICAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoam9pbmVkUmFuZ2VzLmxlbmd0aCA+IDAgJiYgeCA9PT0gam9pbmVkUmFuZ2VzWzBdWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzSm9pbmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gam9pbmVkUmFuZ2VzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNoYXJzID0gdGVybWluYWwuYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhyb3csIHRydWUsIHJhbmdlWzBdLCByYW5nZVsxXSk7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoID0gcmFuZ2VbMV0gLSByYW5nZVswXTtcbiAgICAgICAgICAgICAgICAgICAgY29kZSA9IEluZmluaXR5O1xuICAgICAgICAgICAgICAgICAgICBsYXN0Q2hhclggPSByYW5nZVsxXSAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghaXNKb2luZWQgJiYgdGhpcy5faXNPdmVybGFwcGluZyhjaGFyRGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RDaGFyWCA8IGxpbmUubGVuZ3RoIC0gMSAmJiBsaW5lLmdldChsYXN0Q2hhclggKyAxKVtCdWZmZXJfMS5DSEFSX0RBVEFfQ09ERV9JTkRFWF0gPT09IEJ1ZmZlcl8xLk5VTExfQ0VMTF9DT0RFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IDI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGZsYWdzID0gYXR0ciA+PiAxODtcbiAgICAgICAgICAgICAgICB2YXIgYmcgPSBhdHRyICYgMHgxZmY7XG4gICAgICAgICAgICAgICAgdmFyIGZnID0gKGF0dHIgPj4gOSkgJiAweDFmZjtcbiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgJiA4KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gYmc7XG4gICAgICAgICAgICAgICAgICAgIGJnID0gZmc7XG4gICAgICAgICAgICAgICAgICAgIGZnID0gdGVtcDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZnID09PSBUeXBlc18xLkRFRkFVTFRfQ09MT1IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZnID0gVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChiZyA9PT0gVHlwZXNfMS5ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiZyA9IFR5cGVzXzEuSU5WRVJURURfREVGQVVMVF9DT0xPUjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhjb2RlLCBjaGFycywgd2lkdGgsIHgsIHksIGZnLCBiZywgZmxhZ3MpO1xuICAgICAgICAgICAgICAgIHggPSBsYXN0Q2hhclg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRleHRSZW5kZXJMYXllci5wcm90b3R5cGUuX2RyYXdCYWNrZ3JvdW5kID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBmaXJzdFJvdywgbGFzdFJvdykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5fY3R4O1xuICAgICAgICB2YXIgY29scyA9IHRlcm1pbmFsLmNvbHM7XG4gICAgICAgIHZhciBzdGFydFggPSAwO1xuICAgICAgICB2YXIgc3RhcnRZID0gMDtcbiAgICAgICAgdmFyIHByZXZGaWxsU3R5bGUgPSBudWxsO1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICB0aGlzLl9mb3JFYWNoQ2VsbCh0ZXJtaW5hbCwgZmlyc3RSb3csIGxhc3RSb3csIG51bGwsIGZ1bmN0aW9uIChjb2RlLCBjaGFycywgd2lkdGgsIHgsIHksIGZnLCBiZywgZmxhZ3MpIHtcbiAgICAgICAgICAgIHZhciBuZXh0RmlsbFN0eWxlID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChiZyA9PT0gVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICAgICAgbmV4dEZpbGxTdHlsZSA9IF90aGlzLl9jb2xvcnMuZm9yZWdyb3VuZC5jc3M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChDaGFyQXRsYXNVdGlsc18xLmlzMjU2Q29sb3IoYmcpKSB7XG4gICAgICAgICAgICAgICAgbmV4dEZpbGxTdHlsZSA9IF90aGlzLl9jb2xvcnMuYW5zaVtiZ10uY3NzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByZXZGaWxsU3R5bGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBzdGFydFggPSB4O1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoeSAhPT0gc3RhcnRZKSB7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHByZXZGaWxsU3R5bGU7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlsbENlbGxzKHN0YXJ0WCwgc3RhcnRZLCBjb2xzIC0gc3RhcnRYLCAxKTtcbiAgICAgICAgICAgICAgICBzdGFydFggPSB4O1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwcmV2RmlsbFN0eWxlICE9PSBuZXh0RmlsbFN0eWxlKSB7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHByZXZGaWxsU3R5bGU7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlsbENlbGxzKHN0YXJ0WCwgc3RhcnRZLCB4IC0gc3RhcnRYLCAxKTtcbiAgICAgICAgICAgICAgICBzdGFydFggPSB4O1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcmV2RmlsbFN0eWxlID0gbmV4dEZpbGxTdHlsZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChwcmV2RmlsbFN0eWxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gcHJldkZpbGxTdHlsZTtcbiAgICAgICAgICAgIHRoaXMuZmlsbENlbGxzKHN0YXJ0WCwgc3RhcnRZLCBjb2xzIC0gc3RhcnRYLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH07XG4gICAgVGV4dFJlbmRlckxheWVyLnByb3RvdHlwZS5fZHJhd0ZvcmVncm91bmQgPSBmdW5jdGlvbiAodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX2ZvckVhY2hDZWxsKHRlcm1pbmFsLCBmaXJzdFJvdywgbGFzdFJvdywgdGhpcy5fY2hhcmFjdGVySm9pbmVyUmVnaXN0cnksIGZ1bmN0aW9uIChjb2RlLCBjaGFycywgd2lkdGgsIHgsIHksIGZnLCBiZywgZmxhZ3MpIHtcbiAgICAgICAgICAgIGlmIChmbGFncyAmIDE2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZsYWdzICYgMikge1xuICAgICAgICAgICAgICAgIF90aGlzLl9jdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgIGlmIChmZyA9PT0gVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9jdHguZmlsbFN0eWxlID0gX3RoaXMuX2NvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoQ2hhckF0bGFzVXRpbHNfMS5pczI1NkNvbG9yKGZnKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fY3R4LmZpbGxTdHlsZSA9IF90aGlzLl9jb2xvcnMuYW5zaVtmZ10uY3NzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2N0eC5maWxsU3R5bGUgPSBfdGhpcy5fY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5maWxsQm90dG9tTGluZUF0Q2VsbHMoeCwgeSwgd2lkdGgpO1xuICAgICAgICAgICAgICAgIF90aGlzLl9jdHgucmVzdG9yZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuZHJhd0NoYXJzKHRlcm1pbmFsLCBjaGFycywgY29kZSwgd2lkdGgsIHgsIHksIGZnLCBiZywgISEoZmxhZ3MgJiAxKSwgISEoZmxhZ3MgJiAzMiksICEhKGZsYWdzICYgNjQpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBUZXh0UmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uR3JpZENoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93KSB7XG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jYWNoZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fY2hhckF0bGFzKSB7XG4gICAgICAgICAgICB0aGlzLl9jaGFyQXRsYXMuYmVnaW5GcmFtZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xlYXJDZWxscygwLCBmaXJzdFJvdywgdGVybWluYWwuY29scywgbGFzdFJvdyAtIGZpcnN0Um93ICsgMSk7XG4gICAgICAgIHRoaXMuX2RyYXdCYWNrZ3JvdW5kKHRlcm1pbmFsLCBmaXJzdFJvdywgbGFzdFJvdyk7XG4gICAgICAgIHRoaXMuX2RyYXdGb3JlZ3JvdW5kKHRlcm1pbmFsLCBmaXJzdFJvdywgbGFzdFJvdyk7XG4gICAgfTtcbiAgICBUZXh0UmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgdGhpcy5zZXRUcmFuc3BhcmVuY3kodGVybWluYWwsIHRlcm1pbmFsLm9wdGlvbnMuYWxsb3dUcmFuc3BhcmVuY3kpO1xuICAgIH07XG4gICAgVGV4dFJlbmRlckxheWVyLnByb3RvdHlwZS5faXNPdmVybGFwcGluZyA9IGZ1bmN0aW9uIChjaGFyRGF0YSkge1xuICAgICAgICBpZiAoY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSAhPT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb2RlID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX0NPREVfSU5ERVhdO1xuICAgICAgICBpZiAoY29kZSA8IDI1Nikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjaGFyID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdO1xuICAgICAgICBpZiAodGhpcy5fY2hhcmFjdGVyT3ZlcmxhcENhY2hlLmhhc093blByb3BlcnR5KGNoYXIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hhcmFjdGVyT3ZlcmxhcENhY2hlW2NoYXJdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgIHRoaXMuX2N0eC5mb250ID0gdGhpcy5fY2hhcmFjdGVyRm9udDtcbiAgICAgICAgdmFyIG92ZXJsYXBzID0gTWF0aC5mbG9vcih0aGlzLl9jdHgubWVhc3VyZVRleHQoY2hhcikud2lkdGgpID4gdGhpcy5fY2hhcmFjdGVyV2lkdGg7XG4gICAgICAgIHRoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgICAgIHRoaXMuX2NoYXJhY3Rlck92ZXJsYXBDYWNoZVtjaGFyXSA9IG92ZXJsYXBzO1xuICAgICAgICByZXR1cm4gb3ZlcmxhcHM7XG4gICAgfTtcbiAgICByZXR1cm4gVGV4dFJlbmRlckxheWVyO1xufShCYXNlUmVuZGVyTGF5ZXJfMS5CYXNlUmVuZGVyTGF5ZXIpKTtcbmV4cG9ydHMuVGV4dFJlbmRlckxheWVyID0gVGV4dFJlbmRlckxheWVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VGV4dFJlbmRlckxheWVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJhc2VDaGFyQXRsYXMgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJhc2VDaGFyQXRsYXMoKSB7XG4gICAgICAgIHRoaXMuX2RpZFdhcm1VcCA9IGZhbHNlO1xuICAgIH1cbiAgICBCYXNlQ2hhckF0bGFzLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIEJhc2VDaGFyQXRsYXMucHJvdG90eXBlLndhcm1VcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9kaWRXYXJtVXApIHtcbiAgICAgICAgICAgIHRoaXMuX2RvV2FybVVwKCk7XG4gICAgICAgICAgICB0aGlzLl9kaWRXYXJtVXAgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlQ2hhckF0bGFzLnByb3RvdHlwZS5fZG9XYXJtVXAgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgQmFzZUNoYXJBdGxhcy5wcm90b3R5cGUuYmVnaW5GcmFtZSA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICByZXR1cm4gQmFzZUNoYXJBdGxhcztcbn0oKSk7XG5leHBvcnRzLmRlZmF1bHQgPSBCYXNlQ2hhckF0bGFzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QmFzZUNoYXJBdGxhcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBDaGFyQXRsYXNVdGlsc18xID0gcmVxdWlyZShcIi4vQ2hhckF0bGFzVXRpbHNcIik7XG52YXIgRHluYW1pY0NoYXJBdGxhc18xID0gcmVxdWlyZShcIi4vRHluYW1pY0NoYXJBdGxhc1wiKTtcbnZhciBOb25lQ2hhckF0bGFzXzEgPSByZXF1aXJlKFwiLi9Ob25lQ2hhckF0bGFzXCIpO1xudmFyIFN0YXRpY0NoYXJBdGxhc18xID0gcmVxdWlyZShcIi4vU3RhdGljQ2hhckF0bGFzXCIpO1xudmFyIGNoYXJBdGxhc0ltcGxlbWVudGF0aW9ucyA9IHtcbiAgICAnbm9uZSc6IE5vbmVDaGFyQXRsYXNfMS5kZWZhdWx0LFxuICAgICdzdGF0aWMnOiBTdGF0aWNDaGFyQXRsYXNfMS5kZWZhdWx0LFxuICAgICdkeW5hbWljJzogRHluYW1pY0NoYXJBdGxhc18xLmRlZmF1bHRcbn07XG52YXIgY2hhckF0bGFzQ2FjaGUgPSBbXTtcbmZ1bmN0aW9uIGFjcXVpcmVDaGFyQXRsYXModGVybWluYWwsIGNvbG9ycywgc2NhbGVkQ2hhcldpZHRoLCBzY2FsZWRDaGFySGVpZ2h0KSB7XG4gICAgdmFyIG5ld0NvbmZpZyA9IENoYXJBdGxhc1V0aWxzXzEuZ2VuZXJhdGVDb25maWcoc2NhbGVkQ2hhcldpZHRoLCBzY2FsZWRDaGFySGVpZ2h0LCB0ZXJtaW5hbCwgY29sb3JzKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJBdGxhc0NhY2hlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IGNoYXJBdGxhc0NhY2hlW2ldO1xuICAgICAgICB2YXIgb3duZWRCeUluZGV4ID0gZW50cnkub3duZWRCeS5pbmRleE9mKHRlcm1pbmFsKTtcbiAgICAgICAgaWYgKG93bmVkQnlJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICBpZiAoQ2hhckF0bGFzVXRpbHNfMS5jb25maWdFcXVhbHMoZW50cnkuY29uZmlnLCBuZXdDb25maWcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVudHJ5LmF0bGFzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVudHJ5Lm93bmVkQnkubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY2hhckF0bGFzQ2FjaGUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZW50cnkub3duZWRCeS5zcGxpY2Uob3duZWRCeUluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckF0bGFzQ2FjaGUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gY2hhckF0bGFzQ2FjaGVbaV07XG4gICAgICAgIGlmIChDaGFyQXRsYXNVdGlsc18xLmNvbmZpZ0VxdWFscyhlbnRyeS5jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgICAgIGVudHJ5Lm93bmVkQnkucHVzaCh0ZXJtaW5hbCk7XG4gICAgICAgICAgICByZXR1cm4gZW50cnkuYXRsYXM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmFyIG5ld0VudHJ5ID0ge1xuICAgICAgICBhdGxhczogbmV3IGNoYXJBdGxhc0ltcGxlbWVudGF0aW9uc1t0ZXJtaW5hbC5vcHRpb25zLmV4cGVyaW1lbnRhbENoYXJBdGxhc10oZG9jdW1lbnQsIG5ld0NvbmZpZyksXG4gICAgICAgIGNvbmZpZzogbmV3Q29uZmlnLFxuICAgICAgICBvd25lZEJ5OiBbdGVybWluYWxdXG4gICAgfTtcbiAgICBjaGFyQXRsYXNDYWNoZS5wdXNoKG5ld0VudHJ5KTtcbiAgICByZXR1cm4gbmV3RW50cnkuYXRsYXM7XG59XG5leHBvcnRzLmFjcXVpcmVDaGFyQXRsYXMgPSBhY3F1aXJlQ2hhckF0bGFzO1xuZnVuY3Rpb24gcmVtb3ZlVGVybWluYWxGcm9tQ2FjaGUodGVybWluYWwpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJBdGxhc0NhY2hlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGNoYXJBdGxhc0NhY2hlW2ldLm93bmVkQnkuaW5kZXhPZih0ZXJtaW5hbCk7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIGlmIChjaGFyQXRsYXNDYWNoZVtpXS5vd25lZEJ5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNoYXJBdGxhc0NhY2hlLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoYXJBdGxhc0NhY2hlW2ldLm93bmVkQnkuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5yZW1vdmVUZXJtaW5hbEZyb21DYWNoZSA9IHJlbW92ZVRlcm1pbmFsRnJvbUNhY2hlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhckF0bGFzQ2FjaGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgUGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb3JlL1BsYXRmb3JtXCIpO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi9UeXBlc1wiKTtcbmZ1bmN0aW9uIGdlbmVyYXRlU3RhdGljQ2hhckF0bGFzVGV4dHVyZShjb250ZXh0LCBjYW52YXNGYWN0b3J5LCBjb25maWcpIHtcbiAgICB2YXIgY2VsbFdpZHRoID0gY29uZmlnLnNjYWxlZENoYXJXaWR0aCArIFR5cGVzXzEuQ0hBUl9BVExBU19DRUxMX1NQQUNJTkc7XG4gICAgdmFyIGNlbGxIZWlnaHQgPSBjb25maWcuc2NhbGVkQ2hhckhlaWdodCArIFR5cGVzXzEuQ0hBUl9BVExBU19DRUxMX1NQQUNJTkc7XG4gICAgdmFyIGNhbnZhcyA9IGNhbnZhc0ZhY3RvcnkoMjU1ICogY2VsbFdpZHRoLCAoMiArIDE2ICsgMTYpICogY2VsbEhlaWdodCk7XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgYWxwaGE6IGNvbmZpZy5hbGxvd1RyYW5zcGFyZW5jeSB9KTtcbiAgICBjdHguZmlsbFN0eWxlID0gY29uZmlnLmNvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC5maWxsU3R5bGUgPSBjb25maWcuY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgIGN0eC5mb250ID0gZ2V0Rm9udChjb25maWcuZm9udFdlaWdodCwgY29uZmlnKTtcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykge1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5yZWN0KGkgKiBjZWxsV2lkdGgsIDAsIGNlbGxXaWR0aCwgY2VsbEhlaWdodCk7XG4gICAgICAgIGN0eC5jbGlwKCk7XG4gICAgICAgIGN0eC5maWxsVGV4dChTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLCBpICogY2VsbFdpZHRoLCAwKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9XG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguZm9udCA9IGdldEZvbnQoY29uZmlnLmZvbnRXZWlnaHRCb2xkLCBjb25maWcpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgucmVjdChpICogY2VsbFdpZHRoLCBjZWxsSGVpZ2h0LCBjZWxsV2lkdGgsIGNlbGxIZWlnaHQpO1xuICAgICAgICBjdHguY2xpcCgpO1xuICAgICAgICBjdHguZmlsbFRleHQoU3RyaW5nLmZyb21DaGFyQ29kZShpKSwgaSAqIGNlbGxXaWR0aCwgY2VsbEhlaWdodCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgY3R4LmZvbnQgPSBnZXRGb250KGNvbmZpZy5mb250V2VpZ2h0LCBjb25maWcpO1xuICAgIGZvciAodmFyIGNvbG9ySW5kZXggPSAwOyBjb2xvckluZGV4IDwgMTY7IGNvbG9ySW5kZXgrKykge1xuICAgICAgICB2YXIgeSA9IChjb2xvckluZGV4ICsgMikgKiBjZWxsSGVpZ2h0O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XG4gICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgY3R4LnJlY3QoaSAqIGNlbGxXaWR0aCwgeSwgY2VsbFdpZHRoLCBjZWxsSGVpZ2h0KTtcbiAgICAgICAgICAgIGN0eC5jbGlwKCk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29uZmlnLmNvbG9ycy5hbnNpW2NvbG9ySW5kZXhdLmNzcztcbiAgICAgICAgICAgIGN0eC5maWxsVGV4dChTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLCBpICogY2VsbFdpZHRoLCB5KTtcbiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3R4LmZvbnQgPSBnZXRGb250KGNvbmZpZy5mb250V2VpZ2h0Qm9sZCwgY29uZmlnKTtcbiAgICBmb3IgKHZhciBjb2xvckluZGV4ID0gMDsgY29sb3JJbmRleCA8IDE2OyBjb2xvckluZGV4KyspIHtcbiAgICAgICAgdmFyIHkgPSAoY29sb3JJbmRleCArIDIgKyAxNikgKiBjZWxsSGVpZ2h0O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XG4gICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgY3R4LnJlY3QoaSAqIGNlbGxXaWR0aCwgeSwgY2VsbFdpZHRoLCBjZWxsSGVpZ2h0KTtcbiAgICAgICAgICAgIGN0eC5jbGlwKCk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29uZmlnLmNvbG9ycy5hbnNpW2NvbG9ySW5kZXhdLmNzcztcbiAgICAgICAgICAgIGN0eC5maWxsVGV4dChTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLCBpICogY2VsbFdpZHRoLCB5KTtcbiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgICBpZiAoISgnY3JlYXRlSW1hZ2VCaXRtYXAnIGluIGNvbnRleHQpIHx8IFBsYXRmb3JtXzEuaXNGaXJlZm94IHx8IFBsYXRmb3JtXzEuaXNTYWZhcmkpIHtcbiAgICAgICAgcmV0dXJuIGNhbnZhcztcbiAgICB9XG4gICAgdmFyIGNoYXJBdGxhc0ltYWdlRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBjbGVhckNvbG9yKGNoYXJBdGxhc0ltYWdlRGF0YSwgY29uZmlnLmNvbG9ycy5iYWNrZ3JvdW5kKTtcbiAgICByZXR1cm4gY29udGV4dC5jcmVhdGVJbWFnZUJpdG1hcChjaGFyQXRsYXNJbWFnZURhdGEpO1xufVxuZXhwb3J0cy5nZW5lcmF0ZVN0YXRpY0NoYXJBdGxhc1RleHR1cmUgPSBnZW5lcmF0ZVN0YXRpY0NoYXJBdGxhc1RleHR1cmU7XG5mdW5jdGlvbiBjbGVhckNvbG9yKGltYWdlRGF0YSwgY29sb3IpIHtcbiAgICB2YXIgaXNFbXB0eSA9IHRydWU7XG4gICAgdmFyIHIgPSBjb2xvci5yZ2JhID4+PiAyNDtcbiAgICB2YXIgZyA9IGNvbG9yLnJnYmEgPj4+IDE2ICYgMHhGRjtcbiAgICB2YXIgYiA9IGNvbG9yLnJnYmEgPj4+IDggJiAweEZGO1xuICAgIGZvciAodmFyIG9mZnNldCA9IDA7IG9mZnNldCA8IGltYWdlRGF0YS5kYXRhLmxlbmd0aDsgb2Zmc2V0ICs9IDQpIHtcbiAgICAgICAgaWYgKGltYWdlRGF0YS5kYXRhW29mZnNldF0gPT09IHIgJiZcbiAgICAgICAgICAgIGltYWdlRGF0YS5kYXRhW29mZnNldCArIDFdID09PSBnICYmXG4gICAgICAgICAgICBpbWFnZURhdGEuZGF0YVtvZmZzZXQgKyAyXSA9PT0gYikge1xuICAgICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbb2Zmc2V0ICsgM10gPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaXNFbXB0eSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpc0VtcHR5O1xufVxuZXhwb3J0cy5jbGVhckNvbG9yID0gY2xlYXJDb2xvcjtcbmZ1bmN0aW9uIGdldEZvbnQoZm9udFdlaWdodCwgY29uZmlnKSB7XG4gICAgcmV0dXJuIGZvbnRXZWlnaHQgKyBcIiBcIiArIGNvbmZpZy5mb250U2l6ZSAqIGNvbmZpZy5kZXZpY2VQaXhlbFJhdGlvICsgXCJweCBcIiArIGNvbmZpZy5mb250RmFtaWx5O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhckF0bGFzR2VuZXJhdG9yLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi9UeXBlc1wiKTtcbmZ1bmN0aW9uIGdlbmVyYXRlQ29uZmlnKHNjYWxlZENoYXJXaWR0aCwgc2NhbGVkQ2hhckhlaWdodCwgdGVybWluYWwsIGNvbG9ycykge1xuICAgIHZhciBjbG9uZWRDb2xvcnMgPSB7XG4gICAgICAgIGZvcmVncm91bmQ6IGNvbG9ycy5mb3JlZ3JvdW5kLFxuICAgICAgICBiYWNrZ3JvdW5kOiBjb2xvcnMuYmFja2dyb3VuZCxcbiAgICAgICAgY3Vyc29yOiBudWxsLFxuICAgICAgICBjdXJzb3JBY2NlbnQ6IG51bGwsXG4gICAgICAgIHNlbGVjdGlvbjogbnVsbCxcbiAgICAgICAgYW5zaTogY29sb3JzLmFuc2kuc2xpY2UoMCwgMTYpXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiB0ZXJtaW5hbC5vcHRpb25zLmV4cGVyaW1lbnRhbENoYXJBdGxhcyxcbiAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbzogd2luZG93LmRldmljZVBpeGVsUmF0aW8sXG4gICAgICAgIHNjYWxlZENoYXJXaWR0aDogc2NhbGVkQ2hhcldpZHRoLFxuICAgICAgICBzY2FsZWRDaGFySGVpZ2h0OiBzY2FsZWRDaGFySGVpZ2h0LFxuICAgICAgICBmb250RmFtaWx5OiB0ZXJtaW5hbC5vcHRpb25zLmZvbnRGYW1pbHksXG4gICAgICAgIGZvbnRTaXplOiB0ZXJtaW5hbC5vcHRpb25zLmZvbnRTaXplLFxuICAgICAgICBmb250V2VpZ2h0OiB0ZXJtaW5hbC5vcHRpb25zLmZvbnRXZWlnaHQsXG4gICAgICAgIGZvbnRXZWlnaHRCb2xkOiB0ZXJtaW5hbC5vcHRpb25zLmZvbnRXZWlnaHRCb2xkLFxuICAgICAgICBhbGxvd1RyYW5zcGFyZW5jeTogdGVybWluYWwub3B0aW9ucy5hbGxvd1RyYW5zcGFyZW5jeSxcbiAgICAgICAgY29sb3JzOiBjbG9uZWRDb2xvcnNcbiAgICB9O1xufVxuZXhwb3J0cy5nZW5lcmF0ZUNvbmZpZyA9IGdlbmVyYXRlQ29uZmlnO1xuZnVuY3Rpb24gY29uZmlnRXF1YWxzKGEsIGIpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEuY29sb3JzLmFuc2kubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGEuY29sb3JzLmFuc2lbaV0ucmdiYSAhPT0gYi5jb2xvcnMuYW5zaVtpXS5yZ2JhKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGEudHlwZSA9PT0gYi50eXBlICYmXG4gICAgICAgIGEuZGV2aWNlUGl4ZWxSYXRpbyA9PT0gYi5kZXZpY2VQaXhlbFJhdGlvICYmXG4gICAgICAgIGEuZm9udEZhbWlseSA9PT0gYi5mb250RmFtaWx5ICYmXG4gICAgICAgIGEuZm9udFNpemUgPT09IGIuZm9udFNpemUgJiZcbiAgICAgICAgYS5mb250V2VpZ2h0ID09PSBiLmZvbnRXZWlnaHQgJiZcbiAgICAgICAgYS5mb250V2VpZ2h0Qm9sZCA9PT0gYi5mb250V2VpZ2h0Qm9sZCAmJlxuICAgICAgICBhLmFsbG93VHJhbnNwYXJlbmN5ID09PSBiLmFsbG93VHJhbnNwYXJlbmN5ICYmXG4gICAgICAgIGEuc2NhbGVkQ2hhcldpZHRoID09PSBiLnNjYWxlZENoYXJXaWR0aCAmJlxuICAgICAgICBhLnNjYWxlZENoYXJIZWlnaHQgPT09IGIuc2NhbGVkQ2hhckhlaWdodCAmJlxuICAgICAgICBhLmNvbG9ycy5mb3JlZ3JvdW5kID09PSBiLmNvbG9ycy5mb3JlZ3JvdW5kICYmXG4gICAgICAgIGEuY29sb3JzLmJhY2tncm91bmQgPT09IGIuY29sb3JzLmJhY2tncm91bmQ7XG59XG5leHBvcnRzLmNvbmZpZ0VxdWFscyA9IGNvbmZpZ0VxdWFscztcbmZ1bmN0aW9uIGlzMjU2Q29sb3IoY29sb3JDb2RlKSB7XG4gICAgcmV0dXJuIGNvbG9yQ29kZSA8IFR5cGVzXzEuREVGQVVMVF9DT0xPUjtcbn1cbmV4cG9ydHMuaXMyNTZDb2xvciA9IGlzMjU2Q29sb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1DaGFyQXRsYXNVdGlscy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgVHlwZXNfMSA9IHJlcXVpcmUoXCIuL1R5cGVzXCIpO1xudmFyIEJhc2VDaGFyQXRsYXNfMSA9IHJlcXVpcmUoXCIuL0Jhc2VDaGFyQXRsYXNcIik7XG52YXIgQ29sb3JNYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi4vQ29sb3JNYW5hZ2VyXCIpO1xudmFyIENoYXJBdGxhc0dlbmVyYXRvcl8xID0gcmVxdWlyZShcIi4vQ2hhckF0bGFzR2VuZXJhdG9yXCIpO1xudmFyIExSVU1hcF8xID0gcmVxdWlyZShcIi4vTFJVTWFwXCIpO1xudmFyIFBsYXRmb3JtXzEgPSByZXF1aXJlKFwiLi4vLi4vY29yZS9QbGF0Zm9ybVwiKTtcbnZhciBURVhUVVJFX1dJRFRIID0gMTAyNDtcbnZhciBURVhUVVJFX0hFSUdIVCA9IDEwMjQ7XG52YXIgVFJBTlNQQVJFTlRfQ09MT1IgPSB7XG4gICAgY3NzOiAncmdiYSgwLCAwLCAwLCAwKScsXG4gICAgcmdiYTogMFxufTtcbnZhciBGUkFNRV9DQUNIRV9EUkFXX0xJTUlUID0gMTAwO1xudmFyIEdMWVBIX0JJVE1BUF9DT01NSVRfREVMQVkgPSAxMDA7XG5mdW5jdGlvbiBnZXRHbHlwaENhY2hlS2V5KGdseXBoKSB7XG4gICAgcmV0dXJuIGdseXBoLmNvZGUgPDwgMjEgfCBnbHlwaC5iZyA8PCAxMiB8IGdseXBoLmZnIDw8IDMgfCAoZ2x5cGguYm9sZCA/IDAgOiA0KSArIChnbHlwaC5kaW0gPyAwIDogMikgKyAoZ2x5cGguaXRhbGljID8gMCA6IDEpO1xufVxuZXhwb3J0cy5nZXRHbHlwaENhY2hlS2V5ID0gZ2V0R2x5cGhDYWNoZUtleTtcbnZhciBEeW5hbWljQ2hhckF0bGFzID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRHluYW1pY0NoYXJBdGxhcywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBEeW5hbWljQ2hhckF0bGFzKGRvY3VtZW50LCBfY29uZmlnKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9jb25maWcgPSBfY29uZmlnO1xuICAgICAgICBfdGhpcy5fZHJhd1RvQ2FjaGVDb3VudCA9IDA7XG4gICAgICAgIF90aGlzLl9nbHlwaHNXYWl0aW5nT25CaXRtYXAgPSBbXTtcbiAgICAgICAgX3RoaXMuX2JpdG1hcENvbW1pdFRpbWVvdXQgPSBudWxsO1xuICAgICAgICBfdGhpcy5fYml0bWFwID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2NhY2hlQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIF90aGlzLl9jYWNoZUNhbnZhcy53aWR0aCA9IFRFWFRVUkVfV0lEVEg7XG4gICAgICAgIF90aGlzLl9jYWNoZUNhbnZhcy5oZWlnaHQgPSBURVhUVVJFX0hFSUdIVDtcbiAgICAgICAgX3RoaXMuX2NhY2hlQ3R4ID0gX3RoaXMuX2NhY2hlQ2FudmFzLmdldENvbnRleHQoJzJkJywgeyBhbHBoYTogdHJ1ZSB9KTtcbiAgICAgICAgdmFyIHRtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICB0bXBDYW52YXMud2lkdGggPSBfdGhpcy5fY29uZmlnLnNjYWxlZENoYXJXaWR0aDtcbiAgICAgICAgdG1wQ2FudmFzLmhlaWdodCA9IF90aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodDtcbiAgICAgICAgX3RoaXMuX3RtcEN0eCA9IHRtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgYWxwaGE6IF90aGlzLl9jb25maWcuYWxsb3dUcmFuc3BhcmVuY3kgfSk7XG4gICAgICAgIF90aGlzLl93aWR0aCA9IE1hdGguZmxvb3IoVEVYVFVSRV9XSURUSCAvIF90aGlzLl9jb25maWcuc2NhbGVkQ2hhcldpZHRoKTtcbiAgICAgICAgX3RoaXMuX2hlaWdodCA9IE1hdGguZmxvb3IoVEVYVFVSRV9IRUlHSFQgLyBfdGhpcy5fY29uZmlnLnNjYWxlZENoYXJIZWlnaHQpO1xuICAgICAgICB2YXIgY2FwYWNpdHkgPSBfdGhpcy5fd2lkdGggKiBfdGhpcy5faGVpZ2h0O1xuICAgICAgICBfdGhpcy5fY2FjaGVNYXAgPSBuZXcgTFJVTWFwXzEuZGVmYXVsdChjYXBhY2l0eSk7XG4gICAgICAgIF90aGlzLl9jYWNoZU1hcC5wcmVhbGxvYyhjYXBhY2l0eSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2JpdG1hcENvbW1pdFRpbWVvdXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fYml0bWFwQ29tbWl0VGltZW91dCk7XG4gICAgICAgICAgICB0aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuYmVnaW5GcmFtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZHJhd1RvQ2FjaGVDb3VudCA9IDA7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKGN0eCwgZ2x5cGgsIHgsIHkpIHtcbiAgICAgICAgaWYgKGdseXBoLmNvZGUgPT09IDMyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2NhbkNhY2hlKGdseXBoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBnbHlwaEtleSA9IGdldEdseXBoQ2FjaGVLZXkoZ2x5cGgpO1xuICAgICAgICB2YXIgY2FjaGVWYWx1ZSA9IHRoaXMuX2NhY2hlTWFwLmdldChnbHlwaEtleSk7XG4gICAgICAgIGlmIChjYWNoZVZhbHVlICE9PSBudWxsICYmIGNhY2hlVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5fZHJhd0Zyb21DYWNoZShjdHgsIGNhY2hlVmFsdWUsIHgsIHkpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5fZHJhd1RvQ2FjaGVDb3VudCA8IEZSQU1FX0NBQ0hFX0RSQVdfTElNSVQpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHZvaWQgMDtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jYWNoZU1hcC5zaXplIDwgdGhpcy5fY2FjaGVNYXAuY2FwYWNpdHkpIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuX2NhY2hlTWFwLnNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuX2NhY2hlTWFwLnBlZWsoKS5pbmRleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjYWNoZVZhbHVlXzEgPSB0aGlzLl9kcmF3VG9DYWNoZShnbHlwaCwgaW5kZXgpO1xuICAgICAgICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KGdseXBoS2V5LCBjYWNoZVZhbHVlXzEpO1xuICAgICAgICAgICAgdGhpcy5fZHJhd0Zyb21DYWNoZShjdHgsIGNhY2hlVmFsdWVfMSwgeCwgeSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5fY2FuQ2FjaGUgPSBmdW5jdGlvbiAoZ2x5cGgpIHtcbiAgICAgICAgcmV0dXJuIGdseXBoLmNvZGUgPCAyNTY7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5fdG9Db29yZGluYXRlWCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gKGluZGV4ICUgdGhpcy5fd2lkdGgpICogdGhpcy5fY29uZmlnLnNjYWxlZENoYXJXaWR0aDtcbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLl90b0Nvb3JkaW5hdGVZID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKGluZGV4IC8gdGhpcy5fd2lkdGgpICogdGhpcy5fY29uZmlnLnNjYWxlZENoYXJIZWlnaHQ7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5fZHJhd0Zyb21DYWNoZSA9IGZ1bmN0aW9uIChjdHgsIGNhY2hlVmFsdWUsIHgsIHkpIHtcbiAgICAgICAgaWYgKGNhY2hlVmFsdWUuaXNFbXB0eSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjYWNoZVggPSB0aGlzLl90b0Nvb3JkaW5hdGVYKGNhY2hlVmFsdWUuaW5kZXgpO1xuICAgICAgICB2YXIgY2FjaGVZID0gdGhpcy5fdG9Db29yZGluYXRlWShjYWNoZVZhbHVlLmluZGV4KTtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShjYWNoZVZhbHVlLmluQml0bWFwID8gdGhpcy5fYml0bWFwIDogdGhpcy5fY2FjaGVDYW52YXMsIGNhY2hlWCwgY2FjaGVZLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhcldpZHRoLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCwgeCwgeSwgdGhpcy5fY29uZmlnLnNjYWxlZENoYXJXaWR0aCwgdGhpcy5fY29uZmlnLnNjYWxlZENoYXJIZWlnaHQpO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2dldENvbG9yRnJvbUFuc2lJbmRleCA9IGZ1bmN0aW9uIChpZHgpIHtcbiAgICAgICAgaWYgKGlkeCA8IHRoaXMuX2NvbmZpZy5jb2xvcnMuYW5zaS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25maWcuY29sb3JzLmFuc2lbaWR4XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29sb3JNYW5hZ2VyXzEuREVGQVVMVF9BTlNJX0NPTE9SU1tpZHhdO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2dldEJhY2tncm91bmRDb2xvciA9IGZ1bmN0aW9uIChnbHlwaCkge1xuICAgICAgICBpZiAodGhpcy5fY29uZmlnLmFsbG93VHJhbnNwYXJlbmN5KSB7XG4gICAgICAgICAgICByZXR1cm4gVFJBTlNQQVJFTlRfQ09MT1I7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ2x5cGguYmcgPT09IFR5cGVzXzEuSU5WRVJURURfREVGQVVMVF9DT0xPUikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZy5jb2xvcnMuZm9yZWdyb3VuZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChnbHlwaC5iZyA8IDI1Nikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldENvbG9yRnJvbUFuc2lJbmRleChnbHlwaC5iZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZy5jb2xvcnMuYmFja2dyb3VuZDtcbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLl9nZXRGb3JlZ3JvdW5kQ29sb3IgPSBmdW5jdGlvbiAoZ2x5cGgpIHtcbiAgICAgICAgaWYgKGdseXBoLmZnID09PSBUeXBlc18xLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25maWcuY29sb3JzLmJhY2tncm91bmQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ2x5cGguZmcgPCAyNTYpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRDb2xvckZyb21BbnNpSW5kZXgoZ2x5cGguZmcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWcuY29sb3JzLmZvcmVncm91bmQ7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5fZHJhd1RvQ2FjaGUgPSBmdW5jdGlvbiAoZ2x5cGgsIGluZGV4KSB7XG4gICAgICAgIHRoaXMuX2RyYXdUb0NhY2hlQ291bnQrKztcbiAgICAgICAgdGhpcy5fdG1wQ3R4LnNhdmUoKTtcbiAgICAgICAgdmFyIGJhY2tncm91bmRDb2xvciA9IHRoaXMuX2dldEJhY2tncm91bmRDb2xvcihnbHlwaCk7XG4gICAgICAgIHRoaXMuX3RtcEN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnY29weSc7XG4gICAgICAgIHRoaXMuX3RtcEN0eC5maWxsU3R5bGUgPSBiYWNrZ3JvdW5kQ29sb3IuY3NzO1xuICAgICAgICB0aGlzLl90bXBDdHguZmlsbFJlY3QoMCwgMCwgdGhpcy5fY29uZmlnLnNjYWxlZENoYXJXaWR0aCwgdGhpcy5fY29uZmlnLnNjYWxlZENoYXJIZWlnaHQpO1xuICAgICAgICB0aGlzLl90bXBDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ3NvdXJjZS1vdmVyJztcbiAgICAgICAgdmFyIGZvbnRXZWlnaHQgPSBnbHlwaC5ib2xkID8gdGhpcy5fY29uZmlnLmZvbnRXZWlnaHRCb2xkIDogdGhpcy5fY29uZmlnLmZvbnRXZWlnaHQ7XG4gICAgICAgIHZhciBmb250U3R5bGUgPSBnbHlwaC5pdGFsaWMgPyAnaXRhbGljJyA6ICcnO1xuICAgICAgICB0aGlzLl90bXBDdHguZm9udCA9XG4gICAgICAgICAgICBmb250U3R5bGUgKyBcIiBcIiArIGZvbnRXZWlnaHQgKyBcIiBcIiArIHRoaXMuX2NvbmZpZy5mb250U2l6ZSAqIHRoaXMuX2NvbmZpZy5kZXZpY2VQaXhlbFJhdGlvICsgXCJweCBcIiArIHRoaXMuX2NvbmZpZy5mb250RmFtaWx5O1xuICAgICAgICB0aGlzLl90bXBDdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7XG4gICAgICAgIHRoaXMuX3RtcEN0eC5maWxsU3R5bGUgPSB0aGlzLl9nZXRGb3JlZ3JvdW5kQ29sb3IoZ2x5cGgpLmNzcztcbiAgICAgICAgaWYgKGdseXBoLmRpbSkge1xuICAgICAgICAgICAgdGhpcy5fdG1wQ3R4Lmdsb2JhbEFscGhhID0gVHlwZXNfMS5ESU1fT1BBQ0lUWTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90bXBDdHguZmlsbFRleHQoZ2x5cGguY2hhcnMsIDAsIDApO1xuICAgICAgICB0aGlzLl90bXBDdHgucmVzdG9yZSgpO1xuICAgICAgICB2YXIgaW1hZ2VEYXRhID0gdGhpcy5fdG1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhcldpZHRoLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCk7XG4gICAgICAgIHZhciBpc0VtcHR5ID0gZmFsc2U7XG4gICAgICAgIGlmICghdGhpcy5fY29uZmlnLmFsbG93VHJhbnNwYXJlbmN5KSB7XG4gICAgICAgICAgICBpc0VtcHR5ID0gQ2hhckF0bGFzR2VuZXJhdG9yXzEuY2xlYXJDb2xvcihpbWFnZURhdGEsIGJhY2tncm91bmRDb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHggPSB0aGlzLl90b0Nvb3JkaW5hdGVYKGluZGV4KTtcbiAgICAgICAgdmFyIHkgPSB0aGlzLl90b0Nvb3JkaW5hdGVZKGluZGV4KTtcbiAgICAgICAgdGhpcy5fY2FjaGVDdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgeCwgeSk7XG4gICAgICAgIHZhciBjYWNoZVZhbHVlID0ge1xuICAgICAgICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgICAgICAgaXNFbXB0eTogaXNFbXB0eSxcbiAgICAgICAgICAgIGluQml0bWFwOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9hZGRHbHlwaFRvQml0bWFwKGNhY2hlVmFsdWUpO1xuICAgICAgICByZXR1cm4gY2FjaGVWYWx1ZTtcbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLl9hZGRHbHlwaFRvQml0bWFwID0gZnVuY3Rpb24gKGNhY2hlVmFsdWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKCEoJ2NyZWF0ZUltYWdlQml0bWFwJyBpbiB3aW5kb3cpIHx8IFBsYXRmb3JtXzEuaXNGaXJlZm94IHx8IFBsYXRmb3JtXzEuaXNTYWZhcmkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9nbHlwaHNXYWl0aW5nT25CaXRtYXAucHVzaChjYWNoZVZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMuX2JpdG1hcENvbW1pdFRpbWVvdXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2dlbmVyYXRlQml0bWFwKCk7IH0sIEdMWVBIX0JJVE1BUF9DT01NSVRfREVMQVkpO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2dlbmVyYXRlQml0bWFwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgZ2x5cGhzTW92aW5nVG9CaXRtYXAgPSB0aGlzLl9nbHlwaHNXYWl0aW5nT25CaXRtYXA7XG4gICAgICAgIHRoaXMuX2dseXBoc1dhaXRpbmdPbkJpdG1hcCA9IFtdO1xuICAgICAgICB3aW5kb3cuY3JlYXRlSW1hZ2VCaXRtYXAodGhpcy5fY2FjaGVDYW52YXMpLnRoZW4oZnVuY3Rpb24gKGJpdG1hcCkge1xuICAgICAgICAgICAgX3RoaXMuX2JpdG1hcCA9IGJpdG1hcDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2x5cGhzTW92aW5nVG9CaXRtYXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBnbHlwaHNNb3ZpbmdUb0JpdG1hcFtpXTtcbiAgICAgICAgICAgICAgICB2YWx1ZS5pbkJpdG1hcCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ID0gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBEeW5hbWljQ2hhckF0bGFzO1xufShCYXNlQ2hhckF0bGFzXzEuZGVmYXVsdCkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gRHluYW1pY0NoYXJBdGxhcztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUR5bmFtaWNDaGFyQXRsYXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTFJVTWFwID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBMUlVNYXAoY2FwYWNpdHkpIHtcbiAgICAgICAgdGhpcy5jYXBhY2l0eSA9IGNhcGFjaXR5O1xuICAgICAgICB0aGlzLl9tYXAgPSB7fTtcbiAgICAgICAgdGhpcy5faGVhZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX3RhaWwgPSBudWxsO1xuICAgICAgICB0aGlzLl9ub2RlUG9vbCA9IFtdO1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cbiAgICBMUlVNYXAucHJvdG90eXBlLl91bmxpbmtOb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgdmFyIHByZXYgPSBub2RlLnByZXY7XG4gICAgICAgIHZhciBuZXh0ID0gbm9kZS5uZXh0O1xuICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy5faGVhZCkge1xuICAgICAgICAgICAgdGhpcy5faGVhZCA9IG5leHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgPT09IHRoaXMuX3RhaWwpIHtcbiAgICAgICAgICAgIHRoaXMuX3RhaWwgPSBwcmV2O1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmV2ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBwcmV2Lm5leHQgPSBuZXh0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXh0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBuZXh0LnByZXYgPSBwcmV2O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMUlVNYXAucHJvdG90eXBlLl9hcHBlbmROb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgdmFyIHRhaWwgPSB0aGlzLl90YWlsO1xuICAgICAgICBpZiAodGFpbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGFpbC5uZXh0ID0gbm9kZTtcbiAgICAgICAgfVxuICAgICAgICBub2RlLnByZXYgPSB0YWlsO1xuICAgICAgICBub2RlLm5leHQgPSBudWxsO1xuICAgICAgICB0aGlzLl90YWlsID0gbm9kZTtcbiAgICAgICAgaWYgKHRoaXMuX2hlYWQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2hlYWQgPSBub2RlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMUlVNYXAucHJvdG90eXBlLnByZWFsbG9jID0gZnVuY3Rpb24gKGNvdW50KSB7XG4gICAgICAgIHZhciBub2RlUG9vbCA9IHRoaXMuX25vZGVQb29sO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIG5vZGVQb29sLnB1c2goe1xuICAgICAgICAgICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgICAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgICAgICAgICBrZXk6IG51bGwsXG4gICAgICAgICAgICAgICAgdmFsdWU6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMUlVNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLl9tYXBba2V5XTtcbiAgICAgICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5fdW5saW5rTm9kZShub2RlKTtcbiAgICAgICAgICAgIHRoaXMuX2FwcGVuZE5vZGUobm9kZSk7XG4gICAgICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIExSVU1hcC5wcm90b3R5cGUucGVla1ZhbHVlID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMuX21hcFtrZXldO1xuICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIExSVU1hcC5wcm90b3R5cGUucGVlayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhlYWQgPSB0aGlzLl9oZWFkO1xuICAgICAgICByZXR1cm4gaGVhZCA9PT0gbnVsbCA/IG51bGwgOiBoZWFkLnZhbHVlO1xuICAgIH07XG4gICAgTFJVTWFwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMuX21hcFtrZXldO1xuICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBub2RlID0gdGhpcy5fbWFwW2tleV07XG4gICAgICAgICAgICB0aGlzLl91bmxpbmtOb2RlKG5vZGUpO1xuICAgICAgICAgICAgbm9kZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc2l6ZSA+PSB0aGlzLmNhcGFjaXR5KSB7XG4gICAgICAgICAgICBub2RlID0gdGhpcy5faGVhZDtcbiAgICAgICAgICAgIHRoaXMuX3VubGlua05vZGUobm9kZSk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fbWFwW25vZGUua2V5XTtcbiAgICAgICAgICAgIG5vZGUua2V5ID0ga2V5O1xuICAgICAgICAgICAgbm9kZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fbWFwW2tleV0gPSBub2RlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIG5vZGVQb29sID0gdGhpcy5fbm9kZVBvb2w7XG4gICAgICAgICAgICBpZiAobm9kZVBvb2wubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlUG9vbC5wb3AoKTtcbiAgICAgICAgICAgICAgICBub2RlLmtleSA9IGtleTtcbiAgICAgICAgICAgICAgICBub2RlLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBub2RlID0ge1xuICAgICAgICAgICAgICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX21hcFtrZXldID0gbm9kZTtcbiAgICAgICAgICAgIHRoaXMuc2l6ZSsrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FwcGVuZE5vZGUobm9kZSk7XG4gICAgfTtcbiAgICByZXR1cm4gTFJVTWFwO1xufSgpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IExSVU1hcDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxSVU1hcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQmFzZUNoYXJBdGxhc18xID0gcmVxdWlyZShcIi4vQmFzZUNoYXJBdGxhc1wiKTtcbnZhciBOb25lQ2hhckF0bGFzID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTm9uZUNoYXJBdGxhcywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOb25lQ2hhckF0bGFzKGRvY3VtZW50LCBjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgfVxuICAgIE5vbmVDaGFyQXRsYXMucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbiAoY3R4LCBnbHlwaCwgeCwgeSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4gTm9uZUNoYXJBdGxhcztcbn0oQmFzZUNoYXJBdGxhc18xLmRlZmF1bHQpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IE5vbmVDaGFyQXRsYXM7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Ob25lQ2hhckF0bGFzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBUeXBlc18xID0gcmVxdWlyZShcIi4vVHlwZXNcIik7XG52YXIgQ2hhckF0bGFzR2VuZXJhdG9yXzEgPSByZXF1aXJlKFwiLi9DaGFyQXRsYXNHZW5lcmF0b3JcIik7XG52YXIgQmFzZUNoYXJBdGxhc18xID0gcmVxdWlyZShcIi4vQmFzZUNoYXJBdGxhc1wiKTtcbnZhciBDaGFyQXRsYXNVdGlsc18xID0gcmVxdWlyZShcIi4vQ2hhckF0bGFzVXRpbHNcIik7XG52YXIgU3RhdGljQ2hhckF0bGFzID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU3RhdGljQ2hhckF0bGFzLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFN0YXRpY0NoYXJBdGxhcyhfZG9jdW1lbnQsIF9jb25maWcpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2RvY3VtZW50ID0gX2RvY3VtZW50O1xuICAgICAgICBfdGhpcy5fY29uZmlnID0gX2NvbmZpZztcbiAgICAgICAgX3RoaXMuX2NhbnZhc0ZhY3RvcnkgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IF90aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIHJldHVybiBjYW52YXM7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgU3RhdGljQ2hhckF0bGFzLnByb3RvdHlwZS5fZG9XYXJtVXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciByZXN1bHQgPSBDaGFyQXRsYXNHZW5lcmF0b3JfMS5nZW5lcmF0ZVN0YXRpY0NoYXJBdGxhc1RleHR1cmUod2luZG93LCB0aGlzLl9jYW52YXNGYWN0b3J5LCB0aGlzLl9jb25maWcpO1xuICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3RleHR1cmUgPSByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQudGhlbihmdW5jdGlvbiAodGV4dHVyZSkge1xuICAgICAgICAgICAgICAgIF90aGlzLl90ZXh0dXJlID0gdGV4dHVyZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTdGF0aWNDaGFyQXRsYXMucHJvdG90eXBlLl9pc0NhY2hlZCA9IGZ1bmN0aW9uIChnbHlwaCwgY29sb3JJbmRleCkge1xuICAgICAgICB2YXIgaXNBc2NpaSA9IGdseXBoLmNvZGUgPCAyNTY7XG4gICAgICAgIHZhciBpc0Jhc2ljQ29sb3IgPSBnbHlwaC5mZyA8IDE2O1xuICAgICAgICB2YXIgaXNEZWZhdWx0Q29sb3IgPSBnbHlwaC5mZyA9PT0gVHlwZXNfMS5ERUZBVUxUX0NPTE9SO1xuICAgICAgICB2YXIgaXNEZWZhdWx0QmFja2dyb3VuZCA9IGdseXBoLmJnID09PSBUeXBlc18xLkRFRkFVTFRfQ09MT1I7XG4gICAgICAgIHJldHVybiBpc0FzY2lpICYmIChpc0Jhc2ljQ29sb3IgfHwgaXNEZWZhdWx0Q29sb3IpICYmIGlzRGVmYXVsdEJhY2tncm91bmQgJiYgIWdseXBoLml0YWxpYztcbiAgICB9O1xuICAgIFN0YXRpY0NoYXJBdGxhcy5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uIChjdHgsIGdseXBoLCB4LCB5KSB7XG4gICAgICAgIGlmICh0aGlzLl90ZXh0dXJlID09PSBudWxsIHx8IHRoaXMuX3RleHR1cmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb2xvckluZGV4ID0gMDtcbiAgICAgICAgaWYgKENoYXJBdGxhc1V0aWxzXzEuaXMyNTZDb2xvcihnbHlwaC5mZykpIHtcbiAgICAgICAgICAgIGNvbG9ySW5kZXggPSAyICsgZ2x5cGguZmcgKyAoZ2x5cGguYm9sZCA/IDE2IDogMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ2x5cGguZmcgPT09IFR5cGVzXzEuREVGQVVMVF9DT0xPUikge1xuICAgICAgICAgICAgaWYgKGdseXBoLmJvbGQpIHtcbiAgICAgICAgICAgICAgICBjb2xvckluZGV4ID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2lzQ2FjaGVkKGdseXBoLCBjb2xvckluZGV4KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIHZhciBjaGFyQXRsYXNDZWxsV2lkdGggPSB0aGlzLl9jb25maWcuc2NhbGVkQ2hhcldpZHRoICsgVHlwZXNfMS5DSEFSX0FUTEFTX0NFTExfU1BBQ0lORztcbiAgICAgICAgdmFyIGNoYXJBdGxhc0NlbGxIZWlnaHQgPSB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCArIFR5cGVzXzEuQ0hBUl9BVExBU19DRUxMX1NQQUNJTkc7XG4gICAgICAgIGlmIChnbHlwaC5kaW0pIHtcbiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IFR5cGVzXzEuRElNX09QQUNJVFk7XG4gICAgICAgIH1cbiAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLl90ZXh0dXJlLCBnbHlwaC5jb2RlICogY2hhckF0bGFzQ2VsbFdpZHRoLCBjb2xvckluZGV4ICogY2hhckF0bGFzQ2VsbEhlaWdodCwgY2hhckF0bGFzQ2VsbFdpZHRoLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCwgeCwgeSwgY2hhckF0bGFzQ2VsbFdpZHRoLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgcmV0dXJuIFN0YXRpY0NoYXJBdGxhcztcbn0oQmFzZUNoYXJBdGxhc18xLmRlZmF1bHQpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IFN0YXRpY0NoYXJBdGxhcztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVN0YXRpY0NoYXJBdGxhcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuREVGQVVMVF9DT0xPUiA9IDI1NjtcbmV4cG9ydHMuSU5WRVJURURfREVGQVVMVF9DT0xPUiA9IDI1NztcbmV4cG9ydHMuRElNX09QQUNJVFkgPSAwLjU7XG5leHBvcnRzLkNIQVJfQVRMQVNfQ0VMTF9TUEFDSU5HID0gMTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVR5cGVzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBFdmVudEVtaXR0ZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vRXZlbnRFbWl0dGVyXCIpO1xudmFyIENvbG9yTWFuYWdlcl8xID0gcmVxdWlyZShcIi4uL0NvbG9yTWFuYWdlclwiKTtcbnZhciBSZW5kZXJEZWJvdW5jZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi91aS9SZW5kZXJEZWJvdW5jZXJcIik7XG52YXIgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEgPSByZXF1aXJlKFwiLi9Eb21SZW5kZXJlclJvd0ZhY3RvcnlcIik7XG52YXIgVHlwZXNfMSA9IHJlcXVpcmUoXCIuLi9hdGxhcy9UeXBlc1wiKTtcbnZhciBURVJNSU5BTF9DTEFTU19QUkVGSVggPSAneHRlcm0tZG9tLXJlbmRlcmVyLW93bmVyLSc7XG52YXIgUk9XX0NPTlRBSU5FUl9DTEFTUyA9ICd4dGVybS1yb3dzJztcbnZhciBGR19DTEFTU19QUkVGSVggPSAneHRlcm0tZmctJztcbnZhciBCR19DTEFTU19QUkVGSVggPSAneHRlcm0tYmctJztcbnZhciBGT0NVU19DTEFTUyA9ICd4dGVybS1mb2N1cyc7XG52YXIgU0VMRUNUSU9OX0NMQVNTID0gJ3h0ZXJtLXNlbGVjdGlvbic7XG52YXIgbmV4dFRlcm1pbmFsSWQgPSAxO1xudmFyIERvbVJlbmRlcmVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRG9tUmVuZGVyZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRG9tUmVuZGVyZXIoX3Rlcm1pbmFsLCB0aGVtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbENsYXNzID0gbmV4dFRlcm1pbmFsSWQrKztcbiAgICAgICAgX3RoaXMuX3Jvd0VsZW1lbnRzID0gW107XG4gICAgICAgIHZhciBhbGxvd1RyYW5zcGFyZW5jeSA9IF90aGlzLl90ZXJtaW5hbC5vcHRpb25zLmFsbG93VHJhbnNwYXJlbmN5O1xuICAgICAgICBfdGhpcy5jb2xvck1hbmFnZXIgPSBuZXcgQ29sb3JNYW5hZ2VyXzEuQ29sb3JNYW5hZ2VyKGRvY3VtZW50LCBhbGxvd1RyYW5zcGFyZW5jeSk7XG4gICAgICAgIF90aGlzLnNldFRoZW1lKHRoZW1lKTtcbiAgICAgICAgX3RoaXMuX3Jvd0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBfdGhpcy5fcm93Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoUk9XX0NPTlRBSU5FUl9DTEFTUyk7XG4gICAgICAgIF90aGlzLl9yb3dDb250YWluZXIuc3R5bGUubGluZUhlaWdodCA9ICdub3JtYWwnO1xuICAgICAgICBfdGhpcy5fcm93Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgICBfdGhpcy5fcmVmcmVzaFJvd0VsZW1lbnRzKF90aGlzLl90ZXJtaW5hbC5jb2xzLCBfdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgICAgIF90aGlzLl9zZWxlY3Rpb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgX3RoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFNFTEVDVElPTl9DTEFTUyk7XG4gICAgICAgIF90aGlzLl9zZWxlY3Rpb25Db250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAgIF90aGlzLmRpbWVuc2lvbnMgPSB7XG4gICAgICAgICAgICBzY2FsZWRDaGFyV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBzY2FsZWRDaGFySGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2VsbFdpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2VsbEhlaWdodDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENoYXJMZWZ0OiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2hhclRvcDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENhbnZhc1dpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2FudmFzSGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgY2FudmFzV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICBhY3R1YWxDZWxsV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBhY3R1YWxDZWxsSGVpZ2h0OiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLl91cGRhdGVEaW1lbnNpb25zKCk7XG4gICAgICAgIF90aGlzLl9yZW5kZXJEZWJvdW5jZXIgPSBuZXcgUmVuZGVyRGVib3VuY2VyXzEuUmVuZGVyRGVib3VuY2VyKF90aGlzLl90ZXJtaW5hbCwgX3RoaXMuX3JlbmRlclJvd3MuYmluZChfdGhpcykpO1xuICAgICAgICBfdGhpcy5fcm93RmFjdG9yeSA9IG5ldyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5Eb21SZW5kZXJlclJvd0ZhY3RvcnkoZG9jdW1lbnQpO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFRFUk1JTkFMX0NMQVNTX1BSRUZJWCArIF90aGlzLl90ZXJtaW5hbENsYXNzKTtcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQuYXBwZW5kQ2hpbGQoX3RoaXMuX3Jvd0NvbnRhaW5lcik7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LmFwcGVuZENoaWxkKF90aGlzLl9zZWxlY3Rpb25Db250YWluZXIpO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwubGlua2lmaWVyLm9uKFwibGlua2hvdmVyXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25MaW5rSG92ZXIoZSk7IH0pO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwubGlua2lmaWVyLm9uKFwibGlua2xlYXZlXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25MaW5rTGVhdmUoZSk7IH0pO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoVEVSTUlOQUxfQ0xBU1NfUFJFRklYICsgdGhpcy5fdGVybWluYWxDbGFzcyk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5fcm93Q29udGFpbmVyKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLl9zZWxlY3Rpb25Db250YWluZXIpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuX3RoZW1lU3R5bGVFbGVtZW50KTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLl9kaW1lbnNpb25zU3R5bGVFbGVtZW50KTtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX3VwZGF0ZURpbWVuc2lvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDaGFyV2lkdGggPSBNYXRoLmZsb29yKHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLndpZHRoICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhckhlaWdodCA9IE1hdGguY2VpbCh0aGlzLl90ZXJtaW5hbC5jaGFyTWVhc3VyZS5oZWlnaHQgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsV2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhcldpZHRoICsgTWF0aC5yb3VuZCh0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmxldHRlclNwYWNpbmcpO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbEhlaWdodCA9IE1hdGguZmxvb3IodGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJIZWlnaHQgKiB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmxpbmVIZWlnaHQpO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhckxlZnQgPSAwO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhclRvcCA9IDA7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDYW52YXNXaWR0aCA9IHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsV2lkdGggKiB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2FudmFzSGVpZ2h0ID0gdGhpcy5kaW1lbnNpb25zLnNjYWxlZENlbGxIZWlnaHQgKiB0aGlzLl90ZXJtaW5hbC5yb3dzO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuY2FudmFzV2lkdGggPSBNYXRoLnJvdW5kKHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDYW52YXNXaWR0aCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLmNhbnZhc0hlaWdodCA9IE1hdGgucm91bmQodGhpcy5kaW1lbnNpb25zLnNjYWxlZENhbnZhc0hlaWdodCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLmFjdHVhbENlbGxXaWR0aCA9IHRoaXMuZGltZW5zaW9ucy5jYW52YXNXaWR0aCAvIHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ID0gdGhpcy5kaW1lbnNpb25zLmNhbnZhc0hlaWdodCAvIHRoaXMuX3Rlcm1pbmFsLnJvd3M7XG4gICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBfdGhpcy5kaW1lbnNpb25zLmNhbnZhc1dpZHRoICsgXCJweFwiO1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBfdGhpcy5kaW1lbnNpb25zLmFjdHVhbENlbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmxpbmVIZWlnaHQgPSBfdGhpcy5kaW1lbnNpb25zLmFjdHVhbENlbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXRoaXMuX2RpbWVuc2lvbnNTdHlsZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2RpbWVuc2lvbnNTdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9kaW1lbnNpb25zU3R5bGVFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc3R5bGVzID0gdGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIFJPV19DT05UQUlORVJfQ0xBU1MgKyBcIiBzcGFuIHtcIiArXG4gICAgICAgICAgICBcIiBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XCIgK1xuICAgICAgICAgICAgXCIgaGVpZ2h0OiAxMDAlO1wiICtcbiAgICAgICAgICAgIFwiIHZlcnRpY2FsLWFsaWduOiB0b3A7XCIgK1xuICAgICAgICAgICAgKFwiIHdpZHRoOiBcIiArIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGggKyBcInB4XCIpICtcbiAgICAgICAgICAgIFwifVwiO1xuICAgICAgICB0aGlzLl9kaW1lbnNpb25zU3R5bGVFbGVtZW50LmlubmVySFRNTCA9IHN0eWxlcztcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IHRoaXMuX3Rlcm1pbmFsLl92aWV3cG9ydEVsZW1lbnQuc3R5bGUuaGVpZ2h0O1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LnN0eWxlLndpZHRoID0gdGhpcy5kaW1lbnNpb25zLmNhbnZhc1dpZHRoICsgXCJweFwiO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LnN0eWxlLmhlaWdodCA9IHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHQgKyBcInB4XCI7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuc2V0VGhlbWUgPSBmdW5jdGlvbiAodGhlbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHRoZW1lKSB7XG4gICAgICAgICAgICB0aGlzLmNvbG9yTWFuYWdlci5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl90aGVtZVN0eWxlRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fdGhlbWVTdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl90aGVtZVN0eWxlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0eWxlcyA9IHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBST1dfQ09OVEFJTkVSX0NMQVNTICsgXCIge1wiICtcbiAgICAgICAgICAgIChcIiBjb2xvcjogXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuZm9yZWdyb3VuZC5jc3MgKyBcIjtcIikgK1xuICAgICAgICAgICAgKFwiIGJhY2tncm91bmQtY29sb3I6IFwiICsgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmJhY2tncm91bmQuY3NzICsgXCI7XCIpICtcbiAgICAgICAgICAgIChcIiBmb250LWZhbWlseTogXCIgKyB0aGlzLl90ZXJtaW5hbC5nZXRPcHRpb24oJ2ZvbnRGYW1pbHknKSArIFwiO1wiKSArXG4gICAgICAgICAgICAoXCIgZm9udC1zaXplOiBcIiArIHRoaXMuX3Rlcm1pbmFsLmdldE9wdGlvbignZm9udFNpemUnKSArIFwicHg7XCIpICtcbiAgICAgICAgICAgIFwifVwiO1xuICAgICAgICBzdHlsZXMgKz1cbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiBzcGFuOm5vdCguXCIgKyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5CT0xEX0NMQVNTICsgXCIpIHtcIiArXG4gICAgICAgICAgICAgICAgKFwiIGZvbnQtd2VpZ2h0OiBcIiArIHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuZm9udFdlaWdodCArIFwiO1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgc3Bhbi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkJPTERfQ0xBU1MgKyBcIiB7XCIpICtcbiAgICAgICAgICAgICAgICAoXCIgZm9udC13ZWlnaHQ6IFwiICsgdGhpcy5fdGVybWluYWwub3B0aW9ucy5mb250V2VpZ2h0Qm9sZCArIFwiO1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgc3Bhbi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLklUQUxJQ19DTEFTUyArIFwiIHtcIikgK1xuICAgICAgICAgICAgICAgIFwiIGZvbnQtc3R5bGU6IGl0YWxpYztcIiArXG4gICAgICAgICAgICAgICAgXCJ9XCI7XG4gICAgICAgIHN0eWxlcyArPVxuICAgICAgICAgICAgdGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIFJPV19DT05UQUlORVJfQ0xBU1MgKyBcIjpub3QoLlwiICsgRk9DVVNfQ0xBU1MgKyBcIikgLlwiICsgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuQ1VSU09SX0NMQVNTICsgXCIge1wiICtcbiAgICAgICAgICAgICAgICAoXCIgb3V0bGluZTogMXB4IHNvbGlkIFwiICsgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmN1cnNvci5jc3MgKyBcIjtcIikgK1xuICAgICAgICAgICAgICAgIFwiIG91dGxpbmUtb2Zmc2V0OiAtMXB4O1wiICtcbiAgICAgICAgICAgICAgICBcIn1cIiArXG4gICAgICAgICAgICAgICAgKHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBST1dfQ09OVEFJTkVSX0NMQVNTICsgXCIuXCIgKyBGT0NVU19DTEFTUyArIFwiIC5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkNVUlNPUl9DTEFTUyArIFwiLlwiICsgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuQ1VSU09SX1NUWUxFX0JMT0NLX0NMQVNTICsgXCIge1wiKSArXG4gICAgICAgICAgICAgICAgKFwiIGJhY2tncm91bmQtY29sb3I6IFwiICsgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmN1cnNvci5jc3MgKyBcIjtcIikgK1xuICAgICAgICAgICAgICAgIChcIiBjb2xvcjogXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuY3Vyc29yQWNjZW50LmNzcyArIFwiO1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgUk9XX0NPTlRBSU5FUl9DTEFTUyArIFwiLlwiICsgRk9DVVNfQ0xBU1MgKyBcIiAuXCIgKyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5DVVJTT1JfQ0xBU1MgKyBcIi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkNVUlNPUl9TVFlMRV9CQVJfQ0xBU1MgKyBcIiB7XCIpICtcbiAgICAgICAgICAgICAgICAoXCIgYm94LXNoYWRvdzogMXB4IDAgMCBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5jdXJzb3IuY3NzICsgXCIgaW5zZXQ7XCIpICtcbiAgICAgICAgICAgICAgICBcIn1cIiArXG4gICAgICAgICAgICAgICAgKHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBST1dfQ09OVEFJTkVSX0NMQVNTICsgXCIuXCIgKyBGT0NVU19DTEFTUyArIFwiIC5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkNVUlNPUl9DTEFTUyArIFwiLlwiICsgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuQ1VSU09SX1NUWUxFX1VOREVSTElORV9DTEFTUyArIFwiIHtcIikgK1xuICAgICAgICAgICAgICAgIChcIiBib3gtc2hhZG93OiAwIC0xcHggMCBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5jdXJzb3IuY3NzICsgXCIgaW5zZXQ7XCIpICtcbiAgICAgICAgICAgICAgICBcIn1cIjtcbiAgICAgICAgc3R5bGVzICs9XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgU0VMRUNUSU9OX0NMQVNTICsgXCIge1wiICtcbiAgICAgICAgICAgICAgICBcIiBwb3NpdGlvbjogYWJzb2x1dGU7XCIgK1xuICAgICAgICAgICAgICAgIFwiIHRvcDogMDtcIiArXG4gICAgICAgICAgICAgICAgXCIgbGVmdDogMDtcIiArXG4gICAgICAgICAgICAgICAgXCIgei1pbmRleDogMTtcIiArXG4gICAgICAgICAgICAgICAgXCIgcG9pbnRlci1ldmVudHM6IG5vbmU7XCIgK1xuICAgICAgICAgICAgICAgIFwifVwiICtcbiAgICAgICAgICAgICAgICAodGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIFNFTEVDVElPTl9DTEFTUyArIFwiIGRpdiB7XCIpICtcbiAgICAgICAgICAgICAgICBcIiBwb3NpdGlvbjogYWJzb2x1dGU7XCIgK1xuICAgICAgICAgICAgICAgIChcIiBiYWNrZ3JvdW5kLWNvbG9yOiBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5zZWxlY3Rpb24uY3NzICsgXCI7XCIpICtcbiAgICAgICAgICAgICAgICBcIn1cIjtcbiAgICAgICAgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmFuc2kuZm9yRWFjaChmdW5jdGlvbiAoYywgaSkge1xuICAgICAgICAgICAgc3R5bGVzICs9XG4gICAgICAgICAgICAgICAgX3RoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBGR19DTEFTU19QUkVGSVggKyBpICsgXCIgeyBjb2xvcjogXCIgKyBjLmNzcyArIFwiOyB9XCIgK1xuICAgICAgICAgICAgICAgICAgICAoX3RoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBCR19DTEFTU19QUkVGSVggKyBpICsgXCIgeyBiYWNrZ3JvdW5kLWNvbG9yOiBcIiArIGMuY3NzICsgXCI7IH1cIik7XG4gICAgICAgIH0pO1xuICAgICAgICBzdHlsZXMgKz1cbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBGR19DTEFTU19QUkVGSVggKyBUeXBlc18xLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IgKyBcIiB7IGNvbG9yOiBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5iYWNrZ3JvdW5kLmNzcyArIFwiOyB9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgQkdfQ0xBU1NfUFJFRklYICsgVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SICsgXCIgeyBiYWNrZ3JvdW5kLWNvbG9yOiBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5mb3JlZ3JvdW5kLmNzcyArIFwiOyB9XCIpO1xuICAgICAgICB0aGlzLl90aGVtZVN0eWxlRWxlbWVudC5pbm5lckhUTUwgPSBzdHlsZXM7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnM7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25XaW5kb3dSZXNpemUgPSBmdW5jdGlvbiAoZGV2aWNlUGl4ZWxSYXRpbykge1xuICAgICAgICB0aGlzLl91cGRhdGVEaW1lbnNpb25zKCk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX3JlZnJlc2hSb3dFbGVtZW50cyA9IGZ1bmN0aW9uIChjb2xzLCByb3dzKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGg7IGkgPD0gcm93czsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0aGlzLl9yb3dDb250YWluZXIuYXBwZW5kQ2hpbGQocm93KTtcbiAgICAgICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzLnB1c2gocm93KTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAodGhpcy5fcm93RWxlbWVudHMubGVuZ3RoID4gcm93cykge1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuX3Jvd0VsZW1lbnRzLnBvcCgpKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24gKGNvbHMsIHJvd3MpIHtcbiAgICAgICAgdGhpcy5fcmVmcmVzaFJvd0VsZW1lbnRzKGNvbHMsIHJvd3MpO1xuICAgICAgICB0aGlzLl91cGRhdGVEaW1lbnNpb25zKCk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25DaGFyU2l6ZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURpbWVuc2lvbnMoKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5vbkJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Jvd0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKEZPQ1VTX0NMQVNTKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5vbkZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yb3dDb250YWluZXIuY2xhc3NMaXN0LmFkZChGT0NVU19DTEFTUyk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25TZWxlY3Rpb25DaGFuZ2VkID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLl9zZWxlY3Rpb25Db250YWluZXIuY2hpbGRyZW5bMF0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB2aWV3cG9ydFN0YXJ0Um93ID0gc3RhcnRbMV0gLSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3A7XG4gICAgICAgIHZhciB2aWV3cG9ydEVuZFJvdyA9IGVuZFsxXSAtIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgdmFyIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPSBNYXRoLm1heCh2aWV3cG9ydFN0YXJ0Um93LCAwKTtcbiAgICAgICAgdmFyIHZpZXdwb3J0Q2FwcGVkRW5kUm93ID0gTWF0aC5taW4odmlld3BvcnRFbmRSb3csIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICAgICAgaWYgKHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPj0gdGhpcy5fdGVybWluYWwucm93cyB8fCB2aWV3cG9ydENhcHBlZEVuZFJvdyA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZG9jdW1lbnRGcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgaWYgKGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZFN0YXJ0Um93LCBzdGFydFswXSwgZW5kWzBdLCB2aWV3cG9ydENhcHBlZEVuZFJvdyAtIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgKyAxKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgc3RhcnRDb2wgPSB2aWV3cG9ydFN0YXJ0Um93ID09PSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93ID8gc3RhcnRbMF0gOiAwO1xuICAgICAgICAgICAgdmFyIGVuZENvbCA9IHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPT09IHZpZXdwb3J0Q2FwcGVkRW5kUm93ID8gZW5kWzBdIDogdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZFN0YXJ0Um93LCBzdGFydENvbCwgZW5kQ29sKSk7XG4gICAgICAgICAgICB2YXIgbWlkZGxlUm93c0NvdW50ID0gdmlld3BvcnRDYXBwZWRFbmRSb3cgLSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93IC0gMTtcbiAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZFN0YXJ0Um93ICsgMSwgMCwgdGhpcy5fdGVybWluYWwuY29scywgbWlkZGxlUm93c0NvdW50KSk7XG4gICAgICAgICAgICBpZiAodmlld3BvcnRDYXBwZWRTdGFydFJvdyAhPT0gdmlld3BvcnRDYXBwZWRFbmRSb3cpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW5kQ29sXzEgPSB2aWV3cG9ydEVuZFJvdyA9PT0gdmlld3BvcnRDYXBwZWRFbmRSb3cgPyBlbmRbMF0gOiB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZEVuZFJvdywgMCwgZW5kQ29sXzEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zZWxlY3Rpb25Db250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnRGcmFnbWVudCk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX2NyZWF0ZVNlbGVjdGlvbkVsZW1lbnQgPSBmdW5jdGlvbiAocm93LCBjb2xTdGFydCwgY29sRW5kLCByb3dDb3VudCkge1xuICAgICAgICBpZiAocm93Q291bnQgPT09IHZvaWQgMCkgeyByb3dDb3VudCA9IDE7IH1cbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSByb3dDb3VudCAqIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IHJvdyAqIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSBjb2xTdGFydCAqIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGggKyBcInB4XCI7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoICogKGNvbEVuZCAtIGNvbFN0YXJ0KSArIFwicHhcIjtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25DdXJzb3JNb3ZlID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURpbWVuc2lvbnMoKTtcbiAgICAgICAgdGhpcy5zZXRUaGVtZSh1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5yZWZyZXNoKDAsIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fcm93RWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5pbm5lckhUTUwgPSAnJzsgfSk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUucmVmcmVzaFJvd3MgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB0aGlzLl9yZW5kZXJEZWJvdW5jZXIucmVmcmVzaChzdGFydCwgZW5kKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5fcmVuZGVyUm93cyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHZhciB0ZXJtaW5hbCA9IHRoaXMuX3Rlcm1pbmFsO1xuICAgICAgICB2YXIgY3Vyc29yQWJzb2x1dGVZID0gdGVybWluYWwuYnVmZmVyLnliYXNlICsgdGVybWluYWwuYnVmZmVyLnk7XG4gICAgICAgIHZhciBjdXJzb3JYID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLng7XG4gICAgICAgIGZvciAodmFyIHkgPSBzdGFydDsgeSA8PSBlbmQ7IHkrKykge1xuICAgICAgICAgICAgdmFyIHJvd0VsZW1lbnQgPSB0aGlzLl9yb3dFbGVtZW50c1t5XTtcbiAgICAgICAgICAgIHJvd0VsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICB2YXIgcm93ID0geSArIHRlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgICAgIHZhciBsaW5lRGF0YSA9IHRlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQocm93KTtcbiAgICAgICAgICAgIHZhciBjdXJzb3JTdHlsZSA9IHRlcm1pbmFsLm9wdGlvbnMuY3Vyc29yU3R5bGU7XG4gICAgICAgICAgICByb3dFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX3Jvd0ZhY3RvcnkuY3JlYXRlUm93KGxpbmVEYXRhLCByb3cgPT09IGN1cnNvckFic29sdXRlWSwgY3Vyc29yU3R5bGUsIGN1cnNvclgsIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGgsIHRlcm1pbmFsLmNvbHMpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbWl0KCdyZWZyZXNoJywgeyBzdGFydDogc3RhcnQsIGVuZDogZW5kIH0pO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KERvbVJlbmRlcmVyLnByb3RvdHlwZSwgXCJfdGVybWluYWxTZWxlY3RvclwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiLlwiICsgVEVSTUlOQUxfQ0xBU1NfUFJFRklYICsgdGhpcy5fdGVybWluYWxDbGFzcztcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHsgcmV0dXJuIC0xOyB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGpvaW5lcklkKSB7IHJldHVybiBmYWxzZTsgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX29uTGlua0hvdmVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy5fc2V0Q2VsbFVuZGVybGluZShlLngxLCBlLngyLCBlLnkxLCBlLnkyLCBlLmNvbHMsIHRydWUpO1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLl9vbkxpbmtMZWF2ZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuX3NldENlbGxVbmRlcmxpbmUoZS54MSwgZS54MiwgZS55MSwgZS55MiwgZS5jb2xzLCBmYWxzZSk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX3NldENlbGxVbmRlcmxpbmUgPSBmdW5jdGlvbiAoeCwgeDIsIHksIHkyLCBjb2xzLCBlbmFibGVkKSB7XG4gICAgICAgIHdoaWxlICh4ICE9PSB4MiB8fCB5ICE9PSB5Mikge1xuICAgICAgICAgICAgdmFyIHJvdyA9IHRoaXMuX3Jvd0VsZW1lbnRzW3ldO1xuICAgICAgICAgICAgaWYgKCFyb3cpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc3BhbiA9IHJvdy5jaGlsZHJlblt4XTtcbiAgICAgICAgICAgIHNwYW4uc3R5bGUudGV4dERlY29yYXRpb24gPSBlbmFibGVkID8gJ3VuZGVybGluZScgOiAnbm9uZSc7XG4gICAgICAgICAgICB4ID0gKHggKyAxKSAlIGNvbHM7XG4gICAgICAgICAgICBpZiAoeCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHkrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIERvbVJlbmRlcmVyO1xufShFdmVudEVtaXR0ZXJfMS5FdmVudEVtaXR0ZXIpKTtcbmV4cG9ydHMuRG9tUmVuZGVyZXIgPSBEb21SZW5kZXJlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPURvbVJlbmRlcmVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJ1ZmZlcl8xID0gcmVxdWlyZShcIi4uLy4uL0J1ZmZlclwiKTtcbnZhciBUeXBlc18xID0gcmVxdWlyZShcIi4uL2F0bGFzL1R5cGVzXCIpO1xuZXhwb3J0cy5CT0xEX0NMQVNTID0gJ3h0ZXJtLWJvbGQnO1xuZXhwb3J0cy5JVEFMSUNfQ0xBU1MgPSAneHRlcm0taXRhbGljJztcbmV4cG9ydHMuQ1VSU09SX0NMQVNTID0gJ3h0ZXJtLWN1cnNvcic7XG5leHBvcnRzLkNVUlNPUl9TVFlMRV9CTE9DS19DTEFTUyA9ICd4dGVybS1jdXJzb3ItYmxvY2snO1xuZXhwb3J0cy5DVVJTT1JfU1RZTEVfQkFSX0NMQVNTID0gJ3h0ZXJtLWN1cnNvci1iYXInO1xuZXhwb3J0cy5DVVJTT1JfU1RZTEVfVU5ERVJMSU5FX0NMQVNTID0gJ3h0ZXJtLWN1cnNvci11bmRlcmxpbmUnO1xudmFyIERvbVJlbmRlcmVyUm93RmFjdG9yeSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRG9tUmVuZGVyZXJSb3dGYWN0b3J5KF9kb2N1bWVudCkge1xuICAgICAgICB0aGlzLl9kb2N1bWVudCA9IF9kb2N1bWVudDtcbiAgICB9XG4gICAgRG9tUmVuZGVyZXJSb3dGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVSb3cgPSBmdW5jdGlvbiAobGluZURhdGEsIGlzQ3Vyc29yUm93LCBjdXJzb3JTdHlsZSwgY3Vyc29yWCwgY2VsbFdpZHRoLCBjb2xzKSB7XG4gICAgICAgIHZhciBmcmFnbWVudCA9IHRoaXMuX2RvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgdmFyIGxpbmVMZW5ndGggPSAwO1xuICAgICAgICBmb3IgKHZhciB4ID0gTWF0aC5taW4obGluZURhdGEubGVuZ3RoLCBjb2xzKSAtIDE7IHggPj0gMDsgeC0tKSB7XG4gICAgICAgICAgICB2YXIgY2hhckRhdGEgPSBsaW5lRGF0YS5nZXQoeCk7XG4gICAgICAgICAgICB2YXIgY29kZSA9IGNoYXJEYXRhW0J1ZmZlcl8xLkNIQVJfREFUQV9DT0RFX0lOREVYXTtcbiAgICAgICAgICAgIGlmIChjb2RlICE9PSBCdWZmZXJfMS5OVUxMX0NFTExfQ09ERSB8fCAoaXNDdXJzb3JSb3cgJiYgeCA9PT0gY3Vyc29yWCkpIHtcbiAgICAgICAgICAgICAgICBsaW5lTGVuZ3RoID0geCArIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBsaW5lTGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIHZhciBjaGFyRGF0YSA9IGxpbmVEYXRhLmdldCh4KTtcbiAgICAgICAgICAgIHZhciBjaGFyID0gY2hhckRhdGFbQnVmZmVyXzEuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdO1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfQVRUUl9JTkRFWF07XG4gICAgICAgICAgICB2YXIgd2lkdGggPSBjaGFyRGF0YVtCdWZmZXJfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdO1xuICAgICAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY2hhckVsZW1lbnQgPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgICAgICBpZiAod2lkdGggPiAxKSB7XG4gICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuc3R5bGUud2lkdGggPSBjZWxsV2lkdGggKiB3aWR0aCArIFwicHhcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmbGFncyA9IGF0dHIgPj4gMTg7XG4gICAgICAgICAgICB2YXIgYmcgPSBhdHRyICYgMHgxZmY7XG4gICAgICAgICAgICB2YXIgZmcgPSAoYXR0ciA+PiA5KSAmIDB4MWZmO1xuICAgICAgICAgICAgaWYgKGlzQ3Vyc29yUm93ICYmIHggPT09IGN1cnNvclgpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuQ1VSU09SX0NMQVNTKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGN1cnNvclN0eWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jhcic6XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuQ1VSU09SX1NUWUxFX0JBUl9DTEFTUyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndW5kZXJsaW5lJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoZXhwb3J0cy5DVVJTT1JfU1RZTEVfVU5ERVJMSU5FX0NMQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuY2xhc3NMaXN0LmFkZChleHBvcnRzLkNVUlNPUl9TVFlMRV9CTE9DS19DTEFTUyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmxhZ3MgJiA4KSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBiZztcbiAgICAgICAgICAgICAgICBiZyA9IGZnO1xuICAgICAgICAgICAgICAgIGZnID0gdGVtcDtcbiAgICAgICAgICAgICAgICBpZiAoZmcgPT09IFR5cGVzXzEuREVGQVVMVF9DT0xPUikge1xuICAgICAgICAgICAgICAgICAgICBmZyA9IFR5cGVzXzEuSU5WRVJURURfREVGQVVMVF9DT0xPUjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGJnID09PSBUeXBlc18xLkRFRkFVTFRfQ09MT1IpIHtcbiAgICAgICAgICAgICAgICAgICAgYmcgPSBUeXBlc18xLklOVkVSVEVEX0RFRkFVTFRfQ09MT1I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZsYWdzICYgMSkge1xuICAgICAgICAgICAgICAgIGlmIChmZyA8IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgZmcgKz0gODtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuY2xhc3NMaXN0LmFkZChleHBvcnRzLkJPTERfQ0xBU1MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZsYWdzICYgNjQpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuSVRBTElDX0NMQVNTKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNoYXJFbGVtZW50LnRleHRDb250ZW50ID0gY2hhcjtcbiAgICAgICAgICAgIGlmIChmZyAhPT0gVHlwZXNfMS5ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInh0ZXJtLWZnLVwiICsgZmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJnICE9PSBUeXBlc18xLkRFRkFVTFRfQ09MT1IpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwieHRlcm0tYmctXCIgKyBiZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChjaGFyRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgIH07XG4gICAgcmV0dXJuIERvbVJlbmRlcmVyUm93RmFjdG9yeTtcbn0oKSk7XG5leHBvcnRzLkRvbVJlbmRlcmVyUm93RmFjdG9yeSA9IERvbVJlbmRlcmVyUm93RmFjdG9yeTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPURvbVJlbmRlcmVyUm93RmFjdG9yeS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXZlbnRFbWl0dGVyXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL0V2ZW50RW1pdHRlclwiKTtcbnZhciBDaGFyTWVhc3VyZSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKENoYXJNZWFzdXJlLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIENoYXJNZWFzdXJlKGRvY3VtZW50LCBwYXJlbnRFbGVtZW50KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9kb2N1bWVudCA9IGRvY3VtZW50O1xuICAgICAgICBfdGhpcy5fcGFyZW50RWxlbWVudCA9IHBhcmVudEVsZW1lbnQ7XG4gICAgICAgIF90aGlzLl9tZWFzdXJlRWxlbWVudCA9IF90aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIF90aGlzLl9tZWFzdXJlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCd4dGVybS1jaGFyLW1lYXN1cmUtZWxlbWVudCcpO1xuICAgICAgICBfdGhpcy5fbWVhc3VyZUVsZW1lbnQudGV4dENvbnRlbnQgPSAnVyc7XG4gICAgICAgIF90aGlzLl9tZWFzdXJlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAgICAgX3RoaXMuX3BhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoX3RoaXMuX21lYXN1cmVFbGVtZW50KTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2hhck1lYXN1cmUucHJvdG90eXBlLCBcIndpZHRoXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGg7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGFyTWVhc3VyZS5wcm90b3R5cGUsIFwiaGVpZ2h0XCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0O1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBDaGFyTWVhc3VyZS5wcm90b3R5cGUubWVhc3VyZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX21lYXN1cmVFbGVtZW50LnN0eWxlLmZvbnRGYW1pbHkgPSBvcHRpb25zLmZvbnRGYW1pbHk7XG4gICAgICAgIHRoaXMuX21lYXN1cmVFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gb3B0aW9ucy5mb250U2l6ZSArIFwicHhcIjtcbiAgICAgICAgdmFyIGdlb21ldHJ5ID0gdGhpcy5fbWVhc3VyZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGlmIChnZW9tZXRyeS53aWR0aCA9PT0gMCB8fCBnZW9tZXRyeS5oZWlnaHQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fd2lkdGggIT09IGdlb21ldHJ5LndpZHRoIHx8IHRoaXMuX2hlaWdodCAhPT0gZ2VvbWV0cnkuaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLl93aWR0aCA9IGdlb21ldHJ5LndpZHRoO1xuICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gTWF0aC5jZWlsKGdlb21ldHJ5LmhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2NoYXJzaXplY2hhbmdlZCcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gQ2hhck1lYXN1cmU7XG59KEV2ZW50RW1pdHRlcl8xLkV2ZW50RW1pdHRlcikpO1xuZXhwb3J0cy5DaGFyTWVhc3VyZSA9IENoYXJNZWFzdXJlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhck1lYXN1cmUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5mdW5jdGlvbiBwcmVwYXJlVGV4dEZvclRlcm1pbmFsKHRleHQpIHtcbiAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHI/XFxuL2csICdcXHInKTtcbn1cbmV4cG9ydHMucHJlcGFyZVRleHRGb3JUZXJtaW5hbCA9IHByZXBhcmVUZXh0Rm9yVGVybWluYWw7XG5mdW5jdGlvbiBicmFja2V0VGV4dEZvclBhc3RlKHRleHQsIGJyYWNrZXRlZFBhc3RlTW9kZSkge1xuICAgIGlmIChicmFja2V0ZWRQYXN0ZU1vZGUpIHtcbiAgICAgICAgcmV0dXJuICdcXHgxYlsyMDB+JyArIHRleHQgKyAnXFx4MWJbMjAxfic7XG4gICAgfVxuICAgIHJldHVybiB0ZXh0O1xufVxuZXhwb3J0cy5icmFja2V0VGV4dEZvclBhc3RlID0gYnJhY2tldFRleHRGb3JQYXN0ZTtcbmZ1bmN0aW9uIGNvcHlIYW5kbGVyKGV2LCB0ZXJtLCBzZWxlY3Rpb25NYW5hZ2VyKSB7XG4gICAgaWYgKHRlcm0uYnJvd3Nlci5pc01TSUUpIHtcbiAgICAgICAgd2luZG93LmNsaXBib2FyZERhdGEuc2V0RGF0YSgnVGV4dCcsIHNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uVGV4dCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBldi5jbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCBzZWxlY3Rpb25NYW5hZ2VyLnNlbGVjdGlvblRleHQpO1xuICAgIH1cbiAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xufVxuZXhwb3J0cy5jb3B5SGFuZGxlciA9IGNvcHlIYW5kbGVyO1xuZnVuY3Rpb24gcGFzdGVIYW5kbGVyKGV2LCB0ZXJtKSB7XG4gICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdmFyIHRleHQ7XG4gICAgdmFyIGRpc3BhdGNoUGFzdGUgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICB0ZXh0ID0gcHJlcGFyZVRleHRGb3JUZXJtaW5hbCh0ZXh0KTtcbiAgICAgICAgdGV4dCA9IGJyYWNrZXRUZXh0Rm9yUGFzdGUodGV4dCwgdGVybS5icmFja2V0ZWRQYXN0ZU1vZGUpO1xuICAgICAgICB0ZXJtLmhhbmRsZXIodGV4dCk7XG4gICAgICAgIHRlcm0udGV4dGFyZWEudmFsdWUgPSAnJztcbiAgICAgICAgdGVybS5lbWl0KCdwYXN0ZScsIHRleHQpO1xuICAgICAgICB0ZXJtLmNhbmNlbChldik7XG4gICAgfTtcbiAgICBpZiAodGVybS5icm93c2VyLmlzTVNJRSkge1xuICAgICAgICBpZiAod2luZG93LmNsaXBib2FyZERhdGEpIHtcbiAgICAgICAgICAgIHRleHQgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XG4gICAgICAgICAgICBkaXNwYXRjaFBhc3RlKHRleHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoZXYuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgdGV4dCA9IGV2LmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpO1xuICAgICAgICAgICAgZGlzcGF0Y2hQYXN0ZSh0ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMucGFzdGVIYW5kbGVyID0gcGFzdGVIYW5kbGVyO1xuZnVuY3Rpb24gbW92ZVRleHRBcmVhVW5kZXJNb3VzZUN1cnNvcihldiwgdGV4dGFyZWEpIHtcbiAgICB0ZXh0YXJlYS5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgdGV4dGFyZWEuc3R5bGUud2lkdGggPSAnMjBweCc7XG4gICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gJzIwcHgnO1xuICAgIHRleHRhcmVhLnN0eWxlLmxlZnQgPSAoZXYuY2xpZW50WCAtIDEwKSArICdweCc7XG4gICAgdGV4dGFyZWEuc3R5bGUudG9wID0gKGV2LmNsaWVudFkgLSAxMCkgKyAncHgnO1xuICAgIHRleHRhcmVhLnN0eWxlLnpJbmRleCA9ICcxMDAwJztcbiAgICB0ZXh0YXJlYS5mb2N1cygpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB0ZXh0YXJlYS5zdHlsZS5wb3NpdGlvbiA9IG51bGw7XG4gICAgICAgIHRleHRhcmVhLnN0eWxlLndpZHRoID0gbnVsbDtcbiAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gbnVsbDtcbiAgICAgICAgdGV4dGFyZWEuc3R5bGUubGVmdCA9IG51bGw7XG4gICAgICAgIHRleHRhcmVhLnN0eWxlLnRvcCA9IG51bGw7XG4gICAgICAgIHRleHRhcmVhLnN0eWxlLnpJbmRleCA9IG51bGw7XG4gICAgfSwgMjAwKTtcbn1cbmV4cG9ydHMubW92ZVRleHRBcmVhVW5kZXJNb3VzZUN1cnNvciA9IG1vdmVUZXh0QXJlYVVuZGVyTW91c2VDdXJzb3I7XG5mdW5jdGlvbiByaWdodENsaWNrSGFuZGxlcihldiwgdGV4dGFyZWEsIHNlbGVjdGlvbk1hbmFnZXIsIHNob3VsZFNlbGVjdFdvcmQpIHtcbiAgICBtb3ZlVGV4dEFyZWFVbmRlck1vdXNlQ3Vyc29yKGV2LCB0ZXh0YXJlYSk7XG4gICAgaWYgKHNob3VsZFNlbGVjdFdvcmQgJiYgIXNlbGVjdGlvbk1hbmFnZXIuaXNDbGlja0luU2VsZWN0aW9uKGV2KSkge1xuICAgICAgICBzZWxlY3Rpb25NYW5hZ2VyLnNlbGVjdFdvcmRBdEN1cnNvcihldik7XG4gICAgfVxuICAgIHRleHRhcmVhLnZhbHVlID0gc2VsZWN0aW9uTWFuYWdlci5zZWxlY3Rpb25UZXh0O1xuICAgIHRleHRhcmVhLnNlbGVjdCgpO1xufVxuZXhwb3J0cy5yaWdodENsaWNrSGFuZGxlciA9IHJpZ2h0Q2xpY2tIYW5kbGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2xpcGJvYXJkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZnVuY3Rpb24gYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKG5vZGUsIHR5cGUsIGhhbmRsZXIsIHVzZUNhcHR1cmUpIHtcbiAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgdXNlQ2FwdHVyZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIsIHVzZUNhcHR1cmUpO1xuICAgICAgICAgICAgbm9kZSA9IG51bGw7XG4gICAgICAgICAgICBoYW5kbGVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnRzLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lciA9IGFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxpZmVjeWNsZS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTGlmZWN5Y2xlXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL0xpZmVjeWNsZVwiKTtcbnZhciBMaWZlY3ljbGVfMiA9IHJlcXVpcmUoXCIuL0xpZmVjeWNsZVwiKTtcbnZhciBIT1ZFUl9EVVJBVElPTiA9IDUwMDtcbnZhciBNb3VzZVpvbmVNYW5hZ2VyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTW91c2Vab25lTWFuYWdlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNb3VzZVpvbmVNYW5hZ2VyKF90ZXJtaW5hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIF90aGlzLl96b25lcyA9IFtdO1xuICAgICAgICBfdGhpcy5fYXJlWm9uZXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgX3RoaXMuX3Rvb2x0aXBUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2N1cnJlbnRab25lID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2xhc3RIb3ZlckNvb3JkcyA9IFtudWxsLCBudWxsXTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzIuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKF90aGlzLl90ZXJtaW5hbC5lbGVtZW50LCAnbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbk1vdXNlRG93bihlKTsgfSkpO1xuICAgICAgICBfdGhpcy5fbW91c2VNb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX29uTW91c2VNb3ZlKGUpOyB9O1xuICAgICAgICBfdGhpcy5fY2xpY2tMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25DbGljayhlKTsgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fZGVhY3RpdmF0ZSgpO1xuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHpvbmUpIHtcbiAgICAgICAgdGhpcy5fem9uZXMucHVzaCh6b25lKTtcbiAgICAgICAgaWYgKHRoaXMuX3pvbmVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuY2xlYXJBbGwgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICBpZiAodGhpcy5fem9uZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFlbmQpIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgICAgIGVuZCA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fem9uZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB6b25lID0gdGhpcy5fem9uZXNbaV07XG4gICAgICAgICAgICBpZiAoKHpvbmUueTEgPiBzdGFydCAmJiB6b25lLnkxIDw9IGVuZCArIDEpIHx8XG4gICAgICAgICAgICAgICAgKHpvbmUueTIgPiBzdGFydCAmJiB6b25lLnkyIDw9IGVuZCArIDEpIHx8XG4gICAgICAgICAgICAgICAgKHpvbmUueTEgPCBzdGFydCAmJiB6b25lLnkyID4gZW5kICsgMSkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudFpvbmUgJiYgdGhpcy5fY3VycmVudFpvbmUgPT09IHpvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFpvbmUubGVhdmVDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50Wm9uZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3pvbmVzLnNwbGljZShpLS0sIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl96b25lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2RlYWN0aXZhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuX2FjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2FyZVpvbmVzQWN0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9hcmVab25lc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX21vdXNlTW92ZUxpc3RlbmVyKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9jbGlja0xpc3RlbmVyKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuX2RlYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9hcmVab25lc0FjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5fYXJlWm9uZXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fbW91c2VNb3ZlTGlzdGVuZXIpO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2NsaWNrTGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5fb25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAodGhpcy5fbGFzdEhvdmVyQ29vcmRzWzBdICE9PSBlLnBhZ2VYIHx8IHRoaXMuX2xhc3RIb3ZlckNvb3Jkc1sxXSAhPT0gZS5wYWdlWSkge1xuICAgICAgICAgICAgdGhpcy5fb25Ib3ZlcihlKTtcbiAgICAgICAgICAgIHRoaXMuX2xhc3RIb3ZlckNvb3JkcyA9IFtlLnBhZ2VYLCBlLnBhZ2VZXTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuX29uSG92ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgem9uZSA9IHRoaXMuX2ZpbmRab25lRXZlbnRBdChlKTtcbiAgICAgICAgaWYgKHpvbmUgPT09IHRoaXMuX2N1cnJlbnRab25lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRab25lKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Wm9uZS5sZWF2ZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Wm9uZSA9IG51bGw7XG4gICAgICAgICAgICBpZiAodGhpcy5fdG9vbHRpcFRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdG9vbHRpcFRpbWVvdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghem9uZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N1cnJlbnRab25lID0gem9uZTtcbiAgICAgICAgaWYgKHpvbmUuaG92ZXJDYWxsYmFjaykge1xuICAgICAgICAgICAgem9uZS5ob3ZlckNhbGxiYWNrKGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rvb2x0aXBUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fb25Ub29sdGlwKGUpOyB9LCBIT1ZFUl9EVVJBVElPTik7XG4gICAgfTtcbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5fb25Ub29sdGlwID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy5fdG9vbHRpcFRpbWVvdXQgPSBudWxsO1xuICAgICAgICB2YXIgem9uZSA9IHRoaXMuX2ZpbmRab25lRXZlbnRBdChlKTtcbiAgICAgICAgaWYgKHpvbmUgJiYgem9uZS50b29sdGlwQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHpvbmUudG9vbHRpcENhbGxiYWNrKGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5fb25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoIXRoaXMuX2FyZVpvbmVzQWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHpvbmUgPSB0aGlzLl9maW5kWm9uZUV2ZW50QXQoZSk7XG4gICAgICAgIGlmICh6b25lKSB7XG4gICAgICAgICAgICBpZiAoem9uZS53aWxsTGlua0FjdGl2YXRlKGUpKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE1vdXNlWm9uZU1hbmFnZXIucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHpvbmUgPSB0aGlzLl9maW5kWm9uZUV2ZW50QXQoZSk7XG4gICAgICAgIGlmICh6b25lKSB7XG4gICAgICAgICAgICB6b25lLmNsaWNrQ2FsbGJhY2soZSk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5fZmluZFpvbmVFdmVudEF0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGNvb3JkcyA9IHRoaXMuX3Rlcm1pbmFsLm1vdXNlSGVscGVyLmdldENvb3JkcyhlLCB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LCB0aGlzLl90ZXJtaW5hbC5jaGFyTWVhc3VyZSwgdGhpcy5fdGVybWluYWwuY29scywgdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgICAgIGlmICghY29vcmRzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgeCA9IGNvb3Jkc1swXTtcbiAgICAgICAgdmFyIHkgPSBjb29yZHNbMV07XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fem9uZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB6b25lID0gdGhpcy5fem9uZXNbaV07XG4gICAgICAgICAgICBpZiAoem9uZS55MSA9PT0gem9uZS55Mikge1xuICAgICAgICAgICAgICAgIGlmICh5ID09PSB6b25lLnkxICYmIHggPj0gem9uZS54MSAmJiB4IDwgem9uZS54Mikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gem9uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoKHkgPT09IHpvbmUueTEgJiYgeCA+PSB6b25lLngxKSB8fFxuICAgICAgICAgICAgICAgICAgICAoeSA9PT0gem9uZS55MiAmJiB4IDwgem9uZS54MikgfHxcbiAgICAgICAgICAgICAgICAgICAgKHkgPiB6b25lLnkxICYmIHkgPCB6b25lLnkyKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gem9uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgICByZXR1cm4gTW91c2Vab25lTWFuYWdlcjtcbn0oTGlmZWN5Y2xlXzEuRGlzcG9zYWJsZSkpO1xuZXhwb3J0cy5Nb3VzZVpvbmVNYW5hZ2VyID0gTW91c2Vab25lTWFuYWdlcjtcbnZhciBNb3VzZVpvbmUgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1vdXNlWm9uZSh4MSwgeTEsIHgyLCB5MiwgY2xpY2tDYWxsYmFjaywgaG92ZXJDYWxsYmFjaywgdG9vbHRpcENhbGxiYWNrLCBsZWF2ZUNhbGxiYWNrLCB3aWxsTGlua0FjdGl2YXRlKSB7XG4gICAgICAgIHRoaXMueDEgPSB4MTtcbiAgICAgICAgdGhpcy55MSA9IHkxO1xuICAgICAgICB0aGlzLngyID0geDI7XG4gICAgICAgIHRoaXMueTIgPSB5MjtcbiAgICAgICAgdGhpcy5jbGlja0NhbGxiYWNrID0gY2xpY2tDYWxsYmFjaztcbiAgICAgICAgdGhpcy5ob3ZlckNhbGxiYWNrID0gaG92ZXJDYWxsYmFjaztcbiAgICAgICAgdGhpcy50b29sdGlwQ2FsbGJhY2sgPSB0b29sdGlwQ2FsbGJhY2s7XG4gICAgICAgIHRoaXMubGVhdmVDYWxsYmFjayA9IGxlYXZlQ2FsbGJhY2s7XG4gICAgICAgIHRoaXMud2lsbExpbmtBY3RpdmF0ZSA9IHdpbGxMaW5rQWN0aXZhdGU7XG4gICAgfVxuICAgIHJldHVybiBNb3VzZVpvbmU7XG59KCkpO1xuZXhwb3J0cy5Nb3VzZVpvbmUgPSBNb3VzZVpvbmU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Nb3VzZVpvbmVNYW5hZ2VyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFJlbmRlckRlYm91bmNlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUmVuZGVyRGVib3VuY2VyKF90ZXJtaW5hbCwgX2NhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9jYWxsYmFjayA9IF9jYWxsYmFjaztcbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgIH1cbiAgICBSZW5kZXJEZWJvdW5jZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2FuaW1hdGlvbkZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgUmVuZGVyRGVib3VuY2VyLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKHJvd1N0YXJ0LCByb3dFbmQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcm93U3RhcnQgPSByb3dTdGFydCAhPT0gbnVsbCAmJiByb3dTdGFydCAhPT0gdW5kZWZpbmVkID8gcm93U3RhcnQgOiAwO1xuICAgICAgICByb3dFbmQgPSByb3dFbmQgIT09IG51bGwgJiYgcm93RW5kICE9PSB1bmRlZmluZWQgPyByb3dFbmQgOiB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTtcbiAgICAgICAgdmFyIGlzUm93U3RhcnRTZXQgPSB0aGlzLl9yb3dTdGFydCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuX3Jvd1N0YXJ0ICE9PSBudWxsO1xuICAgICAgICB2YXIgaXNSb3dFbmRTZXQgPSB0aGlzLl9yb3dFbmQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9yb3dFbmQgIT09IG51bGw7XG4gICAgICAgIHRoaXMuX3Jvd1N0YXJ0ID0gaXNSb3dTdGFydFNldCA/IE1hdGgubWluKHRoaXMuX3Jvd1N0YXJ0LCByb3dTdGFydCkgOiByb3dTdGFydDtcbiAgICAgICAgdGhpcy5fcm93RW5kID0gaXNSb3dFbmRTZXQgPyBNYXRoLm1heCh0aGlzLl9yb3dFbmQsIHJvd0VuZCkgOiByb3dFbmQ7XG4gICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5faW5uZXJSZWZyZXNoKCk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyRGVib3VuY2VyLnByb3RvdHlwZS5faW5uZXJSZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yb3dTdGFydCA9IE1hdGgubWF4KHRoaXMuX3Jvd1N0YXJ0LCAwKTtcbiAgICAgICAgdGhpcy5fcm93RW5kID0gTWF0aC5taW4odGhpcy5fcm93RW5kLCB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSk7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrKHRoaXMuX3Jvd1N0YXJ0LCB0aGlzLl9yb3dFbmQpO1xuICAgICAgICB0aGlzLl9yb3dTdGFydCA9IG51bGw7XG4gICAgICAgIHRoaXMuX3Jvd0VuZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBSZW5kZXJEZWJvdW5jZXI7XG59KCkpO1xuZXhwb3J0cy5SZW5kZXJEZWJvdW5jZXIgPSBSZW5kZXJEZWJvdW5jZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1SZW5kZXJEZWJvdW5jZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIExpZmVjeWNsZV8xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9MaWZlY3ljbGVcIik7XG52YXIgU2NyZWVuRHByTW9uaXRvciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFNjcmVlbkRwck1vbml0b3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU2NyZWVuRHByTW9uaXRvcigpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICBTY3JlZW5EcHJNb25pdG9yLnByb3RvdHlwZS5zZXRMaXN0ZW5lciA9IGZ1bmN0aW9uIChsaXN0ZW5lcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5fbGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJMaXN0ZW5lcigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xpc3RlbmVyID0gbGlzdGVuZXI7XG4gICAgICAgIHRoaXMuX291dGVyTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fbGlzdGVuZXIod2luZG93LmRldmljZVBpeGVsUmF0aW8sIF90aGlzLl9jdXJyZW50RGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgICAgICBfdGhpcy5fdXBkYXRlRHByKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3VwZGF0ZURwcigpO1xuICAgIH07XG4gICAgU2NyZWVuRHByTW9uaXRvci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuY2xlYXJMaXN0ZW5lcigpO1xuICAgIH07XG4gICAgU2NyZWVuRHByTW9uaXRvci5wcm90b3R5cGUuX3VwZGF0ZURwciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3Jlc29sdXRpb25NZWRpYU1hdGNoTGlzdCkge1xuICAgICAgICAgICAgdGhpcy5fcmVzb2x1dGlvbk1lZGlhTWF0Y2hMaXN0LnJlbW92ZUxpc3RlbmVyKHRoaXMuX291dGVyTGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N1cnJlbnREZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW87XG4gICAgICAgIHRoaXMuX3Jlc29sdXRpb25NZWRpYU1hdGNoTGlzdCA9IHdpbmRvdy5tYXRjaE1lZGlhKFwic2NyZWVuIGFuZCAocmVzb2x1dGlvbjogXCIgKyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyArIFwiZHBweClcIik7XG4gICAgICAgIHRoaXMuX3Jlc29sdXRpb25NZWRpYU1hdGNoTGlzdC5hZGRMaXN0ZW5lcih0aGlzLl9vdXRlckxpc3RlbmVyKTtcbiAgICB9O1xuICAgIFNjcmVlbkRwck1vbml0b3IucHJvdG90eXBlLmNsZWFyTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fbGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZXNvbHV0aW9uTWVkaWFNYXRjaExpc3QucmVtb3ZlTGlzdGVuZXIodGhpcy5fb3V0ZXJMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX2xpc3RlbmVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5fb3V0ZXJMaXN0ZW5lciA9IG51bGw7XG4gICAgfTtcbiAgICByZXR1cm4gU2NyZWVuRHByTW9uaXRvcjtcbn0oTGlmZWN5Y2xlXzEuRGlzcG9zYWJsZSkpO1xuZXhwb3J0cy5TY3JlZW5EcHJNb25pdG9yID0gU2NyZWVuRHByTW9uaXRvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNjcmVlbkRwck1vbml0b3IuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNsb25lID0gZnVuY3Rpb24gKHZhbCwgZGVwdGgpIHtcbiAgICBpZiAoZGVwdGggPT09IHZvaWQgMCkgeyBkZXB0aCA9IDU7IH1cbiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgaWYgKHZhbCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgdmFyIGNsb25lZE9iamVjdCA9IEFycmF5LmlzQXJyYXkodmFsKSA/IFtdIDoge307XG4gICAgZm9yICh2YXIga2V5IGluIHZhbCkge1xuICAgICAgICBjbG9uZWRPYmplY3Rba2V5XSA9IGRlcHRoIDw9IDEgPyB2YWxba2V5XSA6IGV4cG9ydHMuY2xvbmUodmFsW2tleV0sIGRlcHRoIC0gMSk7XG4gICAgfVxuICAgIHJldHVybiBjbG9uZWRPYmplY3Q7XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2xvbmUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTW91c2VIZWxwZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1vdXNlSGVscGVyKF9yZW5kZXJlcikge1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IF9yZW5kZXJlcjtcbiAgICB9XG4gICAgTW91c2VIZWxwZXIucHJvdG90eXBlLnNldFJlbmRlcmVyID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgfTtcbiAgICBNb3VzZUhlbHBlci5nZXRDb29yZHNSZWxhdGl2ZVRvRWxlbWVudCA9IGZ1bmN0aW9uIChldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQucGFnZVggPT09IG51bGwgfHwgZXZlbnQucGFnZVggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG9yaWdpbmFsRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgIHZhciB4ID0gZXZlbnQucGFnZVg7XG4gICAgICAgIHZhciB5ID0gZXZlbnQucGFnZVk7XG4gICAgICAgIHdoaWxlIChlbGVtZW50KSB7XG4gICAgICAgICAgICB4IC09IGVsZW1lbnQub2Zmc2V0TGVmdDtcbiAgICAgICAgICAgIHkgLT0gZWxlbWVudC5vZmZzZXRUb3A7XG4gICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudCA9IG9yaWdpbmFsRWxlbWVudDtcbiAgICAgICAgd2hpbGUgKGVsZW1lbnQgJiYgZWxlbWVudCAhPT0gZWxlbWVudC5vd25lckRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgICAgIHggKz0gZWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgICAgICAgeSArPSBlbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFt4LCB5XTtcbiAgICB9O1xuICAgIE1vdXNlSGVscGVyLnByb3RvdHlwZS5nZXRDb29yZHMgPSBmdW5jdGlvbiAoZXZlbnQsIGVsZW1lbnQsIGNoYXJNZWFzdXJlLCBjb2xDb3VudCwgcm93Q291bnQsIGlzU2VsZWN0aW9uKSB7XG4gICAgICAgIGlmICghY2hhck1lYXN1cmUud2lkdGggfHwgIWNoYXJNZWFzdXJlLmhlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvb3JkcyA9IE1vdXNlSGVscGVyLmdldENvb3Jkc1JlbGF0aXZlVG9FbGVtZW50KGV2ZW50LCBlbGVtZW50KTtcbiAgICAgICAgaWYgKCFjb29yZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvb3Jkc1swXSA9IE1hdGguY2VpbCgoY29vcmRzWzBdICsgKGlzU2VsZWN0aW9uID8gdGhpcy5fcmVuZGVyZXIuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGggLyAyIDogMCkpIC8gdGhpcy5fcmVuZGVyZXIuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGgpO1xuICAgICAgICBjb29yZHNbMV0gPSBNYXRoLmNlaWwoY29vcmRzWzFdIC8gdGhpcy5fcmVuZGVyZXIuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0KTtcbiAgICAgICAgY29vcmRzWzBdID0gTWF0aC5taW4oTWF0aC5tYXgoY29vcmRzWzBdLCAxKSwgY29sQ291bnQgKyAoaXNTZWxlY3Rpb24gPyAxIDogMCkpO1xuICAgICAgICBjb29yZHNbMV0gPSBNYXRoLm1pbihNYXRoLm1heChjb29yZHNbMV0sIDEpLCByb3dDb3VudCk7XG4gICAgICAgIHJldHVybiBjb29yZHM7XG4gICAgfTtcbiAgICBNb3VzZUhlbHBlci5wcm90b3R5cGUuZ2V0UmF3Qnl0ZUNvb3JkcyA9IGZ1bmN0aW9uIChldmVudCwgZWxlbWVudCwgY2hhck1lYXN1cmUsIGNvbENvdW50LCByb3dDb3VudCkge1xuICAgICAgICB2YXIgY29vcmRzID0gdGhpcy5nZXRDb29yZHMoZXZlbnQsIGVsZW1lbnQsIGNoYXJNZWFzdXJlLCBjb2xDb3VudCwgcm93Q291bnQpO1xuICAgICAgICB2YXIgeCA9IGNvb3Jkc1swXTtcbiAgICAgICAgdmFyIHkgPSBjb29yZHNbMV07XG4gICAgICAgIHggKz0gMzI7XG4gICAgICAgIHkgKz0gMzI7XG4gICAgICAgIHJldHVybiB7IHg6IHgsIHk6IHkgfTtcbiAgICB9O1xuICAgIHJldHVybiBNb3VzZUhlbHBlcjtcbn0oKSk7XG5leHBvcnRzLk1vdXNlSGVscGVyID0gTW91c2VIZWxwZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Nb3VzZUhlbHBlci5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9